"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4091"],{59101:function(t,e,r){r.d(e,{Z:()=>i});let i={container:"container-KbMeLj",themed:"themed-EbT4uD",saveButton:"saveButton-bEqkhJ",text:"text-RPsawq",short:"short-ZM5yW_",imageText:"imageText-mhB5o2",backdrop:"backdrop-Xjlnco",imageBackdrop:"imageBackdrop-mwjQFt",tinted:"tinted-Vm3IqP",blurred:"blurred-UbnY7U",tint:"tint-HtqWIV",header:"header-ndGPw6",restack:"restack-YSzWKs",permalink:"permalink-bijGJH",footer:"footer-0EQTsv",swatchesContainer:"swatchesContainer-TDgd_R",swatchContainer:"swatchContainer-IIrOXq",selected:"selected-how610",alignmentSwatchContainer:"alignmentSwatchContainer-_cyt17",swatch:"swatch-otVp71"}},96726:function(t,e,r){r.d(e,{X:()=>s,h:()=>d});var i=r(16584),a=r(6400),l=r(98661),n=r(30396);let o=(0,a.createContext)(null);function s(t){let{root:e,children:r}=t,a=(0,n.sO)(e);return(0,i.BX)(o.Provider,{value:a,children:[r,!e&&(0,i.tZ)("div",{ref:a})]})}function d(t){let{children:e}=t,r=(0,n.qp)(o).current;return r?(0,l.createPortal)(e,r):null}},16564:function(t,e,r){r.d(e,{KH:()=>P,MR:()=>x,YX:()=>A,_g:()=>_,cM:()=>z,ko:()=>N,nO:()=>M});var i,a,l=r(7409),n=r(99282),o=r(58865),s=r(16584),d=r(94184),u=r.n(d),c=r(1852),m=r(86657);r(36081),r(36813);var p=r(99987),g=r(1055),h=r(72708),v=r(95441);r(68833);var w=r(15771),f=r(6490),b=r(84864),y=r(72925);function k(){let t=(0,o._)(["Playback rate ",""]);return k=function(){return t},t}var x=((i={}).Embed="Embed audio",i.Voiceover="Add voiceover",i.Podcast="Audio",i.PodcastPreview="Podcast free version",i.VideoPodcast="Video",i.ShareQuote="Share quote",i),_=((a={})[a.PubAccent=0]="PubAccent",a[a.PubFull=1]="PubFull",a[a.Substack=2]="Substack",a);let N=t=>{let{containerRef:e,currentTime:r,remainingTime:i,progress:a,onMouseDown:l,shouldCollapseOnMobile:n=!1,theme:o=1}=t;return(0,s.BX)("div",{className:"tw-flex tw-grow tw-items-center tw-gap-3 tw-font-meta tw-text-sm tw-text-substack-primary sm:tw-gap-3","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":100*a,children:[(0,s.tZ)("div",{className:u()("tw-min-w-[40px] tw-text-right",{"tw-hidden sm:tw-block":n}),children:r}),(0,s.BX)("div",{ref:e,className:u()("tw-relative tw-h-5 tw-grow ",{"tw-ml-2 sm:tw-ml-0":n}),onMouseDown:l,children:[(0,s.tZ)("div",{className:u()("audio-progress-bar tw-absolute tw-top-2 tw-right-0 tw-left-0 tw-h-1 tw-rounded",{"tw-bg-pub-detail":1===o,"tw-bg-substack-detail":1!==o})}),(0,s.tZ)("div",{className:u()("tw-absolute tw-top-2 tw-left-0 tw-h-1 tw-rounded-l-full",{"tw-bg-pub-accent":2!==o,"tw-bg-substack-accent":2===o}),style:{width:"".concat(100*a,"%")}}),(0,s.tZ)("div",{className:u()("audio-playhead tw-absolute tw-ml-[-10px] tw-h-4 tw-w-4 tw-rounded-full tw-border-2 tw-border-solid ",{"tw-border-pub-background":1===o,"tw-border-substack-bg":1!==o,"tw-bg-substack-accent":2===o,"tw-bg-pub-accent":2!==o}),style:{left:"".concat(100*a,"%")}})]}),(0,s.tZ)("div",{className:"tw-min-w-[40px]",children:i})]})},S=[{value:1,display:"1"},{value:1.25,display:"1.25"},{value:1.5,display:"1.5"},{value:1.75,display:"1.75"},{value:2,display:"2"}],$=t=>{var e;let{onSetPlaybackRate:r,playbackRate:i,className:a}=t,l=S.findIndex(t=>{let{value:e}=t;return e===i}),{iTemplate:n}=(0,v.M1)(),o=(null==S?void 0:null===(e=S[l])||void 0===e?void 0:e.display)?"".concat(null==S?void 0:S[l].display,"x"):"";return(0,s.BX)("div",{onClick:()=>{let t=(l+1)%S.length;r(S[t].value)},className:a,"aria-label":n(k(),o),children:[S[l].display,"\xd7"]})},z=t=>{let{iString:e}=(0,v.M1)();return(0,s.tZ)(m.Z,(0,n._)((0,l._)({},t),{metricsPost:t.post,feature:"Embed audio",render:r=>{let{currentTime:i,isPlaying:a,progress:l,progressBarRef:n,progressBarOnMouseDown:o,remainingTime:d,playbackRate:u,setPlaybackRate:c,togglePlayback:m}=r;return(0,s.BX)("div",{"data-component-name":"AudioEmbedPlayer","data-drag-handle":"",className:"audio-embed tw-my-4 tw-box-border tw-flex tw-w-full tw-select-none tw-items-center tw-gap-4 tw-space-y-0 tw-rounded-full tw-bg-pub-wash tw-p-4 tw-font-sans sm:tw-gap-5",role:"region","aria-label":e("Audio embed player"),children:[(0,s.tZ)($,{onSetPlaybackRate:c,playbackRate:u,className:"audio-button tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[t.label&&(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-text-pub-primary-text",children:t.label}),(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 sm:tw-gap-4",children:(0,s.tZ)(N,{currentTime:i,remainingTime:d,containerRef:n,progress:l,onMouseDown:o})})]}),(0,s.tZ)("div",{className:"audio-embed-play-button tw-relative tw-flex tw-h-12 tw-w-12 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:m,role:"button","aria-label":e("Play/pause"),children:a?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-4 tw-justify-between",children:[(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(g.Z,{className:"tw-relative tw-left-[.1rem] tw-fill-pub-accent",stroke:"none",height:18})})]})}}))},M=t=>{var e;let{pub:r,post:i,duration:a,label:l}=t,{iString:n}=(0,v.M1)();return(0,s.tZ)("table",{"data-component-name":"AudioEmbedPlayerStatic",className:"tw-w-full tw-rounded-full tw-bg-substack-wash",children:(0,s.tZ)("tr",{children:(0,s.tZ)("td",{className:"tw-text-center tw-font-meta tw-text-ssm tw-uppercase tw-text-substack-primary",children:(0,s.BX)("a",{href:null==i?void 0:i.canonical_url,className:u()("tw-block tw-w-full tw-p-4 tw-text-substack-primary",y.Z.noUnderline),children:[(0,s.tZ)(p.Z,{className:"tw-w-max-4 tw-mr-2 tw-inline-block tw-w-4 tw-align-middle",stroke:null===(e=r.theme)||void 0===e?void 0:e.background_pop_color,isStatic:!0}),(0,s.BX)("span",{className:"tw-align-middle",children:[(0,b.truncateText)(l,10)||n("Listen now")," \xb7 ",(0,b.secondsToHHMMSS)(a||0)]})]})})})})},P=t=>{let e=(0,c.useMediaQuery)({maxWidth:631}),r="/api/v1/audio/upload/".concat(t.mediaUploadId,"/src"),{iString:i}=(0,v.M1)();return(0,s.tZ)(m.Z,(0,n._)((0,l._)({},t),{src:r,feature:"Add voiceover",metricsPost:t.post,render:t=>{let{isPaywalled:r,currentTime:a,isPlaying:l,progress:n,progressBarRef:o,progressBarOnMouseDown:d,remainingTime:u,playbackRate:c,setPlaybackRate:m,togglePlayback:p}=t;return(0,s.BX)("div",{className:"tw-mb-6 tw-flex sm:tw-gap-1",children:[(0,s.tZ)("div",{className:"tw-hidden tw-h-20 tw-shrink-0 tw-basis-20 tw-items-center tw-justify-center tw-rounded-md tw-bg-pub-wash tw-fill-pub-primary-text tw-text-pub-primary-text sm:tw-flex",children:(0,s.tZ)(h.Z,{className:"tw-stroke-pub-secondary-text"})}),(0,s.BX)("div",{className:"tw-box-border tw-flex tw-h-20 tw-w-full tw-select-none tw-items-center tw-gap-3 tw-space-y-0 tw-rounded-l-md tw-rounded-r-[64px] tw-bg-pub-wash  tw-p-4 tw-font-sans",children:[r?(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-flex-wrap tw-justify-center tw-text-ssm tw-text-pub-secondary-text sm:tw-text-sm",children:i("Upgrade to paid to play voiceover")}):(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-uppercase tw-text-pub-secondary-text",children:i("Article voiceover")}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 ",children:[(0,s.tZ)($,{onSetPlaybackRate:m,playbackRate:c,className:"tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.tZ)(N,{currentTime:a,remainingTime:u,containerRef:o,progress:n,onMouseDown:d,shouldCollapseOnMobile:!0})]})]}),r?(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-not-allowed tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform",children:(0,s.tZ)(g.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-detail",stroke:"none",height:e?20:24})}):(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid  tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:p,role:"button",children:l?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-5 tw-justify-between",children:[(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(g.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-accent",stroke:"none",height:20})})]})]})}}))},A=t=>{let{isOpen:e,onDismiss:r}=t,{iString:i}=(0,v.M1)();return(0,s.BX)(f.u_,{isOpen:e,onClose:r,children:[(0,s.tZ)(f.xB,{showClose:!1,title:i("Something went wrong...")}),(0,s.tZ)(f.fe,{children:i("Unfortunately, there was a problem with your audio file upload. We'll investigate, but in the meantime, please try again, and we apologize for the inconvenience.")}),(0,s.tZ)(f.mz,{showDivider:!1,direction:"row",primaryButton:(0,s.tZ)(w.zx,{onClick:r,priority:"primary",children:i("Got it")})})]})}},26049:function(t,e,r){r.d(e,{_:()=>a});var i=r(17043);function a(t,e){let{width:r,height:a}=e,o=l.flatMap(e=>n.map(l=>"'".concat((0,i.zF)(t,r*l,{format:e,height:a?a*l:void 0,crop:"fill"}),"' ").concat(l,"x type('image/").concat(e,"')")));return"image-set(".concat(o.join(", "),")")}let l=["avif","jpeg"],n=[1,2,3]},30343:function(t,e,r){r.d(e,{v:()=>s,r:()=>o});var i,a=r(64757),l=((i=l||{})[i.Vibrant=0]="Vibrant",i[i.DarkVibrant=1]="DarkVibrant",i[i.LightVibrant=2]="LightVibrant",i[i.Muted=3]="Muted",i[i.DarkMuted=4]="DarkMuted",i[i.LightMuted=5]="LightMuted",i);let n=Object.keys(l),o={custom:{green:"var(--color-bg-marketing-green)",orange:"var(--color-accent-fg-orange)"},basic:{primary:"var(--color-bg-secondary)"},image:{tintedImageMuted:"cover_image_tinted_muted",tintedImageVibrant:"cover_image_tinted_vibrant",fadedImage:"cover_image_faded",blurredImage:"cover_image_blurred"}};function s(t){let{coverImage:e,palette:r}=t;return a.Hv.filter(t=>t in o.basic||t in o.custom||t in o.image&&!!e||!!n.includes(t)&&!!(null==r?void 0:r[t]))}},64757:function(t,e,r){r.d(e,{Hp:()=>n,Hv:()=>i,a_:()=>l});let i=["DarkMuted","Vibrant","green","orange","primary","blurredImage","fadedImage","tintedImageMuted","tintedImageVibrant"];var a,l=((a={}).Left="left",a.Center="center",a);let n=Object.values(l)},57639:function(t,e,r){r.d(e,{$y:()=>g,MQ:()=>y,N9:()=>f,Nh:()=>v,RK:()=>h});var i=r(7409),a=r(94184),l=r.n(a),n=r(98661),o=r(26445),s=r(98914),d=r(60308),u=r(63651),c=r(19520),m=r(30548);let p=t=>t.attrs.fullscreen?"full":t.attrs.imageSize||"normal",g={attrs:{src:{default:""},srcNoWatermark:{default:null},fullscreen:{default:null},imageSize:{default:null},height:{default:null},width:{default:null},resizeWidth:{default:null},bytes:{default:null},alt:{default:null},title:{default:null},type:{default:null},href:{default:null},belowTheFold:{default:!1},topImage:{default:!1},internalRedirect:{default:null},isProcessing:{default:!1},align:{default:null},offset:{default:!1}},inline:!1,atom:!0,group:"block",draggable:!0,selectable:!0,isolating:!0,defining:!0,parseDOM:[{tag:"p",priority:100,getAttrs:t=>{if(t.textContent.trim())return!1;let[e]=t.getElementsByTagName("img");return!!e&&v(e)}},{tag:"img[src]",getAttrs:t=>!(t.getAttribute("height")&&1>=Number(t.getAttribute("height"))||t.getAttribute("width")&&1>=Number(t.getAttribute("width")))&&v(t)}],toDOM:t=>{let{ImageActions:e}=r(55918);try{let r,i,a;let s=w(t),c=p(t),m=d.s2v.map(e=>({width:e,imageSrc:w(t,{maxWidth:e})})),g=d.s2v.map(e=>({width:e,imageSrc:w(t,{maxWidth:e,imageProps:{format:"webp"}})})),{isProcessing:h}=t.attrs;t.attrs.height&&t.attrs.width&&(r=t.attrs.height,i=t.attrs.width,t.attrs.resizeWidth?(r=t.attrs.resizeWidth*r/i,i=t.attrs.resizeWidth):x(t.attrs)&&i<d.kPM&&(r*=d.kPM/i,i=d.kPM),"full"===c&&(i=Math.min(i,d.qN9)));let v=t.attrs.width/t.attrs.height,f=t.attrs.resizeWidth?t.attrs.resizeWidth/v:t.attrs.height,b=t.attrs.resizeWidth?t.attrs.resizeWidth/f:v,y=!(t.attrs.href&&t.attrs.href!=t.attrs.src);y=(y=y&&t.attrs.height>240&&f>240)&&v<4&&b<4;let k="undefined"==typeof window;a=t.attrs.href?(0,u.chL)(t.attrs.href)?(0,d.zF4)(t.attrs.href):t.attrs.href:(0,d.zF4)(t.attrs.src);let _=document.createElement("div");if(y&&k){_.className="image-link-expand";try{_.innerHTML=(0,o.Dq)((0,n.createElement)(e,{size:20}))}catch(t){console.error("Error rendering ImageActions",t)}}return["a",{class:l()("image-link image2","left"===t.attrs.align&&"image2-align-left","right"===t.attrs.align&&"image2-align-right",t.attrs.offset&&"left"===t.attrs.align&&"image2-offset-left",t.attrs.offset&&"right"===t.attrs.align&&"image2-offset-right",y&&"is-viewable-img",h&&"processing"),target:"_blank",href:a,"data-component-name":"Image2ToDOM"},["div",{class:"image2-inset".concat("full"===c?" image2-full-screen":"")},["picture",{},["source",{type:"image/webp",srcset:g.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw"}],["img",{src:s,width:"full"===c?void 0:i,height:"full"===c?void 0:r,"data-attrs":JSON.stringify(t.attrs),class:"full"===c?"sizing-fullscreen":"large"===c?"sizing-large":"sizing-normal",alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,srcset:m.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw",loading:t.attrs.belowTheFold?"lazy":null,fetchpriority:t.attrs.topImage?"high":null}]],_]]}catch(e){return console.error("Error rendering Maximize2",e),(0,c.s)({msg:null,node:t,err:e,group:"block"})}},toDOMStatic:t=>{var e,r;let i=p(t),a=t.attrs.href||t.attrs.internalRedirect||(0,d.zF4)(t.attrs.src,void 0,{quality:"normal"===i?"auto:good":"auto:best"});if(t.attrs.height&&t.attrs.width&&"full"!==i){let{width:e,height:r}=t.attrs,i=e;t.attrs.resizeWidth?i=t.attrs.resizeWidth:x(t.attrs)&&(i=Math.min(Math.max(e,d.kPM),d.JWy));let l=Math.min(i,d.bxL),n=r*l/e,o=i>d.bxL,s={"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:l,height:n,class:o?"wide-image":"",src:(0,d.zF4)(t.attrs.src,Math.min(!x(t.attrs)&&o?2*i:i,2*d.bxL),{lossy:k(t.attrs)})};return["table",{class:"image-wrapper",width:"100%",border:"0",cellSpacing:"0",cellPadding:"0","data-component-name":"Image2ToDOMStatic"},["tr",{},["td"],["td",{align:"left",class:"content",width:i},["a",{class:"image-link",target:"_blank",href:a},["img",s]]],["td"]]]}return"full"===i?["a",{class:"image-link",target:"_blank",href:a},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs),crop:"limit",aspect:"full"===i?"1":void 0}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,height:t.attrs.height,width:t.attrs.width}]]:["a",{class:"image-link",target:"_blank",href:a},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs)}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:t.attrs.resizeWidth||t.attrs.width,height:t.attrs.resizeWidth?(e=t.attrs.width,r=t.attrs.height,r*t.attrs.resizeWidth/e):t.attrs.height}]]}},h=(0,m.S)({name:"image2",nodeSpec:g}),v=function(t,e){let r,i,a,{bytes:l,internalRedirect:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.getAttribute("data-attrs");if(o)try{return JSON.parse(o)}catch(t){}t.getAttribute("imageSize")&&(r=t.getAttribute("imageSize"));let s=t.getAttribute("style");if(s){let t=/max-height:\s*(\d+)px/.exec(s);t&&(i=Number(t[1]));let e=/max-width:\s*(\d+)px/.exec(s);e&&(a=Number(e[1]))}else t.getAttribute("width")&&t.getAttribute("height")&&(i=Number(t.getAttribute("height")),a=Number(t.getAttribute("width")));return t.complete&&t.naturalHeight&&t.naturalWidth&&(i=t.naturalHeight,a=t.naturalWidth),{src:(0,d.UH4)(t.getAttribute("data-medium-file")||t.getAttribute("src")),type:e,title:t.getAttribute("title"),alt:t.getAttribute("alt"),height:i,width:a,bytes:l,internalRedirect:n,imageSize:r,href:t.getAttribute("href"),align:t.getAttribute("align"),offset:"true"===t.getAttribute("offset")}},w=function(t){let{maxWidth:e=null,imageProps:r={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=p(t),l="full"===a?2*d.hI6:"large"===a?2*d.urw:2*d.qN9;return e&&(l=Math.min(e,l)),(0,d.zF4)(t.attrs.src,l,(0,i._)({lossy:k(t.attrs)},r))},f=function(t){var e;let{customSchema:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&!r.nodes.image2)return null;let i=/(https?:\/\/(giphy\.com\/gifs|gph.is\/g|media\d*\.giphy\.com\/media)\/[^\s]+)/.exec(t);return null!==(e=i&&i[1])&&void 0!==e?e:null},b=async t=>{let e=(await Promise.resolve().then(r.t.bind(r,80569,23))).default,i="image/gif",a=await e.get("/api/v1/giphy").query({url:t});return v(await new Promise(t=>(0,s.pt)(w({attrs:{type:i,src:a.body.url}}),t)),i,{bytes:a.body.bytes})},y=async function(t){let{customSchema:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e?{schema:e}:await Promise.resolve().then(r.bind(r,37175))).schema.nodes.image2.create(await b(t))};function k(t){return x(t)&&(!t.bytes||t.bytes>5e6)}function x(t){return!!(t.type&&"image/gif"===t.type||t.src&&t.src.split("?")[0].split("#")[0].endsWith(".gif"))}},37175:function(t,e,r){r.r(e),r.d(e,{EMPTY_DOC:()=>ep,HEADER_IMAGE_ATTRS_FROM_NODE_TYPE:()=>eg,addIdsToHeaders:()=>eF,checkForUnpublishableComments:()=>e4,checkForUnsafeLinks:()=>e5,createStringDoc:()=>e7,customMediaNodes:()=>ev,extractTags:()=>ej,fromHtml:()=>eL,getCoverImage:()=>eR,getCoverImages:()=>eQ,getDefaultPodcastDescriptionWithoutFeedCTAs:()=>e6,getDescription:()=>eJ,getDimensionsFromImageUrl:()=>em,getFirstImageFromBody:()=>eY,getHeaderImageFromBody:()=>eG,getImageUrlsFromPostBody:()=>eK,getImagesFromBody:()=>eX,getLinks:()=>e2,getPreviewImageUrl:()=>e0,hasExplicitPaywall:()=>rt,migrateMarkdown:()=>eH,migratePost:()=>eU,migrateProsemirrorToTiptap:()=>eI,migratePublication:()=>eq,migrateTiptapToProsemirror:()=>eZ,nodeToHtml:()=>eD,normalizeDbPodcastDescriptionToHtmlString:()=>e8,purgeUnsafeLinks:()=>e3,schema:()=>ey,schemaStatic:()=>ek,serializeDoc:()=>eC,serializedToPodcastDescription:()=>eV,setBelowTheFoldAttribute:()=>e9,setButtonActions:()=>e1,tipTapNodes:()=>ez,tipTapSchema:()=>eM,toHtml:()=>eE,toText:()=>eW,trackedCustomNodes:()=>ef,unserializeDoc:()=>eO,unserializeDocAsync:()=>eB,unserializeJson:()=>eT});var i=r(7409),a=r(99282),l=r(88897),n=r(19512),o=r(56070),s=r(18490),d=r(24717),u=r(56782),c=r(43557),m=r(99961),p=r(18e3),g=r(51127),h=r(67338),v=r(75481),w=r(55786),f=r(32018),b=r(91077),y=r(87597),k=r(94886),x=r(99218),_=r(55963),N=r(21803),S=r(76405),$=r(39693),z=r.n($),M=r(14293),P=r.n(M),A=r(44908),I=r.n(A),Z=r(60826),T=r(24791),O=r(40121),B=r(5889),C=r(60308),D=r(84864),F=r(5835),E=r(26603),W=r(57937),V=r(55633),j=r(1451),L=r(44262),H=r(41676),U=r(82032),q=r(95068),J=r(99605),R=r(12568),X=r(65626),Y=r(37622),G=r(36621),K=r(31188),Q=r(71993),tt=r(88954),te=r(13991),tr=r(36122),ti=r(72270),ta=r(82167),tl=r(47456),tn=r(32978),to=r(40924),ts=r(86725),td=r(59383),tu=r(5660),tc=r(1415),tm=r(98616),tp=r(82708),tg=r(73984),th=r(11105),tv=r(10218),tw=r(98738),tf=r(81519),tb=r(59662),ty=r(60511),tk=r(75837),tx=r(29961),t_=r(24653),tN=r(80334),tS=r(94413),t$=r(75970),tz=r(715),tM=r(87113),tP=r(98450),tA=r(87413),tI=r(69323),tZ=r(61601),tT=r(57639),tO=r(54793),tB=r(29511),tC=r(49640),tD=r(99975),tF=r(41128),tE=r(23431),tW=r(73078),tV=r(85197),tj=r(53797),tL=r(99741),tH=r(3185),tU=r(8220),tq=r(18119),tJ=r(44288),tR=r(13938),tX=r(54757),tY=r(11006),tG=r(11470),tK=r(66928),tQ=r(19805),t0=r(46393),t1=r(2107),t2=r(99149),t4=r(79592),t5=r(62645),t3=r(39111),t9=r(42034),t8=r(41505),t6=r(57950),t7=r(78483),et=r(57881),ee=r(84766),er=r(62092),ei=r(68303),ea=r(88956),el=r(22498),en=r(22365),eo=r(60802),es=r(45913),ed=r(12076),eu=r(34612),ec=r(32751);let em=t=>{var e,r,i,a;let[l,n]=((null===(a=t.split("_"))||void 0===a?void 0:null===(i=a[1])||void 0===i?void 0:null===(r=i.split("."))||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.split("x"))||[0,0]).map(Number);return{width:l||0,height:n||0}},ep={type:"doc",content:[{type:"paragraph"}]},eg={captionedImage:t=>{var e,r,i,a;let l=null===(e=t.content)||void 0===e?void 0:e.find(t=>{var e,r;return"image2"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.width)>=300&&(null==t?void 0:null===(r=t.attrs)||void 0===r?void 0:r.height)>=300});if(!l)return{url:null,caption:void 0,alt:void 0};let n=null==t?void 0:null===(r=t.content)||void 0===r?void 0:r.find(t=>"caption"===t.type);return{url:null==l?void 0:null===(i=l.attrs)||void 0===i?void 0:i.src,caption:n,alt:null==l?void 0:null===(a=l.attrs)||void 0===a?void 0:a.alt}},image2:t=>{var e,r,i,a;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?{url:null==t?void 0:null===(i=t.attrs)||void 0===i?void 0:i.src,alt:null==t?void 0:null===(a=t.attrs)||void 0===a?void 0:a.alt}:{url:null,caption:void 0,alt:void 0}},image3:t=>{var e,r,i,a,l;let n=em(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||n.width>=300&&n.height>=300?{url:null===(a=t.attrs)||void 0===a?void 0:a.src,caption:t.content,alt:null===(l=t.attrs)||void 0===l?void 0:l.alt}:{url:null,caption:void 0,alt:void 0}}},eh={image:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.src)},image2:t=>{var e,r,i;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?e0(null===(i=t.attrs)||void 0===i?void 0:i.src):null},image3:t=>{var e,r,i,a;let l=em(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||l.width>=300&&l.height>=300?e0(null===(a=t.attrs)||void 0===a?void 0:a.src):null},imageGallery:t=>{var e,r,i;return e0(null===(i=t.attrs)||void 0===i?void 0:null===(r=i.gallery.images)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.src)},spotify:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},spotify2:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},opensea:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},twitter2:t=>{var e,r;if(null===(e=t.attrs)||void 0===e?void 0:e.photos){for(let e of t.attrs.photos)if(e.img_url)return e0(e.img_url)}return(null===(r=t.attrs)||void 0===r?void 0:r.expanded_url)&&t.attrs.expanded_url.image?t.attrs.expanded_url.image.url?e0(t.attrs.expanded_url.image.url):e0(t.attrs.expanded_url.image):null},vimeo:t=>{var e;return es.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube:t=>{var e;return ec.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube2:t=>{var e;return ec.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},kindle:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},applePodcast:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},tiktok:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},prediction_market:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},manifold:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},lichess:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},datawrapper:t=>{var e;return(0,C.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},pinterest:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)}},ev={augmentation_placeholder:j.$,youtube2:ec.$y,youtube:eu.$,vimeo:es.$y,install_substack_app:tC.$,preview_in_substack_app:tX.$,opensea:tj.$y,twitter2:ee.$y,twitter:et.$,communityChat:tt.$y,communityPost:te.$y,comment:Q.$y,spotify2:t4.$y,spotify:t2.$,soundcloud:t0.$y,instagram:tB.$y,image2:tT.$y,image:tI.$,button:q.$y,comic:K.Z.nodeSpec,file:K.Z.nodeSpec,pdf:tH.Z.nodeSpec,xlsx:ed.Z.nodeSpec,ebook:tn.Z.nodeSpec,referral_link:tK.$,bandcamp:L.$y,kindle:tD.$y,gitgist:tA.$y,embeddedPost:to.$y,embeddedPublication:ts.$y,applePodcast:F.$y,audio:W.$y,video:eo.$,audioUrl:V.$y,tiktok:t7.$y,bluesky:U.$y,poll:tq.$,sponsorshipCampaign:t1.$,imageGallery:tZ.$y,image3:tO.$y,cashtag:G.$,substack_mentions:tV.$,prediction_market:tJ.$y,manifold:tJ.$y,lichess:tE.$y,datawrapper:ti.$y,digestPostEmbed:ta.$y,assetError:E.$,directMessage:tl.$y,recipe:tG.$,pinterest:tU.$y},ew=(0,a._)((0,i._)({},ev),{blockquote:H.$,calloutBlock:J.$,fragmentNode:tP.$,captionedImage:Y.$,caption:R.$,ctaCaption:tr.$,footnote:tz.$,footnoteAnchor:tM.$,latex_block:tF.$y,paywall:tL.$,preformatted_text_block:tR.$,pullquote:tY.$,subscribeWidget:t3.$,captionedShareButton:(0,X.$y)({url:Z.W.SHARE_URL}),captionedWriterReferralButton:(0,X.$y)({hasDynamicSubstitutions:!1}),templateComment:t6.$,meeting:tW.$,referralTier:tQ.$y}),ef=(0,a._)((0,i._)({},ev),{subscribeWidget:t3.$,paywall:tL.$,templateComment:t6.$}),eb={strikethrough:t5.J,superscript:t8.O,subscript:t9.l},ey=new S.V_({nodes:eP(),marks:eA()}),ek=new S.V_({nodes:eP({isStatic:!0}),marks:eA({isStatic:!0})}),ex=Object.keys(ew).filter(t=>!["blockquote","pullquote","calloutBlock"].includes(t)).map(t=>{let e=(0,ei.Co)(t,ew[t]),r=(0,i._)({},ew[t],e);return"youtube2"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new ec.dQ(e)}:"tiktok"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new t7.QZ(e)}:"lichess"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tE.$1(e)}:"datawrapper"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new ti.s3(e)}:"prediction_market"===t||"manifold"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tJ.eC(e)}:"paywall"===t?r.addNodeView=()=>t=>new tL.b:"latex_block"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tF.Jd(e)}:"comic"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return K.Z.getNodeView({node:e,editor:r,getPos:i})}:"pdf"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return tH.Z.getNodeView({node:e,editor:r,getPos:i})}:"xlsx"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return ed.Z.getNodeView({node:e,editor:r,getPos:i})}:"ebook"===t&&(r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return tn.Z.getNodeView({node:e,editor:r,getPos:i})}),l.NB.create(r)}),e_=n.V6.extend({addCommands(){return{toggleBlockquote:()=>t=>{let{state:e,commands:r}=t;return!(!(0,l.Ig)(e,"paragraph")||(0,l.Ig)(e,"pullquote")||(0,l.Ig)(e,"calloutBlock"))&&r.toggleWrap(this.name)}}},parseHTML:()=>H.$.parseDOM}),eN=n.V6.extend({name:"calloutBlock",addCommands(){return{toggleCalloutBlock:()=>t=>{let{state:e,commands:r}=t;if((0,l.Ig)(e,"calloutBlock"))return r.lift("calloutBlock");if((0,l.Ig)(e,"paragraph")||(0,l.Ig)(e,"button"))return!((0,l.Ig)(e,"pullquote")||(0,l.Ig)(e,"blockquote"))&&r.toggleWrap(this.name);let i=[e.schema.nodes.paragraph,e.schema.nodes.button].filter(t=>!!t),a=!0;return e.doc.nodesBetween(e.selection.from,e.selection.to,(t,r,l,n)=>{if(l===e.doc&&(t.type===e.schema.nodes.blockquote||t.type===e.schema.nodes.pullquote||!i.includes(t.type)))return a=!1,!1}),!(!a||(0,l.Ig)(e,"pullquote")||(0,l.Ig)(e,"blockquote"))&&r.toggleWrap(this.name)}}},parseHTML:()=>[{tag:"div[data-callout]",priority:100},{tag:"div.callout-block",priority:99}],renderHTML:()=>["div",{class:"callout-block","data-callout":"true"},0]}),eS=h.b.extend({addCommands:()=>({insertHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;return r&&e.schema.nodes.horizontalRule&&r((0,ei.o4)(e,e.schema.nodes.horizontalRule.create())),!0},setHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;if(r){if(!e.schema.nodes.horizontalRule)return console.error("horizontalRule is missing"),!1;r((0,ei.o4)(e,e.schema.nodes.horizontalRule.create()))}return!0}})}),e$=u.dn.extend({marks:"_"}),ez=[e_,o.d8,s.DY,tu.z,eN,d.EK,e$,tm.l,c.B,tg.w,m.U,p.X,g.A,eS,td.M,t$.f,tv._,tf.r,tk.q,tN.a,tx.R,ty.q,th.y,v.Tx,tw.d,w.H,f.GS,b.n,tb.f,tY.z,y.Re,k.a,x.$,_.x,tc.n,tS.T,tp.k,tl.e1,...ex],eM=(0,l.J1)(ez);function eP(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=N.fK.spec.nodes;for(let r of Object.keys(ew)){let i=Object.assign({},ew[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eA(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=N.fK.spec.marks;for(let r of Object.keys(eb)){let i=Object.assign({},eb[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eI(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eT(i,{postId:e,pubId:r})),(0,ei.cb)(i,t=>{let e=ei.qj.find(e=>e[0]===t.type);return e&&(t.type=e[1],t.attrs&&"orderedList"===e[1]&&(t.attrs.start=t.attrs.order)),t.marks&&t.marks.forEach(t=>{let e=ei.PH.find(e=>e[0]===t.type);e&&(t.type=e[1])}),t}),i}function eZ(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eT(i,{postId:e,pubId:r})),(0,ei.cb)(i,t=>{let e=ei.qj.find(e=>e[1]===t.type);return e&&(t.type=e[0],t.attrs&&"ordered_list"===e[0]&&(t.attrs.order=t.attrs.start)),t.marks&&t.marks.forEach(t=>{let e=ei.PH.find(e=>e[1]===t.type);e&&(t.type=e[0])}),t}),i}function eT(t){let e,{postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&(t=(t=t.replace("http://substack-post-media","https://substack-post-media")).replace("http://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984","https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984")),t=eH(t))try{e=JSON.parse(t)}catch(e){console.error("unserializeJson for post [".concat(r,"], pubId [").concat(i,"], could not parse serialized:"),t,e)}return null!=e?e:void 0}function eO(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:a=!1,shouldThrowOnInvalid:l,postId:n,pubId:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let l=eT(t,{postId:n,pubId:o})||ep;i&&i(l);let s=e3(l);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return a&&(d=e9(d)),d=r?eI(d,{postId:n,pubId:o}):eZ(d,{postId:n,pubId:o}),(e||ey).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(n,"], serialized:"),t,r),l)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ey).nodeFromJSON(ep)}}async function eB(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:a=!1,shouldThrowOnInvalid:l,postId:n,pubId:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let l=eT(t,{postId:n,pubId:o})||ep;i&&await i(l);let s=e3(l);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return a&&(d=e9(d)),d=r?eI(d,{postId:n,pubId:o}):eZ(d,{postId:n,pubId:o}),(e||ey).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(n,"], serialized:"),t,r),l)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ey).nodeFromJSON(ep)}}function eC(t){let{runMigrations:e=!1,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.toJSON();return e&&(a=eZ(a=e3(a=function(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="string"==typeof t?eT(t,{postId:e}):t;return(0,ei.cb)(r,t=>{t.text&&(t.text=(0,D.stripInvalidBytes)(t.text))},{nodeTypes:["text"]}),r}(a)),{postId:r,pubId:i})),JSON.stringify(a)}function eD(t,e){let r=document.createElement("div");return r.appendChild(S.PW.fromSchema(e?ek:ey).serializeFragment(S.HY.fromArray([t]),{document})),r}function eF(t){Array.from(t.querySelectorAll("h2, h3, h4, h5, h6")).forEach(t=>{if(!t.getAttribute("id")){var e,r;let i=(r=t.textContent||"",(0,O.Hm)((0,D.truncateText)(r,500,{ellipsis:""}),{allowUnicode:!0})),a=document.createElement("div");a.setAttribute("id",i),a.setAttribute("class","anchor-target"),null===(e=t.parentNode)||void 0===e||e.insertBefore(a,t);let l=document.createElement("a");for(l.setAttribute("href","#".concat(i));t.firstChild;)l.appendChild(t.firstChild);t.appendChild(l)}})}function eE(t,e){let{isAmp:r,transform:i,useTipTap:a,pubId:l,postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(a){let r=eI(eT(t,{postId:n,pubId:l}),{postId:n,pubId:l});if(!r)throw Error("could not serialize json doc");return(0,en.e)({doc:r,extensions:(0,t_.p)({isStatic:null!=e&&e}),customDocument:document})}let o=eO(t,{shouldSetBelowTheFoldAttribute:!0,postId:n,pubId:l}),s=S.PW.fromSchema(e?ek:ey),d=document.createElement("div");try{s.serializeFragment(o.content,{document},d)}catch(t){return console.error("could not serialize fragment, for pubId [".concat(l,"], postId [").concat(n,"]"),t),d.innerHTML}return i&&i(d),r&&function(t){Array.from(t.querySelectorAll("img")).forEach(t=>{let e=document.createElement("amp-img");e.setAttribute("layout","intrinsic"),t.getAttributeNames().forEach(r=>{var i;"srcset"!==r&&e.setAttribute(r,null!==(i=t.getAttribute(r))&&void 0!==i?i:"null")}),t.replaceWith(e)})}(d),d.innerHTML}function eW(t,e){let{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,ei.lr)(eO(t,{postId:r}),e)}function eV(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ei.fX)(eO(t,{postId:e}))}function ej(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ei.E5)(eO(t,{postId:e}))}function eL(t){let{stripEmptyParagraphs:e,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=S.aw.fromSchema(ey).parse(new DOMParser().parseFromString(t,"text/html"));return(e&&(a=(0,ea.Y)(a,t=>!t.type||"paragraph"!==t.type.name||!!(0,ei.lr)(t))),a)?eC(a,{postId:r,pubId:i}):null}function eH(t){return t&&"{"!==t[0]&&"null"!==t?eC(N.EU.parse(t)):t}function eU(t){var e,r;return t.body=null!==(e=eH(t.body))&&void 0!==e?e:null,t.draft_body=null!==(r=eH(t.draft_body))&&void 0!==r?r:null,t}function eq(t){var e,r,i,a,l;return t.subscribe_content=null!==(e=eH(t.subscribe_content))&&void 0!==e?e:null,t.welcome_email_content=null!==(r=eH(t.welcome_email_content))&&void 0!==r?r:null,t.tos_content=null!==(i=eH(t.tos_content))&&void 0!==i?i:null,t.privacy_content=null!==(a=eH(t.privacy_content))&&void 0!==a?a:null,t.disclosures_content=null!==(l=eH(t.disclosures_content))&&void 0!==l?l:null,t}function eJ(t,e){let{post:r=null,pubId:i,minCharacters:a=6,maxStopAfter:l=null,singleSentence:n=!0,language:o="en",excludeMediaPrefix:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:d}=I18N.i(o),u=(null==r?void 0:r.type)==="thread"?145:250;(l||0===l)&&(u=Math.min(l,u));let c=(null==r?void 0:r.type)==="thread",m="";if(e)m+=e;else if(0!==u){var p;let e={paragraph:!0,blockquote:!0,list_item:!0,listItem:!0,heading:!0,code_block:!0,codeBlock:!0,hardbreak:!0,hard_break:!0,hardBreak:!0},l={caption:!0,footnote:!0};(0,ei.cb)("string"==typeof t?eT(t,{postId:null!==(p=null==r?void 0:r.id)&&void 0!==p?p:null,pubId:i}):t,t=>{if(u&&m.length>=u||t.type&&l[t.type])return!1;if("text"===t.type){let{text:e}=t;if(e){let t=e.match(/[.?!] /);if(n&&(null==t?void 0:t.index))return m+=e.slice(0,t.index+1),el.aT;m+=e}}else if(t.type&&e[t.type]&&m){if(m.length>a)return el.aT;" "!==m[m.length-1]&&(m+=" ")}else if("substack_mentions"===t.type){var r,i;m+=null!==(i=null===(r=t.attrs)||void 0===r?void 0:r.name)&&void 0!==i?i:""}})}if(m=m.replace(/\s+/g," ").trim(),c&&u&&m.length>=u&&(m=(0,D.truncateText)(m,u)),((null==r?void 0:r.type)==="podcast"||(null==r?void 0:r.type)==="video")&&!s){let t=(0,T.XV)(r);m="".concat(d((null==r?void 0:r.type)==="video"||(null==r?void 0:r.videoUpload)?"Watch now":"Listen now")," ").concat(t?"(".concat((0,D.secondsToLargestUnit)(t,{minutesCutoff:10800,language:o}),") "):"","| ").concat(m)}return m}function eR(t,e){var r;return null!==(r=eQ(t,e)[0])&&void 0!==r?r:null}function eX(t){let{postId:e,pubId:r,width:i,height:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=eT(t,{postId:e,pubId:r});return l?I()(z()((0,ei.fp)(l,t=>{var e;return!!eh[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;let l=null===(e=eh[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(eh,t);return l?(0,C.zF4)(l,i,{height:a}):null}))):[]}function eY(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=eX(t,{postId:e,pubId:r});return i.length>0&&!P()(i[0])?i[0]:null}function eG(t){let{body:e}=t,r=eT(e);if(r)return(0,ei.fp)(r,t=>{var e;return!!eg[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;return null===(e=eg[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(eg,t)})[0]}async function eK(t){let{body:e,postId:r}=t,i=eO(e,{postId:r}),a=[];return(0,ei.je)(i,t=>{switch(t.type.name){case"image":case"image2":t.attrs.src&&a.push(t.attrs.src);break;case"imageGallery":var e;null===(e=t.attrs.gallery.images)||void 0===e||e.map(t=>{t.src&&a.push(t.src)})}}),a}function eQ(t,e){var r;let i=[];"podcast_episode_image_info"in e&&e.podcast_episode_image_info&&!e.podcast_episode_image_info.isDefaultArt&&i.unshift(e.podcast_episode_image_info.url),i.unshift(...eX(t,{postId:e.id}));let a="podcastUpload"in e&&e.podcastUpload||"draftPodcastUpload"in e&&e.draftPodcastUpload||void 0;if((null==a?void 0:a.state)==="transcoded"&&(null!==(r=null==a?void 0:a.thumbnail_id)&&void 0!==r?r:1)>1){let t=(0,C.ow1)(a);t&&i.unshift(t)}let l="videoUpload"in e&&e.videoUpload||"draftVideoUpload"in e&&e.draftVideoUpload||void 0;if((null==l?void 0:l.state)==="transcoded"){let t=(0,C.ow1)(l);t&&i.unshift(t)}return"podcast_art_url"in e&&e.podcast_art_url&&i.unshift(e.podcast_art_url),i}function e0(t){return"string"!=typeof t?null:(t=t.replace(/\/l_twitter_play_button_rvaygk[^/]+/g,""),(0,C.zF4)(t,void 0,{height:600}))}function e1(t){(0,ei.cb)(t,t=>{var e;return"button"===t.type&&((null===(e=t.attrs)||void 0===e?void 0:e.url)&&"string"==typeof t.attrs.url&&t.attrs.url.startsWith("%%")&&(t.attrs.action=t.attrs.url.replace(/%%/g,"")),!0)},{nodeTypes:"button"})}function e2(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return[];r=t}e1(r);let i=[];return(0,ei.cb)(r,t=>{var e,r,a;if("button"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.url)&&!t.attrs.action)i.push({text:t.attrs.text,url:t.attrs.url});else if("image2"===t.type&&(null===(r=t.attrs)||void 0===r?void 0:r.href))i.push({text:t.attrs.href,url:t.attrs.href});else if(t.marks){for(let e of t.marks)if("link"===e.type&&(null===(a=e.attrs)||void 0===a?void 0:a.href)){i.push({text:t.text,url:e.attrs.href});break}}}),i}function e4(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return!1;r=t}return!!(0,ei.DY)(r,t=>"templateComment"===t.type)}function e5(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return!1;r=t}return!!(0,ei.DY)(r,t=>{for(let o of["href","src","url"]){var e,r,i,a,l,n;if((null==t?void 0:null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,a,l;return null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:")})))return!0}return!1})}function e3(t){let e,{postId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){let i=eT(t,{postId:r});if(!i)return null;e=i}else e=t;return(0,er.f5)(e)?(0,ea.Y)(e,t=>{for(let o of["href","src","url"]){var e,r,i,a,l,n;if((null==t?void 0:null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,a,l;return null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:")})))return!1}return!0}):(0,ea.Y)(e,t=>{for(let o of["href","src","url"]){var e,r,i,a,l,n;if((null==t?void 0:null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,a,l;return null===(a=t.attrs)||void 0===a?void 0:null===(i=a[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(l=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(l).startsWith("javascript:")})))return!1}return!0})}function e9(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="string"==typeof t?eT(t,{postId:r}):t;if(!i)return;let a=!1;return"doc"===i.type&&i.content&&i.content.map((t,r)=>{r>e?(0,ei.cb)(t,t=>{!t.content&&t.attrs&&(t.attrs.belowTheFold=!0)}):a||(0,ei.cb)(t,t=>{!t.content&&(null==t?void 0:t.type)=="image2"&&t.attrs&&(t.attrs.topImage=!0,a=!0)})}),i}function e8(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return JSON.parse(t),eV(t,{postId:e})}catch(e){return t}}function e6(t,e){let{body:r,hasPodcastPreview:i}=e;if(!t||!r)return null;let a=r;return i&&(a=JSON.stringify((0,ei.N5)(eT(r,{postId:t.id}),{maxLength:"post_preview_limit"in t&&t.post_preview_limit&&"number"==typeof t.post_preview_limit?t.post_preview_limit:356}))),eV(a,{postId:t.id})}function e7(t){return eC(ey.node("doc",null,t.split("\n").map(t=>t.trim()).filter(t=>t.length>0).map(t=>{let e=[],r=(0,B.m)(t);if(r.length>0){let i=t;for(;;){let t=r.map(t=>[i.indexOf(t.value),t.value]).sort().find(t=>{let[e]=t;return e>=0});if(!t)break;let[a,l]=t;if(a>0&&e.push(ey.text(i.substring(0,a))),!ey.marks.link){console.error("link is missing from schema");continue}e.push(ey.text(l,[ey.marks.link.create({title:l,href:l,target:"_blank"})])),i=i.substring(a+l.length)}i&&e.push(ey.text(i))}else e.push(ey.text(t));return ey.node("paragraph",null,e)})))}function rt(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof t){let i=eT(t,{postId:e});if(!i)return!1;r=i}else r=t;return(0,ei.C4)(r)}Object.entries(eM.nodes).forEach(t=>{let[e,r]=t;void 0!==ew[e]&&(r.spec=(0,i._)({},ew[e],r.spec))})}}]);