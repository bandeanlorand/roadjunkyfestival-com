"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["9077"],{21694:function(e,t,n){n.d(t,{Z:()=>o});let o={root:"root-LeqPP3",badge:"badge-WYVub3",circle:"circle-_ZTVoA"}},11547:function(e,t,n){n.d(t,{Z:()=>ek});var o=n(7409),i=n(99282),r=n(16584),s=n(30396),a=n(94184),l=n.n(a),d=n(14293),c=n.n(d),u=n(24840),m=n(80569),_=n.n(m),p=n(30218),h=n(93666),v=n(31131),g=n(99869),f=n(67358),y=n(12561),b=n(59154),Z=n(79138),w=n(37632),C=n(4473),x=n(39535),P=n(75697),I=n(16354),N=n(95441),k=n(68833),S=n(15771),R=n(44424),M=n(63651),B=n(47929);function A(e){let{pub:t,user:n}=e,{iString:o}=(0,N.M1)(),[i,a]=(0,s.eJ)(!1),l=(0,M.SVA)(t),d={utm_source:B.b3.navbar,utm_medium:B.lP.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},c=(0,M.n1t)(l,d),u=async()=>{(0,k.j)(k.FP.PUBLICATION_SHARE_BUTTON_CLICKED)},m=(0,r.tZ)(S.hU,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,r.tZ)(v.Z,{size:20})});return(0,r.BX)(r.HY,{children:[(0,r.BX)(R.v2,{trigger:m,onOpen:u,layerOptions:{placement:"bottom-end",preferX:"left"},className:"dropdownMenu-zWNckK",maxHeight:"fit-content",children:[(0,r.tZ)(R.sN,{leading:(0,r.tZ)(g.Z,{}),onClick:()=>{(0,P.Ui)({shareUrl:c,pub:t,utm_campaign:B.VX.navbar})},children:o("Copy link")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(f.Z,{}),onClick:()=>{(0,P.WZ)({shareUrl:c,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:B.VX.navbar})},children:o("Send as email")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(y.Z,{}),onClick:()=>{(0,k.j)(k.FP.SHARE_PUBLICATION_MODAL_OPENED),a(!0)},children:o("Get shareable images")}),(0,r.BX)(R.xw,{children:[(0,r.tZ)(R.sN,{leading:(0,r.tZ)(C.Z,{}),onClick:()=>{(0,P.BZ)({shareUrl:c,pub:t,utm_campaign:B.VX.navbar})},children:o("Share to Notes")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(Z.Z,{}),onClick:()=>{(0,P.Po)({shareUrl:c,pub:t,utm_campaign:B.VX.navbar})},children:o("Share to Facebook")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(w.Z,{}),onClick:()=>{(0,P.lc)({shareUrl:c,pub:t,utm_campaign:B.VX.navbar})},children:o("Share to Linkedin")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(b.Z,{}),onClick:()=>{(0,P.bI)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:B.VX.navbar})},children:o("Share to Bluesky")}),(0,r.tZ)(R.sN,{leading:(0,r.tZ)(x.Z,{}),onClick:()=>{(0,P.Wn)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:B.VX.navbar})},children:o("Share to X")})]})]}),(0,r.tZ)(I.iL,{pub:t,isOpen:i,setOpen:a,item:{type:"pub_shareable_image"},width:718})]})}var E=n(96726),L=n(33804),O=n(347),T=n(12757),F=n(57391),z=n(36848),X=n(39648),U=n(56629),D=n(40647),q=n(65205),V=n(60807),j=n(98914),H=n(98422),W=n(80026),J=n(19081),K=n(38841),G=n(78096),Y=n(70379),Q=n(87077),$=n(7617),ee=n(4615);function et(e){let{children:t}=e;return(0,r.tZ)(ee.f6,{theme:"substack-theme",children:t})}var en=n(97842),eo=n(74312),ei=n(68494),er=n(36518),es=n(7882),ea=n(83010),el=n(19425),ed=n(20160),ec=n(98012);let eu={alert:"alert-pEnrFa",transition:"transition-FsyEAS",enterFrom:"enterFrom-dljIVN",enterTo:"enterTo-HLLVxF",leaveFrom:"leaveFrom-aHkaAL",leaveTo:"leaveTo-k1oI5e"},em=e=>{(0,k.j)(k.FP.NOTIFICATIONS_ALERT_SHOWN,["comment_audience","comment_id","community_comment_id","created_at","id","mention_id","publication_id","sender_count","target_comment_id","target_community_comment_id","target_community_post_id","target_post_id","target_user_id","type"].reduce((t,n)=>(t[n]=null==e?void 0:e[n],t),{}))};function e_(){var e;let{activityUnreadCount:t}=(0,er.lR)(),{exposeExperiment:o,getExperimentVariant:i}=(0,F.jc)(),{isLoading:a,result:l,refetch:d}=(0,es.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:1},auto:!1});(0,s.d4)(()=>{t>0&&d()},[t]);let[c,u]=(0,s.eJ)(!1),[m,_]=(0,s.eJ)(!1),{isLoading:p,fetch:h,result:v}=(0,eo.Oe)({module:"./MiniNotificationsViewer",onRequest:()=>Promise.all([n.e("3751"),n.e("9383"),n.e("3536"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),fetchImmediately:!1}),g=(0,ec.Z)(),{userSettings:f,changeSetting:y}=(0,V.SE)(),b=null==l?void 0:null===(e=l.activityItems)||void 0===e?void 0:e[0],Z=(null==b?void 0:b.created_at)?(0,ec.Z)(null==b?void 0:b.created_at):g.subtract(100,"year"),w=(null==f?void 0:f.last_notification_alert_shown_at)?(0,ec.Z)(f.last_notification_alert_shown_at):g.subtract(100,"year"),C=7>g.diff(Z,"day")&&Z.diff(w,"hour")>2,x=(0,s.sO)(null),P=()=>{x.current&&window.clearTimeout(x.current)},I=()=>{P(),x.current=window.setTimeout(()=>{u(!1)},6e3)};return(0,s.d4)(()=>{C&&t>0&&(o("notification_alert_improved"),"treatment"!==i("notification_alert_improved")||(v&&!c?window.setTimeout(()=>{u(!0),y("last_notification_alert_shown_at",(0,ec.Z)().toISOString()),em(b),I()},2e3):v||p||h()))},[a,l,t,p,C,c,u]),(0,r.tZ)(r.HY,{children:(c||m)&&l&&(0,r.tZ)(el.u,{style:{position:"fixed",left:"auto",right:20,top:92,zIndex:100},appear:!0,show:c,beforeEnter:()=>_(!0),afterLeave:()=>_(!1),enter:eu.transition,enterFrom:eu.enterFrom,enterTo:eu.enterTo,leave:eu.transition,leaveFrom:eu.leaveFrom,leaveTo:eu.leaveTo,children:(0,r.tZ)(ed.W,{children:(0,r.tZ)(J.hs,{radius:"md",border:"detail",className:eu.alert,onMouseEnter:P,onMouseLeave:I,shadow:"lg",bg:"primary",children:(0,r.tZ)(eo.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsStack,onRequest:()=>Promise.all([n.e("3751"),n.e("9383"),n.e("3536"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),result:l,isReadOnly:!0})})})})})}var ep=n(21694);function eh(e){let{canShowAlerts:t=!1}=e,a=(0,er.lR)(),l=(0,es.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,s.d4)(()=>{a.activityUnreadCount>0&&(0,k.j)(k.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:a.activityUnreadCount})},[a.activityUnreadCount]);let d=()=>Promise.all([n.e("3751"),n.e("9383"),n.e("3536"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),{iString:c}=(0,N.M1)();return(0,r.BX)(ea.H,{trackingProps:{surface:"dropdown"},children:[(0,r.tZ)(R.v2,{trigger:e=>(0,r.tZ)(Q.u,{text:c("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:Q.$$},children:(0,r.BX)(S.hU,(0,i._)((0,o._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:d,position:"relative",children:[(0,r.tZ)(ei.Z,{"aria-hidden":!0,size:20}),a.activityUnreadCount>0&&(0,r.tZ)(ev,{count:a.activityUnreadCount})]}))}),onOpen:()=>l.refetch(),maxHeight:"fit-content",padding:0,Theme:et,children:(0,r.tZ)(eo.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:d,resource:l,bellCount:a.activityUnreadCount,whileLoading:(0,r.tZ)(J.hs,{width:400})})}),t&&(0,r.tZ)(e_,{})]})}function ev(e){let{count:t}=e;return(0,r.tZ)(J.hs,{className:l()(ep.Z.badge,t<10&&ep.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}function eg(){var e,t;let{iString:n}=(0,N.M1)(),a=null!==(t=null===(e=(0,en.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,s.d4)(()=>{(0,k.j)(k.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:a})},[a]),(0,r.tZ)(R.v2,{trigger:e=>(0,r.tZ)(Q.u,{text:n("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:Q.$$},children:(0,r.BX)(W.hU,(0,i._)((0,o._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:ef,position:"relative",children:[(0,r.tZ)($.Z,{size:20}),a>0&&(0,r.tZ)(ev,{count:a})]}))}),onClose:()=>{(0,k.j)(k.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:et,children:(0,r.tZ)(eo.cr,{module:"./MiniInbox",onRequest:ef,resolve:e=>e.MiniChatInbox,whileLoading:(0,r.tZ)(W.xu,{width:360})})})}let ef=()=>Promise.all([n.e("7768"),n.e("9022"),n.e("1530"),n.e("3447"),n.e("5410"),n.e("5484"),n.e("3751"),n.e("5431"),n.e("4405"),n.e("9153"),n.e("7968"),n.e("7319"),n.e("5698"),n.e("7944"),n.e("5249"),n.e("2688"),n.e("9383"),n.e("1761"),n.e("3145"),n.e("1549"),n.e("5042"),n.e("8336"),n.e("3536"),n.e("7833"),n.e("9578"),n.e("7177"),n.e("9116"),n.e("2622"),n.e("5773"),n.e("3979")]).then(n.bind(n,90370));var ey=n(24791),eb=n(6070),eZ=n(67914),ew=n(60308),eC=n(26111),ex=n(84864);let eP=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,H.v9)(),{iString:i}=(0,N.M1)();return(0,r.tZ)(G.gd,{priority:"secondary",size:o?"sm":"md",menuItems:n.map(e=>{let{logo_url:n,name:o,subdomain:i}=e;return(0,r.tZ)(R.sN,{href:(0,ew.c0Q)(i,{params:{utm_source:B.b3.substack,utm_content:B.fZ.dashboardPubSwitcher}}),leading:(0,r.tZ)(K.wk,{size:24,radius:"xs",logoUrl:n}),priority:t.subdomain===i?"selected":"primary",children:o})}),href:(0,M.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:i("Dashboard")})},eI=e=>{let{onClick:t}=e,{iString:n}=(0,N.M1)();return(0,r.tZ)(Q.u,{text:n("Search"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:Q.$$},children:(0,r.tZ)(W.hU,{priority:"tertiary",onClick:t,children:(0,r.tZ)(u.Z,{size:20})})})},eN=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,N.M1)(),{isMobile:i}=(0,H.v9)();return t.length>1?(0,r.tZ)(eP,{pub:n,dashboardPubs:t}):(0,r.tZ)(W.zx,{size:i?"sm":"md",priority:"secondary",href:(0,M.QK7)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})},ek=e=>{var t;let{className:n,fixedTooltip:a=!0,freeSignup:d,freeSignupEmail:u,hideCta:m,hideNotifications:v,hideChat:g,hideSearch:f,hideShare:y,hideUserIndicator:b,hide_subscribe_cta:Z,isAccountContext:w=!1,isMeetingsActive:C,hasViralGiftsCount:x,isPublishContext:P,pub:I,showCustomerSupportModeModal:S,user:R}=e,{iString:K,language:G}=(0,N.M1)(),{isMobile:Q}=(0,H.v9)(),$=(0,s.sO)(null),{getSettingFor:ee}=(0,U.So)(),et=(0,F.jc)(),[en,eo]=(0,s.eJ)(!1),[ei,er]=(0,s.eJ)(!1),es=(0,Y.pm)(),{canTurnOnCustomerSupportMode:ea,isInCustomerSupportMode:el}={canTurnOnCustomerSupportMode:!!(null==(t=(0,V.aF)())?void 0:t.is_global_admin)&&!(null==t?void 0:t.is_admin),isInCustomerSupportMode:!!(null==t?void 0:t.is_global_admin)&&!!(null==t?void 0:t.is_admin)&&!(null==t?void 0:t.is_author)},ed=(0,s.I4)(async()=>{try{await _().del("/api/v1/customer_support_mode"),document.location.href="/"}catch(e){alert((0,j.zx)(e))}},[]),eu=async()=>{eo(!0);try{await _().post("/api/v1/subscription/reactivate").send({}),er(!0),es.popToast(e=>(0,r.tZ)(Y.FN,(0,i._)((0,o._)({},e),{text:K("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,j.zx)(e))}finally{eo(!1)}},em=(0,s.I4)(async()=>{if(I.custom_domain){let e=window.location.pathname;(0,j.uX)((0,ew.Q6L)(e,I),{local_navigation:!1})}else{var e;null===(e=$.current)||void 0===e||e.open()}},[$,I]),e_=P||w?L.w:O.h,ep=(0,X.O4)();return(0,r.BX)(J.gq,{alignItems:"center",gap:Q?4:8,className:l()("navbar-buttons",n),justifyContent:"end",children:[(0,r.tZ)(e_,{children:(0,r.tZ)(D.QA.Consumer,{children:e=>(0,r.tZ)(z.RD.Consumer,{children:t=>(0,r.BX)(r.HY,{children:[!Q&&!R&&(0,r.BX)(J.gq,{gap:4,children:[!f&&(0,r.tZ)(eI,{onClick:()=>ep.open()}),!y&&(0,r.tZ)(A,{pub:I,user:null!=R?R:void 0})]}),!Q&&R&&(0,r.BX)(J.gq,{gap:4,children:[!f&&(0,r.tZ)(eI,{onClick:()=>ep.open()}),g?!y&&(0,r.tZ)(A,{pub:I,user:R}):(0,r.tZ)(eg,{}),!v&&(0,r.tZ)(eh,{canShowAlerts:!I||P})]}),!m&&function(e){var t,n,o,i,s,a,l,d,u,m,p;let{user:h,pub:v,freeSignup:g,freeSignupEmail:f,hide_subscribe_cta:y,isPublishContext:b,isMeetingsActive:Z,hasViralGiftsCount:w,siteConfigContext:C,getSettingFor:x,experimentApi:{exposeExperiment:P,getExperimentVariant:I},renewing:N,renewed:S,setToRenew:R,language:A,isMobile:E}=e,{iString:L,iPlural:O}=I18N.i(A);v.invite_only&&!((null==h?void 0:h.subscription_id)||(null==h?void 0:h.is_free_subscribed))&&(y=!0);let T=null==h?void 0:h.is_contributor,F=(null==h?void 0:h.is_subscribed)||T,z=(null==h?void 0:h.is_free_subscribed)||g,X=ey.oH(v)&&F&&["gift","comp"].includes(null!==(i=h.subscription_type)&&void 0!==i?i:"")&&!(0,eZ.B9)({pub:v,subscriptionType:null==h?void 0:h.subscription_type})&&(0,ec.Z)(h.subscription_expiry).subtract(30,"days").isBeforeNow(),U=ey.oH(v)&&h&&ey.po(h)&&h.comp_expired_recently,D=(null==h?void 0:h.is_free_subscribed)&&(null==h?void 0:h.is_paused),V=(null==h?void 0:h.subscription_type)==="ios_app";if(T){let e=(null==h?void 0:h.dashboard_pubs)||[];return b&&1===e.length?[]:(0,r.tZ)(eN,{dashboardPubs:e,pub:v})}if(D)return(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,j.uX)((0,ew.BhD)(v,{addBase:!0}),{local_navigation:!1})},children:L("Unpause my subscription")});if(X||U){if(!y)return(0,r.BX)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{var e;(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,j.uX)((0,ew.W1P)(v,{utm_source:B.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eC.x)("referring_pub_ids"),addBase:!0,selectedPlanId:X&&(null==h?void 0:h.is_founding)&&v.plans?null===(e=v.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:L("Subscribe")}),(0,r.tZ)("span",{className:"desktop-only",children:L("Continue your support")})]})}else if(ey.oH(v)&&z&&!F&&!["thebulwark"].includes(v.subdomain)){if(!y)return(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,j.uX)((0,ew.W1P)(v,{utm_source:B.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eC.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,ex.getSubscribeText)(v,{isFreeSubscribed:!0,isMobile:(0,j.K1)(),language:A})})}else if(ey.oH(v)?F:z||F){if(v.invite_only&&F&&!c()(h.invites)&&h.invites<v.subscriber_invites)return(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,j.uX)((0,ew.UzE)(v),{local_navigation:!1})},children:(0,r.tZ)("span",{children:O("1 invite left","%1 invites left",v.subscriber_invites-h.invites)})});if(ey.oH(v)&&Z&&C&&!C.getConfigFor("hide_book_a_meeting_button"))return(0,r.BX)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,j.uX)((0,M.szv)(v,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:L("Book meeting")}),(0,r.tZ)("span",{className:"desktop-only",children:L("Book a meeting")})]});else if(ey.oH(v)&&h&&h.is_subscribed&&!V&&h.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(s=h.subscription_type)&&void 0!==s?s:""))return(0,r.BX)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),R()},disabled:N||S,style:{visibility:S?"hidden":"visible"},children:[(0,r.tZ)("span",{className:"mobile-only",children:L("Renew")}),(0,r.tZ)("span",{className:"desktop-only",children:L("Renew subscription")})]})}else if(!y){let e=null===(d=(0,eC.x)("referring_pub_ids"))||void 0===d?void 0:null===(l=d.split)||void 0===l?void 0:null===(a=l.call(d,","))||void 0===a?void 0:a[0],t=null===(p=(0,eC.x)("referring_pub_ids"))||void 0===p?void 0:null===(m=p.split)||void 0===m?void 0:null===(u=m.call(p,","))||void 0===u?void 0:u.slice(1);return(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:async()=>{let n=h&&!h.is_magic&&h.email||f;if((0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:v.homepage_type}),n){let o;try{o=(await _().post("/api/v1/free").send({source:"menu",email:n,first_url:q.xY,first_referrer:q.ip,current_url:q.UE,current_referrer:q.xU,first_session_url:q.ac,first_session_referrer:q.qR,referring_pub_id:e,additional_referring_pub_ids:t})).body.referral_token,(0,k.IU)()}catch(e){(0,k.j)(k.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,ew.W1P)(v,{utm_source:B.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:o})}else window.location.href=(0,ew.W1P)(v,{utm_source:B.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eC.x)("referring_pub_ids"),addBase:!0})},children:(0,ex.getSubscribeText)(v,{isFreeSubscribed:z,isMobile:(0,j.K1)(),language:A})})}if(ey.oH(v)&&h&&h.is_subscribed&&w){let e=(0,M.xdn)({pub:v,params:{utm_source:B.b3.menu}}),t=I("viral_gift_nav_bar_cta");if(P("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let n="treatment_send"===t?L(w>1?"Send free gifts":"Send free gift"):O("1 gift left","%1 gifts left",w);return(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,j.uX)(e,{local_navigation:!1})},children:n})}}if(ey.oH(v)&&h&&!h.is_founding&&!V&&(0,ec.Z)(h.subscription_first_payment_at).isBefore((0,ec.Z)().subtract(48,"hours"))&&((0,eb.VL)({pub:v})||"pinespayments"===v.subdomain||(null==v?void 0:null===(o=v.plans)||void 0===o?void 0:null===(n=o.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===n?void 0:null===(t=n.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,M.yRy)({pub:v,user:h,params:{utm_source:B.b3.menu,next:document.location.href}});return(0,r.BX)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,j.uX)(e,{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:L("Upgrade")}),(0,r.tZ)("span",{className:"desktop-only",children:L("Upgrade to founding")})]})}return"disabled"===v.payments_state&&!v.invite_only&&x("payment_pledges_enabled")&&z&&!(null==h?void 0:h.is_pledged)?(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,j.uX)((0,ew.W1P)(v,{utm_source:B.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:L("Pledge your support")}):ey.oH(v)&&!v.invite_only?(0,r.BX)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,j.uX)((0,eb.HD)({pub:v})&&h&&(null==C?void 0:C.getConfigFor("enable_founding_gifts"))?(0,eb.Iv)({user:h}):(0,ew.W1P)(v,{utm_source:B.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,r.tZ)("span",{className:"mobile-only",children:L("Give gift")}),(0,r.tZ)("span",{className:"desktop-only",children:L("Gift a subscription")})]}):!v.is_on_substack||(null==h?void 0:h.has_publication)?null:(0,r.tZ)(W.zx,{"data-testid":"noncontributor-cta-button",size:E?"sm":"md",onClick:()=>{(0,k.j)(k.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,j.uX)((0,ew._HV)({utm_source:B.b3.menu}),{local_navigation:!1})},children:L("Start publishing")})}({pub:I,user:R,freeSignup:d,freeSignupEmail:u,hide_subscribe_cta:Z,viralGiftsConfig:I.viralGiftsConfig,isPublishContext:P,localeContext:t,siteConfigContext:e,isMeetingsActive:C,hasViralGiftsCount:x,getSettingFor:ee,experimentApi:et,renewing:en,renewed:ei,setToRenew:eu,language:G,isMobile:Q}),!b&&(0,r.tZ)(T.Co,{pub:I,user:R,enableCustomerServiceMode:ea?em:void 0,disableCustomerServiceMode:el?ed:void 0,fixedTooltip:a})]})})})}),ea&&(0,r.tZ)(E.h,{children:(0,r.tZ)(h.p,{className:"account-info-customer-support-mode-modal",ref:$,openByDefault:S&&ea,children:(0,r.tZ)(p.Z,{redirect:(0,eC.x)("redirect")||"/publish/home",onCancel:e=>{var t;return null===(t=$.current)||void 0===t?void 0:t.close(e)},requiresMfa:null==R?void 0:R.requires_global_admin_mfa_challenge})})})]})}},28161:function(e,t,n){n.d(t,{Z:()=>a});var o=n(7409),i=n(99282),r=n(16584),s=n(64515);let a=e=>(0,r.BX)(s.l,(0,i._)((0,o._)({},e),{name:"SubstackLogoIcon",svgParams:{height:18,width:16,fill:"#ff6719",stroke:"none"},children:[(0,r.tZ)("path",{d:"M16 4H0V6H16V4Z"}),(0,r.tZ)("path",{d:"M0 8V18L7.9993 13.534L16 18V8H0Z"}),(0,r.tZ)("path",{d:"M16 0H0V2H16V0Z"})]}))},55294:function(e,t,n){n.d(t,{v:()=>eo});var o=n(7409),i=n(16584),r=n(30396),s=n(94184),a=n.n(s),l=n(14293),d=n.n(l),c=n(56743),u=n(1852),m=n(28161),_=n(11547),p=n(33804),h=n(99282),v=n(49336),g=n(2564),f=n(94499),y=n(98422),b=n(19081),Z=n(44424),w=n(17043);let C={subMenuTrigger:"subMenuTrigger-SKUcXd",subMenuItem:"subMenuItem-zrY1yO",disabled:"disabled-TCpkl9",logo:"logo-Jt_Kvr",chevron:"chevron-_e2GYQ"};function x(e){let{className:t,hideBorders:n,items:o,menuItemClassName:s,selectedMenuItemClassName:l,selectedSlug:d,pub:u}=e,{isMobile:m}=(0,y.v9)(),_=(0,r.sO)(null),[p,h]=(0,r.eJ)(!1),[x,P]=(0,r.eJ)(!1);function I(e){let{scrollLeft:t,scrollWidth:n,clientWidth:o}=e;h(t>10),P(n-(o+t)>10)}let N=e=>()=>{let{current:t}=_;t&&t.scrollBy({left:250*e,behavior:"smooth"})};return(0,r.d4)(()=>{I(_.current)},[]),(0,i.tZ)("div",{className:a()("overflow-list-container",t),children:(0,i.BX)(b.gq,{borderBottom:n?void 0:"detail",borderTop:n||m?void 0:"detail",className:a()("section-bar",{scroll:!0,"overflow-left":p,"overflow-right":x}),font:"text",height:m?44:48,justifyContent:m?"start":"center",paddingX:4,position:"relative",children:[(0,i.tZ)("div",{ref:_,className:"overflow-items",onScroll:e=>I(e.target),children:o.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:c,noFollow:m,subItems:_,newTab:p}=e;return _?(0,i.tZ)(Z.v2,{hideOnScroll:!0,layerOptions:{placement:"bottom-start",triggerOffset:6},title:t,trigger:(0,i.tZ)("div",{className:a()("menu-item",{selected:o===d},s,l&&{[l]:o===d}),children:(0,i.BX)(f.Z,{className:C.subMenuTrigger,native:r,rel:m?"nofollow":null,onClick:c,children:[(0,i.tZ)("span",{className:"overflow-item-text",children:t}),(0,i.tZ)(v.Z,{className:C.chevron,size:16})]})}),children:_.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:s,noFollow:l,logoUrl:d}=e,c=!!o&&parseInt("".concat(o))===(null==u?void 0:u.id),m=d||(null==u?void 0:u.logo_url);return(0,i.tZ)(Z.sN,{className:a()(C.subMenuItem,{[C.disabled]:c}),disabled:c,href:n,native:r,priority:"primary",rel:l?"nofollow":void 0,onClick:s,children:(0,i.BX)(b.gq,{alignItems:"center",gap:12,style:{margin:"-4px 0 -4px -4px"},children:[m&&(0,i.tZ)("img",{className:C.logo,src:(0,w.zF)(m,64),width:32}),t]})})})}):(0,i.tZ)("div",{className:a()("menu-item",{selected:o===d},s,l&&{[l]:o===d}),children:(0,i.tZ)(f.Z,{href:n,native:r,newTab:p,rel:m?"nofollow":null,onClick:c,children:(0,i.tZ)("span",{className:"overflow-item-text",children:t})})})})}),(0,i.tZ)("div",{className:"left-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:N(-1),children:(0,i.tZ)(c.Z,{strokeWidth:1.5})})}),(0,i.tZ)("div",{className:"right-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:N(1),children:(0,i.tZ)(g.Z,{strokeWidth:1.5})})})]})})}var P=n(95441),I=n(56629),N=n(40647),k=n(48884),S=n(76819),R=n(6070),M=n(63651),B=n(84864);let A={zeteo:{121146:"We’re Not Kidding"}},E=["/about","/chat","/archive","/newsletters"],L=e=>{let{isChatActive:t,isMeetingsActive:n,pub:o,selectedSectionId:r}=e,{language:s}=(0,P.M1)(),{getSettingFor:a}=(0,I.So)(),{getConfigFor:l}=(0,N.xR)(),d=!!l("publication_tabs_reorder"),c=!!a("notes_feed_enabled"),u=!!(a("reader_referrals_enabled")&&a("reader_referrals_leaderboard_enabled")),m=O({groupNewsletters:!!a("group_sections_and_podcasts_in_menu_enabled"),navBarItems:(0,S.Rx)(o.navigationBarItems||[],{isFeedEnabled:c,isChatActive:!!t,isChatEnabled:!!o.threads_v2_enabled,isMeetingsActive:!!n,hasMultipleNewsletters:o.sections&&o.sections.length>0,isReaderReferralsLeaderboardActive:u,language:s,useReordering:d}).filter(e=>!e.is_hidden),pub:o,language:s});return(0,i.tZ)(x,{items:m,className:"sections-overflow",selectedSlug:r,pub:o})},O=e=>{let{groupNewsletters:t,navBarItems:n,pub:o,language:i}=e,{iString:r}=k.mb.i(i),s=[];s.push({href:"/",label:r("Home"),slug:"/home"}),o.podcast_enabled&&o.show_pub_podcast_tab&&s.push({href:"/podcast",label:r("Podcast"),slug:"/podcast"});let a=[];return(0,R.jC)({pub:o})?a=T({navBarItems:n,groups:[{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===118995},excludeFromOthers:!0,isStandalone:!0},{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===121146},excludeFromOthers:!0,isStandalone:!0},{label:"Shows",condition:e=>{var t,n;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)||(null===(n=e.postTag)||void 0===n?void 0:n.slug)==="townhall"}},{label:"Columns",condition:e=>{var t,n;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)&&(null===(n=e.section)||void 0===n?void 0:n.id)!==132068}},{label:"Documentaries",condition:e=>{var t,n;return(null===(t=e.section)||void 0===t?void 0:t.id)===132068||(null===(n=e.section)||void 0===n?void 0:n.id)===214805}}]}):(0,R.VL)({pub:o})?(s.push({href:"/listen",label:"Shows",slug:"/listen"}),a=T({navBarItems:n.filter(e=>!e.section||!e.section.is_podcast||(0,B.sectionIsSpecificallyMarkedAsNewsletter)({section:e.section,pub:o})),groups:[{label:"Newsletters",condition:e=>!!e.section}]})):a=(0,R.p$)({pub:o})?T({navBarItems:n,groups:[{label:"Projects",condition:e=>{var t,n;return[146942,146943,150226].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"News / Research",condition:e=>{var t,n;return[146936,146935].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Calls-to-Action",condition:e=>{var t,n;return[146939,146941,146949].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Recommendations",condition:e=>{var t,n;return[146958].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)||"https://bookshop.org/shop/globalfreedoms"===e.link_url},excludeFromOthers:!0},{label:"Podcasts",condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)},excludeFromOthers:!0}]}):t?T({navBarItems:n,groups:[{label:r("Newsletters"),condition:e=>{var t;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}},{label:r("Podcasts"),condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}}]}):n,[...s,...F({groupedNavBarItems:a,pub:o})]},T=e=>{let{navBarItems:t,groups:n}=e,o=[...t],i=[],r=[...t];for(let e of n)if(e.isStandalone){let t=o.find(e.condition);if(!t)continue;i.push(t),r=r.filter(e=>e!==t),e.excludeFromOthers&&(o=o.filter(e=>e!==t))}else{var s;let t=o.filter(e.condition);if(0===t.length)continue;i.push({label:null!==(s=e.label)&&void 0!==s?s:"Other",navBarItems:t}),r=r.filter(t=>!e.condition(t)),e.excludeFromOthers&&(o=o.filter(t=>!e.condition(t)))}return[...i,...r]},F=e=>{let{groupedNavBarItems:t,pub:n}=e;return t.map(e=>"navBarItems"in e?{label:e.label,subItems:e.navBarItems.map(e=>z({navBarItem:e,pub:n}))}:z({navBarItem:e,pub:n}))},z=e=>{var t,n,i,r,s,a;let{navBarItem:l,pub:d}=e;if(l.section){let e=l.section,a=e.is_podcast&&null!==(r=null===(n=d.sections.find(t=>t.id===e.id))||void 0===n?void 0:null===(t=n.podcastSettings)||void 0===t?void 0:t.podcast_art_url)&&void 0!==r?r:e.logo_url;return(0,h._)((0,o._)({label:null!==(s=null===(i=A[d.subdomain])||void 0===i?void 0:i[e.id])&&void 0!==s?s:(0,B.truncateText)(e.name,30),href:(0,M.Ucy)(d,{section:e})},a?{logoUrl:a}:null),{slug:e.id})}let c=(0,S.Hs)(l),u="link"===c&&!(l.standard_key||E.includes(null!==(a=l.link_url)&&void 0!==a?a:"")),m=u&&d.tier<2;return(0,h._)((0,o._)({href:(0,M.Oz)(d,l,{addBase:u}),label:(0,B.truncateText)((0,S.ye)(l),30)},m?{noFollow:m}:null,"page"===c?{isNative:!0}:null),{slug:(0,M.Oz)(d,l,{addBase:!1}),newTab:u})};var X=n(39693),U=n.n(X),D=n(60308),q=n(36515);let V=e=>{let{hasMeetingsBooked:t,isMeetingsActive:n,pub:o,selectedSectionId:r,user:s}=e,{language:l}=(0,P.M1)(),{iString:d}=k.mb.i(l),c=[{href:(0,D.QK7)(o),label:d("Home"),slug:"/publish/home"},{href:"/publish/posts",label:d("Posts"),slug:"/publish/posts"},...(null==s?void 0:s.is_admin)?U()([{href:(0,D.dIB)(o),label:d("Subscribers"),slug:"/publish/subscribers"},{href:"/publish/stats",label:d("Stats"),slug:"/publish/stats"},{href:(0,D.jHQ)(o),label:d("Podcast"),slug:"/publish/podcasting"},{href:(0,q.r)(o,{noBase:!0}),label:d("Chat"),slug:"/publish/chat"},{href:"/publish/recommendations",label:d("Recommendations"),slug:"/publish/recommendations"},(n||!!t)&&{href:"/publish/meetings",label:d("Meetings"),slug:"/publish/meetings"},{href:(0,D.wI3)(o),label:d("Settings"),slug:"/publish/settings"}]):[]];return(0,i.tZ)(x,{items:c,className:a()("sections-overflow","publish-menu"),selectedSlug:r,pub:o})};var j=n(347),H=n(98914);let W=()=>Math.max(document.documentElement.scrollTop||document.body.scrollTop,0),J=e=>{let{alwaysShow:t,disable:n,menuContentRef:o,menuHeight:i}=e,s=(0,r.sO)(!1),a=(0,r.sO)(W()),l=(0,r.sO)(W()),d=(0,r.I4)((e,t)=>{a.current=t,o.current&&(o.current.style.position=e,o.current.style.top="fixed"===e&&t>=0?"":"".concat(t,"px"))},[o]),c=(0,r.I4)(()=>{d("absolute",W()-i),s.current=!1},[i,d]),u=(0,r.I4)(e=>{let t=e.target;((null==t?void 0:t.classList.contains("footnote-number"))||(null==t?void 0:t.classList.contains("footnote-anchor")))&&(s.current=!0,setTimeout(c,0))},[c]),m=(0,r.I4)(()=>{var e;if(t){d("fixed",0);return}if(s.current)return;let r=l.current;l.current=W();let c=l.current,u=(null===(e=o.current)||void 0===e?void 0:e.style.position)==="fixed",m=c<=0||0>=(0,H.bs)(),_=c>=(0,H.bs)(),p=c>r,h=c<r;if(m){d("fixed",0);return}if(n){d("absolute",0);return}if(!_){if(p){if(u&&a.current>=0){d("absolute",c);return}if(!u&&a.current<c-i){d("fixed",-i);return}}if(h){if(a.current>c){d("fixed",c);return}let e=Math.max(c-i,0);if(a.current<e){d("absolute",e);return}}}},[t,o,n,d,i]);(0,r.d4)(()=>{if("undefined"!=typeof window)return window.addEventListener("scroll",m),window.addEventListener("click",u),m(),()=>{window.removeEventListener("scroll",m),window.removeEventListener("click",u)}},[n,u,m,d])};var K=n(68833),G=n(9682),Y=n(15771),Q=n(38841),$=n(63474),ee=n(58175),et=n(47929);let en={mainMenuContent:"mainMenuContent-DME8DR",topBar:"topBar-pIF0J1",titleWithWordmark:"titleWithWordmark-GfqxEZ",titleContainer:"titleContainer-DJYq5v",title:"title-oOnUGd",buttonsContainer:"buttonsContainer-SJBuep",logoContainer:"logoContainer-p12gJb","fixed-screen-border":"fixed-screen-border-gLZ7nt",fixedScreenBorder:"fixed-screen-border-gLZ7nt"},eo=e=>{var t;let{className:n,freeSignup:s,freeSignupEmail:l,hasMeetingsBooked:d,hasViralGiftsCount:h,hideNavBar:v,hideTitle:g,isAccountContext:f,isChatActive:Z,isMeetingsActive:w,isPostView:C,isPublishContext:x,pub:P,selectedSectionId:I,showCustomerSupportModeModal:k,user:S}=e;g="profile"===P.homepage_type||g;let{getConfigFor:B}=(0,N.xR)(),{isMobile:A}=(0,y.v9)(),E=(0,u.useMediaQuery)({query:"(max-width: 650px)"}),[O]=(0,G.tv)(),T=(0,r.sO)(null),F=(0,r.sO)(null),z=(0,r.sO)(null),X="profile"===P.homepage_type,U=X&&O.path.match(/\/profile\/(subscribers|followers|following)/),q=!X&&!!P.logo_url&&!(0,R.kb)({pub:P}),H=!!(!g&&P.logo_url_wide),W=C?!!B("show_menu_on_posts"):!v,eo=(0,R.kb)({pub:P})||!!(B("larger_wordmark_on_publication_homepage")&&H),{currentMenuHeight:es,currentTopBarHeight:ea,isMinimized:el,maxMenuHeight:ed}=ei({hasExpandableTopBar:eo,forceMaximized:!C&&!f&&!x,forceMinimized:!!(f||x),isMobile:A,showNavBar:W,showWordmark:H}),ec=A?12:eo?40:20,eu=!A&&eo&&el?20:0,em=A?eo?32:20:eo?72:36,e_=!A&&eo&&el?.5555555555555556:1;J({alwaysShow:!!x,disable:!C,menuContentRef:T,menuHeight:es});let{shouldCenterTitle:ep}=er({buttonsRef:z,titleRef:F,horizontalGap:12,horizontalPadding:eo?40:20}),eh=A||!ep,ev=f||x?(0,M.SVA)(P):"/",eg=f||x?p.w:j.h,ef=0;return X&&!E&&("/"===O.path||"/profile/subscribers"===O.path)&&(ef=ec+(A?48:38)+12),(0,i.tZ)(eg,{children:(0,i.BX)("div",{className:a()("main-menu",n),"data-testid":"navbar",children:[(0,i.BX)("div",{ref:T,className:en.mainMenuContent,children:[X&&("/"===O.path||"/profile/subscribers"===O.path)&&(0,i.tZ)("div",{className:en.fixedScreenBorder,style:{height:ea}}),(0,i.BX)(b.gq,{alignItems:"center",borderBottom:W?void 0:"detail-themed",className:en.topBar,gap:12,justifyContent:"space-between",paddingBottom:A?12*!W:void 0,paddingTop:A?12:void 0,paddingX:ec,style:A?void 0:{position:"relative",height:ea},children:[(0,i.BX)("div",{className:en.logoContainer,style:(0,o._)({display:X||q||!eh?null:"none",flexBasis:0,flexGrow:+!eh},eo?{transform:"translateX(-".concat(eu,"px)")}:null),children:[X&&(0,i.BX)(b.gq,{alignItems:"center",gap:40,children:[(0,i.tZ)(b.hs,{alignItems:"center",as:"a",height:20,href:(0,M.n1t)((0,M.SVA)(),{utm_content:et.fZ.islandSubstackLogo}),justifyContent:"center",tabIndex:-1,width:20,children:A?(0,i.tZ)(m.Z,{height:24}):(0,i.tZ)(m.Z,{style:{transform:"scale(1.4)"}})}),U&&(0,i.tZ)(Y.hU,{className:en.backButton,href:(0,D.TJI)(P),size:A?"sm":"md",children:(0,i.tZ)(c.Z,{size:20})})]}),q&&(0,i.tZ)(Q.jM,{href:ev,pub:P,size:A?32:40,onClick:()=>{(0,K.j)(K.FP.NAV_BAR_HOME_LINK_CLICKED)}})]}),!g&&(0,i.tZ)("div",{ref:F,className:en.titleContainer,style:(0,o._)({flexGrow:0},eo?{transform:"translateX(".concat(eh?-eu:0,"px)")}:null),children:(0,i.tZ)(ee.xv,{as:"h1",className:a()(en.title,{[null!==(t=en.titleWithWordmark)&&void 0!==t?t:""]:P.logo_url_wide}),font:"pub-headings",children:(0,i.tZ)($.A0,{href:ev,children:P.logo_url_wide?(0,i.tZ)("img",{alt:P.name,src:(0,M.zF4)(P.logo_url_wide,null,{height:2*em,crop:"limit",leadingSegments:["e_trim:10:white","e_trim:10:transparent"]}),style:(0,o._)({display:"block",height:em},eo?{transform:"scale(".concat(e_,")"),transformOrigin:eh?"left":"center"}:null)}):P.name})})}),(0,i.tZ)(b.gq,{justifyContent:"end",style:{flexBasis:0,flexGrow:1},children:(0,i.tZ)("div",{ref:z,className:en.buttonsContainer,style:eo?{transform:"translateX(".concat(eu,"px)")}:void 0,children:(0,i.tZ)(_.Z,{freeSignup:s,freeSignupEmail:l,hasViralGiftsCount:h,isAccountContext:f,isMeetingsActive:w,isPublishContext:x,pub:P,showCustomerSupportModeModal:k,user:S})})}),X&&ef>0&&(0,i.tZ)("div",{style:{position:"absolute",bottom:A?"0px":"-1px",left:"0px",width:"".concat(ef,"px"),height:"1px",backgroundColor:"var(--color-bg-primary)",zIndex:1}})]}),W&&(x?(0,i.tZ)(V,{hasMeetingsBooked:d,isMeetingsActive:w,pub:P,selectedSectionId:I,user:S}):(0,i.tZ)(L,{isChatActive:Z,isMeetingsActive:w,pub:P,selectedSectionId:I}))]}),(0,i.tZ)("div",{style:{height:ed}})]})})},ei=e=>{let{forceMaximized:t,forceMinimized:n,hasExpandableTopBar:o,isMobile:i,showNavBar:s,showWordmark:a}=e,[l,c]=(0,r.eJ)(!1),u=(0,r.sO)(null),m=!!n||!t&&l,_=e=>i?s?44:56:o?e?72:120:a?88:72,p=s?i?45:50:0,h=_(n)+p,v=_(m),g=(0,r.I4)(()=>{let e=u.current,t=document.documentElement.scrollTop||document.body.scrollTop;if(u.current=t,!d()(e))t>e?t>h+5&&c(!0):t<=0&&c(!1)},[h]);return(0,r.d4)(()=>(window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)),[g]),{currentMenuHeight:v+p,currentTopBarHeight:v,isMinimized:m,maxMenuHeight:h}},er=e=>{let{buttonsRef:t,titleRef:n,horizontalGap:o,horizontalPadding:i}=e,{isMobile:s}=(0,y.v9)(),[a,l]=(0,r.eJ)(!s),d=(0,r.I4)(()=>{if(!t.current||!n.current)return;if(s){l(!1);return}let e=t.current.getBoundingClientRect().width,r=n.current.getBoundingClientRect().width;l(.5*document.body.clientWidth-e-o-i>.5*r)},[t,o,i,s,n]);return(0,r.d4)(()=>(window.addEventListener("resize",d),d(),setTimeout(d,0),()=>{window.removeEventListener("resize",d)}),[d]),{shouldCenterTitle:a}}},21061:function(e,t,n){n.d(t,{l:()=>a});var o=n(30396),i=n(24350),r=n.n(i),s=n(81977);let a=e=>{let{pub:t}=e,n=r()(t.sections,"id"),{setting:i,save:a}=(0,s.m)({key:"archived_section_ids",fallback:[]}),[l,d]=(0,o.eJ)(i),[c,u]=(0,o.eJ)(!1),m=async()=>{u(!0),await a({setting:l})};return{isSaving:c,ids:l,onChange:e=>{let{ids:t}=e;d(t.filter(e=>n[e]))},onSave:m}}},73207:function(e,t,n){n.d(t,{I:()=>d});var o=n(30396),i=n(24350),r=n.n(i),s=n(78718),a=n.n(s),l=n(81977);let d=e=>{let{pub:t,pubSetting:n="column_section_ids"}=e,i=r()(null==t?void 0:t.sections,"id"),{setting:s,save:d}=(0,l.m)({key:n,fallback:{metadata:{},order:[]}}),[c,u]=(0,o.eJ)(s.order),[m,_]=(0,o.eJ)(s.metadata),[p,h]=(0,o.eJ)(!1),v=async()=>{h(!0),await d({setting:{order:c,metadata:a()(m,c)}})};return{isSaving:p,metadata:m,ids:c,onChangeMetadata:e=>{let{metadata:t}=e;_(t)},onChangeOrder:e=>{let{ids:t}=e;u(t.filter(e=>i[e]))},onSave:v}}},98130:function(e,t,n){n.d(t,{L:()=>d});var o=n(30396),i=n(39693),r=n.n(i),s=n(24350),a=n.n(s),l=n(81977);let d=e=>{let{pub:t}=e,n=a()(t.sections,"id"),{setting:i,save:s}=(0,l.m)({key:"event_section_ids",fallback:[]}),[d,c]=(0,o.eJ)(i),[u,m]=(0,o.eJ)(!1),_=async()=>{m(!0),await s({setting:d})};return{initialSections:r()(i.map(e=>n[e])),isSaving:u,ids:d,sections:r()(d.map(e=>n[e])),onChange:e=>{let{ids:t}=e;c(t.filter(e=>n[e]))},onSave:_}}},81977:function(e,t,n){n.d(t,{m:()=>i});var o=n(56629);let i=e=>{let t,{key:n,fallback:i}=e,{getSettingFor:r,changeSetting:s}=(0,o.So)(),a=r(n);try{t=a?JSON.parse(a):i}catch(e){t=i}return{setting:t,save:async e=>{let{setting:t}=e;await s({[n]:JSON.stringify(t)})}}}},94778:function(e,t,n){n.d(t,{c:()=>m});var o=n(30396),i=n(39693),r=n.n(i),s=n(24350),a=n.n(s),l=n(78718),d=n.n(l),c=n(81977);let u=["mediumYellow","darkGreen","mediumRed","darkOrange","mediumPurple","mediumBlue"],m=e=>{let{pub:t}=e,n=a()(t.sections,"id"),{setting:i,save:s}=(0,c.m)({key:"video_section_ids",fallback:{metadata:{},order:[]}});for(let e=0;e<i.order.length;e++){var l,m,_;let t=i.order[e];t&&((null===(l=i.metadata[t])||void 0===l?void 0:l.carouselColor)||(i.metadata[t]={youtubeUrl:null!==(_=null===(m=i.metadata[t])||void 0===m?void 0:m.youtubeUrl)&&void 0!==_?_:"",carouselColor:u[e%u.length]}))}let[p,h]=(0,o.eJ)(i.order),[v,g]=(0,o.eJ)(i.metadata),[f,y]=(0,o.eJ)(!1),b=async()=>{y(!0),await s({setting:{order:p,metadata:d()(v,p)}}),window.location.reload()};return{initialSections:r()(i.order.map(e=>n[e])),isSaving:f,metadata:v,ids:p,sections:r()(p.map(e=>n[e])),onChangeMetadata:e=>{let{metadata:t}=e;g(t)},onChangeOrder:e=>{let{ids:t}=e;h(t.filter(e=>n[e]))},onSave:b}}},12757:function(e,t,n){n.d(t,{Co:()=>z});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(30396),l=n(94184),d=n.n(l),c=n(66120),u=n(24840),m=n(43061),_=n(84488),p=n(86374),h=n(83320),v=n(87698),g=n(89320),f=n(9997),y=n(78327);let b=(0,n(6400).createContext)(!1);var Z=n(95441),w=n(36518),C=n(68833),x=n(43251),P=n(98422),I=n(94874),N=n(17540),k=n(15771),S=n(19081),R=n(44424),M=n(58175),B=n(60308),A=n(6911),E=n(63651),L=n(47929),O=n(75983);let T=L.b3.userMenu,F="https://support.substack.com/hc/en-us/?utm_source=".concat(T);function z(e){var{user:t,pub:n}=e,l=(0,r._)(e,["user","pub"]);let{iString:c}=(0,Z.M1)(),u=(0,a.qp)(b),{isMobile:m}=(0,P.v9)();return(0,s.tZ)(s.HY,{children:t?(0,s.tZ)(X,(0,i._)((0,o._)({},l),{user:t,pub:n})):(0,s.tZ)(k.zx,{href:(0,B.uXE)({for_pub:null==n?void 0:n.subdomain}),priority:"tertiary",size:m?"sm":"md",className:d()({"force-desktop":u}),native:!0,children:c("Sign in")})})}function X(e){let{user:t,pub:n,enableCustomerServiceMode:o,disableCustomerServiceMode:i,freeSignup:r}=e,{iString:a}=(0,Z.M1)(),{activityUnreadCount:l}=(0,w.lR)(),{isMobile:d}=(0,P.v9)(),m=e=>()=>{(0,C.j)(e)},_=d||!t.photo_url?(0,s.tZ)(k.hU,{priority:"tertiary",size:"sm",children:(0,s.tZ)(c.Z,{size:20})}):(0,s.tZ)(k.kG,{resetCss:!0,position:"relative",className:O.Z.avatarButton,showFocus:!0,animate:!0,radius:"full",children:(0,s.tZ)(N.Ct,{priority:"secondary",theme:"default",fillIcon:!0,placement:"bottom-right",content:(0,s.tZ)(p.Z,{size:14}),children:(0,s.tZ)(I.qE,{user:t,size:d?32:40,"aria-hidden":!0})})});return(0,s.BX)(R.v2,{trigger:_,onOpen:()=>(0,C.j)(C.FP.USER_MENU_OPENED),onClose:()=>(0,C.j)(C.FP.USER_MENU_DISMISSED),className:O.Z.dropdown,ariaLabel:a("More options"),children:[(0,s.tZ)(U,{user:t}),(0,s.BX)(R.xw,{children:[(0,s.tZ)(R.sN,{href:(0,B.E2n)({urlParams:{utm_source:T}}),onClick:m(C.FP.USER_MENU_FEED_CLICKED),leading:(0,s.tZ)(S.hs,{children:(0,s.tZ)(g.Z,{size:20})}),native:!0,children:a("Home")}),(0,s.tZ)(R.sN,{href:(0,B.HMK)({utm_source:T}),onClick:m(C.FP.USER_MENU_READER_CLICKED),leading:(0,s.tZ)(S.hs,{children:(0,s.tZ)(f.Z,{size:20})}),native:!0,children:a("Subscriptions")}),(0,s.tZ)(R.sN,{href:(0,E.Cnj)(),onClick:m(C.FP.USER_MENU_CHAT_CLICKED),leading:(0,s.tZ)(S.hs,{children:(0,s.tZ)(v.Z,{size:20})}),native:!0,children:a("Chat")}),(0,s.tZ)(R.sN,{href:(0,B.Fu$)({utm_source:T}),onClick:m(C.FP.USER_MENU_ACTIVITY_CLICKED),leading:(0,s.tZ)(S.hs,{children:(0,s.tZ)(h.Z,{size:20})}),native:!0,children:(0,s.BX)(S.hs,{flex:"grow",justifyContent:"space-between",children:[a("Activity"),l>0&&(0,s.tZ)(y.V,{className:"indicator-badge",count:l})]})}),(0,s.tZ)(R.sN,{href:(0,B._P8)(),onClick:m(C.FP.USER_MENU_DISCOVER_CLICKED),leading:(0,s.tZ)(S.M5,{width:20,height:20,children:(0,s.tZ)(u.Z,{size:16,strokeWidth:2})}),native:!0,children:a("Explore")})]}),(0,s.tZ)(D,{freeSignup:null!=r&&r,pub:null!=n?n:null,user:t}),(0,s.tZ)(q,{pub:null!=n?n:null}),!t.reader_installed_at&&(0,s.tZ)(R.xw,{children:(0,s.tZ)(R.sN,{href:(0,B.tSX)({utm_campaign:L.VX.appMarketing,utm_content:L.fZ.userMenuLink}),priority:"accent",native:!0,children:a("Get the app")})}),(0,s.tZ)(V,{enableCustomerServiceMode:o,disableCustomerServiceMode:i,pub:null!=n?n:null,user:t}),(0,s.tZ)(j,{pub:null!=n?n:null})]})}let U=e=>{let{user:t}=e,{iString:n}=(0,Z.M1)(),o=(0,x.Lw)(t,{utm_source:T}),i="",r="";return t&&(i=(null==t?void 0:t.profile_set_up_at)&&t.name?t.name:t.email,r=(null==t?void 0:t.profile_set_up_at)?t.handle?"@".concat(t.handle):null:n("Set up your profile")),(0,s.tZ)(R.sN,{href:o,onClick:()=>(0,C.j)(C.FP.USER_MENU_PROFILE_CLICKED),native:!0,children:(0,s.BX)(S.hs,{gap:12,alignItems:"center",children:[(0,s.tZ)(I.qE,{size:40,user:null!=t?t:void 0,"aria-hidden":!0}),(0,s.BX)(S.tu,{flex:"grow",children:[(0,s.tZ)(M.xv.B4,{weight:"semibold",children:i}),r&&(0,s.tZ)(M.xv.B4,{color:"secondary",children:r})]})]})})},D=e=>{let{freeSignup:t,user:n,pub:o}=e,{iString:i}=(0,Z.M1)(),r=o&&(t||n&&(n.is_subscribed||n.is_free_subscribed)),a=!!(null==n?void 0:n.subdomain);return a||r?(0,s.BX)(R.xw,{children:[r&&(0,s.tZ)(R.sN,{href:(0,B.n1t)("/account",{utm_source:T}),onClick:()=>(0,C.j)(C.FP.USER_MENU_MANAGE_SUBSCRIPTION_CLICKED),priority:"secondary",native:!0,children:i("Manage subscription")}),a&&n.subdomain&&(0,s.tZ)(R.sN,{priority:"secondary",href:(0,B.c0Q)(n.subdomain,{params:{utm_source:L.b3.substack}}),native:!0,trailing:(0,s.tZ)(m.Z,{}),children:i("Dashboard")})]}):null},q=e=>{let{pub:t}=e,{iString:n}=(0,Z.M1)();return(0,s.BX)(R.xw,{children:[(0,s.tZ)(R.sN,{href:(0,B.v3t)({utm_source:T}),onClick:()=>(0,C.j)(C.FP.USER_MENU_ACCOUNT_SETTINGS_CLICKED),priority:"secondary",native:!0,children:n("Settings")}),(0,s.tZ)(R.sN,{href:F,priority:"secondary",children:n("Support")}),(0,s.tZ)(R.sN,{href:(0,B.ZPN)({utm_source:T,for_pub:null==t?void 0:t.subdomain}),priority:"secondary",native:!0,children:n("Sign out")})]})},V=e=>{let{disableCustomerServiceMode:t,enableCustomerServiceMode:n,pub:o,user:i}=e;return(null==i?void 0:i.is_global_admin)&&(n||t)?(0,s.BX)(R.xw,{children:[n&&(0,s.tZ)(R.sN,{priority:"secondary",onClick:n,trailing:(0,s.tZ)(_.Z,{}),native:!0,children:"Enter support mode"}),t&&(0,s.tZ)(R.sN,{priority:"secondary",onClick:t,trailing:(0,s.tZ)(_.Z,{}),native:!0,children:"Exit support mode"}),o&&(0,s.tZ)(R.sN,{priority:"secondary",href:"".concat((0,E.SVA)({subdomain:"admin"}),"/publications/").concat(o.id),trailing:(0,s.tZ)(_.Z,{}),native:!0,children:"Open in Underground"})]}):null},j=e=>{let{pub:t}=e,{iString:n}=(0,Z.M1)();return(0,s.tZ)(R.xw,{children:(0,s.tZ)(M.xv.B4,{size:12,color:"secondary",children:(0,s.BX)(S.hs,{gap:12,padding:8,className:"footer",children:[(0,s.tZ)(M.hh,{href:(0,B.cdl)({utm_source:T}),children:n("About")}),(0,s.tZ)(M.hh,{href:(0,A.RF)({pub:t,utm_source:T}),children:n("Privacy")}),(0,s.tZ)(M.hh,{href:(0,A.P8)({pub:t,utm_source:T}),children:n("Terms")}),(0,s.tZ)(M.hh,{href:(0,A.WF)({utm_source:T}),children:n("Data")})]})})})}},35543:function(e,t,n){n.d(t,{Sv:()=>R,Xe:()=>N,oJ:()=>k,oh:()=>S,yr:()=>M});var o=n(7409),i=n(99282),r=n(58865),s=n(16584),a=n(30396),l=n(82569),d=n.n(l),c=n(94734),u=n(17520),m=n(69241),_=n(19548),p=n(95441),h=n(60807),v=n(54371),g=n(6910),f=n(48980),y=n(63018),b=n(98914),Z=n(44424),w=n(70379),C=n(88817),x=n(23945);function P(){let e=(0,r._)(["Followed ",""]);return P=function(){return e},e}function I(){let e=(0,r._)(["Unfollowed ",""]);return I=function(){return e},e}function N(e){let t=(0,h.aF)();return(0,y._I)("/api/v1/feed/following",(0,o._)({auto:!!t},e))}function k(){let{mutate:e}=(0,m.kY)();return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return e("/api/v1/feed/following",...n)}}function S(e,t,n){let{isFollowing:o,toggle:i}=R(e,t,n),r=(0,h.aF)(),a=(0,_.gc)(null==e?void 0:e.id),l=!!(r&&e&&r.id!==e.id)&&!a,d=[];return l&&d.push((0,s.tZ)(Z.sN,{leading:o?(0,s.tZ)(g.m,{stroke:"var(--color-fg-primary)"}):(0,s.tZ)(v.w,{stroke:"var(--color-fg-primary)"}),onClick:i,children:o?"Unfollow":"Follow"})),d}function R(e,t,n,r){let a=(0,h.aF)(),{onboardingModalRef:l,requireLogin:m}=(0,C.SJ)(),_=function(e,t){let{data:n}=N(t);return(null!=n?n:[]).includes(null!=e?e:0)}(null==e?void 0:e.id,r),{mutate:v,data:g}=N(r),y=(0,w.pm)(),Z=(0,x.Q1)((null==e?void 0:e.name)||""),{iString:k,iTemplate:S}=(0,p.M1)(),R=async r=>{if(e){if(!a&&l.current){m?m():l.current.open();return}v(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r?[...t,e.id]:d()(t,e.id)},{revalidate:!1});try{await (0,f.rd)("/api/v1/feed/".concat(e.id,"/follow"),{method:r?"POST":"DELETE",json:{surface:t,noteId:n}}),y.popToast(e=>(0,s.tZ)(w.FN,(0,i._)((0,o._)({},e),{Icon:r?c.Z:u.Z,text:r?S(P(),Z):S(I(),Z),cta:k("Undo"),onAccept:()=>R(!r)})))}catch(e){y.popToast(t=>(0,s.tZ)(w.FN,(0,i._)((0,o._)({},t),{text:(0,b.zx)(e)})));return}}};return{isFollowing:_,toggle:()=>R(!_),isLoaded:!!g}}function M(e,t,n){let{isFollowing:o,toggle:i}=R(e,t,n),[r,s]=(0,a.eJ)(!1);return{isFollowing:o,buttonProps:{onClick:()=>{i(),o||s(!0)},onMouseLeave:()=>s(!1)}}}},36518:function(e,t,n){n.d(t,{N$:()=>p,lR:()=>v});var o=n(16584),i=n(6400),r=n(30396),s=n(32351),a=n(14952),l=n(48980),d=n(8635),c=n(7882),u=n(98750),m=n(98914),_=n(6070);function p(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:r,children:s}=e;return(0,o.tZ)(g,{defaultState:null==t?void 0:t.activity,shouldLoad:n,shouldPoll:i,activityToken:r,children:s})}let h=(0,i.createContext)({lastViewedAt:null,activityUnreadCount:0,activityUnreadAtMax:!1,refetch:async()=>!0,markAllAsRead:async()=>{},hasLoadedOnce:!1});function v(){return(0,r.qp)(h)}function g(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:p,children:v}=e,g=(0,c.ib)({pathname:"/api/v1/activity/unread",deps:[],auto:n,initialResult:t,query:{token:p}}),f=(0,a.Ij)(),y=!!f&&(0,_.HD)({pub:f}),b=!(0,u.th)()&&!y,Z=async()=>{let e=await (0,l.rd)("/api/v1/activity/unread",{method:"post",json:{after:new Date().toISOString(),token:p}});g.setResult(e)};(0,d.Z)(async()=>{if(i&&n&&(0,m.dr)()){var e;let t=(null===(e=g.result)||void 0===e?void 0:e.count)||0,n=await g.refetch();if(t!==(!(n instanceof Error)&&n.count||0))return!0}},6e4);let w=null!=g.result?g.result.count:0;return(0,r.d4)(()=>{try{var e,t;null===(e=(t=navigator).setAppBadge)||void 0===e||e.call(t,w)}catch(e){console.warn(e)}},[w]),(0,o.BX)(h.Provider,{value:{lastViewedAt:null!=g.result?g.result.lastViewedAt:null,activityUnreadCount:w,activityUnreadAtMax:null!=g.result&&g.result.max,refetch:g.refetch,markAllAsRead:Z,hasLoadedOnce:g.hasLoadedOnce},children:[(0,o.tZ)(s.Metadata,{badge:b?w:void 0}),v]})}h.displayName="NotificationsContext"},42375:function(e,t,n){n.d(t,{$U:()=>m,rI:()=>p});var o=n(16584),i=n(98661),r=n(30396),s=n(25642),a=n(27744),l=n(75822),d=n(88817),c=n(75419),u=n(41233);function m(e){let{state:t,dispatch:n,surface:i,children:m}=e,{onboardingModalRef:p}=(0,d.SJ)(),h=(0,r.Ye)(()=>({dispatch:n}),[]);return(0,o.tZ)(_.Provider,{value:i,children:(0,o.tZ)(a.RR.Provider,{value:h,children:(0,o.tZ)(a.ev.Provider,{value:t,children:(0,o.tZ)(s.ju,{children:(0,o.tZ)(c.Au,{children:(0,o.BX)(l.qS,{children:[m,(0,o.tZ)(u.fA,{isOpen:!!t.isSigningIn,onCancel:()=>n({type:"sign_in",payload:{isSigningIn:!1}}),onSuccess:()=>{n({type:"sign_in",payload:{isSigningIn:!1}}),document.location.reload()},onSignup:()=>{var e;n({type:"sign_in",payload:{isSigningIn:!1}}),null===(e=p.current)||void 0===e||e.open()},noExit:t.signInNoExit})]})})})})})})}let _=(0,i.createContext)("feed");function p(){return(0,r.qp)(_)}},43251:function(e,t,n){n.d(t,{Lw:()=>i});var o=n(60308);function i(e,t){return(null==e?void 0:e.profile_set_up_at)?(0,o.NNq)(e,t):(0,o.Nhr)((null==t?void 0:t.utm_source)?{utm_source:t.utm_source}:void 0)}},46234:function(e,t,n){n.d(t,{B:()=>d});var o=n(7409),i=n(16584),r=n(19081),s=n(58175),a=n(14773),l=n(63651);let d=e=>{let{firehoseFeedUrl:t,pub:n,section:d,trackingSource:c,variant:u="default"}=e,m=(0,a.n1)("/p/how-do-i-add-a-bulwark-member-only",(0,o._)({utm_source:c},d?{utm_content:d.id}:null)),_=(0,a.n1)("/account/add-all-podcasts",(0,o._)({utm_source:c},d?{utm_content:d.id}:null)),p=t?(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Click here to set up your podcast app for"," ",(0,i.tZ)("a",{href:t,rel:"noopener noreferrer",target:"_blank",children:"everything in one feed"})]}):null,h=(0,l.W1P)(n,{params:{utm_source:c}});return(0,i.tZ)("div",{className:"container-o06YlK",children:"member-only"===u?(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Want to listen without ads? Join Bulwark+ for exclusive ad-free versions of all Bulwark shows."," ",(0,i.tZ)("a",{href:h,rel:"noopener noreferrer",target:"_blank",children:"Upgrade now"})]}),(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Already a Bulwark+ member? Login to access premium shows. ",(0,i.tZ)("a",{href:m,children:"Learn more here"})]})]}):(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Learn about"," ",(0,i.tZ)("a",{href:m,rel:"noopener noreferrer",target:"_blank",children:"setting up your Bulwark+ private podcast feeds"})]}),p||(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Add the Bulwark Premium Show"," ",(0,i.tZ)("a",{href:_,rel:"noopener noreferrer",target:"_blank",children:"super feed"})]})]})})}},30733:function(e,t,n){n.d(t,{N:()=>a});var o=n(16584),i=n(94184),r=n.n(i),s=n(71068);let a=e=>{let{children:t,columns:n=2,paddingTop:i=24}=e,a=(0,s.oB)({paddingTop:i,paddingX:16,paddingBottom:32});return(0,o.tZ)("div",{className:r()("container-kIrj2N",a,{"containerThreeColumn-Rot594":3===n,"containerFourColumn-vOHVwe":4===n}),children:t})}},84370:function(e,t,n){n.d(t,{T:()=>a});var o=n(16584),i=n(43570),r=n(58175),s=n(52503);function a(e){let{modifier:t,children:n,className:a}=e,l=function(e){let t=navigator.platform.toLowerCase().includes("mac");switch(null==e?void 0:e.toLowerCase()){case"cmd":return t?"⌘":"Ctrl + ";case"shift":return t?"⇧":"Shift + ";case"alt":case"opt":return t?"⌥":"Alt + ";case"ctrl":return t?"⌃":"Ctrl + ";case"esc":return"Esc";case"left":return"←";case"right":return"→";case"up":return"↑";case"down":return"↓";default:return""}}(t);return(0,o.tZ)(i.Vp,{priority:"secondary-outline",theme:"default",className:a,children:(0,o.BX)(r.xv,{as:"kbd",font:"text",weight:"regular",color:"secondary",className:s.Z.kbd,children:[l,n]})})}},15562:function(e,t,n){n.d(t,{W:()=>r});var o=n(16584);n(98661);var i=n(6490);let r=e=>{let{isOpen:t=!1,title:n,description:r,icon:s,onClose:a,primaryButton:l,secondaryButton:d}=e;return(0,o.BX)(i.u_,{isOpen:t,onClose:a,children:[n&&(0,o.tZ)(i.xB,{title:n,description:r,showClose:!1,icon:s}),(0,o.tZ)(i.ex,{}),(0,o.tZ)(i.mz,{primaryButton:l,secondaryButton:d})]})}},78096:function(e,t,n){n.d(t,{dm:()=>v,gd:()=>g,yo:()=>f});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(94184),l=n.n(a),d=n(98661),c=n(86374),u=n(95441),m=n(15771),_=n(19081),p=n(44424),h=n(87815);let v=e=>{var{priority:t="secondary-outline",size:n="md"}=e,i=(0,r._)(e,["priority","size"]);"secondary-outline"===t&&(t="tertiary");let a="tertiary"===t;return(0,s.tZ)(b.Provider,{value:{priority:t,size:n},children:(0,s.tZ)(_.X2,(0,o._)({radius:"sm"===n?"xs":"sm",className:l()(h.Z.group,a&&h.Z.outlined)},i))})},g=e=>{var{children:t,priority:n="primary",size:a="md",menuItems:l,additionalMenuProps:d={}}=e,m=(0,r._)(e,["children","priority","size","menuItems","additionalMenuProps"]);let{iString:_}=(0,u.M1)();return(0,s.BX)(v,{priority:n,size:a,children:[(0,s.tZ)(f,(0,i._)((0,o._)({},m),{children:t})),(0,s.tZ)(p.v2,(0,i._)((0,o._)({},d),{layerOptions:{placement:"bottom-end"},trigger:(0,s.tZ)(y,(0,i._)((0,o._)({},m),{"aria-label":_("Dropdown menu"),children:(0,s.tZ)(c.Z,{size:"sm"===a?16:"md"===a?20:24})})),children:l}))]})},f=(0,d.forwardRef)((e,t)=>{var{className:n}=e,a=(0,r._)(e,["className"]);let{priority:c,size:u}=(0,d.useContext)(b);return(0,s.tZ)(m.zx,(0,i._)((0,o._)({priority:c,size:u,className:l()(h.Z.segment,n)},a),{ref:t}))}),y=(0,d.forwardRef)((e,t)=>{var{className:n}=e,a=(0,r._)(e,["className"]);let{priority:c,size:u}=(0,d.useContext)(b);return(0,s.tZ)(m.hU,(0,i._)((0,o._)({priority:c,size:u,className:l()(h.Z.segment,n)},a),{ref:t}))}),b=(0,d.createContext)({priority:"primary",size:"md"})},87077:function(e,t,n){n.d(t,{$$:()=>b,u:()=>Z});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(19425),l=n(94184),d=n.n(l),c=n(98661),u=n(62372),m=n(29032),_=n(20888),p=n(71068),h=n(19081),v=n(58175),g=n(165);let f=["top-start","top-center","top-end","bottom-start","bottom-center","bottom-end"],y=["left-start","left-center","left-end","right-start","right-center","right-end"],b=500,Z=e=>{var{children:t,text:n,title:a,imageUrl:l,as:m="span",leading:_,trailing:p,preferPlacement:h="top-center",layerOptions:v,disabled:b,hoverOptions:Z={}}=e,C=(0,r._)(e,["children","text","title","imageUrl","as","leading","trailing","preferPlacement","layerOptions","disabled","hoverOptions"]);let{layerProps:x,triggerProps:P,hoverProps:I,transitionProps:N,renderLayer:k,shouldShow:S}=function(){var e;let{hoverOptions:t,layerOptions:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,r]=(0,c.useState)(!1),[s,a]=(0,u.XI)((0,o._)({},t)),{triggerProps:l,layerProps:m,renderLayer:_}=(0,u.sJ)((0,o._)({isOpen:s,auto:!0,triggerOffset:8},n)),p=null!==(e=null==n?void 0:n.placement)&&void 0!==e?e:"top-center",h="",v="";switch(p){case"top-start":case"top-center":case"top-end":default:h=d()(g.Z.hide,g.Z.fromBelow),v=d()(g.Z.hide,g.Z.fromBelow);break;case"bottom-start":case"bottom-center":case"bottom-end":h=d()(g.Z.hide,g.Z.fromAbove),v=d()(g.Z.hide,g.Z.fromAbove);break;case"left-start":case"left-center":case"left-end":h=d()(g.Z.hide,g.Z.fromRight),v=d()(g.Z.hide,g.Z.fromRight);break;case"right-start":case"right-center":case"right-end":h=d()(g.Z.hide,g.Z.fromLeft),v=d()(g.Z.hide,g.Z.fromLeft)}return{layerProps:m,triggerProps:l,hoverProps:a,transitionProps:{show:s,beforeEnter:()=>r(!0),afterLeave:()=>r(!1),enterFrom:h,leaveTo:v},renderLayer:_,shouldShow:s||i}}({layerOptions:(0,o._)({placement:h,possiblePlacements:y.includes(h)?y:f},v),hoverOptions:(0,o._)({delayLeave:50},Z)}),{style:R}=x,M=(0,r._)(x,["style"]);return b?(0,s.tZ)(s.HY,{children:t}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(m,(0,i._)((0,o._)({},P,I,C),{children:t})),S&&k((0,s.tZ)(w,{transitionProps:N,tooltipProps:(0,i._)((0,o._)({},M,I),{style:(0,i._)((0,o._)({},R),{maxWidth:320,zIndex:Number.MAX_SAFE_INTEGER})}),text:n,title:a,imageUrl:l,leading:_,trailing:p}))]})};function w(e){let{transitionProps:t,tooltipProps:n,leading:r,trailing:a,text:l,title:d,imageUrl:u}=e,p=l&&!d&&!u;return(0,s.tZ)("div",(0,i._)((0,o._)({},n),{children:(0,s.tZ)(k,(0,i._)((0,o._)({},t),{children:(0,s.tZ)(m.C,{children:(0,s.BX)(N,{textOnly:p,children:[u&&(0,s.tZ)(I,{children:(0,s.tZ)(_.e,{src:u,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,s.BX)(P,{hasTitle:!!d,children:[r&&(0,s.tZ)(x,{children:r}),(0,s.BX)(C,{children:[d&&(0,s.tZ)(v.xv.B4,{weight:"medium",color:"primary",className:g.Z.title,children:d}),(0,s.tZ)(v.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof l?l.split("\n").map((e,t)=>(0,s.BX)(c.Fragment,{children:[t>0&&(0,s.tZ)("br",{}),e]},t)):l})]}),a&&(0,s.tZ)(x,{children:a})]})]})})}))}))}let C=(0,p.zo)({display:"flex",direction:"column",gap:2});function x(e){let{children:t}=e;return(0,s.tZ)(h.X2,{alignItems:"center",justifyContent:"center",className:g.Z.endcapContainer,flex:"auto",gap:8,children:t})}function P(e){let{hasTitle:t,children:n}=e;return(0,s.tZ)(h.X2,{alignItems:t?"start":"center",gap:8,children:n})}function I(e){let{children:t}=e;return(0,s.tZ)(h.sg,{border:"detail",radius:"sm",className:g.Z.imageContainer,overflow:"hidden",children:t})}function N(e){let{textOnly:t,children:n}=e;return(0,s.tZ)(h.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,radius:"md",shadow:"md",border:"detail",bg:"secondary",children:n})}function k(e){return(0,s.tZ)(a.u,(0,o._)({appear:!0,unmount:!1,className:g.Z.animate,enterTo:g.Z.show,leaveFrom:g.Z.show},e))}},89263:function(e,t,n){n.d(t,{n:()=>c});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(30396),l=n(82876),d=n(51776);let c=e=>{var{details:t,disabled:n,errors:c,helpText:u,inputRef:m,label:_,name:p,paddingBottom:h,paddingTop:v,value:g,onChange:f}=e,y=(0,r._)(e,["details","disabled","errors","helpText","inputRef","label","name","paddingBottom","paddingTop","value","onChange"]);let b=(0,a.I4)(e=>{f(e.target.value)},[f]);return(0,s.tZ)(l.g,{label:_,details:t,errors:c,helpText:u,paddingTop:v,paddingBottom:h,wrapWithLabel:!0,children:(0,s.tZ)(d.oi,(0,i._)((0,o._)({},y),{ref:m,error:!!(null==c?void 0:c.length),disabled:n,name:p,value:g,onChange:b}))})}},83010:function(e,t,n){n.d(t,{H:()=>c,n:()=>u});var o=n(7409),i=n(99282),r=n(16584),s=n(6400),a=n(30396),l=n(68833);let d=(0,s.createContext)({surface:null,platform:"web"});function c(e){let{children:t,trackingProps:n}=e,i=(0,a.qp)(d),s=(0,a.Ye)(()=>(0,o._)({},i,n),Object.values(n));return(0,r.tZ)(d.Provider,{value:s,children:t})}function u(){let e=(0,a.qp)(d);return(t,n)=>(0,l.j)(t,(0,o._)((0,i._)((0,o._)({},e),{ui:"page"===e.surface?"activity-page":e.surface}),n))}},8828:function(e,t,n){n.d(t,{dd:()=>r,oH:()=>i});var o=n(48980);let i=function(){let{before:e,tab:t="all"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async n=>{try{var i,r;let s=await (0,o.rd)("/api/v1/messages/inbox",{query:{paginate:"true",tab:t,before:e}});n({type:"inbox-new_items",payload:{threads:null==s?void 0:s.threads,hasMore:null==s?void 0:s.more,directMessagesUnreadCount:null==s?void 0:s.directMessagesUnreadCount,pendingInviteCount:null==s?void 0:s.pendingInviteCount,pendingInviteUnreadCount:null!==(i=null==s?void 0:s.pendingInviteUnreadCount)&&void 0!==i?i:null==s?void 0:s.pendingInviteCount,pubChatUnreadCount:null!==(r=null==s?void 0:s.pubChatUnreadCount)&&void 0!==r?r:0,mostRecentChatTimestamp:s.mostRecentChatTimestamp}})}catch(e){if(console.warn("error",e),e instanceof o.kp)n({type:"inbox-new_error",payload:{error:e}});else throw e}}},r=e=>async t=>{"direct-message"===e&&t(i({tab:"people"})),t({type:"inbox-set_filter",payload:e})}},8113:function(e,t,n){n.d(t,{aM:()=>R});var o=n(7409),i=n(99282),r=n(16584),s=n(30396),a=n(39693),l=n.n(a),d=n(44908),c=n.n(d),u=n(45578),m=n.n(u),_=n(69241),p=n(60807),h=n(12765),v=n(48980),g=n(9682),f=n(98914),y=n(8828),b=n(78308),Z=n(97842),w=n(54584),C=n(86190),x=n(46603),P=n(16889),I=n(91400),N=n(92039),k=n(98012),S=n(17440);function R(e){let{children:t,surface:n}=e,{user:a,userSettings:l}=(0,p.SE)(),d=l.newest_seen_chat_item_published_at,[{path:c}]=(0,g.tv)(),u=(0,I.XA)(),m=(0,N.rG)(),_=(0,N.m)(),[v,f]=(0,h.L)(L,(0,i._)((0,o._)({},Z.UX),{user:a,users:new Map(a?[[a.id,a]]:[])}));(0,Z.WG)({auto:!!a},{onSuccess:e=>{f({type:"inbox-unread_count",payload:e})}});let b=(0,s.sO)(0);return(0,s.d4)(()=>{if(m&&a)return m.listen({["user:".concat(a.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?f($(e)):"chat:updated-post"===e.type?f(ee(e)):"chat:new-post"===e.type&&f(et(e))}}})},[m]),(0,s.d4)(()=>{"open"===_&&a&&f((0,y.oH)())},[_]),(0,s.d4)(()=>{if("open"!==_){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;a&&e-b.current>5e3&&"hidden"!==t&&(b.current=e,f((0,y.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},o=(0,P.n)(t);return c.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[d,c,u,f,_]),(0,r.tZ)(w.o.Provider,{value:n,children:(0,r.tZ)(Z.ge.Provider,{value:f,children:(0,r.tZ)(Z.ky.Provider,{value:v,children:t})})})}let M={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},B={isLoading:!1,hasMore:!1,error:null},A={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},E={before:B,after:(0,i._)((0,o._)({},B),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function L(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,s=null!==(n=e.chats.get(r.id))&&void 0!==n?n:M;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,r.id,(0,i._)((0,o._)({},s),{publication:r})),publications:(0,S.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:s,pendingInviteCount:a,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c}=t.payload,u=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...l()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...l()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:s}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(s)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...l()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:M;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...l()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},A,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,s,a,l,d,c,u,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!==(c=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==c?c:null,muteStatus:null!==(u=t.muteStatus)&&void 0!==u?u:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(a=e.user)||void 0===a?void 0:null===(s=a.primary_publication)||void 0===s?void 0:s.id)||(null===(l=e.inbox.threads.get(t.id))||void 0===l?void 0:l.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(d=t.recentMessage)||void 0===d?void 0:d.id)&&void 0!==m?m:null,isPrimary:!1})}),_=Q(m),p=(0,S.zg)(e.inbox.threads,m,e=>e.id),h=Q([...p.values()]),{filter:v}=e.inbox,g=(0,b.A)(v);return U((0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[g]:{hasMore:r&&_===h,isLoading:!1}}),threads:p,directMessagesUnreadCount:s,pendingInviteCount:a,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:s,pubChatUnreadCount:a}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:s,pubChatUnreadCount:a})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,b.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=j(n.id);return(0,i._)((0,o._)({},e),{chats:(0,S.i4)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.i4)(e.inbox.threads,j(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;j(n.id);let r=(0,S.Rg)(e.inbox.threads,j(n.id),{id:j(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,S.FN)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,S.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,o._)({},r,A))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=H(n);return(0,i._)((0,o._)({},e),{conversations:(0,S.i4)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:s,error:a}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[s].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,i._)((0,o._)({},l),{[s]:{isLoading:!1,cursor:r,error:a}}))})}case"conversation-load_more":{let r;let{edge:s,cursor:a,page:{thread:d,replies:c,publications:u,comments:m,pastCursor:_,futureCursor:p,profile:h,subscriberContext:v}}=t.payload,g=c.map(e=>e.comment.id),f=new Set(g),y=e.conversations.get(d.id);if(!y)return console.error("Attempting to load messages for missing conversation"),e;if(y[s].cursor!==a)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let b=y.replyIds.filter(e=>!f.has(e));b="before"===s?g.concat(b):b.concat(g),r=a?{[s]:{isLoading:!1,cursor:"before"===s?_:p,error:null}}:{before:{isLoading:!1,cursor:_,error:null},after:{isLoading:!1,cursor:p,error:null}};let Z=(0,i._)((0,o._)({},y,r),{thread:d,replyIds:b}),w=h&&(null===(n=d.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),C=(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,d.id,Z),communityComments:Y(e.communityComments,c.flatMap(e=>l()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.created_at),users:(0,S.zg)(e.users,c.flatMap(e=>{var t;return l()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,S.Rg)(e.profiles,h.id,(0,i._)((0,o._)({},w,h),{subscriberContext:v})):e.profiles,publications:u?(0,S.zg)(e.publications,u,e=>e.id):e.publications,notes:m?(0,S.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===s||!a)return z(C,d.id,null);return C}case"conversation-comments-new":{let{conversationId:n,linkUrl:s,quoteReply:a}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let d={comment:(0,i._)((0,o._)({},F(e,t.payload)),{quote_id:null!==(r=l.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:s?{url:s,host:(0,f.Fo)(s)}:void 0,quote:a,quoteId:null==a?void 0:a.comment.id},c=(0,i._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,d.comment.id]});return z((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,d.comment.id,d),conversations:(0,S.Rg)(e.conversations,n,c)}),n,d.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:s,publications:a,comments:l}=t.payload;n=null!=n?n:s.client_id;let d=e.conversations.get(r);if(!d)throw Error("Attempted to post message to missing conversation");let c=n&&e.communityComments.get(n),u=new Map(e.communityComments),m=W(s);u.set(s.comment.id,c?(0,i._)((0,o._)({},m),{clientId:c.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:c.comment.media_uploads})}):m),s.quote&&u.set(s.quote.comment.id,W(s.quote));let _=d.replyIds,p=s.comment.id;return n&&(_=_.map(e=>e===n?p:e)),_.includes(p)||(_=[..._,p]),_=[...new Set(_)],z((0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,r,(0,i._)((0,o._)({},d),{replyIds:_})),communityComments:u,publications:a?(0,S.zg)(e.publications,a,e=>e.id):e.publications,notes:l?(0,S.zg)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,s.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,s=e.communityComments.get(n);if(!s)throw Error("Attempted to assing error to missing comment");if(!s.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,s=e.conversations.get(n);if(!s)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,i._)((0,o._)({},s),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return V(e,n,{unmute_at:o?(0,k.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s)return console.warn("chat item does not exist"),e;let a=r!==s.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,a)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,s,a,l,d;let{publication_id:u}=t.payload,m=null!==(n=e.chats.get(u))&&void 0!==n?n:M;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,s=n.threads.find(e=>"deleted"!==e.communityPost.status),a=Y(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=j(u),d=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},_=(0,i._)((0,o._)({},e),{users:(0,S.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:a,chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m,d),{posts:c()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return G(null===(n=a.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(o=a.get(t))||void 0===o?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!==(t=null==s?void 0:s.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,i._)((0,o._)({},_),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(_)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(u),{lastViewedAt:new Date().toISOString()})}),chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),a={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(s=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==s?s:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0};return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,a.communityPost.id,a),chats:(0,S.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{posts:[a.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let s=new Map(e.communityPosts);return s.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:s})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:s}=t.payload,a=new Map(e.communityPosts);a.set(s,n);let l=Array.from(new Set([s,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,S.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:a,chats:(0,S.Rg)(e.chats,r,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:s}=t.payload,a=new Map(e.communityPosts);a.delete(n),a.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(s),{communityPostId:r.communityPost.id})}),communityPosts:a,chats:(0,S.Rg)(e.chats,s,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityPosts.get(n);if(!s||!J(s)||!(null===(a=s.communityPost)||void 0===a?void 0:a.reactions))return console.warn("chat item does not exist"),e;if(s.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:X(s.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityPosts.get(n);if(!s||!J(s)||!(null===(l=s.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:X(s.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,s=e.communityPosts.get(n);if(!s)return console.warn("chat item does not exist"),e;let a=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{T(t,a);let n=e.replies.get(t);n&&n.comments.forEach(e=>{T(e,a)})});let c=null===(d=e.chats.get(r))||void 0===d?void 0:d.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i?void 0:null===(o=i.communityPost)||void 0===o?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null===(o=e.communityPosts.get(t))||void 0===o?void 0:o.communityPost,s=null===(i=e.communityPosts.get(n))||void 0===i?void 0:i.communityPost;return G(null==r?void 0:r.created_at,null==s?void 0:s.created_at)})[0],u=(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:a,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=c?c:null}):e)})});return(0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},u.inbox),{threadList:D(u)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!J(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,s=e.communityPosts.get(n);if(!s||!J(s))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,s=e.communityPosts.get(n);if(!s)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:s}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:s}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,s=e.communityPosts.get(n);if(!s||!J(s))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,o._)({},s.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,s,a,d,u,m,_,p;let h,g=null,f=null;"parentCommentId"in(p=t).payload&&p.payload.parentCommentId?f=t.payload.parentCommentId:"postId"in t.payload&&(g=t.payload.postId);let y=e=>f?{replies:e}:{comments:e};h=f?null!==(n=e.replies.get(f))&&void 0!==n?n:E:g&&null!==(r=e.comments.get(g))&&void 0!==r?r:E;let b=f?e.replies:e.comments,Z=null!=f?f:g;switch(t.type){case"replies-clear":case"comments-clear":return Z?(0,o._)({},e,y((0,S.Rg)(b,Z,E))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,a=(0,i._)((0,o._)({},B),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{before:"desc"===n?a:B,after:"asc"===n?a:B,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!==(s=null==h?void 0:h.isLoaded)&&void 0!==s&&s}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:s,replies:a,more:d,moreAfter:u,moreBefore:m,lastViewedAt:_}}=t.payload,p=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||M;n.muteStatus||(p=(0,S.Rg)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let v=a.map(e=>e.comment.id),g=Y(e.communityComments,a.flatMap(e=>l()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.updated_at);if(s)g.set(s.comment.id,(0,i._)((0,o._)({},s),{userId:s.user.id}));let f=(0,S.zg)(e.users,l()([null==r?void 0:r.communityPost.user,null==s?void 0:s.user]),e=>e.id),w=Z?b.get(Z):null,C=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:d,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:u,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,S.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:g}),p?{chats:p}:{}),{users:new Map([...f,...a.map(e=>[e.user.id,e.user])])}),y((0,S.Rg)(b,Z,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:c()([...h.comments,...v]).sort((e,t)=>{var n,o;return G(null===(n=g.get(e))||void 0===n?void 0:n.comment.created_at,null===(o=g.get(t))||void 0===o?void 0:o.comment.created_at)}).filter(e=>{var t;return(null===(t=g.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||d?h.order:"desc",isLoaded:!0,lastViewedAt:_}))))}case"replies-target":case"comments-target":return Z?(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,S.FN)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,S.FN)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return Z?(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return Z?(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},F(e,n)),{quote_id:null!==(u=null===(a=n.quoteReply)||void 0===a?void 0:a.comment.id)&&void 0!==u?u:null,post_id:n.postId,parent_id:f}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(d=n.quoteReply)||void 0===d?void 0:d.comment.id,pub_roles:n.pubRoles},s=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,r.comment.id,r)}),y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(f){let n=e.communityComments.get(f);if(n&&K(n)){let r=O(n.comment,e.user,t.payload.postId);s.communityComments.set(f,(0,i._)((0,o._)({},n),{comment:r}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&J(l)){let n=O(l.communityPost,e.user,t.payload.postId);s.communityPosts=(0,S.Rg)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},l),{communityPost:n}))}return s}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,s=new Map(e.communityComments);s.delete(n),s.set(r.comment.id,W(r));let a=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:s}),y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let s=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,W(r))}),y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{comments:s}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,W(r)),users:r.user?(0,S.Rg)(e.users,r.userId,r.user):e.users}),y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof v.kp){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null})),users:t.user?(0,S.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,y((0,S.Rg)(b,Z,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s||!K(s)||!(null===(m=s.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(s.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s||!K(s)||!(null===(_=s.comment)||void 0===_?void 0:_.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,s=e.communityComments.get(n);if(!s||!K(s))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:(0,o._)({},s.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!K(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,s=e.communityComments.get(n);if(!s||!K(s))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,s=e.communityComments.get(n);if(!s||!K(s))return console.warn("comment does not exist"),e;if(s.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:(0,i._)((0,o._)({},s.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function O(e,t,n){var r,s;let a;return(t&&t.photo_url&&(a=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(a=m()([...a,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:a,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:a,comment_count:1+(null!==(s=e.comment_count)&&void 0!==s?s:0)}):e}function T(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function F(e,t){var n,r,s;return(0,i._)((0,o._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(s=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==s?s:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function z(e,t,n){let r=H(t),s=e.inbox.threads.get(r),a=(null==s?void 0:s.type)==="direct-message"?s:null,l=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.Rg)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},a),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},l),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(l)})})}function X(e,t,n){var r,s;let a=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!==(r=l[t])&&void 0!==r?r:0)+(n?1:-1),n&&a&&(l[a]=(null!==(s=l[a])&&void 0!==s?s:0)-1),(0,i._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function U(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(e)})})}function D(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:G(q(e,t),q(e,n))).map(e=>e.id)}function q(e,t){var n,o,i,r;return"chat"===t.type?null!==(i=t.communityPostId&&(null===(o=e.communityPosts.get(t.communityPostId))||void 0===o?void 0:o.communityPost.created_at))&&void 0!==i?i:t.timestamp:null!==(r=null===(n=(0,x._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function V(e,t,n){let r=e.conversations.get(t),s=null==r?void 0:r.thread;if(!r||!s)throw Error("Tried to update a conversation that does not exist.");let a=e.user;if(!a)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},s),{members:s.members.map(e=>e.user_id===a.id?(0,o._)({},e,n):e)})}))})}function j(e){return"chat-".concat(e)}function H(e){return"direct-message-".concat(e)}function W(e){var t,n,r,s;return(0,i._)((0,o._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(s=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==s?s:void 0})}function J(e){return!0!==e.isNew}function K(e){return!0!==e.isNew}function G(e,t){return e===t?0:!t||e&&e>t?-1:1}function Y(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),s=r.get(t);if(!s){r.set(t,e);continue}i(e)>=i(s)&&r.set(t,(0,o._)({},s,e))}return r}function Q(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!==(o=n.timestamp)&&void 0!==o?o:t;return i<e?i:e},t)}let $=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,C.U)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,_.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:s}=e;if("deleted"===s.status){t({type:"posts-delete_post",payload:{id:s.id,publication_id:s.publication_id}});return}t({type:"posts-updated",payload:{id:s.id,chatItem:{communityPost:(0,i._)((0,o._)({},s),{user:s.author,user_id:s.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=s.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=s.user_pub_role_object)&&void 0!==r?r:null}}})},et=e=>async t=>{var n,r;let{post:s}=e;t({type:"posts-new_incoming",payload:{publication_id:s.publication_id,id:s.id,chatItem:{communityPost:(0,i._)((0,o._)({},s),{user:s.author,user_id:s.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=s.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=s.user_pub_role_object)&&void 0!==r?r:null}}})}},76819:function(e,t,n){n.d(t,{Hs:()=>s,Rx:()=>a,ye:()=>r});var o=n(7409),i=n(75561);function r(e){var t,n,o;return e.link_title||(null===(t=e.postTag)||void 0===t?void 0:t.name)||(null===(n=e.section)||void 0===n?void 0:n.name)||(null===(o=e.post)||void 0===o?void 0:o.title)||""}function s(e){var t;return e.postTag?"tag":e.section?"section":(null===(t=e.post)||void 0===t?void 0:t.type)==="page"?"page":e.post?"post":"link"}function a(e,t){let{isChatActive:n,isMeetingsActive:r,hasMultipleNewsletters:s,isChatEnabled:a,isFeedEnabled:l,isReaderReferralsLeaderboardActive:d,language:c="en",useReordering:u=!1}=t,m=e.filter(e=>!e.standard_key),_=new Map(e.filter(e=>e.standard_key).map(e=>[e.standard_key,e])),{iString:p}=I18N.i(c);for(let e of m){var h;(null===(h=e.section)||void 0===h?void 0:h.hide_from_navbar)&&(e.is_hidden=!0)}let v=[l&&{standard_key:"notes",link_title:"Notes",link_url:"/notes"},a&&{standard_key:"chat",link_title:"Chat",link_url:"/chat",is_hidden:!n},r&&{standard_key:"meetings",link_title:"Meetings",link_url:"/meetings"},...m,{standard_key:"archive",link_title:p("Archive"),link_url:"/archive"},s&&{standard_key:"newsletters",link_title:p("Newsletters"),link_url:"/newsletters",is_hidden:!0},d&&{standard_key:"leaderboard",link_title:p("Leaderboard"),link_url:"/leaderboard"},{standard_key:"about",link_title:p("About"),link_url:"/about"}].filter(e=>!!e).map(e=>{if(e.standard_key){let t=_.get(e.standard_key);if(t)return(0,i.CD)((0,o._)({},e),t)}return e});if(u){let e=["about","notes","chat","archive"];return[...v.filter(t=>!e.includes(t.standard_key||"")),...e.map(e=>v.find(t=>t.standard_key===e)).filter(e=>!!e)].filter(e=>!!e)}return v}},62515:function(e,t,n){n.d(t,{Ds:()=>l,Rm:()=>r,aD:()=>s,gp:()=>a});var o=n(14773),i=n(63651);function r(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function s(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function a(e){return(0,o.Q2)("/chat/new",e)}function l(e){let{userId:t,userName:n}=e,r=(0,i.JlE)({userId:t,userName:n});return"".concat((0,o.ZX)(),"/chat/dm/user/").concat(r)}},36515:function(e,t,n){n.d(t,{r:()=>s});var o=n(7409),i=n(99282),r=n(14773);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.Q2)("/publish/chat",(0,i._)((0,o._)({},t),{pub:e}))}}}]);