"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1556"],{33803:function(e,t,n){n.d(t,{Z:()=>r});let r={elevatedTheme:"elevatedTheme-fBklGV"}},42450:function(e,t,n){n.d(t,{Z:()=>r});let r=/^(1588|1691|4457)$/.test(n.j)?null:{menu:"menu-WfPxpI",submenu:"submenu-tlfomG",floatingContainer:"floatingContainer-MUwyEF",menuItem:"menuItem-B7SAG_",disabled:"disabled-bXLaNs",priority_primary:"priority_primary-xntVG3",priorityPrimary:"priority_primary-xntVG3",priority_destructive:"priority_destructive-sXev9X",priorityDestructive:"priority_destructive-sXev9X",priority_secondary:"priority_secondary-prGxrw",prioritySecondary:"priority_secondary-prGxrw",relative:"relative-pHLTt2",icon:"icon-HSm3VM",text:"text-X3mTtF",transition:"transition-a_Ilul",show:"show-Kgvg96",hide:"hide-zZFh0h",actionSheetTransition:"actionSheetTransition-JBN9s_",actionSheetShow:"actionSheetShow-47rpBE",actionSheetHide:"actionSheetHide-QhOutK"}},68857:function(e,t,n){n.d(t,{Z:()=>r});let r=/^(2987|3154|3270|4716|5288|6909)$/.test(n.j)?{scrollBox:"scrollBox-zHkQVP",arrowButtonContainer:"arrowButtonContainer-O4uSiH",visible:"visible-JMTC0j",right:"right-i3oWGi",left:"left-Tg8vqp",arrowButtonOffsetContainer:"arrowButtonOffsetContainer-VMYLE4",arrowButtonOverlaidContainer:"arrowButtonOverlaidContainer-t10AyH",overlay:"overlay-zrMCxn",primary:"primary-lv_sOW",secondary:"secondary-pOosZC",arrowButtonOverlaid:"arrowButtonOverlaid-xLyA_z"}:null},29032:function(e,t,n){n.d(t,{C:()=>o});var r=n(16584),i=n(4615);let o=e=>{let{children:t,disable:n}=e;return n?(0,r.tZ)(r.HY,{children:t}):(0,r.tZ)(i.f6,{theme:"dark-theme",children:t})}},50012:function(e,t,n){n.d(t,{C:()=>m,l:()=>_});var r=n(7409);if(/^(2[79]87|1612|3154|4153|4716|5288|6909)$/.test(n.j))var i=n(99282);var o=n(98848),a=n(16584),l=n(30396),s=n(94184),u=n.n(s),c=n(85685);if(/^(2[79]87|1612|3154|4153|4716|5288|6909)$/.test(n.j))var d=n(93252);var p=n(63018),f=n(32700),h=n(63651);if(/^(2[79]87|1612|3154|4153|4716|5288|6909)$/.test(n.j))var v=n(81821);var g=n(90271);function m(e){var{children:t,disabled:n}=e,l=(0,o._)(e,["children","disabled"]);return n||(0,v.tq)()||(0,d.P)()?(0,a.tZ)(a.HY,{children:t}):(0,a.tZ)(b,(0,i._)((0,r._)({},l),{children:t}))}function b(e){var t,n,s,u,d,{className:v,children:m,subject:b,placement:w="right-center",utmSource:y}=e,Z=(0,o._)(e,["className","children","subject","placement","utmSource"]);let[M,C]=(0,l.eJ)(!1),x=(t=null!==(d=null!==(u=b.slug)&&void 0!==u?u:b.handle)&&void 0!==d?d:(0,h._IO)(b),n={auto:M},(0,p._I)("/api/v1/user/".concat(t,"/public_profile"),n)),P=x.data,j=(0,f.o)((0,r._)({className:g.Z.profileHoverCard,loading:x.isLoading,hideOnScroll:!0,onOpen:()=>{C(!0)},layerOptions:{placement:w},content:P?(0,a.tZ)(c.ProfileCard,{profile:P,subject:b,utmSource:y,forceRefresh:()=>x.mutate()}):null},Z));return(0,a.BX)(_,(0,i._)((0,r._)({className:v},j.hoverProps),{forwardRef:null===(s=j.triggerProps)||void 0===s?void 0:s.ref,children:[m,j.layer]}))}function _(e){var{inline:t,className:n,forwardRef:i}=e,l=(0,o._)(e,["inline","className","forwardRef"]);return(0,a.tZ)("div",(0,r._)({className:u()("profile-hover-card-target",g.Z.profileHoverCardTarget,t&&g.Z.inline,n),ref:i},l))}},35543:function(e,t,n){n.d(t,{Sv:()=>B,Xe:()=>j,oJ:()=>O,oh:()=>L,yr:()=>k});var r=n(7409),i=n(99282),o=n(58865),a=n(16584),l=n(30396),s=n(82569),u=n.n(s),c=n(94734),d=n(17520),p=n(69241),f=n(19548),h=n(95441),v=n(60807),g=n(54371),m=n(6910),b=n(48980),_=n(63018),w=n(98914),y=n(44424),Z=n(70379),M=n(88817),C=n(23945);function x(){let e=(0,o._)(["Followed ",""]);return x=function(){return e},e}function P(){let e=(0,o._)(["Unfollowed ",""]);return P=function(){return e},e}function j(e){let t=(0,v.aF)();return(0,_._I)("/api/v1/feed/following",(0,r._)({auto:!!t},e))}function O(){let{mutate:e}=(0,p.kY)();return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e("/api/v1/feed/following",...n)}}function L(e,t,n){let{isFollowing:r,toggle:i}=B(e,t,n),o=(0,v.aF)(),l=(0,f.gc)(null==e?void 0:e.id),s=!!(o&&e&&o.id!==e.id)&&!l,u=[];return s&&u.push((0,a.tZ)(y.sN,{leading:r?(0,a.tZ)(m.m,{stroke:"var(--color-fg-primary)"}):(0,a.tZ)(g.w,{stroke:"var(--color-fg-primary)"}),onClick:i,children:r?"Unfollow":"Follow"})),u}function B(e,t,n,o){let l=(0,v.aF)(),{onboardingModalRef:s,requireLogin:p}=(0,M.SJ)(),f=function(e,t){let{data:n}=j(t);return(null!=n?n:[]).includes(null!=e?e:0)}(null==e?void 0:e.id,o),{mutate:g,data:m}=j(o),_=(0,Z.pm)(),y=(0,C.Q1)((null==e?void 0:e.name)||""),{iString:O,iTemplate:L}=(0,h.M1)(),B=async o=>{if(e){if(!l&&s.current){p?p():s.current.open();return}g(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o?[...t,e.id]:u()(t,e.id)},{revalidate:!1});try{await (0,b.rd)("/api/v1/feed/".concat(e.id,"/follow"),{method:o?"POST":"DELETE",json:{surface:t,noteId:n}}),_.popToast(e=>(0,a.tZ)(Z.FN,(0,i._)((0,r._)({},e),{Icon:o?c.Z:d.Z,text:o?L(x(),y):L(P(),y),cta:O("Undo"),onAccept:()=>B(!o)})))}catch(e){_.popToast(t=>(0,a.tZ)(Z.FN,(0,i._)((0,r._)({},t),{text:(0,w.zx)(e)})));return}}};return{isFollowing:f,toggle:()=>B(!f),isLoaded:!!m}}function k(e,t,n){let{isFollowing:r,toggle:i}=B(e,t,n),[o,a]=(0,l.eJ)(!1);return{isFollowing:r,buttonProps:{onClick:()=>{i(),r||a(!0)},onMouseLeave:()=>a(!1)}}}},80143:function(e,t,n){n.d(t,{Q:()=>l,Y:()=>s});var r=n(16584),i=n(98661),o=n(30396);let a=(0,i.createContext)({});function l(e){let{entityKey:t,children:n}=e;return(0,r.tZ)(a.Provider,{value:{entityKey:t},children:n})}function s(){return(0,o.qp)(a).entityKey}},6910:function(e,t,n){if(n.d(t,{m:()=>l}),/^(2[79]87|3154|4716|5288|6909)$/.test(n.j))var r=n(7409);if(/^(2[79]87|3154|4716|5288|6909)$/.test(n.j))var i=n(99282);if(/^(2[79]87|3154|4716|5288|6909)$/.test(n.j))var o=n(98848);var a=n(16584);function l(e){var{size:t=20,stroke:n="var(--color-light-fg-secondary)"}=e,l=(0,o._)(e,["size","stroke"]);return(0,a.tZ)("svg",(0,i._)((0,r._)({},l),{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:n,xmlns:"http://www.w3.org/2000/svg",children:(0,a.tZ)("path",{id:"Vector",d:"M3 22C3 17.7044 6.69722 14.2222 11.258 14.2222C11.5081 14.2222 11.7556 14.2326 12 14.2531M21.0039 16.3098L18.6469 18.6668M18.6469 18.6668L16.2899 21.0239M18.6469 18.6668L21.0178 21.0377M18.6469 18.6668L16.276 16.2959M16.4118 6.44444C16.4118 8.89904 14.4102 10.8889 11.9412 10.8889C9.47214 10.8889 7.47059 8.89904 7.47059 6.44444C7.47059 3.98985 9.47214 2 11.9412 2C14.4102 2 16.4118 3.98985 16.4118 6.44444Z",strokeWidth:"2",strokeLinecap:"round","stroke-linejoin":"round"})}))}},83786:function(e,t,n){n.d(t,{M:()=>o});var r=n(98661);let i=0;function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(0,r.useMemo)(()=>(i=++i>Number.MAX_SAFE_INTEGER?1:i,"".concat(e).concat(i)),t)}},73410:function(e,t,n){n.d(t,{V:()=>i});var r=n(98661);let i=/^(4716|5288)$/.test(n.j)?(0,r.createContext)("preact-router"):null},9682:function(e,t,n){n.d(t,{bA:()=>u,js:()=>l,tv:()=>s,yj:()=>c});var r=n(30396),i=n(20042);if(/^(4716|5288)$/.test(n.j))var o=n(74856);var a=n(73410);function l(e,t){(0,r.d4)(()=>{let t=t=>{e(t)};return i.subscribers.push(t),()=>{i.subscribers.splice(i.subscribers.indexOf(t)>>>0,1)}},t)}function s(){let{path:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,r.eJ)({}),o=(0,r.sO)(null);l(e=>{o.current=e,n({})},[]);let a=o.current||(0,i.getCurrentUrl)(),s=a.replace(/\?.+$/,""),u=document.location.hash;return o.current=null,[{url:a,path:s,matches:e&&(0,i.exec)(s,e,{})||null,hash:u},i.route]}function u(){return history.state}function c(){if("react-router"===(0,r.qp)(a.V)){let e=(0,o.s0)();return(t,n)=>(e(t,{replace:n}),!0)}return i.route}},60684:function(e,t,n){n.d(t,{V:()=>v});var r=n(16584);if(!/^(1588|1691|4457)$/.test(n.j))var i=n(19425);var o=n(94184),a=n.n(o);if(!/^(1588|1691|4457)$/.test(n.j))var l=n(71375);var s=n(98661),u=n(20160),c=n(15771),d=n(80026),p=n(19081),f=n(58175);let h=/^(1588|1691|4457)$/.test(n.j)?null:{root:"root-BnqjqA",sheet:"sheet-dvfhcO",transition:"transition-yWeLc7",show:"show-xTDs8w",hide:"hide-F0u6Dg"},v=/^(1588|1691|4457)$/.test(n.j)?null:(0,s.forwardRef)((e,t)=>{let{title:n,onClose:o,children:s,className:v,paddingY:g=8}=e;return(0,r.tZ)(p.tu,{className:h.root,onClick:o,children:(0,r.tZ)(i.u.Child,{appear:!0,className:h.transition,enterFrom:h.hide,enterTo:h.show,leaveFrom:h.show,leaveTo:h.hide,children:(0,r.tZ)(u.W,{children:(0,r.BX)(p.tu,{className:a()(h.sheet,v),padding:8,ref:t,onClick:e=>{e.stopPropagation()},children:[!!n&&(0,r.BX)(r.HY,{children:[(0,r.BX)(p.hs,{justifyContent:"space-between",alignItems:"center",paddingX:8,paddingTop:8,paddingBottom:16,children:[(0,r.tZ)(p.tu,{gap:4,justifyContent:"center",children:(0,r.tZ)(f.xv.B3,{weight:"semibold",children:n})}),(0,r.tZ)(c.hU,{priority:"tertiary",onClick:()=>{o()},children:(0,r.tZ)(l.Z,{size:20})})]}),(0,r.tZ)(d.iz,{paddingX:8})]}),(0,r.tZ)(p.tu,{gap:8,paddingY:g,overflowY:"auto",children:s})]})})})})})},87077:function(e,t,n){n.d(t,{$$:()=>w,k9:()=>y,u:()=>Z});var r=n(7409),i=n(99282),o=n(98848),a=n(16584),l=n(19425),s=n(94184),u=n.n(s),c=n(98661),d=n(62372),p=n(29032),f=n(20888),h=n(71068),v=n(19081),g=n(58175),m=n(165);let b=["top-start","top-center","top-end","bottom-start","bottom-center","bottom-end"],_=["left-start","left-center","left-end","right-start","right-center","right-end"],w=500,y=2987==n.j?{size:16,color:"var(--color-utility-white)"}:null,Z=e=>{var{children:t,text:n,title:l,imageUrl:s,as:p="span",leading:f,trailing:h,preferPlacement:v="top-center",layerOptions:g,disabled:w,hoverOptions:y={}}=e,Z=(0,o._)(e,["children","text","title","imageUrl","as","leading","trailing","preferPlacement","layerOptions","disabled","hoverOptions"]);let{layerProps:C,triggerProps:x,hoverProps:P,transitionProps:j,renderLayer:O,shouldShow:L}=function(){var e;let{hoverOptions:t,layerOptions:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[i,o]=(0,c.useState)(!1),[a,l]=(0,d.XI)((0,r._)({},t)),{triggerProps:s,layerProps:p,renderLayer:f}=(0,d.sJ)((0,r._)({isOpen:a,auto:!0,triggerOffset:8},n)),h=null!==(e=null==n?void 0:n.placement)&&void 0!==e?e:"top-center",v="",g="";switch(h){case"top-start":case"top-center":case"top-end":default:v=u()(m.Z.hide,m.Z.fromBelow),g=u()(m.Z.hide,m.Z.fromBelow);break;case"bottom-start":case"bottom-center":case"bottom-end":v=u()(m.Z.hide,m.Z.fromAbove),g=u()(m.Z.hide,m.Z.fromAbove);break;case"left-start":case"left-center":case"left-end":v=u()(m.Z.hide,m.Z.fromRight),g=u()(m.Z.hide,m.Z.fromRight);break;case"right-start":case"right-center":case"right-end":v=u()(m.Z.hide,m.Z.fromLeft),g=u()(m.Z.hide,m.Z.fromLeft)}return{layerProps:p,triggerProps:s,hoverProps:l,transitionProps:{show:a,beforeEnter:()=>o(!0),afterLeave:()=>o(!1),enterFrom:v,leaveTo:g},renderLayer:f,shouldShow:a||i}}({layerOptions:(0,r._)({placement:v,possiblePlacements:_.includes(v)?_:b},g),hoverOptions:(0,r._)({delayLeave:50},y)}),{style:B}=C,k=(0,o._)(C,["style"]);return w?(0,a.tZ)(a.HY,{children:t}):(0,a.BX)(a.HY,{children:[(0,a.tZ)(p,(0,i._)((0,r._)({},x,P,Z),{children:t})),L&&O((0,a.tZ)(M,{transitionProps:j,tooltipProps:(0,i._)((0,r._)({},k,P),{style:(0,i._)((0,r._)({},B),{maxWidth:320,zIndex:Number.MAX_SAFE_INTEGER})}),text:n,title:l,imageUrl:s,leading:f,trailing:h}))]})};function M(e){let{transitionProps:t,tooltipProps:n,leading:o,trailing:l,text:s,title:u,imageUrl:d}=e,h=s&&!u&&!d;return(0,a.tZ)("div",(0,i._)((0,r._)({},n),{children:(0,a.tZ)(L,(0,i._)((0,r._)({},t),{children:(0,a.tZ)(p.C,{children:(0,a.BX)(O,{textOnly:h,children:[d&&(0,a.tZ)(j,{children:(0,a.tZ)(f.e,{src:d,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,a.BX)(P,{hasTitle:!!u,children:[o&&(0,a.tZ)(x,{children:o}),(0,a.BX)(C,{children:[u&&(0,a.tZ)(g.xv.B4,{weight:"medium",color:"primary",className:m.Z.title,children:u}),(0,a.tZ)(g.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof s?s.split("\n").map((e,t)=>(0,a.BX)(c.Fragment,{children:[t>0&&(0,a.tZ)("br",{}),e]},t)):s})]}),l&&(0,a.tZ)(x,{children:l})]})]})})}))}))}let C=(0,h.zo)({display:"flex",direction:"column",gap:2});function x(e){let{children:t}=e;return(0,a.tZ)(v.X2,{alignItems:"center",justifyContent:"center",className:m.Z.endcapContainer,flex:"auto",gap:8,children:t})}function P(e){let{hasTitle:t,children:n}=e;return(0,a.tZ)(v.X2,{alignItems:t?"start":"center",gap:8,children:n})}function j(e){let{children:t}=e;return(0,a.tZ)(v.sg,{border:"detail",radius:"sm",className:m.Z.imageContainer,overflow:"hidden",children:t})}function O(e){let{textOnly:t,children:n}=e;return(0,a.tZ)(v.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,radius:"md",shadow:"md",border:"detail",bg:"secondary",children:n})}function L(e){return(0,a.tZ)(l.u,(0,r._)({appear:!0,unmount:!1,className:m.Z.animate,enterTo:m.Z.show,leaveFrom:m.Z.show},e))}},47295:function(e,t,n){n.d(t,{U:()=>o});var r=n(16584);n(98661);let i=/^(1588|1691|4457)$/.test(n.j)?null:{hiddenInput:"hiddenInput-m9n617"},o=e=>{let{children:t}=e;return(0,r.tZ)("div",{className:i.hiddenInput,children:t})}},50368:function(e,t,n){n.d(t,{X:()=>o,p:()=>i});var r=n(98661);let i=/^(1588|1691|4457)$/.test(n.j)?null:(0,r.createContext)({useMobileBottomSheet:!0,close:()=>void 0});function o(){return(0,r.useContext)(i)}},10903:function(e,t,n){if(n.d(t,{x:()=>s}),!/^(1588|1691|4457)$/.test(n.j))var r=n(7409);if(!/^(1588|1691|4457)$/.test(n.j))var i=n(99282);var o=n(98661);if(!/^(1588|1691|4457)$/.test(n.j))var a=n(62372);var l=n(83786);let s=function(){let{layerOptions:e,hideOnScroll:t,onClose:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[s,u]=(0,o.useState)(!1),{triggerProps:c,layerProps:d,renderLayer:p}=(0,a.sJ)((0,r._)({isOpen:s,placement:"bottom-center",preferY:"bottom",triggerOffset:10,onOutsideClick:()=>{n&&n(),u(!1)}},e)),f=(0,l.M)("trigger"),h=(0,l.M)("dialog");return(0,o.useEffect)(()=>{if(t){let e=()=>{requestAnimationFrame(()=>{open&&t&&u(!1)})};return window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("scroll",e,!0)}}},[t]),{triggerProps:(0,i._)((0,r._)({},c),{id:f,"aria-expanded":s,"aria-haspopup":"dialog","aria-controls":h}),layerProps:(0,i._)((0,r._)({},d),{id:h,role:"dialog",tabIndex:0,"aria-labeledby":f}),renderLayer:p,isOpen:s,setOpen:u}}},88817:function(e,t,n){n.d(t,{Ly:()=>o,SJ:()=>l,qr:()=>a});var r=n(6400),i=n(30396);let o=(0,r.createContext)({setChildOptions:()=>{},onboardingModalRef:{current:null},isLoading:!1,subscriptions:[],publicationUsers:[],onPageScroll:()=>void 0,setPinTitle:()=>void 0,setDrawer:()=>null,checkFocus:()=>!1,requireLogin:null});function a(e){let{shouldShowGetAppPill:t=!0,style:n,alwaysPinTitle:r,backAction:o,onRefresh:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=l();return(0,i.bt)(()=>{var i;null===(i=s.setChildOptions)||void 0===i||i.call(s,{title:e,style:n,alwaysPinTitle:r,backAction:o,shouldShowGetAppPill:t,onRefresh:a})},[s,e,n,o,t,a]),(0,i.bt)(()=>{var e;null===(e=s.setPinTitle)||void 0===e||e.call(s,!1)},[]),s}function l(){return(0,i.qp)(o)}},97842:function(e,t,n){n.d(t,{I0:()=>s,RN:()=>c,UX:()=>a,WG:()=>d,ge:()=>l,ky:()=>u});var r=n(6400),i=n(30396),o=n(63018);let a={user:null,inbox:{threadList:[],threads:new Map,filter:"all",resources:{all:{isLoading:!0,hasMore:!1},people:{isLoading:!0,hasMore:!1}}},users:new Map,profiles:new Map,communityPosts:new Map,communityComments:new Map,chats:new Map,comments:new Map,replies:new Map,conversations:new Map,publications:new Map,notes:new Map,editingPost:null},l=(0,r.createContext)(()=>Promise.resolve());function s(){return(0,i.qp)(l)}let u=(0,r.createContext)(a);function c(){return(0,i.qp)(u)}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return(0,o._I)("/api/v1/messages/unread-count",e,t)}},32189:function(e,t,n){n.d(t,{i:()=>s,x:()=>l});var r=n(30396),i=n(60807),o=n(68833),a=n(88817);function l(e){let{surface:t,zIndex:n=null}=e,l=(0,i.aF)(),{onboardingModalRef:s}=(0,a.SJ)();return(0,r.d4)(()=>{s.current&&null!==n&&(s.current.props.zIndex=n)},[s,n]),(e,n)=>r=>{if(!e){console.warn("No publication provided to usePubOnboardingHandler handler");return}if(!l){var i,a;if(!s.current)return;r.preventDefault(),n?null===(i=s.current)||void 0===i||i.openForPub(e,n):null===(a=s.current)||void 0===a||a.openToPubSignup(e);return}(0,o.x6)(e,t)}}function s(e){let{zIndex:t=null,onBeforeClose:n}=e,o=(0,i.aF)(),{onboardingModalRef:l}=(0,a.SJ)(),s=(0,r.sO)(null);return(0,r.d4)(()=>{o&&(s.current=o)},[o]),(0,r.d4)(()=>{l.current&&null!==t&&(l.current.props.zIndex=t)},[l,t]),e=>{if(!o&&l.current){n&&(l.current.onBeforeClose=()=>n(s.current)),e.preventDefault(),l.current.open();return}}}},64172:function(e,t,n){if(n.d(t,{Th:()=>g,Y0:()=>b,_V:()=>w,e:()=>v,lV:()=>f,p6:()=>m,th:()=>_}),/^(2[79]87|3154|3270|4716|5288|6909)$/.test(n.j))var r=n(7409);if(/^(2[79]87|3154|3270|4716|5288|6909)$/.test(n.j))var i=n(99282);if(/^(2[79]87|3154|3270|4716|5288|6909)$/.test(n.j))var o=n(98848);var a=n(6400),l=n(30396),s=n(45578),u=n.n(s),c=n(48980);if(/^(2[79]87|3154|3270|4716|5288|6909)$/.test(n.j))var d=n(17440);let p={hasLoadedOnce:!1,publications:[],subscriptions:[],publicationUsers:[],publicationMap:new Map,subscriptionMap:new Map,publicationUserMap:new Map,publicationsWithPledges:[]};function f(e){let{isLoggedIn:t,includePodcasts:n}=e,[o,a]=(0,l.eJ)((0,i._)((0,r._)({},p),{hasLoadedOnce:!t})),s=e=>{a(t=>{let n=u()([...t.publications,...e.publications],e=>e.id),i=u()([...t.subscriptions,...e.subscriptions],e=>e.publication_id),o=u()([...t.publicationUsers,...e.publicationUsers],e=>e.publication_id);return{hasLoadedOnce:!0,publications:n,subscriptions:i,publicationUsers:o,publicationMap:new Map(n.map(e=>[e.id,e])),subscriptionMap:new Map(i.map(e=>[e.publication_id,e])),publicationUserMap:new Map(o.map(e=>[e.publication_id,e])),publicationsWithPledges:[...t.publicationsWithPledges,...e.publicationsWithPledges],latestVoiceoverData:(0,r._)({},t.latestVoiceoverData,null==e?void 0:e.latestVoiceoverData),latestPodcastEpisodeData:(0,r._)({},t.latestPodcastEpisodeData,null==e?void 0:e.latestPodcastEpisodeData)}})};(0,l.d4)(()=>{if("serviceWorker"in navigator){let e=async e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.type)==="subscriptions-update"){let{payload:t}=e.data;t.ok&&s(t.json)}};return navigator.serviceWorker.addEventListener("message",e),()=>{navigator.serviceWorker.removeEventListener("message",e)}}},[]),(0,l.d4)(()=>{t&&(async()=>{try{for await(let e of y("/api/v1/subscriptions",{query:{include_podcasts:n?"1":void 0},getPageInit(e,t){let n=null==e?void 0:e.nextCursor;return n?(0,i._)((0,r._)({},t),{query:(0,i._)((0,r._)({},t.query),{cursor:n})}):null}}))s(e)}catch(e){console.warn(e)}})()},[t]);let f=(e,t)=>{let{subscription:n,publicationUser:o}=t;a(t=>(t=n?(0,i._)((0,r._)({},t),{subscriptions:t.subscriptions.map(e=>e.publication_id===n.publication_id?n:e),subscriptionMap:(0,d.Rg)(t.subscriptionMap,e,n)}):h(t,e),t=o?(0,i._)((0,r._)({},t),{publicationUsers:function(e,t,n){let r=(e=e.slice()).findIndex(t);return r>=0?e[r]=n:e.push(n),e}(t.publicationUsers,t=>t.publication_id===e,o),publicationUserMap:(0,d.Rg)(t.publicationUserMap,e,o)}):(0,i._)((0,r._)({},t),{publicationUsers:t.publicationUsers.filter(t=>t.publication_id!==e),publicationUserMap:(0,d.i4)(t.publicationUserMap,e)})))},v=async e=>{try{let t=await (0,c.rd)("/api/v1/subscription/".concat(e));f(e,t)}catch(t){t instanceof c.kp&&(404===t.response.status?a(t=>h(t,e)):console.error(t))}};return{result:o,isLoading:!1,hasLoadedOnce:o.hasLoadedOnce,refetch:async()=>o,refetchPublication:v,updatePublication:f,removeByPubId:e=>a(t=>h(t,e))}}function h(e,t){let n=e.subscriptions.filter(e=>e.publication_id!==t);return(0,i._)((0,r._)({},e),{subscriptions:n,subscriptionMap:new Map(n.map(e=>[e.publication_id,e]))})}let v=(0,a.createContext)({result:null,isLoading:!1,hasLoadedOnce:!1,refetch:()=>Promise.resolve(p),refetchPublication:()=>Promise.resolve(),updatePublication(){},removeByPubId:()=>{}});function g(){return(0,l.qp)(v)}function m(e){var t;let{subscriptionMap:n,publicationUserMap:r,publicationsWithPledges:i}=null!==(t=g().result)&&void 0!==t?t:{subscriptionMap:new Map,publicationUserMap:new Map,publicationsWithPledges:[]};return{subscription:n.get(e),publicationUser:r.get(e),is_pledged:!!(null==i?void 0:i.includes(e))}}function b(e){let{subscription:t,publicationUser:n,is_pledged:r}=m(e),i=(null==t?void 0:t.membership_state)==="free_signup",o=(null==t?void 0:t.membership_state)==="subscribed",a=!!(null==t?void 0:t.is_founding),l=!!(n&&["contributor","admin"].includes(n.role));return{subscription:t,publicationUser:n,isFreeSubscribed:i,isPaid:o,isSubscribed:i||o||l,isAuthor:l,isFounding:a,isPledged:r}}function _(){var e,t,n;let{publicationUsers:r,publicationMap:i}=null!==(e=g().result)&&void 0!==e?e:{publicationMap:new Map,publicationUsers:[]},o=null!==(n=null!==(t=r.find(e=>e.is_primary))&&void 0!==t?t:r.find(e=>"admin"===e.role))&&void 0!==n?n:r.find(e=>"contributor"===e.role);return o&&i.get(o.publication_id)}function w(e){var t,n;let{publicationUsers:r}=null!==(t=g().result)&&void 0!==t?t:{publicationUsers:[]};return null!==(n=r.find(t=>t.publication_id===e))&&void 0!==n?n:null}async function*y(e,t){var{getPageInit:n}=t,r=(0,o._)(t,["getPageInit"]);let i=await (0,c.rd)(e,r);yield i;let a=n(i,r);for(;null!=a;)i=await (0,c.rd)(e,a),yield i,a=n(i,r)}},17440:function(e,t,n){if(n.d(t,{F5:()=>l,FN:()=>s,Rg:()=>o,i4:()=>a,zg:()=>i}),/^(2[79]87|3154|4716|5288|6909)$/.test(n.j))var r=n(7409);function i(e,t,n){let r=new Map(e);for(let e of t)r.set(n(e),e);return r}function o(e,t,n){let r=new Map(e);return r.set(t,n),r}function a(e,t){let n=new Map(e);return n.delete(t),n}function l(e,t,n){let i=e.get(t);if(null!=i){let o=new Map(e);return o.set(t,(0,r._)({},i,n)),o}return e}function s(e,t,n){let r=e.get(t);if(null!=r){let i=new Map(e);return i.set(t,n(r)),i}return e}},62515:function(e,t,n){n.d(t,{Ds:()=>s,Rm:()=>o,aD:()=>a,gp:()=>l});var r=n(14773),i=n(63651);function o(e,t){return(0,r.Q2)("/chat/".concat(e),t)}function a(e,t){return(0,r.Q2)("/chat/".concat(e),t)}function l(e){return(0,r.Q2)("/chat/new",e)}function s(e){let{userId:t,userName:n}=e,o=(0,i.JlE)({userId:t,userName:n});return"".concat((0,r.ZX)(),"/chat/dm/user/").concat(o)}}}]);