/*! For license information please see 1044.0ccfc201.js.LICENSE.txt */
"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1044"],{72910:function(e,t,a){a.d(t,{Z:()=>r});let r=(0,a(36150).Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},58857:function(e,t,a){a.r(t),a.d(t,{GlobalSearch:()=>I});var r=a(7409),i=a(99282),n=a(16584),o=a(30396),l=a(72910);let c=(0,a(36150).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var s=a(24840),u=a(98661),p=a(71171),d=a.n(p),y=a(53311),h=a(98848),g=a(19081),f=a(58175);function b(e){var{title:t,body:a,children:o}=e,l=(0,h._)(e,["title","body","children"]);return(0,n.tZ)(g.tu,(0,i._)((0,r._)({flex:"grow",alignItems:"center",justifyContent:"center",padding:20},l),{children:(0,n.tZ)(_,{title:t,body:a,children:o})}))}function _(e){let{title:t,body:a,children:r}=e;return(0,n.BX)(g.tu,{gap:12,alignItems:"center",children:[(0,n.BX)(g.tu,{gap:4,alignItems:"center",children:[(0,n.tZ)(f.xv.B3,{weight:"semibold",color:"primary",align:"center",children:t}),(0,n.tZ)(f.xv.B4,{color:"secondary",align:"center",children:a})]}),r]})}var m=a(68833),v=a(7882),S=a(63018),q=a(98914),k=a(45578),w=a.n(k),Z=a(60807),R=a(98012);let L=e=>{let{isOpen:t}=e,a=(0,Z.aF)(),[r,i]=(0,o.eJ)([]),{result:n,hasLoadedOnce:l,isLoading:c,refetch:s}=(0,v.ib)({pathname:"/api/v1/search/history"}),{refetch:u}=(0,v.ib)({pathname:"/api/v1/search/history",method:"post"}),{refetch:p}=(0,v.ib)({pathname:"/api/v1/search/history",method:"delete"});(0,o.d4)(()=>{t&&!l&&!c&&a&&s()},[l,s,t,c,a]),(0,o.d4)(()=>{let e=g();if(null==n?void 0:n.length){var t;let a=null!==(t=null==n?void 0:n.sort((e,t)=>e.created>t.created?-1:1).map(d))&&void 0!==t?t:[];i(w()([...e,...a],"query"))}else i(e)},[n]);let d=e=>({type:"history",query:e.query}),y=()=>a?"ss-recent-search-global-".concat(null==a?void 0:a.id):"",h=()=>{if(!a||!localStorage)return[];let e=localStorage.getItem(y());return(e?JSON.parse(e):[]).filter(e=>new Date(e.expiry)>new Date).sort((e,t)=>e.expiry<t.expiry?-1:1)},g=()=>h().map(d),f=async e=>{let{query:t}=e;if(!a||!localStorage)return;let n=h().filter(e=>e.query!==t);localStorage.setItem(y(),JSON.stringify(n)),i(r.filter(e=>e.query!==t)),await p({query:{query:t}})};return{recentSearches:r,insertRecentSearch:async e=>{let{query:t}=e;if(!a||!localStorage)return;let r=h(),n=w()([{query:t,expiry:(0,R.Z)().add(1,"week").toDate()},...r],"query");localStorage.setItem(y(),JSON.stringify(n)),i(n.map(d)),await u({json:{query:t}})},removeRecentSearch:f,search:function*(e){let{query:t}=e;for(let e of r)e.query.includes(t)&&(yield{type:"history",query:e.query})}}};var J=a(25479),C=a(32071),x=a(60308),O=a(63651),P=a(47929);function X(e){return(0,O.n1t)(e,{utm_source:P.b3.globalSearch})}function I(e){let{isOpen:t,onClose:a,useLocalNavigation:p=!0,suggestedSearches:h}=e,{search:_}=function(e){let{isOpen:t}=e,{data:a}=(0,S._I)("/api/v1/client-search-cache",{auto:t,shouldRevalidate:!1});return{search:e=>(function*(e,t){let a=t.toUpperCase().trim();if(a&&e){for(let t of e.profiles)(0,C.u)([t.name]).some(e=>e.includes(a))&&(yield{type:"user",user:t});for(let t of e.publications)(0,C.u)([t.author_name,t.name]).some(e=>e.includes(a))&&(yield{type:"publication",publication:t});for(let t of e.categories)t.slug&&(0,C.u)([t.canonical_name,t.name]).some(e=>e.includes(a))&&(yield{type:"category",category:t})}})(a,e),get isLoaded(){return!!a}}}({isOpen:t}),{search:k}=function(){let{refetch:e}=(0,v.ib)({pathname:"/api/v1/platform/search",auto:!1});return{async search(t,a,r){let i=await e({query:{query:t,search_id:a,start_rank_at:r}});return i instanceof Error?(console.error(i),{results:[]}):i}}}(),{recentSearches:w,insertRecentSearch:Z,removeRecentSearch:R,search:P}=L({isOpen:t}),{surfaces:I}=(0,J.ze)(),[{results:T,isLoading:B,ribbonResults:E},j]=(0,o.eJ)({results:[],ribbonResults:[],isLoading:!1}),[A,G]=(0,o.eJ)(""),[M,N]=(0,o.eJ)(),[U,D]=(0,o.eJ)("defaults"),F=(0,o.sO)({abort:null});(0,o.d4)(()=>{t&&G("")},[t]),(0,o.d4)(()=>{A||(H(),D("defaults"),j({results:V({queryResults:[...w,...h.map(e=>({type:"trending",query:e})).reverse()]}),ribbonResults:V({queryResults:I}),isLoading:!1}))},[A,w,h,I]),(0,o.d4)(()=>{A&&K(A)},[A]);let H=()=>{var e;(null===(e=F.current)||void 0===e?void 0:e.abort)&&(F.current.abort(),F.current.abort=null)};function V(e){let{queryResults:t}=e,a=[];return t.forEach(e=>{var t,n,o;if("publication"===e.type)a.push({id:"publication".concat(e.publication.publication_id,"-").concat(U),publication:(0,i._)((0,r._)({},e.publication),{logo_url:null!==(t=e.publication.logo_url)&&void 0!==t?t:void 0,url:X((0,x.TJI)(e.publication))}),type:"publication",trackingParameters:e.trackingParameters});else if("user"===e.type){let t=e.user.handle?(0,O.NJv)(e.user.handle):(0,O.GR3)(e.user.user_id,e.user.name);a.push({type:"user",user:(0,i._)((0,r._)({},e.user),{id:e.user.user_id,profile_url:X(t),is_pub_search:!1}),id:"user-".concat(e.user.user_id,"-").concat(U),trackingParameters:e.trackingParameters})}else if("post"===e.type)a.push({id:"post-".concat(e.post.slug,"-").concat(e.post.publication_id,"-").concat(U),type:"post",post:{title:e.post.title,subtitle:e.post.subtitle,url:X(e.post.url),body:e.post.truncated_body,audience:e.post.audience,date:e.post.post_date,image:e.post.cover_image,is_paywalled:["only_paid","founding"].includes(e.post.audience)}});else if("history"===e.type){let t={type:"action",title:"".concat(e.query),icon:l.Z,id:"search-history-".concat(e.query,"-").concat(U),displayValue:e.query,onRemove:()=>{R({query:e.query})},actionType:"history",url:X("".concat((0,O.ZJn)(),"/search/").concat(e.query))};a.unshift((0,i._)((0,r._)({},t),{onSelect:()=>{G(e.query),N((0,i._)((0,r._)({},t),{rank:-1}))}}))}else"trending"===e.type?a.unshift({type:"action",title:"".concat(e.query),icon:c,id:"search-suggestion-".concat(e.query,"-").concat(U),displayValue:e.query,actionType:"trending",url:X("".concat((0,O.ZJn)(),"/search/").concat(e.query))}):"category"===e.type?a.push({id:"category-".concat(e.category.slug,"-").concat(U),type:"category",category:{name:e.category.name,url:(0,O.XAP)(null!==(n=e.category.slug)&&void 0!==n?n:"recommendations"),slug:null!==(o=e.category.slug)&&void 0!==o?o:"",emoji:e.category.emoji}}):"visited-profile"===e.type?a.push({type:"visited-profile",id:"profile-surface-".concat(e.profile.id,"-").concat(U),profile:(0,i._)((0,r._)({},e.profile),{url:X((0,O.GR3)(e.profile.id,e.profile.name))})}):"visited-publication"===e.type&&a.push({type:"visited-publication",id:"publication-surface-".concat(e.publication.id,"-").concat(U),publication:(0,i._)((0,r._)({},e.publication),{url:X((0,x.TJI)(e.publication))})})}),a.map((e,t)=>{let n=(0,i._)((0,r._)({search_id:U,search_key:"global_search",result_count:a.length,score:-1,result_id:"generated-".concat(t),from_server:!1},e.trackingParameters),{rank:t});return(0,i._)((0,r._)({},e),{trackingParameters:n})})}let K=(0,v.Kt)(async e=>{j(e=>(0,i._)((0,r._)({},e),{isLoading:!0})),H();let t=new AbortController;F.current.abort=()=>t.abort();let a=d()();D(a);let n=new Set,o=new Set,l=[],c=0;for await(let a of _(e)){if(t.signal.aborted||l.length>=100)break;"user"===a.type&&n.add(a.user.user_id),"publication"===a.type&&o.add(a.publication.publication_id),l.push(a),++c%20==0&&await new Promise(e=>setTimeout(e,50))}for await(let a of P({query:e})){if(t.signal.aborted||l.length>=100)break;l.push(a),++c%20==0&&await new Promise(e=>setTimeout(e,50))}if(t.signal.aborted||(l.length&&j({results:V({queryResults:l}),ribbonResults:[],isLoading:e.length>=2}),e.length<2))return;let s=l.length,{results:u}=await k(e,a,s);if(t.signal.aborted)return;l.push(...u.filter(e=>"user"===e.type?!n.has(e.user.user_id):"publication"!==e.type||!o.has(e.publication.publication_id))),j({results:V({queryResults:l}),ribbonResults:[],isLoading:!1});let p={query:e,results:l.length,search_id:a};(0,m.j)(m.FP.GLOBAL_SEARCH_RESULTS_SHOWN,(0,i._)((0,r._)({},p),{clientsideResultCount:s}))},300,[_,P]),Q=()=>{N(void 0),G(""),a()},z=(0,u.useMemo)(()=>{let e="".concat((0,O.ZJn)(),"/search/").concat(A),t=A?[{id:"action-search-".concat(A),type:"action",icon:s.Z,url:X(A?e:"/search"),title:(0,n.BX)(f.xv.B3,{as:"span",children:["Search for"," ",(0,n.tZ)(f.xv.B3,{as:"span",weight:"bold",children:A})]}),displayValue:A,actionType:"escape-hatch",keepOpenOnSelect:!1}]:[],a=A&&"defaults"===U?[]:T;return t.concat(a)},[A,T,U]),W=(0,u.useMemo)(()=>A&&"defaults"===U?[]:E,[A,E,U]);return(0,n.tZ)(y.s,{onQueryChange:e=>G(e),results:z,ribbonResults:W,placeholder:"People, publications, or topics",isOpen:t,onClose:Q,onEnter:(e,t)=>{(0,m.j)(m.FP.GLOBAL_SEARCH_RESULT_CLICKED,(0,i._)((0,r._)({},e.trackingParameters),{result_type:e.type,action_type:"action"===e.type?e.actionType:void 0})),A&&Z({query:A}),"user"===e.type&&(0,q.uX)(e.user.profile_url,{newTab:t,local_navigation:p}),"publication"===e.type&&(0,q.uX)(e.publication.url,{local_navigation:!1,newTab:t}),"post"===e.type&&(0,q.uX)(e.post.url,{local_navigation:!1,newTab:t}),"category"===e.type&&(0,q.uX)(e.category.url,{newTab:t,local_navigation:p}),"visited-profile"===e.type&&(0,q.uX)(e.profile.url,{newTab:t,local_navigation:p}),"visited-publication"===e.type&&(0,q.uX)(e.publication.url,{local_navigation:!1,newTab:t}),("action"!==e.type||(e.url&&(0,q.uX)(e.url,{newTab:t,local_navigation:p}),!e.onSelect||(e.onSelect(),!e.keepOpenOnSelect)))&&Q()},isLoading:B,value:M,noQueryZeroState:w.length>0||h.length>0?null:(0,n.BX)(g.tu,{justifyContent:"center",alignItems:"center",padding:8,flex:"grow",gap:12,children:[(0,n.tZ)(s.Z,{}),(0,n.tZ)(b,{title:"Search all of Substack",body:"Find people and publications",flex:"auto",padding:0})]})})}},32071:function(e,t,a){a.d(t,{u:()=>n});var r=a(39693),i=a.n(r);let n=e=>i()(e).map(e=>e.toUpperCase())}}]);