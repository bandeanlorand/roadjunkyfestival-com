"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["7184"],{8131:function(e,t,i){i(16584),i(98661),i(30396),i(94184),i(8400),i(23279),i(23493),i(80569),i(93666),i(95441),i(15771),i(19081),i(98248),i(58175),i(60308)},74679:function(e,t,i){i(16584),i(30396),i(66067),i(15771)},81924:function(e,t,i){i.d(t,{w:()=>f});var o=i(16584),a=i(30396),n=i(55679),d=i(70109),l=i(94184),r=i.n(l);i(23279);var s=i(47976);i(95441);var c=i(22747);i(68833);var p=i(98914);i(15771);var u=i(19081);i(38023),i(6490);var h=i(58175),m=i(81355),v=i(60520);let f=e=>{let{node:t,id:i}=e,[l,f]=(0,a.eJ)(t.attrs.persistentExpression);return(0,a.d4)(()=>{f(t.attrs.persistentExpression)},[t]),(0,a.d4)(()=>{let e=e=>{let{detail:i}=e;i.node.attrs.id===t.attrs.id&&f(i.persistentExpression)};return(0,c.oj)().addEventListener("close",e),()=>{(0,c.oj)().removeEventListener("close",e)}},[]),(0,o.tZ)(n.T5,{"data-drag-handle":"",children:(0,o.tZ)(m.e,{children:(0,o.tZ)("div",{className:"latex-block",id:i,children:(0,o.tZ)(u.tu,{className:r()(v.Z.latexWrapper,t.attrs.persistentExpression||(0,p.K1)()?v.Z.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:l,id:t.attrs.id}),onClick:()=>{l!==t.attrs.persistentExpression&&f(t.attrs.persistentExpression),(0,c.oj)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,o.BX)(u.gq,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[l||t.attrs.persistentExpression?(0,o.tZ)(u.tu,{alignItems:"center",justifyContent:"center",children:(0,o.tZ)(d.Z,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(l||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,o.tZ)(u.tu,{alignSelf:"center",children:(0,o.tZ)(h.xv.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,o.tZ)(u.tu,{children:(0,o.tZ)("button",{className:v.Z.latexEdit,children:(0,o.tZ)(s.Z,{width:20,height:20})})})]})})})})})}},1148:function(e,t,i){i.d(t,{H:()=>a});var o=i(16584);let a=e=>(0,o.tZ)("div",{className:"file-embed-wrapper-editor",children:(0,o.tZ)("div",{className:"file-embed-aligner",children:(0,o.tZ)("div",{className:"file-embed-container placeholder",children:(0,o.tZ)(n,{})})})}),n=()=>(0,o.BX)("div",{className:"embed-loader-container",children:[(0,o.tZ)("div",{className:"embed-loader"}),(0,o.tZ)("div",{className:"embed-loader-text",children:"Loading..."})]})},67560:function(e,t,i){i(16584),i(30396),i(33804),i(95441),i(7882),i(15771),i(19081),i(68709),i(6490),i(17688),i(51776),i(63651)},42684:function(e,t,i){i(27412),i(7409),i(99282),i(16584),i(16564),i(86657),i(64819),i(24763);var o=i(21903);i(24791),i(60308),o.ZP},19908:function(e,t,i){i.d(t,{M:()=>a});var o=i(83857);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let a=e=>(t,i,a)=>{if(i){var n,d,l;(0,o.d)(e.marks.link,{scrollParent:".editor-scroll",language:"undefined"!=typeof window?null===(l=window)||void 0===l?void 0:null===(d=l._preloads)||void 0===d?void 0:null===(n=d.publication)||void 0===n?void 0:n.language:null}).spec.run(t,i,a)}return!0}},21903:function(e,t,i){i.d(t,{QM:()=>b,ZP:()=>M,hJ:()=>w});var o=i(27412),a=i(7409),n=i(58865),d=i(6400),l=i(14293),r=i.n(l),s=i(81763),c=i.n(s),p=i(80569),u=i.n(p),h=i(88452),m=i(40647),v=i(68833),f=i(98914),y=i(10656),g=i(98012),E=i(84864);function U(){let e=(0,n._)(["This will remove your audio. Are you sure?"]);return U=function(){return e},e}function x(){let e=(0,n._)(["This will remove your video. Are you sure?"]);return x=function(){return e},e}function T(){let e=(0,n._)(["File too large. Your file is ","; the maximum is ",".  Try encoding at a lower bitrate."]);return T=function(){return e},e}function _(){let e=(0,n._)(["It looks like your file is empty (0 bytes). Please check that the file you are trying to upload is not corrupted."]);return _=function(){return e},e}let w="video/*";class M extends d.Component{componentDidMount(){this.syncUploads()}componentWillUnmount(){this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime()}componentDidUpdate(e,t){e.mediaUploadId!==this.props.mediaUploadId&&null===this.props.mediaUploadId&&(this.clearSyncMediaUploadTimeouts(),this.stopUpdatingTranscodingTime(),this.setState({mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null})),this.checkTranscodeStates(t),this.checkForNewUploads(e)}getMediaUploadId(){return this.state.mediaUploadId}stopUpdatingTranscodingTime(){clearTimeout(this.updateTranscodingTimeout),this.updateTranscodingTimeout=null}getEstimatedTranscodingTime(){let e=1,t=0,i=new Date().getTime(),{mediaUpload:o}=this.state;if((null==o?void 0:o.state)==="uploaded"&&o.uploaded_at&&o.duration&&o.duration>0){let a="video"===this.props.mediaType?.7:.03,n=1e3*Math.max("video"===this.props.mediaType?60:5,o.duration*a),d=Math.max(0,n-Math.max(0,Date.now()-new Date(o.uploaded_at).getTime()));e=Math.max(0,1-d/n),this.state.timeLeft&&this.state.timeLeft<d&&this.state.estimatedTimeLeftAt-Date.now()<5e3?(t=this.state.timeLeft,i=this.state.estimatedTimeLeftAt):t=d}return{estimatedTimeLeftAt:i,percentComplete:e,timeLeft:t}}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){var i;super(e,t),i=this,(0,o._)(this,"updateTranscodingTimeout",void 0),(0,o._)(this,"syncMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractMediaUploadTimeout",void 0),(0,o._)(this,"syncAudioExtractPreviewMediaUploadTimeout",void 0),(0,o._)(this,"optionsDropdown",void 0),(0,o._)(this,"syncingMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractMediaUpload",void 0),(0,o._)(this,"syncingAudioExtractPreviewMediaUpload",void 0),(0,o._)(this,"i18n",void 0),(0,o._)(this,"updateTranscodingTime",()=>{var e;this.updateTranscodingTimeout||(this.setState(this.getEstimatedTranscodingTime()),(null===(e=this.state.mediaUpload)||void 0===e?void 0:e.state)==="uploaded"&&(this.updateTranscodingTimeout=window.setTimeout(()=>{this.updateTranscodingTimeout=null,this.updateTranscodingTime()},1e3)))}),(0,o._)(this,"onMediaUpload",e=>{var t;let{mediaUpload:i}=e;clearTimeout(null!==(t=this.syncMediaUploadTimeout)&&void 0!==t?t:void 0),this.setState({mediaUploadId:null==i?void 0:i.id,mediaUpload:i},()=>{var e,t;this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),null===(e=(t=this.props).onChange)||void 0===e||e.call(t,{mediaUpload:i})})}),(0,o._)(this,"onAudioExtractMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.setState({audioExtractMediaUploadId:null==t?void 0:t.id,audioExtractMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onAudioExtractPreviewMediaUpload",e=>{let{mediaUpload:t}=e;clearTimeout(this.onAudioExtractPreviewMediaUpload),this.setState({audioExtractPreviewMediaUploadId:null==t?void 0:t.id,audioExtractPreviewMediaUpload:t},()=>{var e,i;this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),null===(e=(i=this.props).onAudioExtractPreviewChange)||void 0===e||e.call(i,{mediaUpload:t})})}),(0,o._)(this,"onMediaUploadUpdated",e=>{var t,i;null===(t=(i=this.props).onChange)||void 0===t||t.call(i,{mediaUpload:(0,a._)({},this.props.mediaUpload,e)})}),(0,o._)(this,"removeUpload",function(){var e;let{skipConfirm:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{iTemplate:o}=i.i18n,{mediaUploadId:a,mediaUpload:n}=i.state;if(a){if(!t&&!["cancelled","error"].includes(null==n?void 0:n.state)&&!confirm(o((null==n?void 0:n.media_type)==="audio"?U():x())))return;null===(e=i.optionsDropdown)||void 0===e||e.close(),i.clearSyncMediaUploadTimeouts(),i.setState({mediaUploadId:null,mediaUpload:null,audioExtractMediaUploadId:null,audioExtractMediaUpload:null,audioExtractPreviewMediaUploadId:null,audioExtractPreviewMediaUpload:null},()=>{var e,t,o,a,n,d;null===(e=(t=i.props).onChange)||void 0===e||e.call(t,{mediaUpload:null}),null===(o=(a=i.props).onAudioExtractChange)||void 0===o||o.call(a,{mediaUpload:null}),null===(n=(d=i.props).onAudioExtractPreviewChange)||void 0===n||n.call(d,{mediaUpload:null})})}}),(0,o._)(this,"syncUploads",()=>{this.syncUpload({uploadIdKey:"mediaUploadId",uploadKey:"mediaUpload",uploadTimeoutKey:"syncMediaUploadTimeout",uploadSyncingKey:"syncingMediaUpload",endpoint:"/api/v1/".concat(this.props.mediaType,"/upload/{id}")}),this.syncUpload({uploadIdKey:"audioExtractMediaUploadId",uploadKey:"audioExtractMediaUpload",uploadTimeoutKey:"syncAudioExtractMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractMediaUpload",endpoint:"/api/v1/audio/upload/{id}"}),this.syncUpload({uploadIdKey:"audioExtractPreviewMediaUploadId",uploadKey:"audioExtractPreviewMediaUpload",uploadTimeoutKey:"syncAudioExtractPreviewMediaUploadTimeout",uploadSyncingKey:"syncingAudioExtractPreviewMediaUpload",endpoint:"/api/v1/audio/upload/{id}"})}),(0,o._)(this,"getTimeoutDuration",e=>(0,g.Z)(e).add(6e4,"milliseconds").isBeforeNow()?3e4:1e4),(0,o._)(this,"clearSyncMediaUploadTimeouts",()=>{this.syncMediaUploadTimeout&&clearTimeout(this.syncMediaUploadTimeout),this.syncAudioExtractMediaUploadTimeout&&clearTimeout(this.syncAudioExtractMediaUploadTimeout),this.syncAudioExtractPreviewMediaUploadTimeout&&clearTimeout(this.syncAudioExtractPreviewMediaUploadTimeout)}),(0,o._)(this,"syncUpload",async e=>{var t,i;let{uploadIdKey:o,uploadKey:a,uploadTimeoutKey:n,uploadSyncingKey:d,endpoint:l}=e,r=this.state[o],s=this.state[a];if(!r){s&&this.setState({[a]:null});return}if((null==s?void 0:s.state)!=="transcoded"&&!this[d]){this[d]=!0;try{let e=await u().get(l.replace("{id}",r));this.setState({[a]:e.body},()=>{"uploaded"!==e.body.state?this.stopUpdatingTranscodingTime():this.updateTranscodingTime()})}catch(e){alert((0,f.zx)(e))}this.state[a]&&(null===(t=this.state[a])||void 0===t?void 0:t.state)!=="uploaded"||(this[n]=window.setTimeout(()=>this.syncUpload({uploadIdKey:o,uploadKey:a,uploadTimeoutKey:n,uploadSyncingKey:d,endpoint:l}),this.getTimeoutDuration(null===(i=this.state[a])||void 0===i?void 0:i.created_at))),this[d]=!1}}),(0,o._)(this,"checkTranscodeStates",e=>{var t,i,o,a,n,d,l,r,s,c,p,u,h,m,v,f;(null===(t=this.state.mediaUpload)||void 0===t?void 0:t.state)==="transcoded"&&(null===(i=e.mediaUpload)||void 0===i?void 0:i.state)!==(null===(o=this.state.mediaUpload)||void 0===o?void 0:o.state)&&(null===(p=(u=this.props).onChange)||void 0===p||p.call(u,{mediaUpload:this.state.mediaUpload})),((null===(a=this.state.audioExtractMediaUpload)||void 0===a?void 0:a.state)==="transcoded"||(null===(n=this.state.audioExtractMediaUpload)||void 0===n?void 0:n.state)==="error")&&(null===(d=e.audioExtractMediaUpload)||void 0===d?void 0:d.state)!==(null===(l=this.state.audioExtractMediaUpload)||void 0===l?void 0:l.state)&&(null===(h=(m=this.props).onAudioExtractChange)||void 0===h||h.call(m,{mediaUpload:this.state.audioExtractMediaUpload})),(null===(r=this.state.audioExtractPreviewMediaUpload)||void 0===r?void 0:r.state)==="transcoded"&&(null===(s=e.audioExtractPreviewMediaUpload)||void 0===s?void 0:s.state)!==(null===(c=this.state.audioExtractPreviewMediaUpload)||void 0===c?void 0:c.state)&&(null===(v=(f=this.props).onAudioExtractPreviewChange)||void 0===v||v.call(f,{mediaUpload:this.state.audioExtractPreviewMediaUpload}))}),(0,o._)(this,"checkForNewUploads",e=>{var t,i,o,a,n,d;(e.mediaUpload!==this.props.mediaUpload||e.mediaUploadId!==this.props.mediaUploadId)&&this.setState({mediaUpload:null!==(t=this.props.mediaUpload)&&void 0!==t?t:null,mediaUploadId:null!==(i=this.props.mediaUploadId)&&void 0!==i?i:null}),(e.audioExtractMediaUpload!==this.props.audioExtractMediaUpload||e.audioExtractMediaUploadId!==this.props.audioExtractMediaUploadId)&&this.setState({audioExtractMediaUpload:null!==(o=this.props.audioExtractMediaUpload)&&void 0!==o?o:null,audioExtractMediaUploadId:null!==(a=this.props.audioExtractMediaUploadId)&&void 0!==a?a:null}),(e.audioExtractPreviewMediaUpload!==this.props.audioExtractPreviewMediaUpload||e.audioExtractPreviewMediaUploadId!==this.props.audioExtractPreviewMediaUploadId)&&this.setState({audioExtractPreviewMediaUpload:null!==(n=this.props.audioExtractPreviewMediaUpload)&&void 0!==n?n:null,audioExtractPreviewMediaUploadId:null!==(d=this.props.audioExtractPreviewMediaUploadId)&&void 0!==d?d:null})}),this.state={mediaUploadId:e.mediaUploadId,mediaUpload:e.mediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1},this.updateTranscodingTimeout=null,this.syncMediaUploadTimeout=null,this.syncAudioExtractMediaUploadTimeout=null,this.syncAudioExtractPreviewMediaUploadTimeout=null,this.syncingMediaUpload=!1,this.syncingAudioExtractMediaUpload=!1,this.syncingAudioExtractPreviewMediaUpload=!1,this.i18n=I18N.i(e.language)}}M.contextType=m.QA;class b extends h.Z{componentDidUpdate(e){this.props.initialFile!==e.initialFile&&(this.onFileSelected(this.props.initialFile),e.initialFile&&this.cancelUpload())}trackUploadClicked(){}onError(){var e,t,i;let{upload_state:o="uploading",customMessage:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,v.j)(v.FP.MEDIA_UPLOAD_FAILED,{upload_state:o,media_upload_id:null===(e=this.state.mediaUpload)||void 0===e?void 0:e.id,post_id:this.props.postId,customMessage:a}),null===(t=(i=this.props).onUploadCanceled)||void 0===t||t.call(i),super.onError({upload_state:o},a)}render(e,t){return console.error("render must be implemented by child class"),null}constructor(e,t){if(super(e,t),(0,o._)(this,"accepts",void 0),(0,o._)(this,"chunkSize",void 0),(0,o._)(this,"input",null),(0,o._)(this,"i18n",void 0),(0,o._)(this,"onUploadClicked",async()=>{this.trackUploadClicked()}),(0,o._)(this,"uploadToS3",async e=>{var t,i,o,n,d,l,r,s,c,p;let h;if((null===(t=this.state)||void 0===t?void 0:t.preuploading)||(null===(i=this.state)||void 0===i?void 0:i.uploading))return;null===(o=(n=this.props).onUploadStarted)||void 0===o||o.call(n),this.setState({preuploading:!0});let{iTemplate:m}=this.i18n;if(e.size>E.MAX_MEDIA_FILE_SIZE){this.onError({upload_state:"preupload",customMessage:m(T(),(0,E.formatBytes)(e.size),(0,E.formatBytes)(E.MAX_MEDIA_FILE_SIZE))});return}if(0===e.size){this.onError({upload_state:"preupload",customMessage:m(_())});return}this.props.postId||(this.props.setPostId?await (null===(d=(l=this.props).setPostId)||void 0===d?void 0:d.call(l)):console.warn("missing postId and cannot set postId, likely a non post editor")),this.setState({durationPromise:(0,y.Iw)(e)});try{let t="video"===this.props.mediaType?"/api/v1/video/upload":"/api/v1/audio/upload";h=await u().post(t).query((0,a._)({filetype:e.type,fileSize:e.size,fileName:"".concat(null==e?void 0:e.name)},this.props.postId?{post_id:this.props.postId}:{})),(0,v.j)(v.FP.MEDIA_UPLOAD_CREATED,{media_type:this.props.mediaType,file_size:e.size,file_type:e.type,parts_size:(null!==(r=h.body.multipartUploadUrls)&&void 0!==r?r:[]).length,post_id:this.props.postId})}catch(e){console.error("Failed to create media upload:",e),this.onError({upload_state:"preupload",customMessage:(0,f.zx)(e)});return}let{mediaUpload:g,multipartUploadId:U,multipartUploadUrls:x}=h.body,w=(null!==(s=null==g?void 0:g.parts)&&void 0!==s?s:[]).map(e=>e.etag).filter(Boolean);"created"===g.state&&w.length===x.length?(this.setState({mediaUpload:g,mediaUploadId:g.id}),await this.initTranscode(g,w)):"uploaded"===g.state||"transcoded"===g.state?null===(c=(p=this.props).onUpload)||void 0===c||c.call(p,h.body):(this.setState({preuploading:!1,mediaUpload:g,multipartUploadId:U,existingEtags:w}),(0,v.j)(v.FP.MEDIA_UPLOAD_STARTED,{media_upload_id:g.id,media_type:this.props.mediaType,post_id:this.props.postId}),super.uploadFile(e,null,{urls:x,method:"PUT",withCredentials:!1,useFormData:!1,mediaUpload:g}))}),(0,o._)(this,"onFileSelected",async e=>{var t,i,o,a;if(this.setState({recording:!1}),e=e||(null===(i=this.input)||void 0===i?void 0:null===(t=i.files)||void 0===t?void 0:t[0]),this.input&&(this.input.value=""),e){if(!r()(this.props.maxVideoDurationSeconds))try{let t=await (0,y.Iw)(e);if("number"==typeof t&&t>this.props.maxVideoDurationSeconds){(0,v.j)(v.FP.VIDEO_UPLOAD_IN_NOTES_FAILED,{duration_seconds:t,reason:"too_long"}),null===(o=(a=this.props).onVideoTooLong)||void 0===o||o.call(a);return}}catch(e){console.warn("could not get video duration",e)}this.uploadToS3(e)}}),(0,o._)(this,"onComplete",async()=>{var e,t,i;let o=null===(e=this.state.uploading)||void 0===e?void 0:e.status;if(!o||o<200||o>=400){this.onError();return}(0,v.j)(v.FP.MEDIA_UPLOAD_COMPLETED,{media_upload_id:this.state.mediaUpload.id,post_id:this.props.postId});let a=[...null!==(i=this.state.existingEtags)&&void 0!==i?i:[],...null===(t=this.state.uploadingXhrs)||void 0===t?void 0:t.map(e=>e.getResponseHeader("Etag")).filter(Boolean)];await this.initTranscode(this.state.mediaUpload,a)}),(0,o._)(this,"initTranscode",async(e,t)=>{let i=null;try{if((i=await this.state.durationPromise)&&"object"==typeof i&&"is_error"in i)throw i}catch(e){console.error("Failed to fetch video duration:",e)}try{var o,a;let n=await u().post("/api/v1/".concat(this.props.mediaType,"/upload/").concat(e.id,"/transcode")).send({duration:c()(i)?i:null,multipart_upload_id:e.multipart_upload_id,multipart_upload_etags:t});this.setState({mediaUpload:null,audioExtractMediaUpload:null,multipartUploadId:null}),this.resetUpload(),null===(o=(a=this.props).onUpload)||void 0===o||o.call(a,n.body,"")}catch(e){throw alert((0,f.zx)(e)),this.onError({upload_state:"transcoding"}),e}}),!["video","audio"].includes(e.mediaType))throw Error("unsupported media type: ".concat(e.mediaType));this.accepts="video"===e.mediaType?w:"audio/mpeg,audio/mp3,audio/m4a,audio/x-m4a,audio/aac,audio/aiff,audio/x-aiff,audio/amr,audio/flac,audio/ogg,audio/wav,audio/x-wav",this.fudgeFactor=.9,this.chunkSize=E.MAX_MEDIA_UPLOAD_CHUNK_SIZE,this.i18n=I18N.i(e.language),e.initialFile&&this.onFileSelected(this.props.initialFile)}}b.contextType=m.QA},78592:function(e,t,i){i(16584),i(30396),i(80569),i(80026),i(6490)},39769:function(e,t,i){i(16584),i(30396),i(94184),i(39693),i(24350),i(57557),i(80569),i(71171),i(95441),i(98914),i(15771),i(55014),i(19081),i(8594),i(68709),i(6490),i(98661),i(88e3),i(98248),i(58175),i(51776),i(70379),i(63651)},60310:function(e,t,i){i(16584),i(98661),i(30396),i(23279),i(23493),i(80569),i(64515),i(93666),i(95441),i(7882),i(15771)},20479:function(e,t,i){i(16584),i(30396),i(347),i(95441),i(14952),i(7882),i(15771),i(19081),i(6490),i(17688),i(58175),i(63651)},44369:function(e,t,i){i.d(t,{$4:()=>r,Sm:()=>h,cS:()=>v,nv:()=>u,om:()=>y,pA:()=>f,vM:()=>m});var o=i(27412),a=i(42249),n=i(68833),d=i(98914),l=i(60308);class r extends a.sN{static fromMenuItem(e,t){let{spec:i}=e;return new r(i,t)}constructor(e,t){super(e);let i=this.spec.run;this.spec.run=(e,o,a,d)=>((0,n.j)(n.FP.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),i.call(this,e,o,a,d))}}let s="ProseMirror-prompt",c="".concat(s,"-visible");class p{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,o._)(this,"options",void 0),this.options=e}}class u extends p{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class h extends u{constructor(e,t,i="en"){let{iString:o}=I18N.i(i);super({label:o("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,l.SVA)(),"/publish/post/"))&&alert(o("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return o("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){console.error("Failed to parse URL:",e)}return e.startsWith("http")?o("Invalid URL"):o("Invalid URL. Try using http://")}}})}}function m(e,t){let{from:i,$from:o,to:a,empty:n}=e.selection;return n?!!t.isInSet(e.storedMarks||o.marks()):e.doc.rangeHasMark(i,a,t)}function v(e){if(f(e))return;let{iString:t}=I18N.i(e.language||"en"),i="".concat(s,"-").concat(e.parentClass),o=e.root||document.body,a=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(o)||window,n=o.appendChild(document.createElement("div"));n.classList.add(s),e.className&&n.classList.add(e.className),n.id=i,(0,d.cn)(document.body,c);let l=e=>{n.contains(e.target)||u()},r=()=>{if(e.position)e.position(n,h);else{var t,i;let o=e.parentClass&&(null===(t=(i=document).querySelector)||void 0===t?void 0:t.call(i,".".concat(e.parentClass)));if(o){let t=o.getBoundingClientRect();n.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),n.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=n.getBoundingClientRect();n.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),n.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},p=t=>{var i;t&&t.preventDefault();let o=function(e,t){let i={},o=0;for(let a in e){let n=e[a],d=t[o++],l=n.read(d),r=n.validate(l);if(r)return function(e,t){let i=e.parentNode;if(!i)return;let o=i.appendChild(document.createElement("div"));o.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),o.style.top="".concat(e.offsetTop-5,"px"),o.className="ProseMirror-invalid",o.textContent=t,setTimeout(()=>i.removeChild(o),1500)}(d,r),null;i[a]=n.clean(l)}return i}(null!==(i=e.fields)&&void 0!==i?i:{},m);o&&u(o)},u=t=>{(0,d.IV)(document.body,c),window.removeEventListener("mousedown",l),window.removeEventListener("resize",r,!1),a.removeEventListener("scroll",r,!1),n.parentNode&&n.parentNode.removeChild(n),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",l),50),window.addEventListener("resize",r,!1),a.addEventListener("scroll",r,!1);let h=n.appendChild(document.createElement("span"));h.className="head";let m=[],v=0;for(let t in e.fields){v++;let i=e.fields[t].render();i.tabIndex=v,m.push(i)}let y=n.appendChild(document.createElement("form"));if(e.title&&(y.appendChild(document.createElement("h5")).textContent=e.title),m.forEach(e=>{y.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let i=document.createElement("button");i.type="submit",i.className="".concat(s,"-submit"),i.textContent=e.submitText||"OK",i.addEventListener("click",p);let o=document.createElement("button");o.type="button",o.className="".concat(s,"-cancel"),o.textContent=t("Cancel"),o.addEventListener("click",()=>u());let a=y.appendChild(document.createElement("div"));a.className="".concat(s,"-buttons"),a.appendChild(i),a.appendChild(document.createTextNode(" ")),a.appendChild(o)}if(e.footer&&y.appendChild(e.footer),e.openseaEmbedFooter&&y.appendChild(e.openseaEmbedFooter),r(),y.addEventListener("submit",p),e.onInput&&y.addEventListener("input",t=>{var i;null===(i=e.onInput)||void 0===i||i.call(e,t,n)}),y.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),u();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{n.contains(document.activeElement)||u()},500),m.length>1)){for(let t=0;t<m.length;t++)if(document.activeElement===m[t]){0===t&&e.shiftKey?(e.preventDefault(),m[m.length-1].focus()):t!==m.length-1||e.shiftKey||(e.preventDefault(),m[0].focus());break}}}else e.preventDefault(),p()}),y.elements.length>0){let e=y.elements[0];for(let t of Array.from(y.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function f(e){let t="".concat(s,"-").concat(e.parentClass),i=document.getElementById(t);if(i){let e;if(i.querySelector&&(e=i.querySelector(".".concat(s,"-cancel"))),e)e.click();else{var o;null===(o=i.parentNode)||void 0===o||o.removeChild(i),(0,d.IV)(document.body,c)}return!0}}function y(e,t){let i=e.selection.$from;for(let e=i.depth;e>=0;e--){let o=i.index(e);if(i.node(e).canReplaceWith(o,o,t))return!0}return!1}},66586:function(e,t,i){i(16584),i(30396);var o=i(23493),a=i.n(o);i(16564),i(95441),i(42684),i(47921),i(68833),i(15771),i(19081),i(58175),i(87077),a()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1})},47921:function(e,t,i){i(16584),i(33804),i(71068),i(15771),i(6400),i(98661),i(30396),i(94184),i(19081),i(58175)},66067:function(e,t,i){i(16584),i(30396);var o=i(23493),a=i.n(o);i(95441),i(28771),i(47921),i(82061),i(68833),i(93687),i(15771),i(19081),i(58175),i(87077),a()((e,t)=>{e({mediaUploadId:null==t?void 0:t.id,duration:null==t?void 0:t.duration,mediaUpload:t})},1e3,{trailing:!1})},22747:function(e,t,i){i.d(t,{oj:()=>v});var o=i(7409),a=i(99282),n=i(98848),d=i(16584),l=i(98661),r=i(30396),s=i(94184);i(80569),i(8131),i(86374),i(74679),i(81924),i(347),i(95441),i(56629),i(60807),i(78592),i(39769),i(60310),i(20479),i(44369),i(66586),i(67560);var c=i(68833);i(49762),i(7882),i(98914);var p=i(15771);i(61254),i(19081);var u=i(44424);i(73943),i(84864);let h=(e,t,i)=>{(0,c.j)(c.FP.EDITOR_MENU_ICON_CLICKED,{button:i}),t(e)};function m(e,t){return(0,r.I4)(i=>{e&&(t?h(i,e,t):e(i))},[e,t])}(0,l.forwardRef)((e,t)=>{var{trackedName:i,testId:l,priority:r="tertiary",onClick:s}=e,c=(0,n._)(e,["trackedName","testId","priority","onClick"]);let u=m(s,i);return(0,d.tZ)(p.hU,(0,a._)((0,o._)({},c),{size:"sm","data-testId":l,onClick:u,ref:t,priority:r}))}),(0,l.forwardRef)((e,t)=>{var{trackedName:i,testId:l,priority:r="tertiary",onClick:s}=e,c=(0,n._)(e,["trackedName","testId","priority","onClick"]);let u=m(s,i);return(0,d.tZ)(p.zx,(0,a._)((0,o._)({},c),{size:"sm","data-testId":l,onClick:u,ref:t,priority:r}))}),(0,l.forwardRef)((e,t)=>{var{trackedName:i,testId:l,onClick:r}=e,s=(0,n._)(e,["trackedName","testId","onClick"]);let c=m(r,i);return(0,d.tZ)(u.sN,(0,a._)((0,o._)({},s),{"data-testId":l,onClick:c,ref:t}))});let v=()=>{if(window)return window.LatexModalEvent||(window.LatexModalEvent=new EventTarget),window.LatexModalEvent}},70232:function(e,t,i){i.d(t,{zF:()=>o}),i(98914);let o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAY4AAAB0BAMAAABgVMiEAAAAMFBMVEX////7+/vt7e3o6Ojm5ubn5+fu7u709PTs7Oz39/f19fX29vby8vLx8fHz8/Pw8PCxY+A8AAAAoklEQVR4AWJgVHYZ+sBIgEE0vXzog7JAhrZZq4Y+WJnB4A5o5w5oAAYBGAi6mcKpQgIaClhCBklz7+AM/Gjo5+Dg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgeO7g4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OD4Zse3dmVXfIST0/B1vh0UtMKbNF7rAAAAAElFTkSuQmCC"},82061:function(e,t,i){i.d(t,{nP:()=>S});var o=i(27412),a=i(7409),n=i(99282),d=i(58865),l=i(16584),r=i(98661),s=i(94184),c=i.n(s),p=i(98961),u=(i(2647),i(57560)),h=i(80569),m=i(13304),v=i(93666),f=(i(12281),i(95441)),y=i(41688),g=(i(31098),i(71825),i(21903)),E=(i(21680),i(40158),i(29719),i(68833)),U=(i(98914),i(88788)),x=i(69791),T=i(15771),_=i(19081),w=(i(44424),i(58175),i(74134),i(18618),i(84864)),M=i(96085);function b(){let e=(0,d._)([""," remaining"]);return b=function(){return e},e}function I(e){let{children:t,className:i}=e,o=(0,r.useRef)(null);if(!o.current){let e=document.getElementById("video-portal");if(e)o.current=e;else{let e=document.createElement("div");e.setAttribute("id","video-portal"),e.className=i||"",document.body.appendChild(e),o.current=e}}return(0,r.createPortal)(t,o.current)}g.ZP;let A=e=>{let{onCancel:t,percentComplete:i,msLeft:o}=e,{iString:a,iTemplate:n}=(0,f.M1)(),d=(0,w.secondsToLargestUnit)(o/1e3,{long:!0,secondsCutoff:30});return(0,l.BX)("div",{className:"video-uploader-progress",children:[(0,l.BX)("div",{className:"video-uploader-progress-label",children:[a("Uploading video..."),o?n(b(),d):""]}),(0,l.BX)("div",{className:"video-uploader-progress-status",children:[(0,l.tZ)(T.hU,{size:"sm",priority:"quaternary",onClick:()=>{t()},children:(0,l.tZ)(m.Z,{})}),(0,l.tZ)("div",{className:"video-uploader-progress-bar",children:(0,l.tZ)("div",{className:"video-uploader-progress-bar-filled",style:"width: ".concat(100*i,"%;")})})]})]})};g.QM;class S extends g.QM{trackUploadClicked(){(0,E.j)(E.FP.UPLOAD_VIDEO_CLICKED,{source:"notes"})}render(e,t){return null}constructor(e,t){super(e,t),(0,o._)(this,"videoRecorderModal",null),this.state=(0,n._)((0,a._)({},this.state),{hideVideoInfoPanel:!1})}}class C extends v.p{getClassName(){return"video-recorder-modal"}componentWillUnmount(){super.componentWillUnmount(),this.recorder.stopCapture(),this.close()}onBeforeOpen(){this.startCapturePromise||(this.startCapturePromise=this.recorder.startCapture())}async onOpen(){var e,t;(0,E.j)(E.FP.VIDEO_RECORDER_SHOWN),null===(t=this.props)||void 0===t||null===(e=t.onOpen)||void 0===e||e.call(t);let i=this.startCapturePromise;if(this.startCapturePromise=null,!await i){this.close();return}if(this.recorder.stream instanceof Promise){console.error("onOpen called before stream was ready");return}this.videoElement&&"srcObject"in this.videoElement?this.videoElement.srcObject=this.recorder.stream:this.videoElement.src=URL.createObjectURL(this.recorder.stream)}onBeforeClose(){if(this.videoElement&&(this.videoElement.pause(),this.videoElement.srcObject=null,this.videoElement.src=null),this.recorder.state===U.Z.STATE.STARTED&&["embed","podcast"].includes(this.props.videoFeature))this.onButtonClick();else if(this.recorder.state===U.Z.STATE.STARTED);else if(this.recorder.state===U.Z.STATE.STARTING){let e=this.recorder;e.onStarted=()=>e.stop({dropRecording:!0})}else this.recorder.stopCapture()}onClose(){var e,t;(0,E.j)(E.FP.VIDEO_RECORDER_HIDDEN),null===(t=this.props)||void 0===t||null===(e=t.onClose)||void 0===e||e.call(t),this.setState({videoLoading:!0})}onButtonClick(){this.recorder.state===U.Z.STATE.STOPPED?(this.setState({countDown:3}),setTimeout(()=>this.setState({countDown:2}),700),setTimeout(()=>this.setState({countDown:1}),1400),this.recorder.start({startAt:Date.now()+2100})):this.recorder.state===U.Z.STATE.STARTED&&this.recorder.stop({stopCapture:!1})}renderChildren(e,t){let{children:i}=e,{videoLoading:o,recorderState:a,recorderDuration:n,recorderVolume:d,countDown:r}=t,{iString:s}=this.context;return(0,l.BX)("div",{className:"video-recorder-modal-wrap",children:[(0,l.tZ)("video",{ref:this.assignVideoElement,className:"video-recorder-preview",onLoadedMetadata:this.onVideoElementLoadedMetadata}),(0,l.tZ)("div",{className:"video-recorder-duration ".concat(a),children:a===U.Z.STATE.STOPPED?s(o?"Loading...":"Press to record"):a===U.Z.STATE.STARTING?"".concat(r||3):(0,w.secondsToHHMMSS)(n||0)}),(0,l.BX)("div",{className:"video-recorder-button ".concat(a),onClick:()=>this.onButtonClick(),children:[(0,l.tZ)("div",{className:"video-recorder-button-volume",style:"border-width:".concat(20*d,"px")}),(0,l.tZ)("div",{className:"video-recorder-button-inner"})]})]})}constructor(e,t){super(e,t),(0,o._)(this,"recorder",void 0),(0,o._)(this,"startCapturePromise",null),(0,o._)(this,"videoElement",null),(0,o._)(this,"recorderUpdateInterval",null),(0,o._)(this,"assignVideoElement",e=>{this.videoElement=e}),(0,o._)(this,"onVideoElementLoadedMetadata",()=>{if(!this.videoElement){console.error("onVideoElementLoadedMetadata called, videoElement not set");return}this.videoElement.volume=0,this.videoElement.play(),this.setState({videoLoading:!1})}),(0,o._)(this,"onRecorderStarting",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STARTING),this.onRecorderUpdated()}),(0,o._)(this,"onRecorderStarted",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STARTED),this.onRecorderUpdated(),this.recorderUpdateInterval=window.setInterval(()=>this.onRecorderUpdated(),100)}),(0,o._)(this,"onRecorderStopping",()=>{(0,E.j)(E.FP.VIDEO_RECORDER_STOPPING),this.recorderUpdateInterval&&clearInterval(this.recorderUpdateInterval),this.onRecorderUpdated()}),(0,o._)(this,"onRecorderStopped",e=>{if((0,E.j)(E.FP.VIDEO_RECORDER_STOPPED),this.onRecorderUpdated(),e){var t,i;(0,E.j)(E.FP.VIDEO_RECORDED,{videoType:e.type,videoSize:e.size}),null===(t=(i=this.props).onVideoRecorded)||void 0===t||t.call(i,e)}}),(0,o._)(this,"onRecorderUpdated",()=>{this.setState({recorderState:this.recorder.state,recorderDuration:this.recorder.duration,recorderVolume:this.recorder.volume})}),this.state.videoLoading=!0,this.recorder=new U.Z({aspectRatio:1920/1080,onStarting:this.onRecorderStarting,onStarted:this.onRecorderStarted,onStopping:this.onRecorderStopping,onStopped:this.onRecorderStopped,language:this.props.language}),this.onRecorderUpdated()}}(0,o._)(C,"contextType",f.wj)},8594:function(e,t,i){i.d(t,{A:()=>h,L:()=>m});var o=i(7409),a=i(99282),n=i(98848),d=i(16584),l=i(94697),r=i(45587),s=i(24285),c=i(71068);let p={opacity:.5,zIndex:1e3},u=e=>"item-".concat(e);function h(e){let{children:t,items:i,onReorder:o}=e,a=(0,l.Dy)((0,l.VT)(l.we,{activationConstraint:{distance:2}}),(0,l.VT)(l.Lg,{coordinateGetter:r.is}));return(0,d.tZ)(l.LB,{sensors:a,collisionDetection:l.pE,onDragEnd:e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let n=i.findIndex(e=>u(e)===t.id),d=i.findIndex(e=>u(e)===a.id);o((0,r.Rp)(i,n,d))},autoScroll:!1,children:(0,d.tZ)(r.Fo,{items:i.map(e=>u(e)),strategy:r.U2,children:t})})}function m(e){var{item:t}=e,i=(0,n._)(e,["item"]);return(0,d.tZ)(v,(0,o._)({id:u(t)},i))}let v=e=>{let{children:t,id:i,useDragHandle:n=!1}=e,{listeners:l,setNodeRef:u,transform:h,transition:m,isDragging:v}=(0,r.nB)({id:i});return(0,d.tZ)(c.xu,(0,a._)((0,o._)({ref:e=>u(e),style:(0,o._)({transform:s.ux.Translate.toString(h),transition:m},v?p:{})},n?{}:(0,o._)({},l)),{children:"function"==typeof t?t({listeners:l}):t}))}},5889:function(e,t,i){i.d(t,{gg:()=>a,m:()=>n});var o=i(25235);function a(e){return e&&n(e).pop()||null}function n(e){return(0,o.find)(e).filter(e=>"url"===e.type&&e.href.startsWith("http"))}},54809:function(e,t,i){i.d(t,{ER:()=>n,Lz:()=>r,Nf:()=>c,Xb:()=>s,Z$:()=>l,uM:()=>d});var o=i(80983),a=i(84864);let n={"application/x-cbr":[[82,97,114,33,26,7,0],[82,97,114,33,26,7,1,0],[127,69,76,70]],"application/x-cbz":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},d={"application/vnd.amazon.kfx":[[75,70,88,32]],"application/vnd.amazon.kpf":[[80,75,3,4]],"application/epub+zip":[[80,75,3,4]],"application/x-mobipocket-ebook":[[77,79,66,73]]},l={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},r={"application/pdf":[[37,80,68,70]]};function s(e){let{mimeTypesToSignature:t,substackType:i,actionButtonAttr:o}=e;return[{tag:"div.file-embed-wrapper",getAttrs:e=>{let n={};try{var d,l,r;let[s,c,p]=e.children[0].children;if(!s)return!1;let[u,h]=s.children;if(!h||!u)return!1;let[m,v]=h.children;if(!v)return!1;n.title=null==m?void 0:m.textContent;let[f,y]=(null===(d=v.textContent)||void 0===d?void 0:d.split("∙"))||[];if(!f||!y)return!1;n.filesize=(0,a.formattedBytesToNumber)(f);let g=null===(r=y.split("File"))||void 0===r?void 0:null===(l=r[0])||void 0===l?void 0:l.trim().toLowerCase();if(!g)return!1;if(t[g]||i===g)n.filetype=g;else{if("file"!==i)return!1;n.filetype=g}return(null==u?void 0:u.classList.contains("file-embed-thumbnail-default"))||(n.thumbnail=u.getAttribute("src")||""),n.description=null==c?void 0:c.innerText,n[o]=null==p?void 0:p.getAttribute("href"),n}catch(e){return!1}}}]}function c(e){var t;let{attrs:i}=e;return"".concat((0,a.numberToHumanFileSize)(null!==(t=Number(i.filesize))&&void 0!==t?t:void 0)," ∙ ").concat(function(e){var t,i,a,n;let{filetype:d}=e;return d?["application/vnd.amazon.kfx","application/vnd.amazon.kpf","application/vnd.amazon.ebook"].includes(d)?"Kindle":null!==(n=null===(i=o.extension(d)||(null===(a=d.split("/").pop())||void 0===a?void 0:a.split("-").pop()))||void 0===i?void 0:null===(t=i.toUpperCase)||void 0===t?void 0:t.call(i))&&void 0!==n?n:"":""}({filetype:i.filetype})," file")}},68303:function(e,t,i){i.d(t,{$9:()=>W,$_:()=>K,C4:()=>q,Co:()=>C,DY:()=>U,Dg:()=>D,E5:()=>x,Hs:()=>H,N5:()=>g,PH:()=>f,S7:()=>P,Wi:()=>B,cb:()=>m.cb,do:()=>N,fX:()=>I,fp:()=>E,gR:()=>L,je:()=>m.je,k:()=>k,lr:()=>A,o4:()=>X,qe:()=>O,qj:()=>v});var o=i(7409),a=i(99282),n=i(92007);i(39693);var d=i(14293),l=i.n(d),r=i(10691),s=i.n(r),c=i(19834),p=i(36186),u=i(84864),h=i(88956),m=i(22498);let v=[["list_item","listItem"],["bullet_list","bulletList"],["ordered_list","orderedList"],["hard_break","hardBreak"],["horizontal_rule","horizontalRule"],["code_block","codeBlock"]],f=[["em","italic"],["strong","bold"],["strikethrough","strike"]],y={image2:1,image:0,horizontal_rule:0,audio:0,video:0,youtube:0,youtube2:0,vimeo:0,opensea:0,twitter:0,twitter2:0,spotify:0,spotify2:0,soundcloud:0,bandcamp:0,kindle:0,tiktok:0,prediction_market:0,lichess:0,datawrapper:0,recipe:0,pinterest:0},g=function(e){let{maxLength:t=356,getAfterCutoff:i=!1,withEllipsis:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="",n=!1,d={},l=q(e),r=!1,s=(0,h.Y)(e,e=>{var o;if(n)return i;if("paywall"===e.type)return n=!0,!1;if(l)return!0;let s=null!==(o=e.type)&&void 0!==o?o:"undefined";if(d[s]=(d[s]||0)+1,e.type&&e.type in y&&d[s]>y[e.type])return n=!0,i;let c=t-a.length;if(c<=0&&!l||!(c>0))return i;if(i){if("text"===e.type&&e.text){if(!(t-(a+=e.text).length<=0))return!1;e.text=e.text.substring(e.text.length+t-a.length-1,e.text.length)}}else if("text"===e.type&&e.text){a+=e.text;let t=e.text;e.text=(0,u.truncateText)(t,c),r=t!==e.text}return!0});if(s&&o&&!r){let e=function(e){let t=[],i=[e];for(;i.length;){var o;let e=i.pop();if(!e)break;if(e.content&&(null===(o=e.content)||void 0===o?void 0:o.length)>0)for(let t=e.content.length-1;t>=0;t--){let o=e.content[t];o&&i.push(o)}else t.push(e)}return t}(s),t=null,i=null;for(let o=e.length-1;o>=0&&(!t||!i);o--){let a=e[o];null===t&&(null==a?void 0:a.type)==="text"&&(t=o),null===i&&(null==a?void 0:a.type)!=="text"&&(null==a?void 0:a.type)!=="paragraph"&&(i=o)}let o=null!==t?e[t]:null,a=o&&null!==i&&null!==t&&i>t;o&&!a&&(o.text=S(o.text))}return s},E=(e,t)=>{let i=[];if(e&&(t(e)&&i.push(e),e.content))for(let o of e.content)i=i.concat(E(o,t));return i},U=(e,t)=>{if(e){if(t(e))return e;if(e.content)for(let i of e.content){let e=U(i,t);if(e)return e}}return null},x=e=>{let t=[];return e.nodesBetween(0,e.content.size,e=>{var i;(null===(i=e.type)||void 0===i?void 0:i.name)==="cashtag"&&t.push(e.attrs.symbol)},0),t},T=new Set(["caption","footnote","captionedImage","image","image2"]),_=new Set(["bullet_list","bulletList","ordered_list","orderedList","blockquote"]),w="x_li_start_placeholder_x",M=(e,t)=>{var i,o,a,n;if((null===(i=e.type)||void 0===i?void 0:i.name)==="list_item"||(null===(o=e.type)||void 0===o?void 0:o.name)==="listItem")return{open:w,close:""};if((null===(a=e.type)||void 0===a?void 0:a.name)==="paragraph"||e.isBlock&&e.textContent.length>0&&!_.has(null===(n=e.type)||void 0===n?void 0:n.name)){let e="<p>";return(t.length>0?t[t.length-1]:null)===w&&(t.pop(),e+="* "),{open:e,close:"</p>"}}return null},b=e=>{var t,i,o;let{node:a,recursiveDepth:n,tokens:d}=e;if(n>100)return console.warn("Reached max recursive depth while converting document to HTML for podcast"),!1;let l=!0;if(T.has(null===(t=a.type)||void 0===t?void 0:t.name))l=!1;else if(a.isText){if(a.text&&a.text.length>0){let e=a.marks.find(e=>"link"===e.type.name&&e.attrs.href),t=a.marks.find(e=>"em"===e.type.name),i=a.marks.find(e=>"strong"===e.type.name),o=a.text;t&&(o="<em>".concat(o,"</em>")),i&&(o="<strong>".concat(o,"</strong>")),e&&(o='<a target="_blank" href="'.concat((0,c.Z)(e.attrs.href),'">').concat(o,"</a>")),d.push(o)}}else if(M(a,[])){let e=M(a,d);e&&d.push(e.open),a.descendants(e=>b({node:e,recursiveDepth:n+1,tokens:d})),e&&d.push(e.close),l=!1}else if((null===(i=a.type)||void 0===i?void 0:i.name)==="cashtag")d.push("".concat(a.attrs.symbol," "));else if((null===(o=a.type)||void 0===o?void 0:o.name)==="substack_mentions"){let e=a.marks.find(e=>"em"===e.type.name),t=a.marks.find(e=>"strong"===e.type.name),i=a.attrs.name;if(e&&(i="<em>".concat(i,"</em>")),t&&(i="<strong>".concat(i,"</strong>")),"user"===a.attrs.type){let e=(0,p.GR)(a.attrs.id,a.attrs.name);d.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}else if("pub"===a.attrs.type){let e=a.attrs.url;d.push('<a target="_blank" href="'.concat(e,'">').concat(i,"</a>"))}}return l},I=e=>{let t=[];return e.descendants(e=>b({node:e,recursiveDepth:1,tokens:t})),t.filter(e=>e!==w).join("").trim()},A=function(e){let{withLinks:t=!0,withCaptionsAndFootnotes:i=!1,forPodcast:o=!1,truncateAt:a=null,truncateTo:n=a,truncateEllipsis:d="…",truncateExtension:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="",p="",h="",m=!0;return e.nodesBetween(0,e.content.size,e=>{var a,v,f,y;if(!i&&["caption","footnote"].includes(null===(a=e.type)||void 0===a?void 0:a.name))return!1;if(e.isText){if(e.text&&e.text.length>0){let i;m=!1,!l()(n)&&s.length<n&&s.length+e.text.length>=n&&(i=(0,u.truncateText)(e.text,n-s.length,{ellipsis:d,extension:r}));let a=e.marks.filter(e=>"link"===e.type.name&&e.attrs.href)[0],v=e.marks.filter(e=>"em"===e.type.name)[0],f=e.marks.filter(e=>"strong"===e.type.name)[0],y=e.text;s+=y,v&&o&&(i&&(i="<em>".concat(i,"</em>")),y="<em>".concat(y,"</em>")),f&&o&&(i&&(i="<strong>".concat(i,"</strong>")),y="<strong>".concat(y,"</strong>")),a&&t?o?(i&&(h="".concat(p,'<a target="_blank" href="').concat((0,c.Z)(a.attrs.href),'">').concat(i,"</a>")),p+='<a target="_blank" href="'.concat((0,c.Z)(a.attrs.href),'">').concat(y,"</a>")):(i&&(h="".concat(p).concat(i," [ ").concat(a.attrs.href," ]")),p+="".concat(y," [ ").concat(a.attrs.href," ]")):(i&&(h=p+i),p+=y)}}else!m&&["hard_break","hardBreak"].includes(null===(v=e.type)||void 0===v?void 0:v.name)?(m=!0,s+="\n",o?p+="<br/>":p+="\n"):!m&&e.isBlock?(m=!0,s+="\n",o?p+="<br/><br/>":p+="\n"):(null===(f=e.type)||void 0===f?void 0:f.name)==="cashtag"?p+="".concat(e.attrs.symbol," "):(null===(y=e.type)||void 0===y?void 0:y.name)==="substack_mentions"&&(p+="".concat(e.attrs.name," "))},0),!l()(a)&&s.length>a&&h&&(p=h),p=p.trim(),o&&(p=p.replace(/\s*(<br\/>)+$/,"").trim()),p},S=e=>"".concat(s()(e,"."),"..."),C=(e,t)=>(0,a._)((0,o._)({name:e},t),{addAttributes:()=>t.attrs||{},parseHTML:()=>t.parseDOM,renderHTML(i){let{node:o}=i;return t.toDOM?t.toDOM(o):(console.warn("trying to create TipTapNode, no toDOM found for node",e),["span"])}}),D=(e,t)=>{let i,o,a;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,n)=>{if(i||o)return!1;let d=e.marks.find(e=>e.type===t);d&&(i=e,o=d,a={from:n,to:n+e.nodeSize})}),i)return{node:i,mark:o,pos:a}},k=(e,t)=>{let i,o,a;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(n,d)=>{if(i||o||!(d<=e.selection.from)||!(e.selection.to<=d+n.nodeSize))return!1;{let e=n.marks.find(e=>e.type===t);e&&(i=n,o=e,a={from:d,to:d+n.nodeSize})}}),!i){if(e.selection.empty){let l=e.doc.resolve(e.selection.from),r=l.nodeBefore&&l.nodeBefore.marks.find(e=>e.type===t),s=l.nodeAfter&&l.nodeAfter.marks.find(e=>e.type===t);if(r||s){var n,d;i=s?l.nodeAfter:l.nodeBefore,o=s||r,a=s?{from:l.pos,to:l.pos+l.nodeAfter.nodeSize}:{from:l.pos-(null!==(d=null===(n=l.nodeBefore)||void 0===n?void 0:n.nodeSize)&&void 0!==d?d:0),to:l.pos}}}if(!i)return}return{node:i,mark:o,pos:a}},P=function(e){let{allowedMarks:t=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!e.selection.empty||O(e,e.selection.from,e.selection.to,{allowedMarks:t})},O=function(e,t,i){let{allowedMarks:o=[]}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=!0,n=!1;return e.doc.nodesBetween(t,i,t=>{if(!a)return!1;t.type!==e.schema.nodes.text?n?a=!1:n=!0:t.marks.find(e=>!o.includes(e.type))&&(a=!1)}),a},L=(e,t)=>{if(e.selection.empty)return!1;let i=Array.isArray(t)?t:[t];if("node"in e.selection){var o;let t=e.selection;return i.includes(null===(o=t.node)||void 0===o?void 0:o.type)}return R(e,e.selection.from,e.selection.to,i)},R=(e,t,i,o)=>{let a=null;return e.doc.nodesBetween(t,i,e=>{if(!(!1!==a&&o.includes(e.type)))return a=!1,!1;a=!0}),a||!1},N=e=>e.selection.empty?null:Z(e,e.selection.from,e.selection.to),Z=(e,t,i)=>{let o=null;return e.doc.nodesBetween(t,i,t=>!o&&(t.type===e.schema.nodes.image2?(o=t.attrs.href,!1):void(t.type===e.schema.nodes.image3&&(o=t.attrs.href)))),o||null},B=(e,t,i)=>{e.selection.empty||z(e,t,e.selection.from,e.selection.to,i)},z=(e,t,i,o,a)=>{e.doc.nodesBetween(i,o,(i,o)=>{(i.type===e.schema.nodes.image2||i.type===e.schema.nodes.image3)&&t.setNodeMarkup(o,i.type,Object.assign({},i.attrs,{href:a}),i.marks)})},F=e=>({top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}),K=(e,t,i,o)=>{let a=document.body,n=window.innerWidth<=481,d=j(e,t.from,t.to,t=>[e.state.schema.nodes.image,e.state.schema.nodes.image2].includes(t.type))?-44:8,l=F(e.coordsAtPos(t.from)),r=F(e.coordsAtPos(t.to));i.style.position="fixed";let s=r.bottom+(n?a.scrollTop:0),c=a.clientHeight-i.clientHeight-96-d;l.top<r.top?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(Math.min(l.left,r.left),"px")):a.clientWidth-l.left>i.clientWidth?(o&&(o.style.left="10px"),i.style.right="",i.style.left="".concat(l.left,"px")):(o&&(o.style.left="".concat(l.left-a.clientWidth+i.clientWidth,"px")),i.style.right="10px",i.style.left=""),n||s<c?(o&&(o.style.top="-9px",o.style.bottom="auto",o.style.transform=""),i.style.top="".concat(s+d,"px")):(o&&(o.style.top="auto",o.style.bottom="-9px",o.style.transform="rotate(180deg)"),i.style.top="".concat(c+d,"px"))},j=(e,t,i,o)=>{let a=!1;return e.state.doc.nodesBetween(t,i,e=>{if(a)return!1;a=o(e)}),a},V=e=>e.doc.resolve(e.selection.from).node(1),W=(e,t)=>{var i;return t.includes(null===(i=V(e))||void 0===i?void 0:i.type)},X=(e,t)=>{var i,o,a;let d=e.tr,l=d.selection instanceof n.Bs,r=l&&(null===(a=d.selection.$from)||void 0===a?void 0:null===(o=a.parent)||void 0===o?void 0:null===(i=o.content)||void 0===i?void 0:i.size)===0?e.selection.to-1:e.selection.to;if(Array.isArray(t))for(let e of t.slice().reverse())d.insert(r,e);else d.insert(r,t);return l||d.setSelection(n.qv.near(d.doc.resolve(r))),d},H=(e,t)=>{let i=e.tr;return i.replaceSelectionWith(t),i},q=e=>!!U(e,e=>"paywall"===e.type)},80870:function(e,t,i){function o(e,t){let i=1,o=1;e.doc.descendants((a,n)=>{if(a.type===t.nodes.footnote){if(a.attrs.number!==i){let o=t.nodes.footnote.create({number:i},a.content);e.replaceWith(n,n+a.nodeSize,o)}i+=1}else if(a.type===t.nodes.footnoteAnchor){if(a.attrs.number!==o){let i=t.nodes.footnoteAnchor.create({number:o});e.replaceWith(n,n+a.nodeSize,i)}o+=1}})}function a(e,t){let i=0;e.doc.nodesBetween(0,e.selection.from,e=>{e.type===t.nodes.footnoteAnchor&&(i+=1)});let o=[];return(e.doc.forEach((e,i)=>{e.type===t.nodes.footnote&&o.push(i)}),i<o.length)?o[i]:e.doc.resolve(0).end()}i.d(t,{A0:()=>o,dG:()=>a})}}]);