"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4990"],{8923:function(e,t,n){n.d(t,{$1:()=>h,Sn:()=>u,wg:()=>p});var i=n(7409),o=n(99282),l=n(16584),a=n(6400),r=n(30396),s=n(80569),d=n.n(s);let c=(0,a.createContext)({oauthAccessToken:null,isOAuthProvider:!1}),p=()=>(0,r.qp)(c);function h(e){let t=t=>{let{oauthAccessToken:n}=p();return(0,l.tZ)(e,(0,o._)((0,i._)({},t),{oauthAccessToken:n}))};return t.displayName="WithOAuthEmbed(".concat(e.displayName||e.name||"Component",")"),t}let u=()=>{let{oauthAccessToken:e}=p();return(0,r.Ye)(()=>{let t=t=>(e&&t.set("Authorization","Bearer ".concat(e)),t);return{get:e=>t(d().get(e)),post:e=>t(d().post(e)),put:e=>t(d().put(e)),delete:e=>t(d().delete(e)),patch:e=>t(d().patch(e))}},[e])}},41258:function(e,t,n){n.d(t,{AM:()=>et,L8:()=>Y,LB:()=>V,eR:()=>q,lf:()=>j,sA:()=>G});var i=n(27412),o=n(7409),l=n(99282),a=n(58865),r=n(16584),s=n(6400),d=n(98661),c=n(30396),p=n(94184),h=n.n(p),u=n(74691),m=n.n(u),g=n(14293),f=n.n(g),v=n(43174),y=n.n(v),_=n(80569),S=n.n(_),C=n(79094),w=n(57391),Z=n(95441),b=n(15597),N=n(46914),R=n(68833),k=n(95434),x=n(63648),B=n(65892),E=n(41990),I=n(26419),P=n(82011),M=n(68072),X=n(46638),T=n(12900),O=n(71068),A=n(15771),L=n(19081),D=n(50364),H=n(47929);function F(){let e=(0,a._)(["Comment by ",""]);return F=function(){return e},e}let z=Math.min(Math.ceil((m()(document.body.clientWidth,400,728)-140)/50),10);class J extends s.Component{componentDidMount(){this.setSelectedHighlight(),this.setReplyStateFromHash(),this.updateOverflows()}componentDidUpdate(e){var t,n;(null===(t=e.comment)||void 0===t?void 0:t.id)!==(null===(n=this.props.comment)||void 0===n?void 0:n.id)&&this.setSelectedHighlight(),e.replying!==this.props.replying&&this.props.replying&&this.startReply()}setReplyStateFromHash(){if(this.props.comment.deleted||"undefined"==typeof window||!window.location.hash)return;let e=/^#comment-(\d+)-reply$/.exec(window.location.hash);e&&Number(e[1])===this.props.comment.id&&(window.location.hash=window.location.hash.replace(/-reply$/,""),this.startReply())}async startReply(){this.props.onStartReply?this.props.onStartReply(this.props.comment):await new Promise(e=>this.setState({replying:!0},e))}onDateClick(e){var t;let[n,i]=e.target.href.split("?")[0].split("#");n===(null===(t=window.location.href.split("?")[0])||void 0===t?void 0:t.split("#")[0])&&i&&(e.preventDefault(),this.setState({hideAnchors:!0},()=>{window.location.hash="#".concat(i),this.setState({hideAnchors:!1})}))}updateOverflows(){let e=this.bodyRef.current;if(!e)return;let t=e.scrollHeight-e.clientHeight;t>0&&t<200?e.classList.add("expanded"):t>=200&&(e.classList.add("long"),e.setAttribute("data-hidden-height",t))}render(e,t){var n,i,a,s;let{user:d,comment:c,freeSignup:p,freeSignupEmail:u,pub:m,post:g,reaction_token:v,depth:y,collapseAtDepth:_,onChange:S,scrollRef:C,retainUserCollapseState:w,onStartReply:Z,noHoverProfile:b,onProfileClick:N,onShareComment:R,hideContextMenu:k,noRestack:O,updateCommentReacted:H,iString:J,iTemplate:W,hideShare:j,contextMenuUseMobileBottomSheet:G}=e,{isSelected:Y,replying:V,editing:q,hideAnchors:K,isCollapsed:$}=t,Q=m.community_enabled&&g&&"none"!==g.write_comment_permissions,{user_banned:et}=c;if(q&&d)return(0,r.tZ)(E._,{autoFocus:!0,user:d,freeSignup:p,freeSignupEmail:u,pub:m,post:g,commentBeingEdited:c,saveEdit:this.saveEdit,token:v,onCancel:()=>this.setState({editing:!1}),onSuccess:S?this.onSaveEditSuccess:null});let en=null===(n=(0,X.gz)(c))||void 0===n?void 0:n.name,ei=en?W(F(),en):J("Comment");return(0,r.BX)("div",{className:h()("comment",{selected:Y,"post-reply":"reply"===c.type,collapsed:$}),children:[!K&&[(0,r.tZ)("div",{id:"comment-".concat(c.id),className:"comment-anchor"}),(0,r.tZ)("div",{id:"comment-".concat(c.id,"-reply"),className:"comment-anchor"})],(0,r.BX)(L.X2,{gap:12,paddingBottom:12,className:"comment-content",role:"article","aria-label":ei,children:[(0,r.tZ)(L.sg,{ref:this.headContainerRef,children:(0,r.tZ)(P.a,{comment:c,noHover:b,onClick:N?()=>N(c):void 0})}),(0,r.BX)(L.sg,{flex:"grow",children:[(0,r.tZ)(I.J,{post:g,pub:m,comment:c,isCollapsed:$,toggleCollapse:()=>this.setCollapsed(!this.state.isCollapsed),onProfileClick:N,userBanned:null!=et&&et,userPendingApproval:c.status===D.ql.new_commenter_approval_required&&!!(null==d?void 0:d.is_admin),onChange:this.onChange,startEdit:()=>this.startEdit(),startReport:this.showReportModal,openBan:this.openBan,hideContextMenu:k,useMobileBottomSheet:G}),(0,r.tZ)(B.Z,{comment:c,bodyRef:this.bodyRef,expandToggleClicked:this.expandToggleClicked}),(0,r.tZ)(x.Z,{comment:c,pub:m,user:d,post:g,reaction_token:v,commentsEnabledForPost:Q,noRestack:O,onChange:this.onChange,startReply:()=>this.startReply(),updateCommentReacted:H,shareComment:R,hideShare:j}),(0,r.tZ)(T.H,{expanded:V&&Q,clip:!1,children:(0,r.tZ)(U,{children:(0,r.tZ)(E._,{autoFocus:!0,user:d,freeSignup:p,freeSignupEmail:u,pub:m,post:g,parent:c,token:v,onCancel:()=>this.setState({replying:!1}),onSuccess:S?e=>{this.setState({replying:!1}),S((0,l._)((0,o._)({},c),{children:[e].concat(c.children)}))}:null,alwaysShowButtons:!0})})})]})]}),c.childrenSummary&&(0,r.tZ)("div",{className:"more-replies-container",children:(0,r.tZ)("a",{className:"more-replies",href:(0,X.aE)(g,c,m),children:c.childrenSummary})}),!c.childrenSummary&&!f()(y)&&y>=z&&!!(null===(i=c.children)||void 0===i?void 0:i.length)&&(0,r.tZ)(L.X2,{className:"more-replies-container",children:(0,r.tZ)(A.ZP,{size:"sm",priority:"secondary-outline",href:(0,X.aE)(g,c,m),children:J("Continue thread â†’")})}),!c.childrenSummary&&!f()(y)&&y<z&&(0,r.tZ)(ee,{user:d,freeSignup:p,freeSignupEmail:u,pub:m,post:g,comments:null!==(s=c.children)&&void 0!==s?s:[],parent:c,reaction_token:v,depth:(y||0)+1,collapseAtDepth:_,onChange:S,isChild:!0,scrollRef:C,retainUserCollapseState:w,onStartReply:Z,noHoverProfile:b,onProfileClick:N,hideContextMenu:k,updateCommentReacted:H,noRestack:!0,hideShare:j,contextMenuUseMobileBottomSheet:G},c.id),!$&&(null===(a=c.children)||void 0===a?void 0:a.length)>0&&(0,r.tZ)(M.S,{onCollapse:()=>this.setCollapsed(!0)})]},c.id)}constructor(e,t){super(e,t),(0,i._)(this,"bodyRef",(0,s.createRef)()),(0,i._)(this,"headContainerRef",(0,s.createRef)()),(0,i._)(this,"openBan",()=>{this.props.commentActions.openBanDialog({comment:this.props.comment,onReply:()=>{this.startReply()}})}),(0,i._)(this,"setSelectedHighlight",()=>{let e=(0,X.Jr)()===this.props.comment.id;this.setState({isSelected:e})}),(0,i._)(this,"startEdit",()=>{this.setState({editing:!0})}),(0,i._)(this,"saveEdit",async e=>{if(this.state.editing)return{res:await S().patch("/api/v1/comment/".concat(this.props.comment.id)).send({body:e})}}),(0,i._)(this,"onSaveEditSuccess",e=>{var t,n;let{edited:i}=e;this.setState({editing:!1}),null===(t=(n=this.props).onChange)||void 0===t||t.call(n,(0,o._)({},this.props.comment,i))}),(0,i._)(this,"showReportModal",()=>{var e;let{pub:t,comment:n}=this.props;this.props.onReport({pub:t,canReportToAdmins:!!(null==t?void 0:t.moderation_enabled)&&!(null===(e=n.metadata)||void 0===e?void 0:e.is_author),onSubmit:async e=>{var i,a;let{reportCategory:r,reportedToSubstack:s,details:d}=e;await S().post("/api/v1/comment/".concat(n.id,"/report")).send({publication_id:null==t?void 0:t.id,details:d,reportCategory:r,reportedToSubstack:s}),null===(i=(a=this.props).onChange)||void 0===i||i.call(a,(0,l._)((0,o._)({},this.props.comment),{reported_by_user:!0}))}})}),(0,i._)(this,"expandToggleClicked",()=>{let e=this.bodyRef.current;e&&(e.classList.remove("long"),e.classList.add("expanded"),(0,R.j)(R.FP.COMMENT_EXPAND_TOGGLE_CLICKED,{hiddenHeight:e.getAttribute("data-hidden-height")}))}),(0,i._)(this,"onChange",e=>{this.props.onChange?this.props.onChange((0,o._)({},this.props.comment,e)):document.location.href=(0,X.Os)(this.props.post,this.props.pub)}),(0,i._)(this,"setComment",e=>{this.setState({comment:e})}),(0,i._)(this,"setCollapsed",e=>{var t,n;if(this.setState({isCollapsed:e}),e&&(null===(n=this.headContainerRef)||void 0===n?void 0:null===(t=n.current)||void 0===t?void 0:t.scrollIntoView)){let e=this.headContainerRef.current.getBoundingClientRect();e.top<0&&(document.documentElement.scrollTop+=e.top-80)}this.props.retainUserCollapseState&&(0,X.VS)(this.props.comment.id,e)}),this.state={editing:!1,replying:!1,hideAnchors:!1,isSelected:!1,isCollapsed:this.props.retainUserCollapseState&&(0,X.ei)(this.props.comment.id)}}}(0,i._)(J,"contextType",w.kx);let U=(0,O.zo)({display:"flex",flex:"grow",paddingTop:16}),W=(0,d.memo)((0,Z.fz)(function(e){let t=(0,d.useContext)(en),n=(0,C.T)();return(0,r.tZ)(J,(0,l._)((0,o._)({},e),{commentActions:t,onReport:n}))}));J.displayName="Comment_Internal";let j=5,G=1,Y=16,V=50,q=200;function K(e){return e.reduce((e,t)=>e+1+K(t.children||[]),0)}let $=e=>{let{user:t,freeSignup:n,freeSignupEmail:i,pub:o,post:l,comments:a,reaction_token:s,depth:d,collapseAtDepth:p,onChange:u,pageSize:m,retainUserCollapseState:g,updateCommentReacted:f,parent:v,scrollRef:_,className:S,onStartReply:C,noHoverProfile:w,onProfileClick:R,hideContextMenu:k,noRestack:x,hideShare:B,contextMenuUseMobileBottomSheet:E}=e,I=m||Y,[P,M]=(0,c.eJ)(!1),[X,T]=(0,c.eJ)(!1),[O,L]=(0,c.eJ)(I),[D,F]=(0,c.eJ)(-1),[z,J]=(0,c.eJ)(new Set(a.map(e=>{let{id:t}=e;return t}))),{iString:U,iPlural:j}=(0,Z.M1)();(0,c.d4)(()=>{D>=0&&window.scrollTo(window.scrollX,D)},[D]);let G=(0,b.s)(),V=(0,N.z)(e=>{G.open({pub:o,post:l,commentId:e,comments:a,user:null!=t?t:void 0,utm_campaign:H.VX.commentListShareCta})});if(0===(a||[]).length)return null;let[q,$]=y()(null!=a?a:[],e=>{let{id:n,user_id:i}=e;return z.has(n)||i===(null==t?void 0:t.id)}),Q=q.slice(0,O);return(0,r.BX)("div",{className:h()("comment-list",S,{"has-new-comments":$.length>0}),children:[$.length>0&&(0,r.tZ)(A.zx,{size:"sm",priority:"secondary-outline",onClick:()=>{setTimeout(()=>{J(new Set(a.map(e=>{let{id:t}=e;return t}))),T(!1)},0),T(!0)},children:X?j("loading 1 new reply","loading %1 new replies",K($)):j("1 new reply","%1 new replies",K($))}),(0,r.tZ)("div",{className:"comment-list-items",children:Q.map(e=>(0,r.tZ)(W,{user:t,freeSignup:n,freeSignupEmail:i,pub:o,post:l,comment:e,parent:v,reaction_token:s,collapseAtDepth:p,depth:d||0,onChange:u,scrollRef:_,retainUserCollapseState:g,onStartReply:C,noHoverProfile:w,onShareComment:V,onProfileClick:R,hideContextMenu:k,noRestack:x,updateCommentReacted:f,hideShare:B,contextMenuUseMobileBottomSheet:E},e.id))}),q.length>Q.length&&(0,r.tZ)(A.zx,{size:"sm",priority:"secondary-outline",loading:P,onClick:()=>{F(window.scrollY),setTimeout(()=>{L(O+I),M(!1)},0),M(!0)},children:U("Load More")})]})};$.displayName="CommentList";let Q=(0,d.memo)($);Q.displayName="CommentList";let ee=Q;function et(e){let[t,n]=(0,c.eJ)(null),i=(0,d.useMemo)(()=>({openBanDialog:n}),[]);return(0,r.BX)(en.Provider,{value:i,children:[(0,r.tZ)(ee,(0,o._)({},e)),(0,r.tZ)(k.Gg,(0,l._)((0,o._)({},t),{onClose:()=>n(null),onBan:(t,n)=>{let{onChange:i}=e;i?i((0,l._)((0,o._)({},t),{user_banned:!0,bans:n.concat(t.bans)})):document.location.href=(0,X.Os)(e.post,e.pub)}}))]})}let en=(0,d.createContext)({openBanDialog:()=>void 0})},41990:function(e,t,n){n.d(t,{_:()=>J});var i=n(7409),o=n(99282),l=n(58865),a=n(16584),r=n(98661),s=n(30396),d=n(94184),c=n.n(d),p=n(80569),h=n.n(p),u=n(93666),m=n(18787),g=n(96726),f=n(42493),v=n(347),y=n(95441),_=n(8923),S=n(16451),C=n(68833),w=n(48980),Z=n(98914),b=n(52513),N=n(26419),R=n(46638),k=n(12900),x=n(15771),B=n(82402),E=n(19081),I=n(43570),P=n(58175),M=n(440),X=n(70379),T=n(37155),O=n(31377),A=n(60308),L=n(63651),D=n(84864),H=n(60648);function F(){let e=(0,l._)(["Only "," subscribers can comment on this post"]);return F=function(){return e},e}let z="commentInput",J=(0,r.forwardRef)((e,t)=>{let{commentBeingEdited:n,parent:l,post:r,autoFocus:d,formClassName:p,saveEdit:u,onCancel:m,onSuccess:g,user:f,freeSignup:S,freeSignupEmail:b,pub:N,token:k,bannedFromNotes:x,alwaysShowButtons:B}=e,{iString:I}=(0,y.M1)(),P=(0,X.pm)(),M=(0,_.Sn)(),{isOAuthProvider:O,oauthAccessToken:F}=(0,_.wg)(),[J,U]=(0,s.eJ)(!1),[W,j]=(0,s.eJ)(null),[G,Y]=(0,s.eJ)(!1),V=(0,s.Ye)(()=>{if("undefined"!=typeof localStorage){let e=JSON.parse(localStorage.getItem(z)||"{}");if(e.postId===r.id)return{value:e.value,alsoShareToNotes:!!e.alsoShareToNotes};localStorage.removeItem(z)}},[]),q=(0,i._)({value:null==n?void 0:n.body,alsoShareToNotes:!1,loading:!1,error:null},V),[{value:Q,alsoShareToNotes:ee,loading:et,error:en},ei]=(0,s.eJ)(q),eo=e=>ei(t=>(0,o._)((0,i._)({},t),{value:e})),el=(0,s.sO)(null),ea=(0,s.sO)(null);(0,s.aP)(t,()=>({focus(){var e;null===(e=el.current)||void 0===e||e.focus()}}),[]),(0,s.d4)(()=>{if(d){var e;null===(e=el.current)||void 0===e||e.focus()}},[]);let er=!(null==f?void 0:f.name),es=(0,s.sO)(),ed=async()=>{var e;(0,C.j)(C.FP.COMMENT_PAYWALL_SHOWN,{post_id:r.id,post_type:r.type,parent_id:null==l?void 0:l.id}),await (null===(e=es.current)||void 0===e?void 0:e.open())},ec=(0,s.sO)(),ep=async()=>{(0,C.j)(C.FP.FINISH_MAGIC_LOGIN_MODAL_SHOWN,{post_id:r.id,post_type:r.type,parent_id:null==l?void 0:l.id});let e=ec.current;e&&(await eg(),await e.open())},eh=(0,s.sO)(),eu=async()=>{var e;(0,C.j)(C.FP.PROFILE_UPDATER_SHOWN,{post_id:r.id,parent_id:null==l?void 0:l.id}),await (null===(e=eh.current)||void 0===e?void 0:e.open())},em=(0,s.sO)(!1),eg=async()=>{if(!f){console.error("cannot sendLoginEmail, user not defined");return}if(!em.current){em.current=!0;try{var e;let t=await (0,w.rd)("/api/v1/email-login",{method:"POST",json:{email:f.email,redirect:null===(e=document.location.href.split("?")[0])||void 0===e?void 0:e.split("#")[0]}});"optional"===t.verification_code&&(U(!0),t.onboarding_redirect&&j(t.onboarding_redirect))}catch(e){alert((0,Z.zx)(e))}}},ef=()=>{localStorage.setItem(z,JSON.stringify({postId:r.id,value:Q,alsoShareToNotes:ee}))},ev=async()=>{if(n){ei(e=>(0,o._)((0,i._)({},e),{loading:!0}));try{let e=await (null==u?void 0:u(Q));e_(e)}catch(e){ei(t=>(0,o._)((0,i._)({},t),{loading:!1,error:e}))}}else ey()},ey=async function(){var e;let{profileUpdated:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(et)return;if(!(0,D.canPostComments)(f,r,N).canReply){ef(),await ed(),await (0,T.g)(600),ei(e=>(0,o._)((0,i._)({},e),{error:I("Please sign in.")}));return}if(er&&!t){ef(),O?(Y(!0),ei(e=>(0,o._)((0,i._)({},e),{loading:!1,error:I("Please set your profile name to comment.")}))):(Y(!1),await eu(),await (0,T.g)(600),ei(e=>(0,o._)((0,i._)({},e),{error:I("Please update your profile.")})));return}ei(e=>(0,o._)((0,i._)({},e),{loading:!0}));let n={body:null===(e=el.current)||void 0===e?void 0:e.value,token:k};try{let e;if(ee){let t=await M.post("/api/v1/comment/attachment").send({type:"link",url:(0,A.uRy)(N,r)}),o=null==t?void 0:t.body;if(o){let t=(0,i._)({},n);t.attachmentIds=[o.id],e=await M.post("/api/v1/comment/feed").send(t)}else console.warn("Error creating attachment")}l&&(n.parent_id=l.id);let t=await M.post("/api/v1/post/".concat(r.id,"/comment")).send(n);if(localStorage.removeItem(z),!(null==f?void 0:f.profile_set_up_at)){let{body:{count:e}}=await h().get("/api/v1/user/profile_role_count");if(e>=2){let e=(0,A.n1t)("".concat((0,A.ZJn)(),"/profile/start"),{commentProfileFlow:!0,next:(0,R.aE)(r,t.body,N)});return(0,Z.uX)(e),!1}}e_({notesComment:e,res:t})}catch(e){e.response&&403===e.response.statusCode&&(f&&f.is_magic?await ep():await ed()),ei(t=>(0,o._)((0,i._)({},t),{loading:!1,error:e}))}},e_=e=>{let{res:t,notesComment:n}=e;if(!1!==t){if(g&&!er){if(ee&&n){let e=(0,L.Sgq)(n.body);P.popToast(t=>(0,a.tZ)(X.FN,(0,o._)((0,i._)({},t),{text:I("Shared to Notes"),cta:I("View Now"),href:e})))}eo(""),g(t.body)}else{let e=(0,R.Os)(r,N);O?(0,Z.uX)((0,R.fg)(r,N,null!=F?F:"")):window.location.pathname===e?window.location.reload():(0,Z.uX)((0,R.Os)(r,N,ee?{feedCommentUrl:(0,L.Sgq)(t.body)}:{}))}ei(e=>(0,o._)((0,i._)({},e),{loading:!1}))}};return(0,a.tZ)(v.h,{children:(0,a.BX)(E.hs,{"data-test-id":"comment-input",flex:"grow",className:c()({comment:n}),children:[(0,a.tZ)("form",{className:c()(H.Z.form,p),onSubmit:e=>{e.preventDefault(),ev()},ref:ea,children:(0,a.tZ)($,{user:f,commentBeingEdited:n,post:r,pub:N,value:Q,bodyInputRef:el,onInput:e=>{let t=e.currentTarget.value;if(!(0,D.canPostComments)(f,r,N).canReply){e.preventDefault(),ed();return}eo(t)},onKeyDown:e=>{var t,n;if(null==f?void 0:f.is_magic){e&&e.preventDefault(),ep();return}if(!(0,D.canPostComments)(f,r,N).canReply){e.preventDefault(),ed();return}"Escape"===e.key&&(null===(t=el.current)||void 0===t?void 0:t.value.trim())===""?(null===(n=el.current)||void 0===n||n.blur(),null==m||m()):"Enter"===e.key&&e.metaKey&&ev()},bannedFromNotes:x,alsoShareToNotes:ee,onShareToNotesChange:()=>ei(e=>(0,o._)((0,i._)({},e),{alsoShareToNotes:!ee})),onCancel:()=>{m?m():eo("")},error:en,loading:et,alwaysShowButtons:B,isReplying:!!l,showProfileSetupLinkOnError:G})}),(0,a.tZ)(K,{user:f,freeSignup:S,freeSignupEmail:b,pub:N,post:r,token:k,profileUpdaterRef:eh,modalPaywallRef:es,finishMagicLoginModalRef:ec,otpLoginEnabled:J,onboardingRedirect:W,onProfileUpdaterSuccess:e=>"boolean"!=typeof e||!!(e&&ey({profileUpdated:e}))})]})})}),U=e=>{let{error:t,showProfileSetupLinkOnError:n}=e,{iString:i}=(0,y.M1)();if(!t)return null;let o="string"==typeof t?t:(0,Z.zx)(t,"Something went wrong.");return(0,a.BX)(E.hs,{direction:"column",gap:4,children:[(0,a.tZ)(I.Vp,{priority:"secondary",theme:"error",flex:"auto",children:o}),n&&(0,a.tZ)(P.xv.B3,{children:(0,a.tZ)("a",{href:"".concat((0,A.ZJn)(),"/profile/edit"),target:"_blank",children:i("Set up profile")})})]})},W=e=>{let{alsoShareToNotes:t,onChange:n}=e,{iString:i}=(0,y.M1)();return(0,a.BX)(E.hs,{as:"label",gap:12,alignItems:"center",justifyContent:"center",children:[(0,a.tZ)(B.X,{name:"also_feed",checked:t,onChange:n}),(0,a.tZ)(P.xv.B3,{color:"secondary",children:i("Also share to Notes")})]})},j=e=>{let{bodyInputRef:t,value:n,onInput:i,onKeyDown:o,iString:l,disabled:r}=e;return(0,a.tZ)(M.l,{ref:t,name:"body",placeholder:l("Write a comment..."),defaultRows:4,maxRows:24,value:n||"",onInput:i,onKeyDown:o,className:H.Z.input,disabled:r,"aria-label":l("Write a comment...")})},G=e=>{let{isEditing:t,isReplying:n,bannedFromNotes:i,alsoShareToNotes:o,onShareToNotesChange:l,onCancel:r,loading:s,disableSubmit:d}=e;return(0,a.BX)(E.X2,{alignItems:"center",justifyContent:"space-between",children:[!t&&!i&&(0,a.tZ)(W,{alsoShareToNotes:o,onChange:l}),(0,a.BX)(Y,{children:[(0,a.tZ)(V,{onCancel:r}),(0,a.tZ)(q,{isEditing:t,isReplying:n,loading:s,disabled:d})]})]})},Y=e=>{let{children:t}=e;return(0,a.tZ)(E.X2,{gap:8,justifyContent:"end",flex:"grow",children:t})},V=e=>{let{onCancel:t}=e,{iString:n}=(0,y.M1)();return(0,a.tZ)(x.zx,{priority:"secondary",onClick:t,children:n("Cancel")})},q=e=>{let{isEditing:t,isReplying:n,loading:i,disabled:o}=e,{iString:l}=(0,y.M1)();return(0,a.tZ)(x.zx,{priority:"primary",type:"submit",loading:i,disabled:o,children:l(t?"Save":n?"Reply":"Post")})},K=e=>{var t,n;let{user:i,freeSignup:o,freeSignupEmail:l,pub:r,post:s,token:d,profileUpdaterRef:c,modalPaywallRef:p,finishMagicLoginModalRef:h,otpLoginEnabled:v,onboardingRedirect:_,onProfileUpdaterSuccess:S}=e,{iString:C,iTemplate:w}=(0,y.M1)();return(0,a.BX)(g.h,{children:[(0,a.tZ)(f.EB,{ref:c,user:i,freeSignup:o,freeSignupEmail:l,optionalPhoto:!0,token:d,text:C("Save & Post Comment"),onBeforeClose:S}),(0,a.tZ)(m.sF,{ref:p,user:i,freeSignup:o,freeSignupEmail:l,publication:r,post:s,title:w(F(),(0,O.isFoundingAudience)(s.audience)?"founding":"paid"),reauthenticationTitle:C("To post a comment, please re-authenticate.")}),(0,a.BX)(u.p,{ref:h,className:"finish-magic-login-modal",children:[(0,a.tZ)("h4",{children:C("Check your email")}),(0,a.tZ)("p",{children:C("For your security, we need to re-authenticate you.")}),v?(0,a.BX)(a.HY,{children:[(0,a.BX)(P.xv,{as:"p",translated:!0,children:["Click the link we sent to ",I18N.p(null!==(t=null==i?void 0:i.email)&&void 0!==t?t:"")," or enter the code below."]}),(0,a.tZ)(b.E,{email:null==i?void 0:i.email,redirect:_||document.location.href})]}):(0,a.BX)(P.xv,{as:"p",translated:!0,children:["Click the link we sent to ",I18N.p(null!==(n=null==i?void 0:i.email)&&void 0!==n?n:""),", or"," ",(0,a.tZ)("a",{href:(0,A.uXE)({for_pub:r.subdomain,with_password:!0}),native:!0,children:"click here to sign in"}),"."]})]})]})},$=e=>{let{user:t,commentBeingEdited:n,post:i,pub:o,value:l,bodyInputRef:r,onInput:s,onKeyDown:d,bannedFromNotes:c,alsoShareToNotes:p,onShareToNotesChange:h,onCancel:u,error:m,loading:g,alwaysShowButtons:f,isReplying:v,showProfileSetupLinkOnError:_}=e,{iString:C}=(0,y.M1)(),w=!(null==l?void 0:l.trim());return(0,a.BX)(a.HY,{children:[(0,a.tZ)(S.Zb,{size:32,user:t}),(0,a.BX)(E.tu,{flex:"grow",gap:8,children:[n&&(0,a.tZ)(N.J,{comment:n,post:i,pub:o,isCollapsed:!0,userBanned:!1,hideContextMenu:!0,onChange:()=>{},startEdit:()=>{},startReport:()=>{},openBan:()=>{}}),(0,a.tZ)(j,{bodyInputRef:r,value:l,onInput:s,onKeyDown:d,iString:C,disabled:g}),(0,a.tZ)(U,{error:m,showProfileSetupLinkOnError:_}),(0,a.tZ)(k.H,{expanded:!w||!!f,clip:!1,children:(0,a.tZ)(G,{isReplying:v,isEditing:!!n,bannedFromNotes:c,alsoShareToNotes:p,onShareToNotesChange:h,onCancel:u,loading:g,disableSubmit:w})})]})]})}},1980:function(e,t,n){n.d(t,{l:()=>o});var i=n(16584);let o=()=>(0,i.BX)("div",{className:"comment-silhouette",children:[(0,i.tZ)("div",{className:"comment-silhouette-head"}),(0,i.BX)("div",{className:"comment-silhouette-content",children:[(0,i.tZ)("div",{className:"comment-silhouette-meta"}),(0,i.tZ)("div",{className:"comment-silhouette-body"}),(0,i.tZ)("div",{className:"comment-silhouette-actions"})]})]})},43570:function(e,t,n){n.d(t,{D7:()=>f,NH:()=>u,Vp:()=>g});var i=n(7409),o=n(99282),l=n(98848),a=n(16584),r=n(94184),s=n.n(r),d=n(98661),c=n(15771),p=n(19081);n(58175),n(76641);var h=n(66327);let u={size:14,strokeWidth:2.5},m={display:"flex",height:20,paddingX:6,paddingY:2,gap:4,fontSize:11,fontWeight:"medium",alignItems:"center"},g=(0,d.forwardRef)((e,t)=>{var{className:n,theme:r="default",priority:d="secondary",leading:u,trailing:g,children:f,fillIcon:v,radius:y="xs",onClick:_,href:S}=e,C=(0,l._)(e,["className","theme","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let w=void 0!==_||void 0!==S;return(0,a.BX)(c.kG,(0,o._)((0,i._)((0,o._)((0,i._)({},C),{className:s()(n,h.Z.tag,h.Z["theme_".concat(r)],h.Z["priority_".concat(d)],w&&h.Z.clickable),onClick:_,href:S,ref:t,radius:y,cursor:w?"pointer":"inherit",tabIndex:w?0:-1}),m),{children:[u&&(0,a.tZ)(p.hs,{className:s()(h.Z.leading,v&&h.Z.fillIcon),alignItems:"center",children:u}),f,g&&(0,a.tZ)(p.hs,{className:s()(h.Z.trailing,v&&h.Z.fillIcon),alignItems:"center",children:g})]}))}),f=(0,d.forwardRef)((e,t)=>{var{className:n,priority:r="primary",leading:d,trailing:u,children:g,fillIcon:f,radius:v="xs",onClick:y,href:_}=e,S=(0,l._)(e,["className","priority","leading","trailing","children","fillIcon","radius","onClick","href"]);let C=void 0!==y||void 0!==_;return(0,a.BX)(c.kG,(0,o._)((0,i._)((0,o._)((0,i._)({},S),{className:s()(n,h.Z.tag,h.Z.media,h.Z["priority_".concat(r)],C&&h.Z.clickable),onClick:y,href:_,ref:t,radius:v,cursor:C?"pointer":"inherit",tabIndex:C?0:-1}),m),{children:[d&&(0,a.tZ)(p.hs,{className:s()(h.Z.leading,f&&h.Z.fillIcon),alignItems:"center",children:d}),g,u&&(0,a.tZ)(p.hs,{className:s()(h.Z.trailing,f&&h.Z.fillIcon),alignItems:"center",children:u})]}))});f.displayName="MediaTag"}}]);