"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["7250"],{34009:function(e,t,n){n.d(t,{Z:()=>r});let r={referralsTierCard:"referralsTierCard-XI8dRc"}},35047:function(e,t,n){n.d(t,{Eh:()=>j,ZP:()=>J,sv:()=>D});var r=n(7409),o=n(99282),i=n(58865),l=n(16584),a=n(98661),s=n(30396),u=n(94184),c=n.n(u),d=n(36808),p=n(2564),m=n(71375),h=n(91925),f=n(12620),v=n(64343),g=n(21312),b=n(20888),y=n(75744),_=n(57391),w=n(95441),x=n(56629),Z=n(40647),k=n(35702),N=n(68833),S=n(98914),C=n(71068),B=n(15771),E=n(19081),L=n(10510),T=n(58175),I=n(64528),A=n(55722),F=n(74312),P=n(31377),O=n(60308),W=n(26111),R=n(70408),H=n(84864),M=n(47929),U=n(31190);function $(){let e=(0,i._)(["By ",""]);return $=function(){return e},e}let z="intro_popup_last_hidden_at";function D(e){let{includePrice:t=!0,includeRankingDetail:r=!0,includeByline:o=!0,includeBadge:i=!1,rankingDetailOverrideText:a=null,language:s="en"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=s||e.language,{iTemplate:c}=I18N.i(s||e.language),d=(0,H.getByLine)(e),p=null;return r&&(p=a||(e.rankingDetailByLanguage&&"en"!==u&&e.rankingDetailByLanguage[u]?e.rankingDetailByLanguage[u].rankingDetail:e.rankingDetail)),(0,l.BX)(I.N,{separator:" \xb7 ",children:[o&&d?(0,l.BX)(E.hs,{inline:!0,gap:4,children:[c($(),d),i&&(0,l.tZ)(F.cr,{module:"../pencraft/unstable/UserBadge",resolve:e=>e.UserBadge,onRequest:()=>Promise.all([n.e("565"),n.e("1400")]).then(n.bind(n,71460)),size:"sm",tier:e.author_bestseller_tier,userId:e.author_id,whileLoading:e.author_bestseller_tier?(0,l.tZ)(E.hs,{alignItems:"center",children:(0,l.tZ)(A.o,{size:"sm",tier:e.author_bestseller_tier})}):(0,l.tZ)(l.HY,{})})]}):null,p,t&&function(e,t){let{language:n}=t,r=!e.disable_monthly_subscriptions&&e.plans&&e.plans.filter(e=>"month"===e.interval).sort((e,t)=>e.amount-t.amount)[0],o=!e.disable_annual_subscriptions&&e.plans&&e.plans.filter(e=>"year"===e.interval).sort((e,t)=>e.amount-t.amount)[0],i=r||o;if(i)return(0,H.planBasePricing)(i,{language:n})}(e,{language:s})]})}let J=(0,a.memo)(e=>{var t,n,i;let{publication:a,user:u,post:c,onHide:p,freeSignup:m,hidden:f,alwaysShow:v,showOnMount:g,freeSignupEmail:b,email:y,referralCode:w,blurbs:C,launchWelcomePage:B,topThreePosts:E,topThreeSubscribers:L}=e,{getConfigFor:T}=(0,Z.xR)(),I=T("welcome_page_query_params"),[A,F]=(0,s.eJ)(!1),[R,U]=(0,s.eJ)(!!(B||v)),$=(e,t)=>{var n;return I&&null!==(n=(0,W.x)(e))&&void 0!==n?n:t},[D]=(0,s.eJ)($("no_skip",void 0)),[J]=(0,s.eJ)($("no_blurbs",!1)),[j]=(0,s.eJ)(()=>{let e=$("hero_text",void 0);return e?decodeURIComponent(e):void 0}),{getExperimentVariant:Y,exposeExperiment:G}=(0,_.jc)(),{getSettingFor:K}=(0,x.So)(),Q=null!==(t=(0,W.x)("force"))&&void 0!==t?t:void 0;(0,s.d4)(()=>{let e=e=>{"Escape"===e.key&&er(!0)};if(R)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[R]),(0,s.d4)(()=>{if(B&&!eo()||et()){if("undefined"!=typeof window&&(0,S.cn)(document.documentElement,"has-intro-popup"),(0,W.x)("r")){let e=(0,W.x)("r");u&&(0,H.userReferralKey)(u)===e||(0,N.j)(N.FP.COVER_PAGE_REFERRAL_VISIT,{referral_key:e,referring_user:(0,H.userFromReferralKey)(e)})}ee()}else p&&p(),(0,k.a)({hide_intro_popup:!0}),"undefined"!=typeof window&&(0,S.IV)(document.documentElement,"has-intro-popup"),!v&&"undefined"!=typeof window&&(0,S.pv)(document.documentElement,"show-intro-popup")&&(0,S.IV)(document.documentElement,"show-intro-popup");return["no_skip","no_blurbs","hero_text","hide_intro_popup"].forEach(e=>(0,S.iO)(e)),()=>{"undefined"!=typeof window&&(0,S.IV)(document.documentElement,"has-intro-popup"),er(!0)}},[]);let ee=()=>{"undefined"==typeof window||((0,S.cn)(document.documentElement,"show-intro-popup"),(0,N.j)(N.FP.COVER_PAGE_SHOWN,{has_cover_photo:!!a.cover_photo_url,has_free_signup_email:!!b,has_free_signup:!!m,functional_version:!0,launch_welcome_page:B,always_show:v,hidden:f,screen_height:"undefined"!=typeof window?window.innerHeight:null,screen_width:"undefined"!=typeof window?window.innerWidth:null,test_experiment_variant_v5:Y("test_experiment_v5")}),G("test_experiment_v5"),v||(0,N.XY)("pageview",{dl:"".concat(document.location.origin,"/welcome").concat(document.location.search)})),U(!0)},et=(0,s.I4)(()=>!!v||!f&&(!!g||!!A||!eo()&&!!(null==c||c&&!(0,P.isPaidAudience)(c.audience))&&!m&&(!u||!u.is_free_subscribed&&!u.is_subscribed)),[v,m,f,c,g,A,u]),en=K("display_welcome_page_details")&&a.freeSubscriberCount&&!(0,S.K1)()&&!Q&&!a.invite_only&&!w&&!a.custom_domain&&(null==E?void 0:E.length)&&(null==L?void 0:L.length)&&!D&&!j;(0,s.d4)(()=>{R&&et()&&en&&G("welcome_page_update_desktop_visuals_limited")},[G,K,en,et,R]);let er=e=>{e||(ei(),setTimeout(()=>{(0,k.a)({hide_intro_popup:!0})},500)),p&&p(),!v&&"undefined"!=typeof window&&(0,S.pv)(document.documentElement,"show-intro-popup")&&(0,S.IV)(document.documentElement,"show-intro-popup")},eo=()=>{let e=d.get(z);return!!(e&&new Date(e)>new Date(Date.now()-864e5))},ei=()=>{d.set(z,new Date().toJSON(),{expires:3650})},el=async e=>{(0,N.j)(N.FP.COVER_PAGE_EMAIL_SUBMITTED,{is_paying_sub:!!e.body.prompt_to_login,has_plans:!!a.plans,functional_version:!0,homepage_type:a.homepage_type}),ei(),F(!0),(0,k.a)({freeSignup:!0,freeSignupEmail:e.body.email});let t=v?"/":document.location.href;e.body.prompt_to_login?setTimeout(()=>{document.location.href=(0,O.n1t)("/account/login",{redirect:t,email:e.body.email})},30):document.location.href=(0,O.n1t)("/subscribe",(0,o._)((0,r._)({next:t,later:!0,just_signed_up:!0},e.body.subscription_id&&{subscription_id:e.body.subscription_id},e.body.referral_token&&{referral_token:e.body.referral_token}),{requires_confirmation:e.body.requires_confirmation?"true":"",utm_source:M.b3.coverPage,email:e.body.email,skip_redirect_check:!0}))},ea=()=>{(0,N.j)(N.FP.COVER_PAGE_MAYBE_LATER_CLICKED,{functional_version:!0}),er()};if(!R||!et())return null;let es=(0,l.tZ)(V,{source:"cover_page",email:y,pub:a,user:null!=u?u:null,freeSignup:m,freeSignupEmail:b,referralCode:w,forceSignup:null!==(i=null!==(n=(0,W.x)("force"))&&void 0!==n?n:D)&&void 0!==i?i:void 0,onMaybeLater:D?void 0:ea,onFreeSignup:el,blurbs:C,hideBlurbs:J,overrideSubtitle:j});if(en)switch(Y("welcome_page_update_desktop_visuals_limited")){case"treatment_social_proof":es=(0,l.tZ)(q,{email:y,pub:a,user:null!=u?u:null,freeSignup:m,freeSignupEmail:b,onMaybeLater:ea,onFreeSignup:el,blurbs:C,topThreeSubscribers:L});break;case"treatment_large_fonts":es=(0,l.tZ)(X,{email:y,pub:a,user:null!=u?u:null,freeSignup:m,freeSignupEmail:b,onMaybeLater:ea,onFreeSignup:el,blurbs:C})}return(0,l.tZ)(h.s,{children:(0,l.tZ)("div",{className:"intro-popup",children:(0,l.tZ)("div",{className:"intro-popup-page",children:es})})})}),j=e=>(0,l.tZ)("div",{className:"intro-inline",children:(0,l.tZ)(V,(0,r._)({},e))}),q=e=>{var t,o,i,a,u;let{pub:d,user:p,email:m,freeSignup:h,freeSignupEmail:_,onMaybeLater:Z,onFreeSignup:k,blurbs:S,topThreeSubscribers:B}=e,I="cover_page",A=(0,s.qp)(x.vz),{iString:P,language:W}=(0,w.M1)(),{title:H,subtitle:M,logoUrl:$,coverPhotoUrl:z,hideTitle:J,hideSubtitle:j}=Y(d),q=z&&(0,O.zJH)(z),X=q&&q.width/q.height,V=!!(X&&X<2),G=!J||z&&V,Q=!j||z&&V;(0,s.d4)(()=>{(0,N.j)(N.FP.FULL_EMAIL_FORM_SHOWN,{source:I,functional_version:!0,version:"social-proof"})},[I]);let ee=S?S.filter(e=>""!=e.description):[],et=D(d,{includePrice:!1,includeBadge:!0,includeRankingDetail:!1,language:W});return(0,l.BX)("div",{className:"full-email-form",children:[(0,l.BX)("div",{className:"vertically-centered",children:[(0,l.tZ)(K,{onClick:Z}),z?V?null:(0,l.tZ)(C.xu,{paddingBottom:48,children:(0,l.tZ)(b.e,{className:U.Z.publicationCoverPhotoCenter,src:z,imageProps:{quality:"auto:best"},maxWidth:840,loading:"eager",style:(0,r._)({},q&&q.width&&{height:"min(168px, ".concat(840*q.height/q.width,"px)")}),imageIsFixedWidth:!0})}):$&&(0,l.tZ)(C.xu,{paddingBottom:32,children:(0,l.tZ)(L.wk,{logoUrl:$,size:88})}),(0,l.BX)(E.hs,{gap:48,children:[(0,l.BX)(E.tu,{className:V?U.Z.column:U.Z.centeredColumn,gap:32,children:[(0,l.BX)(E.tu,{gap:16,children:[G?(0,l.tZ)(T.xv.H1,{textAlign:V?"left":"center",font:"pub-headings",className:U.Z.coverPrimary,textWrap:"balance",children:H}):null,Q?(0,l.tZ)(T.xv.B3,{textAlign:V?"left":"center",font:"display",size:15,lineHeight:20,className:U.Z.coverSecondary,textWrap:"balance",children:M}):null,et&&(null===(a=et.props)||void 0===a?void 0:null===(i=a.children)||void 0===i?void 0:null===(o=i.filter)||void 0===o?void 0:null===(t=o.call(i,Boolean))||void 0===t?void 0:t.length)?(0,l.tZ)(T.xv.B2,{textAlign:V?"left":"center",weight:"semibold",font:"display",size:17,lineHeight:24,className:U.Z.coverSecondary,children:et}):null]}),(0,l.BX)(E.tu,{gap:16,children:[(0,l.BX)(E.hs,{alignItems:"center",alignSelf:V?"start":"center",gap:8,children:[(0,l.tZ)(E.hs,{alignItems:"center",className:c()(U.Z.faces),children:B.map((e,t)=>{let{id:r,photo_url:o}=e,i=(0,l.tZ)(b.e,{className:c()(U.Z.face,0===t&&U.Z.first,t===B.length-1&&U.Z.last),style:{zIndex:B.length-t},maxWidth:80,src:(0,O.zF4)(o||(0,R.I4)(r),64),imageIsFixedWidth:!0});return(0,l.tZ)(F.cr,{module:"@/frontend/components/ProfileHoverCard",resolve:e=>e.ProfileHoverCard,onRequest:()=>Promise.all([n.e("6304"),n.e("1426"),n.e("565"),n.e("881"),n.e("5330"),n.e("1262"),n.e("222"),n.e("4870"),n.e("7119"),n.e("9340")]).then(n.bind(n,85685)),whileLoading:i,subject:e,dontStopPropagation:!1,disabled:!1,placement:"top-start",children:i})})}),d.freeSubscriberCount?(0,l.BX)(T.xv.H3,{font:"display",weight:"semibold",size:20,lineHeight:24,className:U.Z.coverPrimary,translated:!0,children:["Join over ",I18N.p(d.freeSubscriberCount)," subscribers"]}):null]}),(0,l.tZ)(f.Z,{email:m,isWelcomePageColor:!0,freeSignup:h,freeSignupEmail:_,pub:d,source:I,user:p,onConfirmationRequired:"enabled"===d.payments_state?()=>null:void 0,onSuccess:k||(()=>document.location.href="/"),autoFocus:!0,className:U.Z.containerClassName,promptClassName:U.Z.promptClassName,inputClassName:U.Z.inputClassName,subscribeButtonClassName:U.Z.subscribeButtonClassName}),(0,l.BX)(E.hs,{gap:4,cursor:"pointer",alignItems:"center",alignSelf:V?"start":"center",inline:!0,onClick:Z,children:[(0,l.tZ)(T.xv.B3,{style:{color:"var(--cover_print_secondary)"},children:"No thanks"===A.getSettingFor("welcome_page_opt_out_text")?P("No thanks"):null!==(u=A.getSettingFor("welcome_page_opt_out_text"))&&void 0!==u?u:P("No thanks")}),(0,l.tZ)(v.Z,{height:18,stroke:"var(--cover_print_secondary)",strokeWidth:2})]})]})]}),z&&V?(0,l.tZ)(E.tu,{className:c()(U.Z.column,U.Z.hideColumnSmallScreens),gap:32,children:(0,l.tZ)(b.e,{className:U.Z.publicationCoverPhotoRight,src:z,imageProps:{quality:"auto:best"},maxWidth:476,loading:"eager",imageIsFixedWidth:!0})}):null]}),!!(null==ee?void 0:ee.length)&&(0,l.tZ)("div",{className:"blurb-buffer"}),!!(null==ee?void 0:ee.length)&&(0,l.tZ)(E.gq,{className:"blurbs",gap:20,children:ee.map(e=>(0,l.BX)(E.tu,{gap:8,className:"blurb",children:[(0,l.tZ)(T.xv.B4,{className:"blurb-text",children:(0,l.tZ)(g.Z,{maxLines:4,ellipsesText:"...”",text:"“".concat(e.description,"”")})}),(0,l.BX)(T.xv.B4,{weight:"semibold",className:"blurb-text",children:[e.author_name||e.recommendingPublication.email_from_name||e.recommendingPublication.copyright,", ",(0,l.tZ)("a",{href:(0,O.SVA)(e.recommendingPublication),children:e.recommendingPublication.name})]})]}))})]}),(0,l.tZ)(y.fJ,{publication:d})]})},X=e=>{var t;let{pub:n,user:o,email:i,freeSignup:a,freeSignupEmail:u,onMaybeLater:d,onFreeSignup:p,blurbs:m}=e,h="cover_page",_=(0,s.qp)(x.vz),{getSettingFor:Z}=(0,x.So)(),{iString:k,language:S}=(0,w.M1)(),{title:B,subtitle:I,logoUrl:A,coverPhotoUrl:F,hideTitle:P,hideSubtitle:W}=Y(n),R=F&&(0,O.zJH)(F),H=R&&R.width/R.height,M=!!(H&&H<2),$=!P||F&&M,z=!W||F&&M;(0,s.d4)(()=>{(0,N.j)(N.FP.FULL_EMAIL_FORM_SHOWN,{source:h,functional_version:!0,version:"large-fonts"})},[h]);let J=m?m.filter(e=>""!=e.description):[],j=Z("display_welcome_page_details");return(0,l.BX)("div",{className:"full-email-form",children:[(0,l.BX)("div",{className:"vertically-centered",children:[(0,l.tZ)(K,{onClick:d}),F?M?null:(0,l.tZ)(C.xu,{paddingBottom:48,children:(0,l.tZ)(b.e,{className:U.Z.publicationCoverPhotoCenter,src:F,imageProps:{quality:"auto:best"},maxWidth:840,loading:"eager",style:(0,r._)({},R&&R.width&&{height:"min(168px, ".concat(840*R.height/R.width,"px)")}),imageIsFixedWidth:!0})}):A&&(0,l.tZ)(C.xu,{paddingBottom:32,children:(0,l.tZ)(L.wk,{logoUrl:A,size:88})}),(0,l.BX)(E.hs,{gap:48,children:[(0,l.BX)(E.tu,{className:M?U.Z.largeColumn:U.Z.largeCenteredColumn,gap:32,children:[(0,l.BX)(E.tu,{gap:16,children:[$?(0,l.tZ)(T.xv.H1,{textAlign:M?"left":"center",font:"pub-headings",className:c()(U.Z.coverPrimary,U.Z.largeHeading),textWrap:"balance",children:B}):null,z?(0,l.tZ)(T.xv.B3,{textAlign:M?"left":"center",font:"display",size:15,lineHeight:20,className:c()(U.Z.coverSecondary,U.Z.largeSubHeading),textWrap:"balance",children:I}):null,(0,l.tZ)(T.xv.B2,{textAlign:"left",weight:"semibold",font:"display",size:17,lineHeight:24,className:U.Z.coverSecondary,alignSelf:M?"start":"center",children:D(n,{includePrice:!1,includeBadge:!0,rankingDetailOverrideText:n.rankingDetailFreeSubscriberCount,includeRankingDetail:!!j,language:S})})]}),(0,l.BX)(E.tu,{gap:16,children:[(0,l.tZ)(f.Z,{email:i,isWelcomePageColor:!0,freeSignup:a,freeSignupEmail:u,pub:n,source:h,user:o,onConfirmationRequired:"enabled"===n.payments_state?()=>null:void 0,onSuccess:p||(()=>document.location.href="/"),autoFocus:!0,className:U.Z.containerClassName,promptClassName:U.Z.largePromptClassName,inputClassName:U.Z.largeInputClassName,inputWrapperClassName:U.Z.largeInputWrapperClassName,subscribeButtonClassName:U.Z.largeSubscribeButtonClassName}),(0,l.BX)(E.hs,{gap:4,cursor:"pointer",alignItems:"center",alignSelf:"center",inline:!0,onClick:d,children:[(0,l.tZ)(T.xv.B1,{size:20,lineHeight:30,weight:"semibold",style:{color:"var(--cover_print_secondary)"},children:"No thanks"===_.getSettingFor("welcome_page_opt_out_text")?k("No thanks"):null!==(t=_.getSettingFor("welcome_page_opt_out_text"))&&void 0!==t?t:k("No thanks")}),(0,l.tZ)(v.Z,{height:18,stroke:"var(--cover_print_secondary)",strokeWidth:2})]})]})]}),F&&M?(0,l.tZ)(E.tu,{className:c()(U.Z.largeColumn,U.Z.hideLargeColumnSmallScreens),gap:32,children:(0,l.tZ)(b.e,{className:U.Z.largePublicationCoverPhotoRight,src:F,imageProps:{quality:"auto:best"},maxWidth:568,loading:"eager",imageIsFixedWidth:!0})}):null]}),!!(null==J?void 0:J.length)&&(0,l.tZ)("div",{className:"blurb-buffer"}),!!(null==J?void 0:J.length)&&(0,l.tZ)(E.gq,{className:"blurbs",gap:20,children:J.map(e=>(0,l.BX)(E.tu,{gap:8,className:"blurb",children:[(0,l.tZ)(T.xv.B4,{className:"blurb-text",children:(0,l.tZ)(g.Z,{maxLines:4,ellipsesText:"...”",text:"“".concat(e.description,"”")})}),(0,l.BX)(T.xv.B4,{weight:"semibold",className:"blurb-text",children:[e.author_name||e.recommendingPublication.email_from_name||e.recommendingPublication.copyright,", ",(0,l.tZ)("a",{href:(0,O.SVA)(e.recommendingPublication),children:e.recommendingPublication.name})]})]}))})]}),(0,l.tZ)(y.fJ,{publication:n})]})},V=e=>{var t;let{autoFocus:o=!0,pub:i,user:a,email:u,freeSignup:d,freeSignupEmail:m,referralCode:h,source:v,forceSignup:b,submitButtonText:y,onMaybeLater:_,onFreeSignup:Z,blurbs:k,hideBlurbs:S,overrideSubtitle:C}=e,L=(0,s.qp)(x.vz),{iString:I}=(0,w.M1)(),A=(0,W.x)("referralCode"),P=(0,W.x)("refSource"),R=I("Learn More"),H=(0,O.d6h)(i,{params:(0,r._)({utm_source:M.b3.subscribeEmail,utm_content:M.fZ.learnMore},A&&{referralCode:A},P&&{refSource:P})});(0,s.d4)(()=>{"subscribe_page"===v&&(0,N.j)(N.FP.SUBSCRIBE_EMAIL_FULL_SCREEN_SHOWN,{functional_version:!0}),(0,N.j)(N.FP.FULL_EMAIL_FORM_SHOWN,{source:v,functional_version:!0})},[v]);let $=k&&!S?k.filter(e=>""!=e.description):[];return(0,l.tZ)("div",{className:"full-email-form",children:(0,l.BX)("div",{className:"vertically-centered",children:[_&&!i.invite_only&&(0,l.tZ)(K,{onClick:_}),(0,l.tZ)(G,{pub:i,overrideSubtitle:C}),!i.invite_only||a&&a.is_free_subscribed?(0,l.BX)(l.HY,{children:[(0,l.tZ)(E.gq,{justifyContent:"center",style:{width:"100%"},children:(0,l.BX)(E.tu,{gap:4,style:{width:"100%",maxWidth:"380px"},children:[(0,l.tZ)(f.Z,{email:u,isWelcomePageColor:!0,freeSignup:d,freeSignupEmail:m,pub:i,referralCode:h,source:v,submitButtonText:y,user:a,onConfirmationRequired:"enabled"===i.payments_state?()=>null:void 0,onSuccess:Z||(()=>document.location.href="/"),autoFocus:o}),(0,l.BX)(T.xv.B4,{paddingX:{mobile:16,desktop:0},paddingTop:16,className:U.Z.tosText,translated:!0,children:["By subscribing, I agree to Substack’s"," ",(0,l.tZ)("a",{className:U.Z.tosLink,href:(0,O._QN)(),target:"_blank",rel:"noopener noreferrer",children:"Terms of Use"})," ","and acknowledge its"," ",(0,l.tZ)("a",{className:U.Z.tosLink,href:(0,O.WFt)(),target:"_blank",rel:"noopener noreferrer",children:"Information Collection Notice"})," ","and"," ",(0,l.tZ)("a",{className:U.Z.tosLink,href:(0,O.Zzu)(),target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]})}),!b&&(_?(0,l.tZ)("a",{onClick:e=>e.preventDefault(),className:"no-styles",children:(0,l.BX)(B.zx,{priority:"quaternary",className:U.Z.maybeLater,onClick:_,"data-testid":"maybeLater",children:["No thanks"===L.getSettingFor("welcome_page_opt_out_text")?I("No thanks"):null!==(t=L.getSettingFor("welcome_page_opt_out_text"))&&void 0!==t?t:I("No thanks"),(0,l.tZ)(p.Z,{size:20})]})}):(0,l.BX)(B.zx,{priority:"quaternary",className:U.Z.maybeLater,href:H,localNavigation:!1,children:[R,(0,l.tZ)(p.Z,{size:20})]}))]}):(0,l.tZ)(F.cr,{onRequest:()=>n.e("2457").then(n.bind(n,51323)),resolve:e=>e.InviteActions,module:"./InviteActions",pub:i,user:a,freeSignupEmail:m}),!!(null==$?void 0:$.length)&&(0,l.tZ)("div",{className:"blurb-buffer"}),!!(null==$?void 0:$.length)&&(0,l.tZ)(E.gq,{className:"blurbs",gap:20,children:$.map(e=>(0,l.BX)(E.tu,{gap:8,className:"blurb",children:[(0,l.tZ)(T.xv.B4,{className:c()("blurb-text",U.Z.blurbText),children:(0,l.tZ)(g.Z,{maxLines:4,ellipsesText:"...”",text:"“".concat(e.description,"”")})}),(0,l.BX)(T.xv.B4,{weight:"semibold",className:c()("blurb-text",U.Z.blurbText),children:[e.author_name||e.recommendingPublication.email_from_name||e.recommendingPublication.copyright,", ",(0,l.tZ)("a",{href:(0,O.SVA)(e.recommendingPublication),children:e.recommendingPublication.name})]})]}))})]})})},Y=(e,t)=>{let n,r,o,i,l,a;let{getConfigFor:s}=(0,Z.xR)();if(s("section_specific_welcome_pages")&&e.section){var u;n=e.section.name,r=e.section.description,o=null!==(u=e.section.logo_url)&&void 0!==u?u:e.logo_url,l=!!((i=e.section.cover_photo_url)&&e.section.hide_intro_title),a=!!(i&&e.section.hide_intro_subtitle)}else n=e.name,r=e.hero_text,o=e.logo_url,l=!!((i=e.cover_photo_url)&&e.hide_intro_title),a=!!(i&&e.hide_intro_subtitle);return t&&(r=t),{title:n,subtitle:r,logoUrl:o,coverPhotoUrl:i,hideTitle:l,hideSubtitle:a}},G=e=>{let{pub:t,overrideSubtitle:n}=e,{getSettingFor:o}=(0,x.So)(),{language:i}=(0,w.M1)(),{title:a,subtitle:s,logoUrl:u,coverPhotoUrl:d,hideTitle:p,hideSubtitle:m}=Y(t,n),h=o("display_welcome_page_details"),f=d&&(0,O.zJH)(d);return(0,l.BX)(l.HY,{children:[d?(0,l.tZ)(b.e,{className:"publication-cover-photo",src:d,imageProps:{quality:"auto:best"},maxWidth:1360,loading:"eager",style:(0,r._)({},f&&f.width&&{height:"min(35vh, ".concat(680*f.height/f.width,"px)")})}):u&&(0,l.tZ)(C.xu,{paddingBottom:32,children:(0,l.tZ)(L.wk,{logoUrl:u,size:88})}),!p&&(0,l.tZ)("h1",{className:c()("publication-name",{"no-logo":!u,"with-cover":d},U.Z.balancedText),children:a}),!m&&s&&(0,l.tZ)("p",{className:c()("publication-tagline with-cover",{verbose:!0,"with-cover":d},U.Z.balancedText),children:s}),(0,l.tZ)("div",{className:"publication-meta",children:D(t,{includePrice:!1,includeBadge:!0,rankingDetailOverrideText:t.rankingDetailFreeSubscriberCount,includeRankingDetail:!!h,language:i})})]})},K=e=>{let{onClick:t}=e;return(0,l.tZ)(B.hU,{onClick:t,"aria-label":"Close","data-testid":"close-welcome-modal",priority:"tertiary",className:U.Z.closeWelcomeModal,children:(0,l.tZ)(m.Z,{size:20})})}},72392:function(e,t,n){n.d(t,{o:()=>w});var r=n(16584),o=n(30396),i=n(94184),l=n.n(i),a=n(347),s=n(95441),u=n(98914),c=n(15771),d=n(19081),p=n(44424),m=n(63474),h=n(58175),f=n(81821),v=n(98550);let g=e=>{let[t,n]=(0,o.eJ)(null);return(0,o.d4)(()=>{let t=[];return e.forEach(e=>{let r=(0,u.VA)(e.text.toLowerCase(),!0),o=document.getElementById("\xa7".concat(r));if(o){let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.intersectionRatio>=.8&&n(r)})},{threshold:.5,rootMargin:"0px 0px -90% 0px"});e.observe(o),t.push(e)}}),()=>t.forEach(e=>e.disconnect())},[e]),t},b=e=>e?/^H[1-5]$/i.test(e.tagName)?e:b(e.parentElement):null,y=e=>{let{toc:t,minLevel:n,activeItem:o}=e;return(0,r.tZ)(d.tu,{gap:12,paddingY:12,paddingX:8,alignItems:"end",children:t.map((e,t)=>{let i=e.level-n,a="indent-".concat(Math.min(i,3)),s=(0,u.VA)(e.text.toLowerCase(),!0);return(0,r.tZ)("div",{className:l()(v.Z.line,v.Z[a],o===s&&v.Z.active)},t)})})},_=e=>{let{toc:t,minLevel:n,activeItem:o,onItemClick:i}=e,{iString:a}=(0,s.M1)();return(0,r.BX)(d.tu,{gap:4,flex:"grow",children:[(0,r.tZ)(h.xv.Meta,{padding:4,color:"primary",children:a("Contents")}),t.map((e,t)=>{let a=(0,u.VA)(e.text.toLowerCase(),!0),s=e.level-n,c="indent-".concat(Math.min(s,3));return(0,r.tZ)(m.A0,{href:"#\xa7".concat(a),onClick:e=>{e.preventDefault(),i(a)},children:(0,r.tZ)(d.gq,{padding:4,className:l()(v.Z.row),children:(0,r.tZ)(h.xv.B3,{className:l()(v.Z.label,v.Z[c],o===a&&v.Z.active),ellipsis:!0,children:e.text})})},t)})]})},w=e=>{let{toc:t,position:n="fixed"}=e,{iString:i}=(0,s.M1)(),u=Math.min(...t.map(e=>e.level)),[d,m]=(0,o.eJ)(null),h=g(t);return t.length<2||(0,f.tq)()?null:(0,r.tZ)(a.h,{children:(0,r.tZ)(p.v2,{trigger:e=>{let{ref:o,onClick:a}=e;return(0,r.tZ)(c.kG,{ref:o,onClick:a,className:l()(v.Z.trigger,v.Z[n]),"aria-label":i("Table of Contents"),position:n,children:(0,r.tZ)(y,{toc:t,minLevel:u,activeItem:h})})},customShowClass:v.Z.show,customHideClass:v.Z.hide,layerClassName:v.Z.menu,layerOptions:{placement:"right-center",triggerOffset:8},children:(0,r.tZ)(_,{toc:t,minLevel:u,activeItem:h,onItemClick:e=>{let t=document.getElementById("\xa7".concat(e));if(t){let n=b(t);if(n){if(d){let e=document.getElementById("\xa7".concat(d)),t=e?b(e):null;null==t||t.classList.remove("highlight")}n.classList.add("highlight"),m(e),t.scrollIntoView({behavior:"smooth",block:"start"})}}}})})})}},59708:function(e,t,n){let r;n.d(t,{Kd:()=>X,N1:()=>V});var o,i=n(7409),l=n(99282),a=n(16584),s=n(6400),u=n(70109),c=n(94184),d=n.n(c),p=n(60826),m=n(4373),h=n(62049),f=n(16564),v=n(17117),g=n(36441),b=n(78435),y=n(80836),_=n(3258),w=n(33665),x=n(95441),Z=n(57796),k=n(26989),N=n(98914),S=n(55706),C=n(19081),B=n(32700),E=n(93903),L=n(60308),T=n(26111),I=n(81821),A=n(64314);let F=(e,t)=>{var n,r,o,l;return(0,a.tZ)("div",{className:"subscription-widget-wrap",children:(0,a.BX)("div",{className:"subscription-widget show-subscribe",children:[(0,a.tZ)("div",{className:"preamble",children:(0,a.tZ)("p",{dangerouslySetInnerHTML:{__html:null!==(l=null===(o=e.children[0])||void 0===o?void 0:null===(r=o.children[0])||void 0===r?void 0:null===(n=r.children[0])||void 0===n?void 0:n.innerHTML)&&void 0!==l?l:""}})}),(0,a.tZ)(w.Z,(0,i._)({pub:t.pub,subscribeButtonAttrs:null,source:"subscribe-widget-preamble"},t.props))]})})},P=(e,t)=>{try{let n=JSON.parse((0,E.Z)(e.getAttribute("data-attrs")));if(["".concat(t.pub.base_url,"/subscribe?"),"".concat(t.pub.base_url,"/subscribe?plan=founding"),p.W.CHECKOUT_URL,p.W.FOUNDING_CHECKOUT_URL].includes(n.url)){let n=JSON.parse((0,E.Z)(e.getAttribute("data-attrs")));return(0,a.tZ)(w.Z,(0,i._)({pub:t.pub,subscribeButtonAttrs:n},t.props))}}catch(e){console.error("Failed to parse button:",e)}return null},O=(e,t)=>{let{pub:n,props:{isStatic:r,post:o}}=t;try{let t=e.getAttribute("data-attrs");if(t){let e=JSON.parse((0,E.Z)(t));return r?(0,a.tZ)(f.nO,{label:e.label,pub:n,post:o,duration:e.duration}):(0,a.tZ)(f.cM,{label:e.label,pub:n,post:o,src:"/api/v1/audio/upload/".concat(e.mediaUploadId,"/src"),duration:e.duration,autoPlay:!1,mediaUpload:{id:e.mediaUploadId}})}}catch(e){console.error("Failed to parse audio:",e)}return null},W=(e,t)=>{let{pub:n,props:{isStatic:r,post:o}}=t;try{let t=e.getAttribute("data-attrs");if(t){let e=JSON.parse((0,E.Z)(t));return r?(0,a.tZ)(f.nO,{label:e.label,pub:n,post:o,duration:e.duration}):(0,a.tZ)(f.cM,{label:e.label,pub:n,post:o,src:e.url,duration:e.duration,autoPlay:!1})}}catch(e){console.error("Failed to parse audio:",e)}return null},R=(e,t)=>{let{props:{isStatic:n}}=t;try{let t=e.getAttribute("data-attrs");if(t){let{name:e,avatarUrl:r,url:o}=JSON.parse((0,E.Z)(t));return n?(0,a.tZ)(S.W,{name:e,avatarUrl:r,url:o}):(0,a.tZ)(S.R,{name:e,avatarUrl:r,url:o})}}catch(e){console.error("Failed to parse audio:",e)}return null},H=e=>{try{let t=JSON.parse(e.dataset.attrs).symbol;if(t)return(0,a.tZ)(v.Z,{symbol:t,prependSymbol:JSON.parse(e.dataset.attrs).prependSymbol,isStatic:JSON.parse(e.dataset.attrs).isStatic});return(0,a.tZ)(a.HY,{})}catch(e){return console.error("failed to parse cashtag"),(0,a.tZ)(a.HY,{})}},M=(e,t)=>{let{pub:n,props:{isStatic:r}}=t,{iString:o}=I18N.i({pub:n});try{if(r){let t=e.getAttribute("data-attrs");if(t){let e=JSON.parse((0,E.Z)(t)),n=null==e?void 0:e.persistentExpression;return n?(0,a.tZ)("img",{src:(0,L.iJV)(n),style:{transform:"scale(0.5)"},"data-component-name":"LatexImg"}):(0,a.tZ)("p",{children:o("Failed to render LaTeX expression — no expression found in email")})}return(0,a.tZ)("p",{children:o("Failed to render LaTeX expression — data attributes not found")})}let t=e.getAttribute("data-attrs"),n=JSON.parse((0,E.Z)(t)),i=null==n?void 0:n.persistentExpression;return i?(0,a.tZ)(C.gq,{className:"latex-rendered",justifyContent:"center",flex:"grow",paddingBottom:"4px",paddingTop:"4px","data-component-name":"Latex",children:(0,a.tZ)(C.tu,{justifyContent:"center",children:(0,a.tZ)(u.Z,{inline:!1,children:"\\(".concat(i,"\\)")})})}):(0,a.tZ)("p",{children:o("Failed to render LaTeX expression — no expression found")})}catch(e){return console.error("failed to render mathjax",e),(0,a.tZ)("p",{children:o("Failed to render LaTeX expression — error")})}},U=e=>{try{let{name:t,id:n,type:r,url:o,photo_url:i,uuid:l,isStatic:s}=JSON.parse(e.dataset.attrs);if(t)return(0,a.tZ)(_.ZP,{name:t,id:n,type:r,url:o,photo_url:i,uuid:l,isStatic:s});return(0,a.tZ)(a.HY,{})}catch(e){return(0,a.tZ)(a.HY,{})}},$=(e,t)=>{try{let o=JSON.parse((0,E.Z)(e.getAttribute("data-attrs")));if(null==o?void 0:o.isEmail){var n,r;return(0,a.tZ)("table",{className:"poll-embed poll-email",cellSpacing:"16px",width:"100%",children:(0,a.tZ)("tbody",{children:(0,a.tZ)("tr",{children:(0,a.tZ)("td",{align:"center",children:(0,a.tZ)(b.kq,{id:o.id,embeddedPolls:null!==(r=null===(n=t.props.dataForEmailRender)||void 0===n?void 0:n.embeddedPolls)&&void 0!==r?r:[],pub:t.pub})})})})})}return(0,a.tZ)("div",{className:"poll-embed",dataAttrs:e.getAttribute("data-attrs"),children:(0,a.tZ)(b.n_,{id:o.id,isEditor:!1,post:t.props.post,isVersionView:!!t.props.isVersionView})})}catch(e){return console.error("Failed to parse poll:",e),(0,a.tZ)(a.HY,{})}},z=(e,t,n)=>{var r;let[o,,i]=e.id.split("-"),l=null===(r=n.wrapper.querySelector("#".concat(o,"-").concat(i)))||void 0===r?void 0:r.nextElementSibling;return l?((0,I.tq)()&&(e.href="#_"),(0,a.tZ)(B.z,{content:(0,a.tZ)("div",{className:"markup",children:q(l,t,n)}),className:"footnote-hovercard-target",dontStopPropagation:!0,layerClassName:"typography footnote-hovercard",as:"span",children:q(e,t,n)})):q(e,t,n)},D=(e,t)=>(0,a.tZ)(x._7,{language:t,children:e}),J=function(e,t){var n,r,o;let{shallow:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("A"!==e.nodeName||e.getAttribute("rel")||e.setAttribute("rel","pub"in t&&(null===(o=t.pub)||void 0===o?void 0:o.no_follow)?"nofollow ugc noopener":""),(0,N.pv)(e,"image2")&&(null===(n=t.props)||void 0===n?void 0:n.canRestackImage)&&e.classList.add("can-restack"),"pub"in t&&t.pub&&"P"===e.nodeName&&(0,N.pv)(e,"button-wrapper")){let n=P(e,t);if(n)return n;let r=(0,g.TW)(e,t);if(r)return r}let u="pub"in t&&(null===(r=t.pub)||void 0===r?void 0:r.language)||"en";return(0,N.pv)(e,"subscription-widget-wrap-editor")||(0,N.pv)(e,"subscription-widget-wrap")?D(F(e,t),u):(0,N.pv)(e,"cashtag-wrap")?D(H(e),u):(0,N.pv)(e,"mention-wrap")?D(U(e),u):"pub"in t&&t.pub&&(0,N.pv)(e,"native-audio-url-embed")?D(W(e,t),u):"pub"in t&&t.pub&&(0,N.pv)(e,"native-audio-embed")?D(O(e,t),u):"pub"in t&&t.pub&&(0,N.pv)(e,"native-video-embed")?D((0,g.tj)(e,t),u):"pub"in t&&t.pub&&(0,N.pv)(e,"meeting-embed")?D(R(e,t),u):(0,N.pv)(e,"poll-embed")?D($(e,t),u):(0,N.pv)(e,"recipe-embed")?D((0,g.G3)(e,t),u):(0,N.pv)(e,"sponsorship-campaign-embed")?D((0,g.b3)(e,t),u):(0,N.pv)(e,"image-gallery-embed")?D((0,g.W5)(e,t),u):(0,N.pv)(e,"image3")?D((0,g.L0)(e,t),u):(0,N.pv)(e,"directMessage")?D((0,g.Gz)(e,t),u):(0,N.pv)(e,"latex-rendered")?D(M(e,t),u):(0,N.pv)(e,"community-chat")?D(function(e,t){let{props:{isStatic:n}}=t;try{let t=e.getAttribute("data-attrs"),r=JSON.parse((0,E.Z)(t));if(!r.pub||!r.subdomain)return console.error("could not deepPrepare communityChat, subdomain or pub missing from node"),(0,a.tZ)(s.Fragment,{});return(0,a.tZ)("div",{className:"community-chat",dataAttrs:t,children:n?(0,a.tZ)(m.C,(0,i._)({},r)):(0,a.tZ)(m.a,{pub:r.pub,subdomain:r.subdomain})})}catch(e){return console.error("Failed to parse chat embed:",e),(0,a.tZ)(s.Fragment,{})}}(e,t),u):(0,N.pv)(e,"community-post")?D(function(e,t){let{props:{isStatic:n,is_freemail:r}}=t;try{let t=e.getAttribute("data-attrs"),o=JSON.parse((0,E.Z)(t));return n?(0,a.tZ)(h.s,(0,i._)({is_freemail:r},o)):(0,a.tZ)(h.V,(0,i._)({},o))}catch(e){return console.error("Failed to parse chat post embed:",e),(0,a.tZ)(s.Fragment,{})}}(e,t),u):(0,N.pv)(e,"digest-post-embed")?D((0,g.Do)(e,t),u):(0,N.pv)(e,"comment")&&!(0,N.pv)(e,"template-comment")?D(function(e,t){let{props:{isStatic:n}}=t;try{let t=e.getAttribute("data-attrs"),r=JSON.parse((0,E.Z)(t));return n?(0,a.tZ)(k.Eo,(0,i._)({},r)):(0,a.tZ)(Z.d,(0,i._)({},r))}catch(e){return console.error("Failed to parse chat post embed:",e),(0,a.tZ)(s.Fragment,{})}}(e,t),u):(0,N.pv)(e,"referrals-tier-card")?D((0,g.mx)(e,t),u):("undefined"!=typeof window&&(0,N.pv)(e,"file-embed-button")&&"href"in e&&e.href&&!(0,T.x)(e.href,"token")&&(e.href=(0,L.n1t)(e.href,{token:(0,T.x)(window._preloads.original_url,"token")})),"props"in t&&t.props&&"post"in t.props&&t.props.post&&"object"==typeof t.props.post&&"id"in t.props.post&&t.props.post.id&&(0,N.pv)(e,"footnote")&&(e.id&&(e.id+="-".concat(t.props.post.id)),"href"in e&&e.href&&(e.href+="-".concat(t.props.post.id))),(0,N.pv)(e,"footnote-anchor"))?D(z(e,J,t),u):l?null:q(e,J,t)},j=function(e){let t={};for(let{name:n,value:r}of Array.prototype.slice.call(e))t[n]=r;return t},q=(o=(e,t,n,r)=>{var o;if(!e)throw Error("Empty node, cannot preactify!");let u=3===e.nodeType?"span":8===e.nodeType?"x_preact_compatible_html_comment_x":e.tagName.toLowerCase(),c=1!==e.nodeType?{}:j(e.attributes),p=e.children&&e.children.length>0?null:e.textContent;if(r||"script"===u&&e.innerHTML===A.N)return(0,s.h)(u,(0,l._)((0,i._)({},c),{dangerouslySetInnerHTML:{__html:e.innerHTML}}));let m=!!(null===(o=e.parentElement)||void 0===o?void 0:o.getAttribute("data-prose-mirror-wrapper"));if(n&&"pub"in n&&m&&["h1","h2","h3","h4"].includes(u)&&!e.className)return function(e,t,n,r){var o,u,c,p;let m=d()("header-anchor-post",t.className),h=n.children.length?Array.prototype.map.call(n.childNodes,e=>J(e,r)):[n.textContent];return(0,s.h)(e,(0,l._)((0,i._)({},t),{className:m}),...h,(0,a.tZ)(y.Z,{text:null!==(c=n.textContent)&&void 0!==c?c:"",pub:null==r?void 0:r.pub,post:null==r?void 0:null===(o=r.props)||void 0===o?void 0:o.post,offsetTop:!0,isAboutPage:null!==(p=null==r?void 0:null===(u=r.props)||void 0===u?void 0:u.isAboutPage)&&void 0!==p&&p}))}(u,c,e,n);if(p)return(0,s.h)(u,c,p);let h=t(e,n,{shallow:!0});return h||(0,s.h)(u,c,...Array.prototype.map.call(e.childNodes,e=>t(e,n)))},r=0,function(){let e=[].slice.call(arguments,0),t=++r>2500;if(t){var n,i,l;console.error("Too many post nodes to recurse",{postId:null===(l=e[2])||void 0===l?void 0:null===(i=l.props)||void 0===i?void 0:null===(n=i.post)||void 0===n?void 0:n.id,depth:r})}let a=o.apply(null,[...e,...t?[!0]:[]]);return r--,a});function X(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement("div");return r.setAttribute("data-prose-mirror-wrapper","1"),r.innerHTML=e,Array.prototype.map.call(r.childNodes,e=>q(e,J,{wrapper:r,pub:t,props:n}))}function V(e){if("undefined"==typeof window)return[];let t=document.createElement("div");t.innerHTML=e;let n=[];for(let e of t.querySelectorAll("h1, h2, h3, h4")){var r,o;let t=e.tagName[1],i=t?parseInt(t):NaN;n.push({level:null!=i?i:0,text:null!==(r=e.textContent)&&void 0!==r?r:"",id:null!==(o=e.id)&&void 0!==o?o:""})}return n}},2748:function(e,t,n){n.d(t,{F:()=>i});var r=n(1835),o=n(84864);function i(e,t){var n,i,l,a;let s,u;let c=null===(n=e.name)||void 0===n?void 0:n.trim(),d=c;(0,o.endsWithPunctuation)(c)&&(d='"'.concat(c,'"'));let p=(0,r.Im)(e.contributors);return e.invite_only?(s=null,u=null):(s=(null===(l=e.rankingDetailFreeIncluded)||void 0===l?void 0:l.toLowerCase().includes("subscribers"))?e.rankingDetailFreeIncluded.toLowerCase():null,u=e.rankingDetailFreeIncluded||e.rankingDetail),(0,r.ab)(null!==(a=null!=t?t:null===(i=e.hero_text)||void 0===i?void 0:i.trim())&&void 0!==a?a:"",p,s,d,u)}},91246:function(e,t,n){if(n.d(t,{V:()=>h,u:()=>v}),4716==n.j)var r=n(7409);if(4716==n.j)var o=n(99282);var i=n(16584);if(4716==n.j)var l=n(28518);if(4716==n.j)var a=n(93920);if(4716==n.j)var s=n(78493);if(4716==n.j)var u=n(55585);var c=n(98661),d=n(19081),p=n(44424),m=n(42450);function h(e){let{trigger:t,children:n,onOpen:r,onClose:o,disabled:l,stopPropagation:a,placement:s="bottom"}=e;return(0,i.tZ)(u.v,{children:e=>{let{open:u}=e;return(0,i.tZ)(f,{trigger:t,children:n,open:u,onOpen:r,onClose:o,disabled:l,stopPropagation:a,placement:s})}})}function f(e){let{trigger:t,children:n,open:h,disabled:f,onOpen:v,onClose:g,stopPropagation:b,placement:y}=e,{refs:_,floatingStyles:w,context:x}=(0,l.YF)({placement:y,strategy:"fixed",open:h,whileElementsMounted:a.Me,middleware:[(0,s.cv)(4),(0,s.RR)()]}),{getReferenceProps:Z,getFloatingProps:k}=(0,l.NI)([(0,l.bQ)(x,{ancestorScroll:!0})]),{isMounted:N,styles:S}=(0,l.Y_)(x,{duration:250,initial:e=>{let{side:t}=e;return{opacity:0,transform:"translate".concat("bottom"===t||"top"===t?"Y":"X","(calc(").concat("bottom"===t||"right"===t?-1:1," * ").concat("var(--size-8)","))")}},open:{opacity:1,transform:"translate(0, 0)"},common:{transition:"var(--animate-hover)"}});return(0,c.useEffect)(()=>{h?null==v||v():null==g||g()},[h]),(0,i.BX)(d.sg,{onClick:e=>{b&&e.stopPropagation()},children:[(0,i.tZ)(u.v.Button,(0,o._)((0,r._)({as:c.Fragment,ref:_.setReference},Z()),{disabled:f,children:t})),(0,i.tZ)(l.ll,{children:N&&(0,i.tZ)(u.v.Items,(0,o._)((0,r._)({className:m.Z.floatingContainer,ref:_.setFloating,style:w,static:!0},k()),{children:(0,i.tZ)(p.ep,{style:S,children:n})}))})]})}function v(e){return(0,i.tZ)(u.v.Item,{children:(0,i.tZ)(p.sN,(0,r._)({},e))})}},5889:function(e,t,n){n.d(t,{gg:()=>o,m:()=>i});var r=n(25235);function o(e){return e&&i(e).pop()||null}function i(e){return(0,r.find)(e).filter(e=>"url"===e.type&&e.href.startsWith("http"))}},18967:function(e,t,n){n.d(t,{E4:()=>o,ML:()=>i});var r,o=2787!=n.j?((r={}).CompOneMonth="comp_one_month",r.CompThreeMonths="comp_three_months",r.CompSixMonths="comp_six_months",r.CompNineMonths="comp_nine_months",r.CompTwelveMonths="comp_twelve_months",r.Custom="custom",r):null;let i={comp_one_month:"1 month comp",comp_three_months:"3 month comp",comp_six_months:"6 month comp",comp_nine_months:"9 month comp",comp_twelve_months:"12 month comp",custom:"Custom"}},86551:function(e,t,n){n.d(t,{BN:()=>C,F2:()=>S,Fp:()=>T,HQ:()=>k,Lb:()=>Z,R_:()=>O,S_:()=>B,T6:()=>P,U0:()=>x,Ui:()=>F,aZ:()=>I,op:()=>L,pw:()=>E,sj:()=>N,tX:()=>A});var r=n(58865),o=n(60826),i=n(68833),l=n(60308),a=n(63651),s=n(84864),u=n(47929),c=n(68303),d=n(39947);function p(){let e=(0,r._)(["Start writing today. Use the button below to create a Substack of your own"]);return p=function(){return e},e}function m(){let e=(0,r._)(["Share ",""]);return m=function(){return e},e}function h(){let e=(0,r._)(["Get ","% off a group subscription"]);return h=function(){return e},e}function f(){let e=(0,r._)(["Get a group subscription"]);return f=function(){return e},e}function v(){let e=(0,r._)(["Give a gift subscription"]);return v=function(){return e},e}function g(){let e=(0,r._)(["","! Subscribe for free to receive new posts and support my work."]);return g=function(){return e},e}function b(){let e=(0,r._)(["",". To receive new posts and support my work, consider becoming a free or paid subscriber."]);return b=function(){return e},e}function y(){let e=(0,r._)(["","! This post is public so feel free to share it."]);return y=function(){return e},e}function _(){let e=(0,r._)(["Thanks for reading ","! Subscribe for free to receive new posts and support my work."]);return _=function(){return e},e}function w(){let e=(0,r._)([""," is a reader-supported publication. To receive new posts and support my work, consider becoming a free or paid subscriber."]);return w=function(){return e},e}let x=e=>(t,n)=>{let{iString:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:"".concat(o.W.CHECKOUT_URL,"&donate=true"),text:r("Donate Subscriptions")};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},Z=e=>(t,n)=>{let{iString:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:"".concat(o.W.LEADERBOARD_URL,"&utm_source=").concat(u.b3.post),text:r("Refer a friend")};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},k=e=>{let{writerReferralCode:t,publication:n,postId:r}=e;return(e,o)=>{let{iString:i,iTemplate:a}=I18N.i({pub:n});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!e.schema.nodes.captionedWriterReferralButton)return console.error("captionedWriterReferralButton node type not found in schema"),!1;if(!e.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,d.o)(e,e.schema.nodes.button))return!1;let s=a(p()),m={url:"".concat((0,l.Fnz)(t||""),"?utm_source=").concat(u.b3.substack,"&utm_context=").concat(u.gD.post,"&utm_content=").concat(r,"&utm_campaign=").concat(u.VX.writerReferralButton),text:i("Start a Substack")},h=e.schema.nodes.captionedWriterReferralButton.create(m,e.schema.nodes.ctaCaption.create(null,[e.schema.text(s)]));return o&&o((0,c.o4)(e,h)),!0}},N=e=>(t,n)=>{let{iString:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:o.W.HALF_MAGIC_COMMENTS_URL,text:r("Leave a comment")};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},S=(e,t,n)=>(r,o)=>{if((0,i.j)(i.FP.READER_SURVEY_LINKED_IN_POST,{editorVersion:"1",surveyId:t.id}),!r.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(r,r.schema.nodes.button))return!1;let l={url:"".concat((0,a.h8g)(e,t.id)),text:n};return o&&o((0,c.o4)(r,r.schema.nodes.button.create(l))),!0},C=e=>(t,n)=>{let{iString:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:o.W.SHARE_URL,text:r("Share")};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},B=e=>(t,n)=>{let{iTemplate:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:o.W.SHARE_PUB_URL,text:r(m(),e.name)};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},E=e=>{let{couponPub:t,scrollParent:n,parentClass:r,get_coupons:o,insert_coupon:i,SelectField:a,openPrompt:s,closePrompt:u,getNetworkErrorMessage:c}=e;return(e,p,m)=>{let{iString:h}=I18N.i({pub:t});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(e,e.schema.nodes.button))return!1;let f={parentClass:r,root:n?document.querySelector(".".concat(n)):m.dom.parentNode,scrollParent:n,offsetTop:10},v=Object.assign({title:h("Loading..."),no_buttons:!0,language:t.language},f);return s(v),o().then(n=>{u(v);let r=n.map(e=>{var t;return{label:null!==(t=e.name)&&void 0!==t?t:"",value:e}}).concat([{label:h("Create new offer"),value:{create_new:!0}}]),o={coupon:new a({label:h("Select offer..."),required:!0,options:r,onChange:n=>{if(n&&"create_new"in n&&n.create_new){u(c);let n=window.open("".concat((0,l.SVA)(t),"/publish/offers/new?popup=true"),"_blank");n&&n.addEventListener&&n.addEventListener("message",t=>{let{data:n}=t;n&&n.coupon&&i({coupon:n.coupon,state:e,dispatch:p,schema:e.schema})},!1)}}})},c=Object.assign({title:h("Special Offer"),fields:o,language:null==t?void 0:t.language,onSubmit:t=>{let{coupon:n}=t;i({coupon:n,state:e,dispatch:m.dispatch,schema:e.schema})},onClose:()=>{m.focus()}},f);s(c)}).catch(e=>{u(v),alert(c(e))}),!1}},L=e=>{let{scrollParent:t,parentClass:n,TextField:r,openPrompt:o,publication:i}=e;return(e,l,a)=>{let{iString:s}=I18N.i({pub:i});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(e,e.schema.nodes.button))return!1;let u={parentClass:n,title:s("Create a button"),root:t?document.querySelector(".".concat(t)):a.dom.parentNode,scrollParent:t,offsetTop:10,language:null==i?void 0:i.language,fields:{text:new r({label:s("Enter text..."),required:!0,clean:e=>(e||"").trim(),validate:e=>{if(e.length>40)return s("Too long")}}),href:new r({label:s("Enter URL..."),required:!0,clean:e=>(e||"").trim(),validate:e=>{if(!/^%%.*%%$/.test(e)){try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){console.error("Failed to parse URL:",e)}return s("Invalid URL")}}})}};return u.onSubmit=t=>{let n={url:t.href,text:t.text};if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;l&&a.dispatch((0,c.o4)(e,e.schema.nodes.button.create(n)))},u.onClose=()=>{a.focus()},o(u),!0}},T=e=>{let{publication:t}=e;return(e,n)=>{let{iTemplate:r}=I18N.i({pub:t});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(e,e.schema.nodes.button))return!1;let i=t.default_group_coupon,l={url:"".concat(o.W.CHECKOUT_URL,"group=true").concat(i?"&coupon=".concat(i):""),text:(0,s.getSubscriptionSentenceWithCustomWords)(t,()=>{var e;return i&&t.default_group_coupon_percent_off?r(h(),null!==(e=t.default_group_coupon_percent_off.split(".")[0])&&void 0!==e?e:""):r(f())},e=>i&&t.default_group_coupon_percent_off?"Get ".concat(t.default_group_coupon_percent_off.split(".")[0],"% off a group ").concat(e.subscription):"Get a group ".concat(e.subscription))};return n&&n((0,c.o4)(e,e.schema.nodes.button.create(l))),!0}},I=e=>(t,n)=>{let{iTemplate:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i={url:"".concat(o.W.CHECKOUT_URL,"&gift=true"),text:(0,s.getSubscriptionSentenceWithCustomWords)(e,()=>r(v()),e=>"Give a gift ".concat(e.subscription))};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(i))),!0},A=e=>(t,n)=>{if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let r={url:o.W.CHECKOUT_URL,text:(0,s.getSubscribeText)(e,{now:!0}),language:e.language};return n&&n((0,c.o4)(t,t.schema.nodes.button.create(r))),!0},F=e=>(t,n)=>{let{iTemplate:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!t.schema.nodes.subscribeWidget)return console.error("subscribeWidget node type not found in schema"),!1;if(!t.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let i="enabled"!==e.payments_state?r(g(),e.author_name===e.name?"Thanks for reading":"Thanks for reading ".concat(e.name)):r(b(),e.author_name===e.name?"This Substack is reader-supported":"".concat(e.name," is a reader-supported publication")),l={url:o.W.CHECKOUT_URL,text:(0,s.getSubscribeText)(e),language:e.language},a=t.schema.nodes.subscribeWidget.create(l,[t.schema.nodes.ctaCaption.create(null,[t.schema.text(i)])]);return n&&n((0,c.o4)(t,a)),!0},P=e=>(t,n)=>{let{iString:r,iTemplate:i}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!t.schema.nodes.captionedShareButton)return console.error("captionedShareButton node type not found in schema"),!1;if(!t.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let l=i(y(),e.author_name===e.name?"Thanks for reading":"Thanks for reading ".concat(e.name)),a={url:o.W.SHARE_URL,text:r("Share")},s=t.schema.nodes.captionedShareButton.create(a,t.schema.nodes.ctaCaption.create(null,[t.schema.text(l)]));return n&&n((0,c.o4)(t,s)),!0},O=e=>(t,n)=>{let{tr:r}=t,{iTemplate:i,iString:l}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!t.schema.nodes.subscribeWidget)return console.error("captionedShareButton node type not found in schema"),!1;if(!t.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,d.o)(t,t.schema.nodes.button))return!1;let a=e.author_name===e.name?l("enabled"!==e.payments_state?"Thanks for reading! Subscribe for free to receive new posts and support my work.":"This Substack is reader-supported. To receive new posts and support my work, consider becoming a free or paid subscriber."):i("enabled"!==e.payments_state?_():w(),e.name),u={url:o.W.CHECKOUT_URL,text:(0,s.getSubscribeText)(e),language:e.language},c=0,p=null;return t.doc.descendants((e,t)=>{var n;return(null===(n=e.type)||void 0===n?void 0:n.name)==="paragraph"&&2==++c&&(p=t+e.nodeSize),!1}),c>=5&&null!==p&&r.insert(p,t.schema.nodes.subscribeWidget.create(u,[t.schema.nodes.ctaCaption.create(null,[t.schema.text(a)])])),r.insert(r.doc.content.size,t.schema.nodes.subscribeWidget.create(u,[t.schema.nodes.ctaCaption.create(null,[t.schema.text(a)])])),n&&n(r),!0}},57208:function(e,t,n){n.d(t,{Er:()=>o,LC:()=>l,f2:()=>i});var r=n(68303);let o=e=>!(0,r.DY)(e.doc.toJSON(),e=>"paywall"===e.type),i=e=>(t,n)=>{if(!o(t))return!1;let{schema:r,tr:i}=t,a=r.nodes.paywall.create();return 1===i.selection.anchor?l(e)(t,n):(i.insert(i.selection.anchor,a),n&&(n(i),e()),!0)},l=e=>(t,n)=>{if(!o(t))return!1;let{schema:r,tr:i}=t,l=r.nodes.paywall.create(),a=0,s=0;for(;a<10&&s<3;){let e=t.doc.resolve(a).nodeAfter;if(!e)break;a+=e.nodeSize,s++}return i.insert(a,l),n&&(n(i),e()),!0}},37175:function(e,t,n){n.r(t),n.d(t,{EMPTY_DOC:()=>tc,HEADER_IMAGE_ATTRS_FROM_NODE_TYPE:()=>td,addIdsToHeaders:()=>tP,checkForUnpublishableComments:()=>t0,checkForUnsafeLinks:()=>t1,createStringDoc:()=>t6,customMediaNodes:()=>tm,documentToHtml:()=>tF,extractTags:()=>tH,fromHtml:()=>tM,getCoverImage:()=>tJ,getCoverImages:()=>tY,getDefaultPodcastDescriptionWithoutFeedCTAs:()=>t3,getDescription:()=>tD,getDimensionsFromImageUrl:()=>tu,getFirstImageFromBody:()=>tq,getHeaderImageFromBody:()=>tX,getImageUrlsFromPostBody:()=>tV,getImagesFromBody:()=>tj,getLinks:()=>tQ,getPreviewImageUrl:()=>tG,hasExplicitPaywall:()=>t5,migrateMarkdown:()=>tU,migratePost:()=>t$,migrateProsemirrorToTiptap:()=>tC,migratePublication:()=>tz,migrateTiptapToProsemirror:()=>tB,nodeToHtml:()=>tA,normalizeDbPodcastDescriptionToHtmlString:()=>t2,purgeUnsafeLinks:()=>t4,schema:()=>tg,schemaStatic:()=>tb,serializeDoc:()=>tI,serializedToPodcastDescription:()=>tR,setBelowTheFoldAttribute:()=>t8,setButtonActions:()=>tK,tipTapNodes:()=>tZ,tipTapSchema:()=>tk,toHtml:()=>tO,toText:()=>tW,trackedCustomNodes:()=>tf,unserializeDoc:()=>tL,unserializeDocAsync:()=>tT,unserializeJson:()=>tE});var r=n(7409),o=n(99282),i=n(88897),l=n(19512),a=n(56070),s=n(18490),u=n(24717),c=n(56782),d=n(43557),p=n(99961),m=n(18e3),h=n(51127),f=n(67338),v=n(75481),g=n(55786),b=n(32018),y=n(91077),_=n(87597),w=n(94886),x=n(99218),Z=n(55963),k=n(21803),N=n(76405),S=n(39693),C=n.n(S),B=n(14293),E=n.n(B),L=n(44908),T=n.n(L),I=n(60826),A=n(24791),F=n(40121),P=n(5889),O=n(60308),W=n(84864),R=n(5835),H=n(26603),M=n(57937),U=n(55633),$=n(1451),z=n(44262),D=n(41676),J=n(82032),j=n(95068),q=n(12568),X=n(65626),V=n(37622),Y=n(36621),G=n(31188),K=n(71993),Q=n(88954),ee=n(13991),et=n(36122),en=n(72270),er=n(82167),eo=n(47456),ei=n(32978),el=n(40924),ea=n(86725),es=n(59383),eu=n(5660),ec=n(1415),ed=n(98616),ep=n(82708),em=n(73984),eh=n(11105),ef=n(10218),ev=n(98738),eg=n(81519),eb=n(59662),ey=n(75837),e_=n(29961),ew=n(24653),ex=n(80334),eZ=n(94413),ek=n(75970),eN=n(715),eS=n(87113),eC=n(98450),eB=n(87413),eE=n(69323),eL=n(61601),eT=n(57639),eI=n(54793),eA=n(29511),eF=n(49640),eP=n(99975),eO=n(41128),eW=n(23431),eR=n(73078),eH=n(85197),eM=n(53797),eU=n(99741),e$=n(3185),ez=n(18119),eD=n(44288),eJ=n(13938),ej=n(54757),eq=n(11006),eX=n(11470),eV=n(66928),eY=n(19805),eG=n(46393),eK=n(2107),eQ=n(99149),e0=n(79592),e1=n(62645),e4=n(39111),e8=n(42034),e2=n(41505),e3=n(57950),e6=n(78483),e5=n(57881),e9=n(84766),e7=n(62092),te=n(68303),tt=n(88956),tn=n(22498),tr=n(22365),to=n(60802),ti=n(45913),tl=n(12076),ta=n(34612),ts=n(32751);let tu=e=>{var t,n,r,o;let[i,l]=((null===(o=e.split("_"))||void 0===o?void 0:null===(r=o[1])||void 0===r?void 0:null===(n=r.split("."))||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.split("x"))||[0,0]).map(Number);return{width:i,height:l}},tc={type:"doc",content:[{type:"paragraph"}]},td={captionedImage:e=>{var t,n,r,o;let i=null===(t=e.content)||void 0===t?void 0:t.find(e=>{var t,n;return"image2"===e.type&&(null===(t=e.attrs)||void 0===t?void 0:t.width)>=300&&(null==e?void 0:null===(n=e.attrs)||void 0===n?void 0:n.height)>=300});if(!i)return{url:null,caption:void 0,alt:void 0};let l=null==e?void 0:null===(n=e.content)||void 0===n?void 0:n.find(e=>"caption"===e.type);return{url:null==i?void 0:null===(r=i.attrs)||void 0===r?void 0:r.src,caption:l,alt:null==i?void 0:null===(o=i.attrs)||void 0===o?void 0:o.alt}},image2:e=>{var t,n,r,o;return"number"!=typeof(null===(t=e.attrs)||void 0===t?void 0:t.width)&&"number"!=typeof(null===(n=e.attrs)||void 0===n?void 0:n.height)||e.attrs.width>=300&&e.attrs.height>=300?{url:null==e?void 0:null===(r=e.attrs)||void 0===r?void 0:r.src,alt:null==e?void 0:null===(o=e.attrs)||void 0===o?void 0:o.alt}:{url:null,caption:void 0,alt:void 0}},image3:e=>{var t,n,r,o,i;let l=tu(null===(t=e.attrs)||void 0===t?void 0:t.src);return"number"!=typeof(null===(n=e.attrs)||void 0===n?void 0:n.width)&&"number"!=typeof(null===(r=e.attrs)||void 0===r?void 0:r.height)||e.attrs.width>=300&&e.attrs.height>=300||l.width>=300&&l.height>=300?{url:null===(o=e.attrs)||void 0===o?void 0:o.src,caption:e.content,alt:null===(i=e.attrs)||void 0===i?void 0:i.alt}:{url:null,caption:void 0,alt:void 0}}},tp={image:e=>{var t;return tG(null===(t=e.attrs)||void 0===t?void 0:t.src)},image2:e=>{var t,n,r;return"number"!=typeof(null===(t=e.attrs)||void 0===t?void 0:t.width)&&"number"!=typeof(null===(n=e.attrs)||void 0===n?void 0:n.height)||e.attrs.width>=300&&e.attrs.height>=300?tG(null===(r=e.attrs)||void 0===r?void 0:r.src):null},image3:e=>{var t,n,r,o;let i=tu(null===(t=e.attrs)||void 0===t?void 0:t.src);return"number"!=typeof(null===(n=e.attrs)||void 0===n?void 0:n.width)&&"number"!=typeof(null===(r=e.attrs)||void 0===r?void 0:r.height)||e.attrs.width>=300&&e.attrs.height>=300||i.width>=300&&i.height>=300?tG(null===(o=e.attrs)||void 0===o?void 0:o.src):null},imageGallery:e=>{var t,n,r;return tG(null===(r=e.attrs)||void 0===r?void 0:null===(n=r.gallery.images)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.src)},spotify:e=>{var t;return tG(null===(t=e.attrs)||void 0===t?void 0:t.image)},spotify2:e=>{var t;return tG(null===(t=e.attrs)||void 0===t?void 0:t.image)},opensea:e=>{var t;return tG(null===(t=e.attrs)||void 0===t?void 0:t.image)},twitter2:e=>{var t,n;if(null===(t=e.attrs)||void 0===t?void 0:t.photos){for(let t of e.attrs.photos)if(t.img_url)return tG(t.img_url)}return(null===(n=e.attrs)||void 0===n?void 0:n.expanded_url)&&e.attrs.expanded_url.image?e.attrs.expanded_url.image.url?tG(e.attrs.expanded_url.image.url):tG(e.attrs.expanded_url.image):null},vimeo:e=>{var t;return ti.Jn(null===(t=e.attrs)||void 0===t?void 0:t.videoId,{playButton:!1})},youtube:e=>{var t;return ts.Jn(null===(t=e.attrs)||void 0===t?void 0:t.videoId,{playButton:!1})},youtube2:e=>{var t;return ts.Jn(null===(t=e.attrs)||void 0===t?void 0:t.videoId,{playButton:!1})},kindle:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.imageUrl)},applePodcast:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.imageUrl)},tiktok:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.thumbnail_url)},prediction_market:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.thumbnail_url)},manifold:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.thumbnail_url)},lichess:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.thumbnail_url)},datawrapper:e=>{var t;return(0,O.zF4)(null===(t=e.attrs)||void 0===t?void 0:t.thumbnail_url)}},tm={augmentation_placeholder:$.$,youtube2:ts.$y,youtube:ta.$,vimeo:ti.$y,install_substack_app:eF.$,preview_in_substack_app:ej.$,opensea:eM.$y,twitter2:e9.$y,twitter:e5.$,communityChat:Q.$y,communityPost:ee.$y,comment:K.$y,spotify2:e0.$y,spotify:eQ.$,soundcloud:eG.$y,instagram:eA.$y,image2:eT.$y,image:eE.$,button:j.$y,comic:G.Z.nodeSpec,file:G.Z.nodeSpec,pdf:e$.Z.nodeSpec,xlsx:tl.Z.nodeSpec,ebook:ei.Z.nodeSpec,referral_link:eV.$,bandcamp:z.$y,kindle:eP.$y,gitgist:eB.$y,embeddedPost:el.$y,embeddedPublication:ea.$y,applePodcast:R.$y,audio:M.$y,video:to.$,audioUrl:U.$y,tiktok:e6.$y,bluesky:J.$y,poll:ez.$,sponsorshipCampaign:eK.$,imageGallery:eL.$y,image3:eI.$y,cashtag:Y.$,substack_mentions:eH.$,prediction_market:eD.$y,manifold:eD.$y,lichess:eW.$y,datawrapper:en.$y,digestPostEmbed:er.$y,assetError:H.$,directMessage:eo.$y,recipe:eX.$},th=(0,o._)((0,r._)({},tm),{blockquote:D.$,fragmentNode:eC.$,captionedImage:V.$,caption:q.$,ctaCaption:et.$,footnote:eN.$,footnoteAnchor:eS.$,latex_block:eO.$y,paywall:eU.$,preformatted_text_block:eJ.$,pullquote:eq.$,subscribeWidget:e4.$,captionedShareButton:(0,X.$y)({url:I.W.SHARE_URL}),captionedWriterReferralButton:(0,X.$y)({hasDynamicSubstitutions:!1}),templateComment:e3.$,meeting:eR.$,referralTier:eY.$y}),tf=(0,o._)((0,r._)({},tm),{subscribeWidget:e4.$,paywall:eU.$,templateComment:e3.$}),tv={strikethrough:e1.J,superscript:e2.O,subscript:e8.l},tg=new N.V_({nodes:tN(),marks:tS()}),tb=new N.V_({nodes:tN({isStatic:!0}),marks:tS({isStatic:!0})}),ty=Object.keys(th).filter(e=>!["blockquote","pullquote"].includes(e)).map(e=>{let t=(0,te.Co)(e,th[e]),n=(0,r._)({},th[e],t);return"youtube2"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new ts.dQ(t)}:"tiktok"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new e6.QZ(t)}:"lichess"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eW.$1(t)}:"datawrapper"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new en.s3(t)}:"prediction_market"===e||"manifold"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eD.eC(t)}:"paywall"===e?n.addNodeView=()=>e=>new eU.b:"latex_block"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eO.Jd(t)}:"comic"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return G.Z.getNodeView({node:t,editor:n,getPos:r})}:"pdf"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return e$.Z.getNodeView({node:t,editor:n,getPos:r})}:"xlsx"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return tl.Z.getNodeView({node:t,editor:n,getPos:r})}:"ebook"===e&&(n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return ei.Z.getNodeView({node:t,editor:n,getPos:r})}),i.NB.create(n)}),t_=l.V6.extend({addCommands(){return{toggleBlockquote:()=>e=>{let{state:t,commands:n}=e;return!(!(0,i.Ig)(t,"paragraph")||(0,i.Ig)(t,"pullquote"))&&n.toggleWrap(this.name)}}},parseHTML:()=>D.$.parseDOM}),tw=f.b.extend({addCommands:()=>({insertHorizontalRule:()=>e=>{let{state:t,dispatch:n}=e;return n&&t.schema.nodes.horizontalRule&&n((0,te.o4)(t,t.schema.nodes.horizontalRule.create())),!0},setHorizontalRule:()=>e=>{let{state:t,dispatch:n}=e;return n&&n((0,te.o4)(t,t.schema.nodes.horizontalRule.create())),!0}})}),tx=c.dn.extend({marks:"_"}),tZ=[t_,a.d8,s.DY,eu.z,u.EK,tx,ed.l,d.B,em.w,p.U,m.X,h.A,tw,es.M,ek.f,ef._,eg.r,ey.q,ex.a,e_.R,eh.y,v.Tx,ev.d,g.H,b.GS,y.n,eb.f,eq.z,_.Re,w.a,x.$,Z.x,ec.n,eZ.T,ep.k,eo.e1,...ty],tk=(0,i.J1)(tZ);function tN(){let{isStatic:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=k.fK.spec.nodes;for(let n of Object.keys(th)){let r=Object.assign({},th[n]);e&&r.toDOMStatic&&(r.toDOM=r.toDOMStatic),delete r.toDOMStatic,t=t.get(n)?t.update(n,r):t.addToEnd(n,r)}return t}function tS(){let{isStatic:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=k.fK.spec.marks;for(let n of Object.keys(tv)){let r=Object.assign({},tv[n]);e&&r.toDOMStatic&&(r.toDOM=r.toDOMStatic),delete r.toDOMStatic,t=t.get(n)?t.update(n,r):t.addToEnd(n,r)}return t}function tC(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return"string"==typeof r&&(r=tE(r,{postId:t,pubId:n})),(0,te.cb)(r,e=>{let t=te.qj.find(t=>t[0]===e.type);return t&&(e.type=t[1],e.attrs&&"orderedList"===t[1]&&(e.attrs.start=e.attrs.order)),e.marks&&e.marks.forEach(e=>{let t=te.PH.find(t=>t[0]===e.type);t&&(e.type=t[1])}),e}),r}function tB(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return"string"==typeof r&&(r=tE(r,{postId:t,pubId:n})),(0,te.cb)(r,e=>{let t=te.qj.find(t=>t[1]===e.type);return t&&(e.type=t[0],e.attrs&&"ordered_list"===t[0]&&(e.attrs.order=e.attrs.start)),e.marks&&e.marks.forEach(e=>{let t=te.PH.find(t=>t[1]===e.type);t&&(e.type=t[0])}),e}),r}function tE(e){let t,{postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&(e=(e=e.replace("http://substack-post-media","https://substack-post-media")).replace("http://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984","https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984")),e=tU(e))try{t=JSON.parse(e)}catch(t){console.error("unserializeJson for post [".concat(n,"], pubId [").concat(r,"], could not parse serialized:"),e,t)}return null!=t?t:void 0}function tL(e){let{customSchema:t,useTiptap:n,mutateJson:r,shouldSetBelowTheFoldAttribute:o=!1,shouldThrowOnInvalid:i,postId:l,pubId:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let i=tE(e,{postId:l,pubId:a})||tc;r&&r(i);let s=t4(i);if(!s)throw Error("could not purgeUnsafeLinks");let u=s;return o&&(u=t8(u)),u=n?tC(u,{postId:l,pubId:a}):tB(u,{postId:l,pubId:a}),(t||tg).nodeFromJSON(u)}catch(n){if(console.error("Failed to parse JSON for post [".concat(l,"], serialized:"),e,n),i)throw Error("Failed to parse JSON:  ".concat(n.message));return(t||tg).nodeFromJSON(tc)}}async function tT(e){let{customSchema:t,useTiptap:n,mutateJson:r,shouldSetBelowTheFoldAttribute:o=!1,shouldThrowOnInvalid:i,postId:l,pubId:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let i=tE(e,{postId:l,pubId:a})||tc;r&&await r(i);let s=t4(i);if(!s)throw Error("could not purgeUnsafeLinks");let u=s;return o&&(u=t8(u)),u=n?tC(u,{postId:l,pubId:a}):tB(u,{postId:l,pubId:a}),(t||tg).nodeFromJSON(u)}catch(n){if(console.error("Failed to parse JSON for post [".concat(l,"], serialized:"),e,n),i)throw Error("Failed to parse JSON:  ".concat(n.message));return(t||tg).nodeFromJSON(tc)}}function tI(e){let{runMigrations:t=!1,postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.toJSON();return t&&(o=tB(o=t4(o=function(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="string"==typeof e?tE(e,{postId:t}):e;return(0,te.cb)(n,e=>{e.text&&(e.text=(0,W.stripInvalidBytes)(e.text))},{nodeTypes:["text"]}),n}(o)),{postId:n,pubId:r})),JSON.stringify(o)}function tA(e,t){let n=document.createElement("div");return n.appendChild(N.PW.fromSchema(t?tb:tg).serializeFragment([e],{document})),n}function tF(e){return N.PW.renderSpec(document,e).dom.outerHTML}function tP(e){Array.from(e.querySelectorAll("h2, h3, h4, h5, h6")).forEach(e=>{if(!e.getAttribute("id")){var t,n;let r=(n=e.textContent||"",(0,F.Hm)((0,W.truncateText)(n,500,{ellipsis:""}),{allowUnicode:!0})),o=document.createElement("div");o.setAttribute("id",r),o.setAttribute("class","anchor-target"),null===(t=e.parentNode)||void 0===t||t.insertBefore(o,e);let i=document.createElement("a");for(i.setAttribute("href","#".concat(r));e.firstChild;)i.appendChild(e.firstChild);e.appendChild(i)}})}function tO(e,t){let{isAmp:n,transform:r,useTipTap:o,pubId:i,postId:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o){let n=tC(tE(e,{postId:l,pubId:i}),{postId:l,pubId:i});if(!n)throw Error("could not serialize json doc");return(0,tr.e)({doc:n,extensions:(0,ew.p)({isStatic:null!=t&&t}),customDocument:document})}let a=tL(e,{shouldSetBelowTheFoldAttribute:!0,postId:l,pubId:i}),s=N.PW.fromSchema(t?tb:tg),u=document.createElement("div");try{s.serializeFragment(a.content,{document},u)}catch(e){return console.error("could not serialize fragment, for pubId [".concat(i,"], postId [").concat(l,"]"),e),u.innerHTML}return r&&r(u),n&&function(e){Array.from(e.querySelectorAll("img")).forEach(e=>{let t=document.createElement("amp-img");t.setAttribute("layout","intrinsic"),e.getAttributeNames().forEach(n=>{"srcset"!==n&&t.setAttribute(n,e.getAttribute(n))}),e.replaceWith(t)})}(u),u.innerHTML}function tW(e,t){let{postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,te.lr)(tL(e,{postId:n}),t)}function tR(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,te.fX)(tL(e,{postId:t}))}function tH(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,te.E5)(tL(e,{postId:t}))}function tM(e){let{stripEmptyParagraphs:t,postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=N.aw.fromSchema(tg).parse(new DOMParser().parseFromString(e,"text/html"));return(t&&(o=(0,tt.Y)(o,e=>!e.type||"paragraph"!==e.type.name||!!(0,te.lr)(e))),o)?tI(o,{postId:n,pubId:r}):null}function tU(e){return e&&"{"!==e[0]&&"null"!==e?tI(k.EU.parse(e)):e}function t$(e){var t,n;return e.body=null!==(t=tU(e.body))&&void 0!==t?t:null,e.draft_body=null!==(n=tU(e.draft_body))&&void 0!==n?n:null,e}function tz(e){var t,n,r,o,i;return e.subscribe_content=null!==(t=tU(e.subscribe_content))&&void 0!==t?t:null,e.welcome_email_content=null!==(n=tU(e.welcome_email_content))&&void 0!==n?n:null,e.tos_content=null!==(r=tU(e.tos_content))&&void 0!==r?r:null,e.privacy_content=null!==(o=tU(e.privacy_content))&&void 0!==o?o:null,e.disclosures_content=null!==(i=tU(e.disclosures_content))&&void 0!==i?i:null,e}function tD(e,t){let{post:n=null,pubId:r,minCharacters:o=6,maxStopAfter:i=null,singleSentence:l=!0,language:a="en",excludeMediaPrefix:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:u}=I18N.i(a),c=(null==n?void 0:n.type)==="thread"?145:250;(i||0===i)&&(c=Math.min(i,c));let d=(null==n?void 0:n.type)==="thread",p="";if(t)p+=t;else if(0!==c){var m;let t={paragraph:!0,blockquote:!0,list_item:!0,listItem:!0,heading:!0,code_block:!0,codeBlock:!0,hardbreak:!0,hard_break:!0,hardBreak:!0},i={caption:!0,footnote:!0};(0,te.cb)("string"==typeof e?tE(e,{postId:null!==(m=null==n?void 0:n.id)&&void 0!==m?m:null,pubId:r}):e,e=>{if(c&&p.length>=c||e.type&&i[e.type])return!1;if("text"===e.type){let{text:t}=e;if(t){let e=t.match(/[\.\?\!] /);if(l&&(null==e?void 0:e.index))return p+=t.slice(0,e.index+1),tn.aT;p+=t}}else if(e.type&&t[e.type]&&p){if(p.length>o)return tn.aT;" "!==p[p.length-1]&&(p+=" ")}else if("substack_mentions"===e.type){var n,r;p+=null!==(r=null===(n=e.attrs)||void 0===n?void 0:n.name)&&void 0!==r?r:""}})}if(p=p.replace(/\s+/g," ").trim(),d&&c&&p.length>=c&&(p=(0,W.truncateText)(p,c)),((null==n?void 0:n.type)==="podcast"||(null==n?void 0:n.type)==="video")&&!s){let e=(0,A.XV)(n);p="".concat(u((null==n?void 0:n.type)==="video"||(null==n?void 0:n.videoUpload)?"Watch now":"Listen now")," ").concat(e?"(".concat((0,W.secondsToLargestUnit)(e,{minutesCutoff:10800,language:a}),") "):"","| ").concat(p)}return p}function tJ(e,t){var n;return null!==(n=tY(e,t)[0])&&void 0!==n?n:null}function tj(e){let{postId:t,pubId:n,width:r,height:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=tE(e,{postId:t,pubId:n});return i?T()(C()((0,te.fp)(i,e=>{var t;return!!tp[null!==(t=e.type)&&void 0!==t?t:""]}).map(e=>{var t,n;let i=null===(t=tp[null!==(n=e.type)&&void 0!==n?n:""])||void 0===t?void 0:t.call(tp,e);return i?(0,O.zF4)(i,r,{height:o}):null}))):[]}function tq(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=tj(e,{postId:t,pubId:n});return r.length>0&&!E()(r[0])?r[0]:null}function tX(e){let{body:t}=e,n=tE(t);if(n)return(0,te.fp)(n,e=>{var t;return!!td[null!==(t=e.type)&&void 0!==t?t:""]}).map(e=>{var t,n;return null===(t=td[null!==(n=e.type)&&void 0!==n?n:""])||void 0===t?void 0:t.call(td,e)})[0]}async function tV(e){let{body:t,postId:n}=e,r=tL(t,{postId:n}),o=[];return(0,te.je)(r,e=>{switch(e.type.name){case"image":case"image2":e.attrs.src&&o.push(e.attrs.src);break;case"imageGallery":var t;null===(t=e.attrs.gallery.images)||void 0===t||t.map(e=>{e.src&&o.push(e.src)})}}),o}function tY(e,t){var n;let r=[];"podcast_episode_image_info"in t&&t.podcast_episode_image_info&&!t.podcast_episode_image_info.isDefaultArt&&r.unshift(t.podcast_episode_image_info.url),r.unshift(...tj(e,{postId:t.id}));let o="podcastUpload"in t&&t.podcastUpload||"draftPodcastUpload"in t&&t.draftPodcastUpload||void 0;if((null==o?void 0:o.state)==="transcoded"&&(null!==(n=null==o?void 0:o.thumbnail_id)&&void 0!==n?n:1)>1){let e=(0,O.ow1)(o);e&&r.unshift(e)}let i="videoUpload"in t&&t.videoUpload||"draftVideoUpload"in t&&t.draftVideoUpload||void 0;if((null==i?void 0:i.state)==="transcoded"){let e=(0,O.ow1)(i);e&&r.unshift(e)}return"podcast_art_url"in t&&t.podcast_art_url&&r.unshift(t.podcast_art_url),r}function tG(e){return"string"!=typeof e?null:(e=e.replace(/\/l_twitter_play_button_rvaygk[^\/]+/g,""),(0,O.zF4)(e,void 0,{height:600}))}function tK(e){(0,te.cb)(e,e=>{var t;return"button"===e.type&&((null===(t=e.attrs)||void 0===t?void 0:t.url)&&"string"==typeof e.attrs.url&&e.attrs.url.startsWith("%%")&&(e.attrs.action=e.attrs.url.replace(/%%/g,"")),!0)},{nodeTypes:"button"})}function tQ(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("string"==typeof n){let e=tE(n,{postId:t});if(!e)return[];n=e}tK(n);let r=[];return(0,te.cb)(n,e=>{var t,n,o;if("button"===e.type&&(null===(t=e.attrs)||void 0===t?void 0:t.url)&&!e.attrs.action)r.push({text:e.attrs.text,url:e.attrs.url});else if("image2"===e.type&&(null===(n=e.attrs)||void 0===n?void 0:n.href))r.push({text:e.attrs.href,url:e.attrs.href});else if(e.marks){for(let t of e.marks)if("link"===t.type&&(null===(o=t.attrs)||void 0===o?void 0:o.href)){r.push({text:e.text,url:t.attrs.href});break}}}),r}function t0(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof n){let e=tE(n,{postId:t});if(!e)return!1;n=e}return!!(0,te.DY)(n,e=>"templateComment"===e.type)}function t1(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof n){let e=tE(n,{postId:t});if(!e)return!1;n=e}return!!(0,te.DY)(n,e=>{for(let a of["href","src","url"]){var t,n,r,o,i,l;if((null==e?void 0:null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:"))||(null==e?void 0:null===(l=e.marks)||void 0===l?void 0:l.find(e=>{var t,n,r,o,i;return null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:")})))return!0}return!1})}function t4(e){let t,{postId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let r=tE(e,{postId:n});if(!r)return null;t=r}else t=e;return(0,e7.f5)(t)?(0,tt.Y)(t,e=>{for(let a of["href","src","url"]){var t,n,r,o,i,l;if((null==e?void 0:null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:"))||(null==e?void 0:null===(l=e.marks)||void 0===l?void 0:l.find(e=>{var t,n,r,o,i;return null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:")})))return!1}return!0}):(0,tt.Y)(t,e=>{for(let a of["href","src","url"]){var t,n,r,o,i,l;if((null==e?void 0:null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:"))||(null==e?void 0:null===(l=e.marks)||void 0===l?void 0:l.find(e=>{var t,n,r,o,i;return null===(o=e.attrs)||void 0===o?void 0:null===(r=o[a])||void 0===r?void 0:null===(n=r.trim)||void 0===n?void 0:null===(t=(i=n.call(r)).toLowerCase)||void 0===t?void 0:t.call(i).startsWith("javascript:")})))return!1}return!0})}function t8(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,{postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="string"==typeof e?tE(e,{postId:n}):e;if(!r)return;let o=!1;return"doc"===r.type&&r.content&&r.content.map((e,n)=>{n>t?(0,te.cb)(e,e=>{!e.content&&e.attrs&&(e.attrs.belowTheFold=!0)}):o||(0,te.cb)(e,e=>{!e.content&&(null==e?void 0:e.type)=="image2"&&e.attrs&&(e.attrs.topImage=!0,o=!0)})}),r}function t2(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return JSON.parse(e),tR(e,{postId:t})}catch(t){return e}}function t3(e,t){let{body:n,hasPodcastPreview:r}=t;if(!e||!n)return null;let o=n;return r&&(o=JSON.stringify((0,te.N5)(tE(n,{postId:e.id}),{maxLength:e.post_preview_limit?e.post_preview_limit:356}))),tR(o,{postId:e.id})}function t6(e){return tI(tg.node("doc",null,e.split("\n").map(e=>e.trim()).filter(e=>e.length>0).map(e=>{let t=[],n=(0,P.m)(e);if(n.length>0){let r=e;for(;;){let e=n.map(e=>[r.indexOf(e.value),e.value]).sort().find(e=>{let[t]=e;return t>=0});if(!e)break;let[o,i]=e;o>0&&t.push(tg.text(r.substring(0,o))),t.push(tg.text(i,[tg.marks.link.create({title:i,href:i,target:"_blank"})])),r=r.substring(o+i.length)}r&&t.push(tg.text(r))}else t.push(tg.text(e));return tg.node("paragraph",null,t)})))}function t5(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof e){let r=tE(e,{postId:t});if(!r)return!1;n=r}else n=e;return(0,te.C4)(n)}Object.entries(tk.nodes).forEach(e=>{let[t,n]=e;void 0!==th[t]&&(n.spec=(0,r._)({},th[t],n.spec))})},68303:function(e,t,n){n.d(t,{$9:()=>et,$_:()=>J,$y:()=>D,C4:()=>eo,Co:()=>A,DY:()=>Z,Dc:()=>K,Dg:()=>F,E5:()=>k,Hs:()=>er,I_:()=>V,N5:()=>w,PH:()=>y,S7:()=>O,Wi:()=>$,cb:()=>g.cb,do:()=>M,fX:()=>L,fp:()=>x,gR:()=>R,hL:()=>q,je:()=>g.je,k:()=>P,lr:()=>T,o4:()=>en,qe:()=>W,qj:()=>b});var r=n(7409),o=n(99282);if(4716==n.j)var i=n(76405);var l=n(92007),a=n(39693),s=n.n(a),u=n(14293),c=n.n(u),d=n(10691),p=n.n(d),m=n(19834),h=n(36186),f=n(84864),v=n(88956),g=n(22498);let b=[["list_item","listItem"],["bullet_list","bulletList"],["ordered_list","orderedList"],["hard_break","hardBreak"],["horizontal_rule","horizontalRule"],["code_block","codeBlock"]],y=[["em","italic"],["strong","bold"],["strikethrough","strike"]],_={image2:1,image:0,horizontal_rule:0,audio:0,video:0,youtube:0,youtube2:0,vimeo:0,opensea:0,twitter:0,twitter2:0,spotify:0,spotify2:0,soundcloud:0,bandcamp:0,kindle:0,tiktok:0,prediction_market:0,lichess:0,datawrapper:0,recipe:0},w=function(e){let{maxLength:t=356,getAfterCutoff:n=!1,withEllipsis:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o="",i=!1,l={},a=eo(e),s=!1,u=(0,v.Y)(e,e=>{var r;if(i)return n;if("paywall"===e.type)return i=!0,!1;if(a)return!0;let u=null!==(r=e.type)&&void 0!==r?r:"undefined";if(l[u]=(l[u]||0)+1,e.type&&e.type in _&&l[u]>_[e.type])return i=!0,n;let c=t-o.length;if(c<=0&&!a||!(c>0))return n;if(n){if("text"===e.type&&e.text){if(!(t-(o+=e.text).length<=0))return!1;e.text=e.text.substring(e.text.length+t-o.length-1,e.text.length)}}else if("text"===e.type&&e.text){o+=e.text;let t=e.text;e.text=(0,f.truncateText)(t,c),s=t!==e.text}return!0});if(u&&r&&!s){let e=function(e){let t=[],n=[e];for(;n.length;){var r;let e=n.pop();if(!e)break;if(e.content&&(null===(r=e.content)||void 0===r?void 0:r.length)>0)for(let t=e.content.length-1;t>=0;t--){let r=e.content[t];r&&n.push(r)}else t.push(e)}return t}(u),t=null,n=null;for(let r=e.length-1;r>=0&&(!t||!n);r--){let o=e[r];null===t&&(null==o?void 0:o.type)==="text"&&(t=r),null===n&&(null==o?void 0:o.type)!=="text"&&(null==o?void 0:o.type)!=="paragraph"&&(n=r)}let r=null!==t?e[t]:null,o=r&&null!==n&&null!==t&&n>t;r&&!o&&(r.text=I(r.text))}return u},x=(e,t)=>{let n=[];if(e&&(t(e)&&n.push(e),e.content))for(let r of e.content)n=n.concat(x(r,t));return n},Z=(e,t)=>{if(e){if(t(e))return e;if(e.content)for(let n of e.content){let e=Z(n,t);if(e)return e}}return null},k=e=>{let t=[];return e.nodesBetween(0,e.content.size,e=>{var n;(null===(n=e.type)||void 0===n?void 0:n.name)==="cashtag"&&t.push(e.attrs.symbol)},0),t},N=new Set(["caption","footnote","captionedImage","image","image2"]),S=new Set(["bullet_list","bulletList","ordered_list","orderedList","blockquote"]),C="x_li_start_placeholder_x",B=(e,t)=>{var n,r,o,i;if((null===(n=e.type)||void 0===n?void 0:n.name)==="list_item"||(null===(r=e.type)||void 0===r?void 0:r.name)==="listItem")return{open:C,close:""};if((null===(o=e.type)||void 0===o?void 0:o.name)==="paragraph"||e.isBlock&&e.textContent.length>0&&!S.has(null===(i=e.type)||void 0===i?void 0:i.name)){let e="<p>";return(t.length>0?t[t.length-1]:null)===C&&(t.pop(),e+="* "),{open:e,close:"</p>"}}return null},E=e=>{var t,n,r;let{node:o,recursiveDepth:i,tokens:l}=e;if(i>100)return console.warn("Reached max recursive depth while converting document to HTML for podcast"),!1;let a=!0;if(N.has(null===(t=o.type)||void 0===t?void 0:t.name))a=!1;else if(o.isText){if(o.text&&o.text.length>0){let e=o.marks.find(e=>"link"===e.type.name&&e.attrs.href),t=o.marks.find(e=>"em"===e.type.name),n=o.marks.find(e=>"strong"===e.type.name),r=o.text;t&&(r="<em>".concat(r,"</em>")),n&&(r="<strong>".concat(r,"</strong>")),e&&(r='<a target="_blank" href="'.concat((0,m.Z)(e.attrs.href),'">').concat(r,"</a>")),l.push(r)}}else if(B(o,[])){let e=B(o,l);e&&l.push(e.open),o.descendants(e=>E({node:e,recursiveDepth:i+1,tokens:l})),e&&l.push(e.close),a=!1}else if((null===(n=o.type)||void 0===n?void 0:n.name)==="cashtag")l.push("".concat(o.attrs.symbol," "));else if((null===(r=o.type)||void 0===r?void 0:r.name)==="substack_mentions"){let e=o.marks.find(e=>"em"===e.type.name),t=o.marks.find(e=>"strong"===e.type.name),n=o.attrs.name;if(e&&(n="<em>".concat(n,"</em>")),t&&(n="<strong>".concat(n,"</strong>")),"user"===o.attrs.type){let e=(0,h.GR)(o.attrs.id,o.attrs.name);l.push('<a target="_blank" href="'.concat(e,'">').concat(n,"</a>"))}else if("pub"===o.attrs.type){let e=o.attrs.url;l.push('<a target="_blank" href="'.concat(e,'">').concat(n,"</a>"))}}return a},L=e=>{let t=[];return e.descendants(e=>E({node:e,recursiveDepth:1,tokens:t})),t.filter(e=>e!==C).join("").trim()},T=function(e){let{withLinks:t=!0,withCaptionsAndFootnotes:n=!1,forPodcast:r=!1,truncateAt:o=null,truncateTo:i=o,truncateEllipsis:l="…",truncateExtension:a=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="",u="",d="",p=!0;return e.nodesBetween(0,e.content.size,e=>{var o,h,v,g;if(!n&&["caption","footnote"].includes(null===(o=e.type)||void 0===o?void 0:o.name))return!1;if(e.isText){if(e.text&&e.text.length>0){let n;p=!1,!c()(i)&&s.length<i&&s.length+e.text.length>=i&&(n=(0,f.truncateText)(e.text,i-s.length,{ellipsis:l,extension:a}));let o=e.marks.filter(e=>"link"===e.type.name&&e.attrs.href)[0],h=e.marks.filter(e=>"em"===e.type.name)[0],v=e.marks.filter(e=>"strong"===e.type.name)[0],g=e.text;s+=g,h&&r&&(n&&(n="<em>".concat(n,"</em>")),g="<em>".concat(g,"</em>")),v&&r&&(n&&(n="<strong>".concat(n,"</strong>")),g="<strong>".concat(g,"</strong>")),o&&t?r?(n&&(d="".concat(u,'<a target="_blank" href="').concat((0,m.Z)(o.attrs.href),'">').concat(n,"</a>")),u+='<a target="_blank" href="'.concat((0,m.Z)(o.attrs.href),'">').concat(g,"</a>")):(n&&(d="".concat(u).concat(n," [ ").concat(o.attrs.href," ]")),u+="".concat(g," [ ").concat(o.attrs.href," ]")):(n&&(d=u+n),u+=g)}}else!p&&["hard_break","hardBreak"].includes(null===(h=e.type)||void 0===h?void 0:h.name)?(p=!0,s+="\n",r?u+="<br/>":u+="\n"):!p&&e.isBlock?(p=!0,s+="\n",r?u+="<br/><br/>":u+="\n"):(null===(v=e.type)||void 0===v?void 0:v.name)==="cashtag"?u+="".concat(e.attrs.symbol," "):(null===(g=e.type)||void 0===g?void 0:g.name)==="substack_mentions"&&(u+="".concat(e.attrs.name," "))},0),!c()(o)&&s.length>o&&d&&(u=d),u=u.trim(),r&&(u=u.replace(/\s*(<br\/>)+$/,"").trim()),u},I=e=>"".concat(p()(e,"."),"..."),A=(e,t)=>(0,o._)((0,r._)({name:e},t),{addAttributes:()=>t.attrs||{},parseHTML:()=>t.parseDOM,renderHTML(n){let{node:r}=n;return t.toDOM?t.toDOM(r):(console.warn("trying to create TipTapNode, no toDOM found for node",e),["span"])}}),F=(e,t)=>{let n,r,o;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,i)=>{if(n||r)return!1;let l=e.marks.find(e=>e.type===t);l&&(n=e,r=l,o={from:i,to:i+e.nodeSize})}),n)return{node:n,mark:r,pos:o}},P=(e,t)=>{let n,r,o;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(i,l)=>{if(n||r||!(l<=e.selection.from)||!(e.selection.to<=l+i.nodeSize))return!1;{let e=i.marks.find(e=>e.type===t);e&&(n=i,r=e,o={from:l,to:l+i.nodeSize})}}),!n){if(e.selection.empty){let a=e.doc.resolve(e.selection.from),s=a.nodeBefore&&a.nodeBefore.marks.find(e=>e.type===t),u=a.nodeAfter&&a.nodeAfter.marks.find(e=>e.type===t);if(s||u){var i,l;n=u?a.nodeAfter:a.nodeBefore,r=u||s,o=u?{from:a.pos,to:a.pos+a.nodeAfter.nodeSize}:{from:a.pos-(null!==(l=null===(i=a.nodeBefore)||void 0===i?void 0:i.nodeSize)&&void 0!==l?l:0),to:a.pos}}}if(!n)return}return{node:n,mark:r,pos:o}},O=function(e){let{allowedMarks:t=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!e.selection.empty||W(e,e.selection.from,e.selection.to,{allowedMarks:t})},W=function(e,t,n){let{allowedMarks:r=[]}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=!0,i=!1;return e.doc.nodesBetween(t,n,t=>{if(!o)return!1;t.type!==e.schema.nodes.text?i?o=!1:i=!0:t.marks.find(e=>!r.includes(e.type))&&(o=!1)}),o},R=(e,t)=>{if(e.selection.empty)return!1;let n=Array.isArray(t)?t:[t];if("node"in e.selection){var r;let t=e.selection;return n.includes(null===(r=t.node)||void 0===r?void 0:r.type)}return H(e,e.selection.from,e.selection.to,n)},H=(e,t,n,r)=>{let o=null;return e.doc.nodesBetween(t,n,e=>{if(!(!1!==o&&r.includes(e.type)))return o=!1,!1;o=!0}),o||!1},M=e=>e.selection.empty?null:U(e,e.selection.from,e.selection.to),U=(e,t,n)=>{let r=null;return e.doc.nodesBetween(t,n,t=>!r&&(t.type===e.schema.nodes.image2?(r=t.attrs.href,!1):void(t.type===e.schema.nodes.image3&&(r=t.attrs.href)))),r||null},$=(e,t,n)=>{e.selection.empty||z(e,t,e.selection.from,e.selection.to,n)},z=(e,t,n,r,o)=>{e.doc.nodesBetween(n,r,(n,r)=>{(n.type===e.schema.nodes.image2||n.type===e.schema.nodes.image3)&&t.setNodeMarkup(r,n.type,Object.assign({},n.attrs,{href:o}),n.marks)})},D=e=>({top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}),J=(e,t,n,r)=>{let o=document.body,i=window.innerWidth<=481,l=j(e,t.from,t.to,t=>[e.state.schema.nodes.image,e.state.schema.nodes.image2].includes(t.type))?-44:8,a=D(e.coordsAtPos(t.from)),s=D(e.coordsAtPos(t.to));n.style.position="fixed";let u=s.bottom+(i?o.scrollTop:0),c=o.clientHeight-n.clientHeight-96-l;a.top<s.top?(r&&(r.style.left="10px"),n.style.right="",n.style.left="".concat(Math.min(a.left,s.left),"px")):o.clientWidth-a.left>n.clientWidth?(r&&(r.style.left="10px"),n.style.right="",n.style.left="".concat(a.left,"px")):(r&&(r.style.left="".concat(a.left-o.clientWidth+n.clientWidth,"px")),n.style.right="10px",n.style.left=""),i||u<c?(r&&(r.style.top="-9px",r.style.bottom="auto",r.style.transform=""),n.style.top="".concat(u+l,"px")):(r&&(r.style.top="auto",r.style.bottom="-9px",r.style.transform="rotate(180deg)"),n.style.top="".concat(c+l,"px"))},j=(e,t,n,r)=>{let o=!1;return e.state.doc.nodesBetween(t,n,e=>{if(o)return!1;o=r(e)}),o},q=async(e,t)=>i.p2.maxOpen(await X(e.content,t)),X=async(e,t,n)=>{let r=[];for(let o=0;o<e.childCount;o++){let i=e.child(o);i.content.childCount&&(i=i.copy(await X(i.content,t,i))),Array.isArray(i=await t(i,o,n))||(i=[i]),r=r.concat(s()(i))}return r=(r=(r=await Promise.all(r)).map(e=>{if(!(null==e?void 0:e.content.childCount))return[e];let t=[],n=[];for(let r=0;r<e.content.childCount;r++){let o=e.content.child(r);Q(e,o)?n.push(o):(t.push(e.copy(i.HY.fromArray(n))),n=[],t.push(o))}return n.length&&t.push(e.copy(i.HY.fromArray(n))),t}).reduce((e,t)=>e.concat(t),[])).filter(e=>e&&!("text"===e.type.name&&!e.text)&&!("paragraph"===e.type.name&&!e.content.childCount)),i.HY.fromArray(r)},V=(e,t,n)=>i.p2.maxOpen(Y(e.content,t,n)),Y=(e,t,n)=>{let r;n=n||(e=>e);let o=[];for(let i=0;i<e.childCount;i++){let l=e.child(i);if(t(l))(r=r||[]).push(l);else{if(r){let[e,...t]=n(r);o.push(G(e,...t)),r=null}l.content.childCount&&(l=l.copy(Y(l.content,t,n))),o.push(l)}}if(r){let[e,...t]=n(r);o.push(G(e,...t)),r=null}return i.HY.fromArray(o)},G=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let o=e.content;for(let e of n)o=o.append(e.content);return e.copy(o)},K=e=>{let t;if(!e)return!0;if("string"==typeof e)try{t=JSON.parse(e)}catch(t){return console.error("Could not parse doc",e),!1}else t=e;if(!t||"doc"!==t.type||!Array.isArray(t.content))return console.error("Could not parse doc",t),!1;for(let e of t.content){if(!e||"object"!=typeof e)return console.error("Could not parse doc",t),!1;if("paragraph"!==e.type)return!1;if(e.content){if(!Array.isArray(e.content))return console.error("Could not parse doc",t),!1;if("text"!==e.type||e.text&&e.text.trim())return!1}}return!0},Q=(e,t)=>{let n=["list_item","listItem"].includes(e.type.name),r=["bullet_list","bulletList","ordered_list","orderedList"].includes(t.type.name);return!!n&&!!r||!!e.type.contentMatch&&!!e.type.contentMatch.matchType(t.type)},ee=e=>e.doc.resolve(e.selection.from).node(1),et=(e,t)=>{var n;return t.includes(null===(n=ee(e))||void 0===n?void 0:n.type)},en=(e,t)=>{var n,r,o;let i=e.tr,a=i.selection instanceof l.Bs,s=a&&(null===(o=i.selection.$from)||void 0===o?void 0:null===(r=o.parent)||void 0===r?void 0:null===(n=r.content)||void 0===n?void 0:n.size)===0?e.selection.to-1:e.selection.to;if(Array.isArray(t))for(let e of t.slice().reverse())i.insert(s,e);else i.insert(s,t);return a||i.setSelection(l.qv.near(i.doc.resolve(s))),i},er=(e,t)=>{let n=e.tr;return n.replaceSelectionWith(t),n},eo=e=>!!Z(e,e=>"paywall"===e.type)}}]);