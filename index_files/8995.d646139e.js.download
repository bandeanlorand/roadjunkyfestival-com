"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8995"],{45985:function(e,t,n){n.d(t,{Z:()=>o});let o={badge:"badge-YORDXJ",dotContainer:"dotContainer-WBRxHF",dot:"dot-uGm5KZ"}},21694:function(e,t,n){n.d(t,{Z:()=>o});let o={root:"root-LeqPP3",badge:"badge-WYVub3",circle:"circle-_ZTVoA"}},30218:function(e,t,n){n.d(t,{Z:()=>c});var o=n(16584),i=n(30396),r=n(20253),a=n(15771),s=n(19081),l=n(58175),d=n(51776),u=n(26111);let c=e=>{let{allowAllDay:t,redirect:n,onCancel:c,requiresMfa:m}=e,[_,p]=(0,i.eJ)(!1),[h,v]=(0,i.eJ)(""),[g,f]=(0,i.eJ)(!m),y=(0,i.sO)(null),b=n||(0,u.x)("redirect")||"/",C=(0,u.x)("for_pub")||"";return(0,i.d4)(()=>{y.current&&y.current.focus()},[]),(0,i.d4)(()=>{6===h.length&&f(!0)},[h]),(0,o.tZ)(r.ZP,{className:"customer-support-mode-form",analyticsName:"Customer Support Mode Form",action:"/api/v1/customer_support_mode",onSuccess:e=>{var t;let n=null==e?void 0:null===(t=e.body)||void 0===t?void 0:t.redirect;n?document.location.href=n:document.location.href=b||"/"},autoLock:!0,children:(0,o.BX)(s.tu,{children:[(0,o.BX)(s.tu,{gap:8,children:[(0,o.tZ)(l.xv.Meta,{className:"danger",weight:"semibold",color:"error",children:"Danger"}),(0,o.tZ)(l.xv.H2,{children:"Support Mode"}),(0,o.tZ)(l.xv.B3,{children:"Be absolutely respectful to the writers on whose behalf you are working."}),m&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(l.xv.B3,{paddingTop:12,weight:"bold",children:"Enter your MFA code"}),(0,o.tZ)(d.oi,{ref:y,name:"code",inputMode:"numeric",maxLength:6,placeholder:"Code",value:h,width:300,autoComplete:"off",onChange:e=>v(e.target.value)})]}),t&&(0,o.tZ)("label",{children:(0,o.BX)(s.gq,{gap:8,children:[(0,o.tZ)("input",{type:"checkbox",defaultChecked:!1,onInput:e=>p(e.target.checked)})," ",(0,o.tZ)(l.xv.B3,{children:"Allow access for the day"})]})}),_&&(0,o.tZ)("input",{type:"hidden",name:"all_pubs",value:"true"}),(0,o.tZ)("input",{type:"hidden",name:"minutes",value:_?600:30}),(0,o.tZ)("input",{type:"hidden",name:"for_pub",value:C}),(0,o.tZ)("input",{type:"hidden",name:"redirect",value:b}),(0,o.BX)(s.gq,{gap:8,paddingTop:8,children:[(0,o.tZ)(a.zx,{priority:"destructive",type:"submit",id:"enter-support-mode",disabled:!g,children:"Enter support mode"}),c&&(0,o.tZ)(a.zx,{priority:"secondary",onClick:c,children:"Cancel"})]})]}),(0,o.tZ)("div",{id:"error-container"})]})})}},78327:function(e,t,n){n.d(t,{V:()=>d});var o=n(16584),i=n(94184),r=n.n(i),a=n(19081),s=n(58175),l=n(45985);function d(e){let{className:t,count:n}=e;return(0,o.tZ)(a.hs,{alignItems:"center",justifyContent:"center",radius:"md",className:r()(l.Z.badge,!n&&l.Z.dot,t),children:(0,o.tZ)(s.xv.Digit,{color:"white",children:n?n<100?n:"99+":"0"})})}},83320:function(e,t,n){n.d(t,{Z:()=>l});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(64515);let l=e=>{var{size:t=32,stroke:n="var(--color-fg-primary)",strokeWidth:l=2}=e,d=(0,r._)(e,["size","stroke","strokeWidth"]);return(0,a.tZ)(s.l,(0,i._)((0,o._)({},d),{name:"LucideTabActivity",svgParams:{viewBox:"0 0 32 32"},width:t,height:t,stroke:n,strokeWidth:l,strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.tZ)("path",{d:"M14.2991 25C15.5582 25.6295 17.0401 25.6295 18.2992 25M13.9242 6.35035C13.1325 6.59102 11.3117 7.50553 10.3617 9.2383C9.17415 11.4043 9.5167 14.4866 9.17415 15.7362C8.83161 16.9858 7.98666 17.9021 7.39291 19.3461C7.25212 19.6885 7.14472 19.9903 7.06278 20.2611C6.74292 21.3183 7.69459 22.2341 8.79916 22.2341H23.7992C24.9037 22.2341 25.8554 21.3183 25.5355 20.2611C25.4536 19.9903 25.3462 19.6885 25.2054 19.3461C24.6117 17.9021 23.7667 16.9858 23.4242 15.7362C23.0816 14.4866 23.4242 11.4043 22.2367 9.2383C21.2867 7.50553 19.4658 6.59102 18.6742 6.35035C17.1253 5.88322 15.473 5.88322 13.9242 6.35035Z"})}))}},87698:function(e,t,n){n.d(t,{Z:()=>l});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(64515);let l=e=>{var{size:t=32,stroke:n="var(--color-fg-primary)",strokeWidth:l=2}=e,d=(0,r._)(e,["size","stroke","strokeWidth"]);return(0,a.tZ)(s.l,(0,i._)((0,o._)({},d),{name:"LucideTabChat",svgParams:{viewBox:"0 0 32 32"},width:t,height:t,stroke:n,strokeWidth:l,strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.tZ)("path",{d:"M8.5 25.5C9.5 24.5 9.83333 22.3333 9.5 21.5C9.42273 21.4734 8.84545 21.2538 8.76817 21.2262C7.66999 20.8332 7 19.7542 7 18.5879V9.87424C7 8.72745 7.64925 7.6677 8.73365 7.2946C12.2079 6.09927 18.2029 5.11688 24.2305 7.27337C25.3287 7.66627 26 8.74577 26 9.91214V18.6258C26 19.7726 25.3496 20.8328 24.2652 21.2058C21.9099 22.016 18.3965 22.7282 14.5 22.4312C13.5 24.4312 11 25.5 8.5 25.5Z"})}))}},89320:function(e,t,n){n.d(t,{Z:()=>l});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(64515);let l=e=>{var{size:t=32,stroke:n="var(--color-fg-primary)",strokeWidth:l=2}=e,d=(0,r._)(e,["size","stroke","strokeWidth"]);return(0,a.tZ)(s.l,(0,i._)((0,o._)({},d),{name:"LucideTabHome",svgParams:{viewBox:"0 0 32 32"},width:t,height:t,stroke:n,strokeWidth:l,strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.tZ)("path",{d:"M14 22.6728C15.259 23.3023 16.741 23.3023 18 22.6728M6 15.3089V23.6727C6 25.3296 7.34315 26.6727 9 26.6727H23C24.6569 26.6727 26 25.3296 26 23.6727V15.3089C26 14.7312 25.7503 14.1818 25.315 13.802L16.6575 6.24657C16.2808 5.91781 15.7192 5.91781 15.3425 6.24657L6.68496 13.802C6.24974 14.1818 6 14.7312 6 15.3089Z"})}))}},9997:function(e,t,n){n.d(t,{Z:()=>l});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(64515);let l=e=>{var{size:t=34,stroke:n="var(--color-fg-primary)",strokeWidth:l=2}=e,d=(0,r._)(e,["size","stroke","strokeWidth"]);return(0,a.BX)(s.l,(0,i._)((0,o._)({},d),{name:"LucideTabInbox",svgParams:{viewBox:"0 0 34 34"},width:t,height:t,stroke:n,strokeWidth:l,strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.tZ)("path",{d:"M15,8C15,6.895 14.105,6 13,6H9C7.895,6 7,6.895 7,8V12C7,13.105 7.895,14 9,14H13C14.105,14 15,13.105 15,12V8Z"}),(0,a.tZ)("path",{d:"M15,20C15,18.895 14.105,18 13,18H9C7.895,18 7,18.895 7,20V24C7,25.105 7.895,26 9,26H13C14.105,26 15,25.105 15,24V20Z"}),(0,a.tZ)("path",{d:"M27,20C27,18.895 26.105,18 25,18H21C19.895,18 19,18.895 19,20V24C19,25.105 19.895,26 21,26H25C26.105,26 27,25.105 27,24V20Z"}),(0,a.tZ)("path",{d:"M27,8C27,6.895 26.105,6 25,6H21C19.895,6 19,6.895 19,8V12C19,13.105 19.895,14 21,14H25C26.105,14 27,13.105 27,12V8Z"})]}))}},66328:function(e,t,n){n.d(t,{v:()=>e1});var o=n(7409),i=n(16584),r=n(30396),a=n(94184),s=n.n(a),l=n(14293),d=n.n(l),u=n(56743),c=n(28161),m=n(99282),_=n(24840),p=n(80569),h=n.n(p),v=n(30218),g=n(93666),f=n(31131),y=n(99869),b=n(67358),C=n(12561),w=n(59154),Z=n(79138),x=n(37632),P=n(4473),k=n(39535),I=n(75697),N=n(16354),S=n(95441),M=n(68833),R=n(15771),B=n(44424),A=n(63651),L=n(47929);function E(e){let{pub:t,user:n}=e,{iString:o}=(0,S.M1)(),[a,s]=(0,r.eJ)(!1),l=(0,A.SVA)(t),d={utm_source:L.b3.navbar,utm_medium:L.lP.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},u=(0,A.n1t)(l,d),c=async()=>{(0,M.j)(M.FP.PUBLICATION_SHARE_BUTTON_CLICKED)},m=(0,i.tZ)(R.hU,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,i.tZ)(f.Z,{size:20})});return(0,i.BX)(i.HY,{children:[(0,i.BX)(B.v2,{trigger:m,onOpen:c,layerOptions:{placement:"bottom-end",preferX:"left"},className:"dropdownMenu-zWNckK",maxHeight:"fit-content",children:[(0,i.tZ)(B.sN,{leading:(0,i.tZ)(y.Z,{}),onClick:()=>{(0,I.Ui)({shareUrl:u,pub:t,utm_campaign:L.VX.navbar})},children:o("Copy link")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(b.Z,{}),onClick:()=>{(0,I.WZ)({shareUrl:u,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:L.VX.navbar})},children:o("Send as email")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(C.Z,{}),onClick:()=>{(0,M.j)(M.FP.SHARE_PUBLICATION_MODAL_OPENED),s(!0)},children:o("Get shareable images")}),(0,i.BX)(B.xw,{children:[(0,i.tZ)(B.sN,{leading:(0,i.tZ)(P.Z,{}),onClick:()=>{(0,I.BZ)({shareUrl:u,pub:t,utm_campaign:L.VX.navbar})},children:o("Share to Notes")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(Z.Z,{}),onClick:()=>{(0,I.Po)({shareUrl:u,pub:t,utm_campaign:L.VX.navbar})},children:o("Share to Facebook")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(x.Z,{}),onClick:()=>{(0,I.lc)({shareUrl:u,pub:t,utm_campaign:L.VX.navbar})},children:o("Share to Linkedin")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(w.Z,{}),onClick:()=>{(0,I.bI)({shareUrl:u,shareName:t.name,pub:t,utm_campaign:L.VX.navbar})},children:o("Share to Bluesky")}),(0,i.tZ)(B.sN,{leading:(0,i.tZ)(k.Z,{}),onClick:()=>{(0,I.Wn)({shareUrl:u,shareName:t.name,pub:t,utm_campaign:L.VX.navbar})},children:o("Share to X")})]})]}),(0,i.tZ)(N.iL,{pub:t,isOpen:a,setOpen:s,item:{type:"pub_shareable_image"},width:718})]})}var T=n(96726),O=n(33804),F=n(347),z=n(12757),X=n(57391),U=n(36848),D=n(39648),q=n(56629),V=n(40647),j=n(65205),H=n(60807),W=n(98914),J=n(98422),K=n(80026),G=n(19081),Y=n(10510),Q=n(78096),$=n(70379),ee=n(87077),et=n(7617),en=n(4615);function eo(e){let{children:t}=e;return(0,i.tZ)(en.f6,{theme:"substack-theme",children:t})}var ei=n(97842),er=n(74312),ea=n(68494),es=n(36518),el=n(7882),ed=n(83010),eu=n(19425),ec=n(20160),em=n(98012);let e_={alert:"alert-pEnrFa",transition:"transition-FsyEAS",enterFrom:"enterFrom-dljIVN",enterTo:"enterTo-HLLVxF",leaveFrom:"leaveFrom-aHkaAL",leaveTo:"leaveTo-k1oI5e"},ep=e=>{(0,M.j)(M.FP.NOTIFICATIONS_ALERT_SHOWN,["comment_audience","comment_id","community_comment_id","created_at","id","mention_id","publication_id","sender_count","target_comment_id","target_community_comment_id","target_community_post_id","target_post_id","target_user_id","type"].reduce((t,n)=>(t[n]=null==e?void 0:e[n],t),{}))};function eh(){var e;let{activityUnreadCount:t}=(0,es.lR)(),{exposeExperiment:o,getExperimentVariant:a}=(0,X.jc)(),{isLoading:s,result:l,refetch:d}=(0,el.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:1},auto:!1});(0,r.d4)(()=>{t>0&&d()},[t]);let[u,c]=(0,r.eJ)(!1),[m,_]=(0,r.eJ)(!1),{isLoading:p,fetch:h,result:v}=(0,er.Oe)({module:"./MiniNotificationsViewer",onRequest:()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5394"),n.e("7833"),n.e("3139")]).then(n.bind(n,79075)),fetchImmediately:!1}),g=(0,em.Z)(),{userSettings:f,changeSetting:y}=(0,H.SE)(),b=null==l?void 0:null===(e=l.activityItems)||void 0===e?void 0:e[0],C=(null==b?void 0:b.created_at)?(0,em.Z)(null==b?void 0:b.created_at):g.subtract(100,"year"),w=(null==f?void 0:f.last_notification_alert_shown_at)?(0,em.Z)(f.last_notification_alert_shown_at):g.subtract(100,"year"),Z=7>g.diff(C,"day")&&C.diff(w,"hour")>2,x=(0,r.sO)(null),P=()=>{x.current&&window.clearTimeout(x.current)},k=()=>{P(),x.current=window.setTimeout(()=>{c(!1)},6e3)};return(0,r.d4)(()=>{Z&&t>0&&(o("notification_alert_improved"),"treatment"!==a("notification_alert_improved")||(v&&!u?window.setTimeout(()=>{c(!0),y("last_notification_alert_shown_at",(0,em.Z)().toISOString()),ep(b),k()},2e3):v||p||h()))},[s,l,t,p,Z,u,c]),(0,i.tZ)(i.HY,{children:(u||m)&&l&&(0,i.tZ)(eu.u,{style:{position:"fixed",left:"auto",right:20,top:92,zIndex:100},appear:!0,show:u,beforeEnter:()=>_(!0),afterLeave:()=>_(!1),enter:e_.transition,enterFrom:e_.enterFrom,enterTo:e_.enterTo,leave:e_.transition,leaveFrom:e_.leaveFrom,leaveTo:e_.leaveTo,children:(0,i.tZ)(ec.W,{children:(0,i.tZ)(G.hs,{radius:"md",border:"detail",className:e_.alert,onMouseEnter:P,onMouseLeave:k,shadow:"lg",bg:"primary",children:(0,i.tZ)(er.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsStack,onRequest:()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5394"),n.e("7833"),n.e("3139")]).then(n.bind(n,79075)),result:l,isReadOnly:!0})})})})})}var ev=n(21694);function eg(e){let{canShowAlerts:t=!1}=e,a=(0,es.lR)(),s=(0,el.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,r.d4)(()=>{a.activityUnreadCount>0&&(0,M.j)(M.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:a.activityUnreadCount})},[a.activityUnreadCount]);let l=()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5394"),n.e("7833"),n.e("3139")]).then(n.bind(n,79075)),{iString:d}=(0,S.M1)();return(0,i.BX)(ed.H,{trackingProps:{surface:"dropdown"},children:[(0,i.tZ)(B.v2,{trigger:e=>(0,i.tZ)(ee.u,{text:d("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},children:(0,i.BX)(R.hU,(0,m._)((0,o._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:l,position:"relative",children:[(0,i.tZ)(ea.Z,{"aria-hidden":!0,size:20}),a.activityUnreadCount>0&&(0,i.tZ)(ef,{count:a.activityUnreadCount})]}))}),onOpen:()=>s.refetch(),maxHeight:"fit-content",padding:0,Theme:eo,children:(0,i.tZ)(er.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:l,resource:s,bellCount:a.activityUnreadCount,whileLoading:(0,i.tZ)(G.hs,{width:400})})}),t&&(0,i.tZ)(eh,{})]})}function ef(e){let{count:t}=e;return(0,i.tZ)(G.hs,{className:s()(ev.Z.badge,t<10&&ev.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}function ey(){var e,t;let{iString:n}=(0,S.M1)(),a=null!==(t=null===(e=(0,ei.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,r.d4)(()=>{(0,M.j)(M.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:a})},[a]),(0,i.tZ)(B.v2,{trigger:e=>(0,i.tZ)(ee.u,{text:n("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},children:(0,i.BX)(K.hU,(0,m._)((0,o._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:eb,position:"relative",children:[(0,i.tZ)(et.Z,{size:20}),a>0&&(0,i.tZ)(ef,{count:a})]}))}),onClose:()=>{(0,M.j)(M.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:eo,children:(0,i.tZ)(er.cr,{module:"./MiniInbox",onRequest:eb,resolve:e=>e.MiniChatInbox,whileLoading:(0,i.tZ)(K.xu,{width:360})})})}let eb=()=>Promise.all([n.e("9539"),n.e("3792"),n.e("785"),n.e("8117"),n.e("3751"),n.e("5410"),n.e("570"),n.e("5431"),n.e("9027"),n.e("4199"),n.e("7123"),n.e("9432"),n.e("3686"),n.e("7944"),n.e("2609"),n.e("8823"),n.e("2280"),n.e("1761"),n.e("1621"),n.e("9517"),n.e("2841"),n.e("7566"),n.e("5042"),n.e("3290"),n.e("8074"),n.e("5394"),n.e("7250"),n.e("7833"),n.e("5477"),n.e("3119"),n.e("9557")]).then(n.bind(n,87078));var eC=n(24791),ew=n(6070),eZ=n(67914),ex=n(60308),eP=n(26111),ek=n(84864);let eI=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,J.v9)(),{iString:r}=(0,S.M1)();return(0,i.tZ)(Q.gd,{priority:"secondary",size:o?"sm":"md",menuItems:n.map(e=>{let{logo_url:n,name:o,subdomain:r}=e;return(0,i.tZ)(B.sN,{href:(0,ex.c0Q)(r,{params:{utm_source:L.b3.substack,utm_content:L.fZ.dashboardPubSwitcher}}),leading:(0,i.tZ)(Y.wk,{size:24,radius:"xs",logoUrl:n}),priority:t.subdomain===r?"selected":"primary",children:o})}),href:(0,A.QK7)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:r("Dashboard")})},eN=e=>{let{onClick:t}=e,{iString:n}=(0,S.M1)();return(0,i.tZ)(ee.u,{text:n("Search"),layerOptions:{placement:"bottom-center",triggerOffset:4},children:(0,i.tZ)(K.hU,{priority:"tertiary",onClick:t,children:(0,i.tZ)(_.Z,{size:20})})})},eS=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,S.M1)(),{isMobile:r}=(0,J.v9)();return t.length>1?(0,i.tZ)(eI,{pub:n,dashboardPubs:t}):(0,i.tZ)(K.zx,{size:r?"sm":"md",priority:"secondary",href:(0,A.QK7)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})},eM=e=>{var t;let{className:n,fixedTooltip:a=!0,freeSignup:l,freeSignupEmail:u,hideCta:c,hideNotifications:_,hideChat:p,hideSearch:f,hideShare:y,hideUserIndicator:b,hide_subscribe_cta:C,isAccountContext:w=!1,isMeetingsActive:Z,hasViralGiftsCount:x,isPublishContext:P,pub:k,showCustomerSupportModeModal:I,user:N}=e,{iString:R,language:B}=(0,S.M1)(),{isMobile:Y}=(0,J.v9)(),Q=(0,r.sO)(null),{getSettingFor:ee}=(0,q.So)(),et=(0,X.jc)(),[en,eo]=(0,r.eJ)(!1),[ei,er]=(0,r.eJ)(!1),ea=(0,$.pm)(),{canTurnOnCustomerSupportMode:es,isInCustomerSupportMode:el}={canTurnOnCustomerSupportMode:!!(null==(t=(0,H.aF)())?void 0:t.is_global_admin)&&!(null==t?void 0:t.is_admin),isInCustomerSupportMode:!!(null==t?void 0:t.is_global_admin)&&!!(null==t?void 0:t.is_admin)&&!(null==t?void 0:t.is_author)},ed=(0,r.I4)(async()=>{try{await h().del("/api/v1/customer_support_mode"),document.location.href="/"}catch(e){alert((0,W.zx)(e))}},[]),eu=async()=>{eo(!0);try{await h().post("/api/v1/subscription/reactivate").send({}),er(!0),ea.popToast(e=>(0,i.tZ)($.FN,(0,m._)((0,o._)({},e),{text:R("Your subscription has been renewed!")})))}catch(e){console.error("Failed to set to renew:",e),alert((0,W.zx)(e))}finally{eo(!1)}},ec=(0,r.I4)(async()=>{if(k.custom_domain){let e=window.location.pathname;(0,W.uX)((0,ex.Q6L)(e,k),{local_navigation:!1})}else{var e;null===(e=Q.current)||void 0===e||e.open()}},[Q,k]),e_=P||w?O.w:F.h,ep=(0,D.O4)();return(0,i.BX)(G.gq,{alignItems:"center",gap:Y?4:8,className:s()("navbar-buttons",n),justifyContent:"end",children:[(0,i.tZ)(e_,{children:(0,i.tZ)(V.QA.Consumer,{children:e=>(0,i.tZ)(U.RD.Consumer,{children:t=>(0,i.BX)(i.HY,{children:[!Y&&!N&&(0,i.BX)(G.gq,{gap:4,children:[!f&&(0,i.tZ)(eN,{onClick:()=>ep.open()}),!y&&(0,i.tZ)(E,{pub:k,user:null!=N?N:void 0})]}),!Y&&N&&(0,i.BX)(G.gq,{gap:4,children:[!f&&(0,i.tZ)(eN,{onClick:()=>ep.open()}),p?!y&&(0,i.tZ)(E,{pub:k,user:N}):(0,i.tZ)(ey,{}),!_&&(0,i.tZ)(eg,{canShowAlerts:!k||P})]}),!c&&function(e){var t,n,o,r,a,s,l,u,c,m,_;let{user:p,pub:v,freeSignup:g,freeSignupEmail:f,hide_subscribe_cta:y,isPublishContext:b,isMeetingsActive:C,hasViralGiftsCount:w,siteConfigContext:Z,getSettingFor:x,experimentApi:{exposeExperiment:P,getExperimentVariant:k},renewing:I,renewed:N,setToRenew:S,language:R,isMobile:B}=e,{iString:E,iPlural:T}=I18N.i(R);v.invite_only&&!((null==p?void 0:p.subscription_id)||(null==p?void 0:p.is_free_subscribed))&&(y=!0);let O=null==p?void 0:p.is_contributor,F=(null==p?void 0:p.is_subscribed)||O,z=(null==p?void 0:p.is_free_subscribed)||g,X=eC.oH(v)&&F&&["gift","comp"].includes(null!==(r=p.subscription_type)&&void 0!==r?r:"")&&!(0,eZ.B9)({pub:v,subscriptionType:null==p?void 0:p.subscription_type})&&(0,em.Z)(p.subscription_expiry).subtract(30,"days").isBeforeNow(),U=eC.oH(v)&&p&&eC.po(p)&&p.comp_expired_recently,D=(null==p?void 0:p.is_free_subscribed)&&(null==p?void 0:p.is_paused),q=(null==p?void 0:p.subscription_type)==="ios_app";if(O){let e=(null==p?void 0:p.dashboard_pubs)||[];return b&&1===e.length?[]:(0,i.tZ)(eS,{dashboardPubs:e,pub:v})}if(D)return(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,W.uX)((0,ex.BhD)(v,{addBase:!0}),{local_navigation:!1})},children:E("Unpause my subscription")});if(X||U){if(!y)return(0,i.BX)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{var e;(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,W.uX)((0,ex.W1P)(v,{utm_source:L.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eP.x)("referring_pub_ids"),addBase:!0,selectedPlanId:X&&(null==p?void 0:p.is_founding)&&v.plans?null===(e=v.plans.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===e?void 0:e.id:null}),{local_navigation:!1})},children:[(0,i.tZ)("span",{className:"mobile-only",children:E("Subscribe")}),(0,i.tZ)("span",{className:"desktop-only",children:E("Continue your support")})]})}else if(eC.oH(v)&&z&&!F&&!["thebulwark"].includes(v.subdomain)){if(!y)return(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,W.uX)((0,ex.W1P)(v,{utm_source:L.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eP.x)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,ek.getSubscribeText)(v,{isFreeSubscribed:!0,isMobile:(0,W.K1)(),language:R})})}else if(eC.oH(v)?F:z||F){if(v.invite_only&&F&&!d()(p.invites)&&p.invites<v.subscriber_invites)return(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,W.uX)((0,ex.UzE)(v),{local_navigation:!1})},children:(0,i.tZ)("span",{children:T("1 invite left","%1 invites left",v.subscriber_invites-p.invites)})});if(eC.oH(v)&&C&&Z&&!Z.getConfigFor("hide_book_a_meeting_button"))return(0,i.BX)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,W.uX)((0,A.szv)(v,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,i.tZ)("span",{className:"mobile-only",children:E("Book meeting")}),(0,i.tZ)("span",{className:"desktop-only",children:E("Book a meeting")})]});else if(eC.oH(v)&&p&&p.is_subscribed&&!q&&p.subscription_unsubscribed_at&&!["gift","comp"].includes(null!==(a=p.subscription_type)&&void 0!==a?a:""))return(0,i.BX)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"renew"}),S()},disabled:I||N,style:{visibility:N?"hidden":"visible"},children:[(0,i.tZ)("span",{className:"mobile-only",children:E("Renew")}),(0,i.tZ)("span",{className:"desktop-only",children:E("Renew subscription")})]})}else if(!y){let e=null===(u=(0,eP.x)("referring_pub_ids"))||void 0===u?void 0:null===(l=u.split)||void 0===l?void 0:null===(s=l.call(u,","))||void 0===s?void 0:s[0],t=null===(_=(0,eP.x)("referring_pub_ids"))||void 0===_?void 0:null===(m=_.split)||void 0===m?void 0:null===(c=m.call(_,","))||void 0===c?void 0:c.slice(1);return(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:async()=>{let n=p&&!p.is_magic&&p.email||f;if((0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:v.homepage_type}),n){let o;try{o=(await h().post("/api/v1/free").send({source:"menu",email:n,first_url:j.xY,first_referrer:j.ip,current_url:j.UE,current_referrer:j.xU,first_session_url:j.ac,first_session_referrer:j.qR,referring_pub_id:e,additional_referring_pub_ids:t})).body.referral_token,(0,M.IU)()}catch(e){(0,M.j)(M.FP.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,ex.W1P)(v,{utm_source:L.b3.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:o})}else window.location.href=(0,ex.W1P)(v,{utm_source:L.b3.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,eP.x)("referring_pub_ids"),addBase:!0})},children:(0,ek.getSubscribeText)(v,{isFreeSubscribed:z,isMobile:(0,W.K1)(),language:R})})}if(eC.oH(v)&&p&&p.is_subscribed&&w){let e=(0,A.xdn)({pub:v,params:{utm_source:L.b3.menu}}),t=k("viral_gift_nav_bar_cta");if(P("viral_gift_nav_bar_cta"),["treatment_send","treatment_left"].includes(null!=t?t:"control")){let n="treatment_send"===t?E(w>1?"Send free gifts":"Send free gift"):T("1 gift left","%1 gifts left",w);return(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"send-viral-gift"}),(0,W.uX)(e,{local_navigation:!1})},children:n})}}if(eC.oH(v)&&p&&!p.is_founding&&!q&&(0,em.Z)(p.subscription_first_payment_at).isBefore((0,em.Z)().subtract(48,"hours"))&&((0,ew.VL)({pub:v})||"pinespayments"===v.subdomain||(null==v?void 0:null===(o=v.plans)||void 0===o?void 0:null===(n=o.find(e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t.founding}))||void 0===n?void 0:null===(t=n.metadata)||void 0===t?void 0:t.short_description)==="Founding Member")){let e=(0,A.yRy)({pub:v,user:p,params:{utm_source:L.b3.menu,next:document.location.href}});return(0,i.BX)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,W.uX)(e,{local_navigation:!1})},children:[(0,i.tZ)("span",{className:"mobile-only",children:E("Upgrade")}),(0,i.tZ)("span",{className:"desktop-only",children:E("Upgrade to founding")})]})}return"disabled"===v.payments_state&&!v.invite_only&&x("payment_pledges_enabled")&&z&&!(null==p?void 0:p.is_pledged)?(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,W.uX)((0,ex.W1P)(v,{utm_source:L.b3.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:E("Pledge your support")}):eC.oH(v)&&!v.invite_only?(0,i.BX)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,W.uX)((0,ew.HD)({pub:v})&&p&&(null==Z?void 0:Z.getConfigFor("enable_founding_gifts"))?(0,ew.Iv)({user:p}):(0,ex.W1P)(v,{utm_source:L.b3.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,i.tZ)("span",{className:"mobile-only",children:E("Give gift")}),(0,i.tZ)("span",{className:"desktop-only",children:E("Gift a subscription")})]}):!v.is_on_substack||(null==p?void 0:p.has_publication)?null:(0,i.tZ)(K.zx,{"data-testid":"noncontributor-cta-button",size:B?"sm":"md",onClick:()=>{(0,M.j)(M.FP.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,W.uX)((0,ex._HV)({utm_source:L.b3.menu}),{local_navigation:!1})},children:E("Start publishing")})}({pub:k,user:N,freeSignup:l,freeSignupEmail:u,hide_subscribe_cta:C,viralGiftsConfig:k.viralGiftsConfig,isPublishContext:P,localeContext:t,siteConfigContext:e,isMeetingsActive:Z,hasViralGiftsCount:x,getSettingFor:ee,experimentApi:et,renewing:en,renewed:ei,setToRenew:eu,language:B,isMobile:Y}),!b&&(0,i.tZ)(z.Co,{pub:k,user:N,enableCustomerServiceMode:es?ec:void 0,disableCustomerServiceMode:el?ed:void 0,fixedTooltip:a})]})})})}),es&&(0,i.tZ)(T.h,{children:(0,i.tZ)(g.p,{className:"account-info-customer-support-mode-modal",ref:Q,openByDefault:I&&es,children:(0,i.tZ)(v.Z,{redirect:(0,eP.x)("redirect")||"/publish/home",onCancel:e=>{var t;return null===(t=Q.current)||void 0===t?void 0:t.close(e)},requiresMfa:null==N?void 0:N.requires_global_admin_mfa_challenge})})})]})};var eR=n(49336),eB=n(2564),eA=n(94499),eL=n(17043);let eE={subMenuTrigger:"subMenuTrigger-SKUcXd",subMenuItem:"subMenuItem-zrY1yO",disabled:"disabled-TCpkl9",logo:"logo-Jt_Kvr",chevron:"chevron-_e2GYQ"};function eT(e){let{className:t,hideBorders:n,items:o,menuItemClassName:a,selectedMenuItemClassName:l,selectedSlug:d,pub:c}=e,{isMobile:m}=(0,J.v9)(),_=(0,r.sO)(null),[p,h]=(0,r.eJ)(!1),[v,g]=(0,r.eJ)(!1);function f(e){let{scrollLeft:t,scrollWidth:n,clientWidth:o}=e;h(t>10),g(n-(o+t)>10)}let y=e=>()=>{let{current:t}=_;t&&t.scrollBy({left:250*e,behavior:"smooth"})};return(0,r.d4)(()=>{f(_.current)},[]),(0,i.tZ)("div",{className:s()("overflow-list-container",t),children:(0,i.BX)(G.gq,{borderBottom:n?void 0:"detail",borderTop:n||m?void 0:"detail",className:s()("section-bar",{scroll:!0,"overflow-left":p,"overflow-right":v}),font:"text",height:m?44:48,justifyContent:m?"start":"center",paddingX:4,position:"relative",children:[(0,i.tZ)("div",{ref:_,className:"overflow-items",onScroll:e=>f(e.target),children:o.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:u,noFollow:m,subItems:_,newTab:p}=e;return _?(0,i.tZ)(B.v2,{hideOnScroll:!0,layerOptions:{placement:"bottom-start",triggerOffset:6},title:t,trigger:(0,i.tZ)("div",{className:s()("menu-item",{selected:o===d},a,l&&{[l]:o===d}),children:(0,i.BX)(eA.Z,{className:eE.subMenuTrigger,native:r,rel:m?"nofollow":null,onClick:u,children:[(0,i.tZ)("span",{className:"overflow-item-text",children:t}),(0,i.tZ)(eR.Z,{className:eE.chevron,size:16})]})}),children:_.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:a,noFollow:l,logoUrl:d}=e,u=!!o&&parseInt("".concat(o))===(null==c?void 0:c.id),m=d||(null==c?void 0:c.logo_url);return(0,i.tZ)(B.sN,{className:s()(eE.subMenuItem,{[eE.disabled]:u}),disabled:u,href:n,native:r,priority:"primary",rel:l?"nofollow":void 0,onClick:a,children:(0,i.BX)(G.gq,{alignItems:"center",gap:12,style:{margin:"-4px 0 -4px -4px"},children:[m&&(0,i.tZ)("img",{className:eE.logo,src:(0,eL.zF)(m,64),width:32}),t]})})})}):(0,i.tZ)("div",{className:s()("menu-item",{selected:o===d},a,l&&{[l]:o===d}),children:(0,i.tZ)(eA.Z,{href:n,native:r,newTab:p,rel:m?"nofollow":null,onClick:u,children:(0,i.tZ)("span",{className:"overflow-item-text",children:t})})})})}),(0,i.tZ)("div",{className:"left-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:y(-1),children:(0,i.tZ)(u.Z,{strokeWidth:1.5})})}),(0,i.tZ)("div",{className:"right-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:y(1),children:(0,i.tZ)(eB.Z,{strokeWidth:1.5})})})]})})}var eO=n(48884),eF=n(76819);let ez={zeteo:{121146:"Weâ€™re Not Kidding"}},eX=["/about","/chat","/archive","/newsletters"],eU=e=>{let{isChatActive:t,isMeetingsActive:n,pub:o,selectedSectionId:r}=e,{language:a}=(0,S.M1)(),{getSettingFor:s}=(0,q.So)(),{getConfigFor:l}=(0,V.xR)(),d=!!l("publication_tabs_reorder"),u=!!s("notes_feed_enabled"),c=!!(s("reader_referrals_enabled")&&s("reader_referrals_leaderboard_enabled")),m=eD({groupNewsletters:!!s("group_sections_and_podcasts_in_menu_enabled"),navBarItems:(0,eF.Rx)(o.navigationBarItems||[],{isFeedEnabled:u,isChatActive:!!t,isChatEnabled:!!o.threads_v2_enabled,isMeetingsActive:!!n,hasMultipleNewsletters:o.sections&&o.sections.length>0,isReaderReferralsLeaderboardActive:c,language:a,useReordering:d}).filter(e=>!e.is_hidden),pub:o,language:a});return(0,i.tZ)(eT,{items:m,className:"sections-overflow",selectedSlug:r,pub:o})},eD=e=>{let{groupNewsletters:t,navBarItems:n,pub:o,language:i}=e,{iString:r}=eO.mb.i(i),a=[];a.push({href:"/",label:r("Home"),slug:"/home"}),o.podcast_enabled&&o.show_pub_podcast_tab&&a.push({href:"/podcast",label:r("Podcast"),slug:"/podcast"});let s=[];return(0,ew.jC)({pub:o})?s=eq({navBarItems:n,groups:[{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===118995},excludeFromOthers:!0,isStandalone:!0},{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===121146},excludeFromOthers:!0,isStandalone:!0},{label:"Shows",condition:e=>{var t,n;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)||(null===(n=e.postTag)||void 0===n?void 0:n.slug)==="townhall"}},{label:"Columns",condition:e=>{var t,n;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)&&(null===(n=e.section)||void 0===n?void 0:n.id)!==132068}},{label:"Documentaries",condition:e=>{var t,n;return(null===(t=e.section)||void 0===t?void 0:t.id)===132068||(null===(n=e.section)||void 0===n?void 0:n.id)===214805}}]}):(0,ew.VL)({pub:o})?(a.push({href:"/listen",label:"Shows",slug:"/listen"}),s=eq({navBarItems:n.filter(e=>!e.section||!e.section.is_podcast||(0,ek.sectionIsSpecificallyMarkedAsNewsletter)({section:e.section,pub:o})),groups:[{label:"Newsletters",condition:e=>!!e.section}]})):s=(0,ew.p$)({pub:o})?eq({navBarItems:n,groups:[{label:"Projects",condition:e=>{var t,n;return[146942,146943,150226].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"News / Research",condition:e=>{var t,n;return[146936,146935].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Calls-to-Action",condition:e=>{var t,n;return[146939,146941,146949].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Recommendations",condition:e=>{var t,n;return[146958].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)||"https://bookshop.org/shop/globalfreedoms"===e.link_url},excludeFromOthers:!0},{label:"Podcasts",condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)},excludeFromOthers:!0}]}):t?eq({navBarItems:n,groups:[{label:r("Newsletters"),condition:e=>{var t;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}},{label:r("Podcasts"),condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}}]}):n,[...a,...eV({groupedNavBarItems:s,pub:o})]},eq=e=>{let{navBarItems:t,groups:n}=e,o=[...t],i=[],r=[...t];for(let e of n)if(e.isStandalone){let t=o.find(e.condition);if(!t)continue;i.push(t),r=r.filter(e=>e!==t),e.excludeFromOthers&&(o=o.filter(e=>e!==t))}else{var a;let t=o.filter(e.condition);if(0===t.length)continue;i.push({label:null!==(a=e.label)&&void 0!==a?a:"Other",navBarItems:t}),r=r.filter(t=>!e.condition(t)),e.excludeFromOthers&&(o=o.filter(t=>!e.condition(t)))}return[...i,...r]},eV=e=>{let{groupedNavBarItems:t,pub:n}=e;return t.map(e=>"navBarItems"in e?{label:e.label,subItems:e.navBarItems.map(e=>ej({navBarItem:e,pub:n}))}:ej({navBarItem:e,pub:n}))},ej=e=>{var t,n,i,r,a,s;let{navBarItem:l,pub:d}=e;if(l.section){let e=l.section,s=e.is_podcast&&null!==(r=null===(n=d.sections.find(t=>t.id===e.id))||void 0===n?void 0:null===(t=n.podcastSettings)||void 0===t?void 0:t.podcast_art_url)&&void 0!==r?r:e.logo_url;return(0,m._)((0,o._)({label:null!==(a=null===(i=ez[d.subdomain])||void 0===i?void 0:i[e.id])&&void 0!==a?a:(0,ek.truncateText)(e.name,30),href:(0,A.Ucy)(d,{section:e})},s?{logoUrl:s}:null),{slug:e.id})}let u="link"===(0,eF.Hs)(l)&&!(l.standard_key||eX.includes(null!==(s=l.link_url)&&void 0!==s?s:"")),c=u&&d.tier<2;return(0,m._)((0,o._)({href:(0,A.Oz)(d,l,{addBase:u}),label:(0,ek.truncateText)((0,eF.ye)(l),30)},c?{noFollow:c}:null),{slug:(0,A.Oz)(d,l,{addBase:!1}),newTab:u})};var eH=n(39693),eW=n.n(eH),eJ=n(36515);let eK=e=>{let{hasMeetingsBooked:t,isMeetingsActive:n,pub:o,selectedSectionId:r,user:a}=e,{language:l}=(0,S.M1)(),{iString:d}=eO.mb.i(l),u=[{href:(0,ex.QK7)(o),label:d("Home"),slug:"/publish/home"},{href:"/publish/posts",label:d("Posts"),slug:"/publish/posts"},...(null==a?void 0:a.is_admin)?eW()([{href:(0,ex.dIB)(o),label:d("Subscribers"),slug:"/publish/subscribers"},{href:"/publish/stats",label:d("Stats"),slug:"/publish/stats"},{href:(0,ex.jHQ)(o),label:d("Podcast"),slug:"/publish/podcasting"},{href:(0,eJ.r)(o,{noBase:!0}),label:d("Chat"),slug:"/publish/chat"},{href:"/publish/recommendations",label:d("Recommendations"),slug:"/publish/recommendations"},(n||!!t)&&{href:"/publish/meetings",label:d("Meetings"),slug:"/publish/meetings"},{href:(0,ex.wI3)(o),label:d("Settings"),slug:"/publish/settings"}]):[]];return(0,i.tZ)(eT,{items:u,className:s()("sections-overflow","publish-menu"),selectedSlug:r,pub:o})},eG=()=>Math.max(document.documentElement.scrollTop||document.body.scrollTop,0),eY=e=>{let{alwaysShow:t,disable:n,menuContentRef:o,menuHeight:i}=e,a=(0,r.sO)(!1),s=(0,r.sO)(eG()),l=(0,r.sO)(eG()),d=(0,r.I4)((e,t)=>{s.current=t,o.current&&(o.current.style.position=e,o.current.style.top="fixed"===e&&t>=0?"":"".concat(t,"px"))},[o]),u=(0,r.I4)(()=>{d("absolute",eG()-i),a.current=!1},[i,d]),c=(0,r.I4)(e=>{let t=e.target;((null==t?void 0:t.classList.contains("footnote-number"))||(null==t?void 0:t.classList.contains("footnote-anchor")))&&(a.current=!0,setTimeout(u,0))},[u]),m=(0,r.I4)(()=>{var e;if(t){d("fixed",0);return}if(a.current)return;let r=l.current;l.current=eG();let u=l.current,c=(null===(e=o.current)||void 0===e?void 0:e.style.position)==="fixed",m=u<=0||0>=(0,W.bs)(),_=u>=(0,W.bs)(),p=u>r,h=u<r;if(m){d("fixed",0);return}if(n){d("absolute",0);return}if(!_){if(p){if(c&&s.current>=0){d("absolute",u);return}if(!c&&s.current<u-i){d("fixed",-i);return}}if(h){if(s.current>u){d("fixed",u);return}let e=Math.max(u-i,0);if(s.current<e){d("absolute",e);return}}}},[t,o,n,d,i]);(0,r.d4)(()=>{if("undefined"!=typeof window)return window.addEventListener("scroll",m),window.addEventListener("click",c),m(),()=>{window.removeEventListener("scroll",m),window.removeEventListener("click",c)}},[n,c,m,d])};var eQ=n(63474),e$=n(58175);let e0={mainMenuContent:"mainMenuContent-DME8DR",topBar:"topBar-pIF0J1",titleWithWordmark:"titleWithWordmark-GfqxEZ",titleContainer:"titleContainer-DJYq5v",title:"title-oOnUGd",buttonsContainer:"buttonsContainer-SJBuep",logoContainer:"logoContainer-p12gJb"},e1=e=>{var t;let{className:n,freeSignup:a,freeSignupEmail:l,hasMeetingsBooked:d,hasViralGiftsCount:m,hideNavBar:_,hideTitle:p,isAccountContext:h,isChatActive:v,isMeetingsActive:g,isPostView:f,isPublishContext:y,pub:b,selectedSectionId:C,showCustomerSupportModeModal:w,user:Z}=e;p="profile"===b.homepage_type||p;let{getConfigFor:x}=(0,V.xR)(),{isMobile:P}=(0,J.v9)(),k=(0,r.sO)(null),I=(0,r.sO)(null),N=(0,r.sO)(null),S="profile"===b.homepage_type,B=S&&document.location.pathname.match(/\/profile\/(subscribers|followers|following)/),L=!S&&!!b.logo_url&&!(0,ew.kb)({pub:b}),E=!!(!p&&b.logo_url_wide),T=f?!!x("show_menu_on_posts"):!_,z=(0,ew.kb)({pub:b})||!!(x("larger_wordmark_on_publication_homepage")&&E),{currentMenuHeight:X,currentTopBarHeight:U,isMinimized:D,maxMenuHeight:q}=e2({hasExpandableTopBar:z,forceMaximized:!f&&!h&&!y,forceMinimized:!!(h||y),isMobile:P,showNavBar:T,showWordmark:E}),j=!P&&z&&D?20:0,H=P?z?32:20:z?72:36,W=!P&&z&&D?.5555555555555556:1;eY({alwaysShow:!!y,disable:!f,menuContentRef:k,menuHeight:X});let{shouldCenterTitle:K}=e4({buttonsRef:N,titleRef:I,horizontalGap:12,horizontalPadding:z?40:20}),Q=P||!K,$=h||y?(0,A.SVA)(b):"/",ee=h||y?O.w:F.h;return(0,i.tZ)(ee,{children:(0,i.BX)("div",{className:s()("main-menu",n),"data-testid":"navbar",children:[(0,i.BX)("div",{ref:k,className:e0.mainMenuContent,children:[(0,i.BX)(G.gq,{alignItems:"center",borderBottom:T?void 0:"detail-themed",className:e0.topBar,gap:12,justifyContent:"space-between",paddingBottom:P?12*!T:void 0,paddingTop:P?12:void 0,paddingX:P?12:z?40:20,style:P?void 0:{height:U},children:[(0,i.BX)("div",{className:e0.logoContainer,style:(0,o._)({display:S||L||!Q?null:"none",flexBasis:0,flexGrow:+!Q},z?{transform:"translateX(-".concat(j,"px)")}:null),children:[S&&(0,i.BX)(G.gq,{alignItems:"center",gap:20,children:[(0,i.tZ)(G.hs,{alignItems:"center",as:"a",height:20,href:"https://substack.com",justifyContent:"center",tabIndex:-1,width:20,children:P?(0,i.tZ)(c.Z,{height:24}):(0,i.tZ)(c.Z,{style:{transform:"scale(1.4)"}})}),B&&(0,i.tZ)(R.hU,{href:(0,ex.TJI)(b),size:P?"sm":"md",children:(0,i.tZ)(u.Z,{size:20})})]}),L&&(0,i.tZ)(Y.jM,{href:$,pub:b,size:P?32:40,onClick:()=>{(0,M.j)(M.FP.NAV_BAR_HOME_LINK_CLICKED)}})]}),!p&&(0,i.tZ)("div",{ref:I,className:e0.titleContainer,style:(0,o._)({flexGrow:0},z?{transform:"translateX(".concat(Q?-j:0,"px)")}:null),children:(0,i.tZ)(e$.xv,{as:"h1",className:s()(e0.title,{[null!==(t=e0.titleWithWordmark)&&void 0!==t?t:""]:b.logo_url_wide}),font:"pub-headings",children:(0,i.tZ)(eQ.A0,{href:$,children:b.logo_url_wide?(0,i.tZ)("img",{alt:b.name,src:(0,A.zF4)(b.logo_url_wide,null,{height:2*H,crop:"limit",leadingSegments:["e_trim:10:white","e_trim:10:transparent"]}),style:(0,o._)({display:"block",height:H},z?{transform:"scale(".concat(W,")"),transformOrigin:Q?"left":"center"}:null)}):b.name})})}),(0,i.tZ)(G.gq,{justifyContent:"end",style:{flexBasis:0,flexGrow:1},children:(0,i.tZ)("div",{ref:N,className:e0.buttonsContainer,style:z?{transform:"translateX(".concat(j,"px)")}:void 0,children:(0,i.tZ)(eM,{freeSignup:a,freeSignupEmail:l,hasViralGiftsCount:m,isAccountContext:h,isMeetingsActive:g,isPublishContext:y,pub:b,showCustomerSupportModeModal:w,user:Z})})})]}),T&&(y?(0,i.tZ)(eK,{hasMeetingsBooked:d,isMeetingsActive:g,pub:b,selectedSectionId:C,user:Z}):(0,i.tZ)(eU,{isChatActive:v,isMeetingsActive:g,pub:b,selectedSectionId:C}))]}),(0,i.tZ)("div",{style:{height:q}})]})})},e2=e=>{let{forceMaximized:t,forceMinimized:n,hasExpandableTopBar:o,isMobile:i,showNavBar:a,showWordmark:s}=e,[l,u]=(0,r.eJ)(!1),c=(0,r.sO)(null),m=!!n||!t&&l,_=e=>i?a?44:56:o?e?72:120:s?88:72,p=a?i?45:50:0,h=_(n)+p,v=_(m),g=(0,r.I4)(()=>{let e=c.current,t=document.documentElement.scrollTop||document.body.scrollTop;if(c.current=t,!d()(e))t>e?t>h+5&&u(!0):t<=0&&u(!1)},[h]);return(0,r.d4)(()=>(window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)),[g]),{currentMenuHeight:v+p,currentTopBarHeight:v,isMinimized:m,maxMenuHeight:h}},e4=e=>{let{buttonsRef:t,titleRef:n,horizontalGap:o,horizontalPadding:i}=e,{isMobile:a}=(0,J.v9)(),[s,l]=(0,r.eJ)(!a),d=(0,r.I4)(()=>{if(!t.current||!n.current)return;if(a){l(!1);return}let e=t.current.getBoundingClientRect().width,r=n.current.getBoundingClientRect().width;l(.5*document.body.clientWidth-e-o-i>.5*r)},[t,o,i,a,n]);return(0,r.d4)(()=>(window.addEventListener("resize",d),d(),setTimeout(d,0),()=>{window.removeEventListener("resize",d)}),[d]),{shouldCenterTitle:s}}},21061:function(e,t,n){n.d(t,{l:()=>s});var o=n(30396),i=n(24350),r=n.n(i),a=n(81977);let s=e=>{let{pub:t}=e,n=r()(t.sections,"id"),{setting:i,save:s}=(0,a.m)({key:"archived_section_ids",fallback:[]}),[l,d]=(0,o.eJ)(i),[u,c]=(0,o.eJ)(!1),m=async()=>{c(!0),await s({setting:l})};return{isSaving:u,ids:l,onChange:e=>{let{ids:t}=e;d(t.filter(e=>n[e]))},onSave:m}}},73207:function(e,t,n){n.d(t,{I:()=>d});var o=n(30396),i=n(24350),r=n.n(i),a=n(78718),s=n.n(a),l=n(81977);let d=e=>{let{pub:t,pubSetting:n="column_section_ids"}=e,i=r()(null==t?void 0:t.sections,"id"),{setting:a,save:d}=(0,l.m)({key:n,fallback:{metadata:{},order:[]}}),[u,c]=(0,o.eJ)(a.order),[m,_]=(0,o.eJ)(a.metadata),[p,h]=(0,o.eJ)(!1),v=async()=>{h(!0),await d({setting:{order:u,metadata:s()(m,u)}})};return{isSaving:p,metadata:m,ids:u,onChangeMetadata:e=>{let{metadata:t}=e;_(t)},onChangeOrder:e=>{let{ids:t}=e;c(t.filter(e=>i[e]))},onSave:v}}},98130:function(e,t,n){n.d(t,{L:()=>d});var o=n(30396),i=n(39693),r=n.n(i),a=n(24350),s=n.n(a),l=n(81977);let d=e=>{let{pub:t}=e,n=s()(t.sections,"id"),{setting:i,save:a}=(0,l.m)({key:"event_section_ids",fallback:[]}),[d,u]=(0,o.eJ)(i),[c,m]=(0,o.eJ)(!1),_=async()=>{m(!0),await a({setting:d})};return{initialSections:r()(i.map(e=>n[e])),isSaving:c,ids:d,sections:r()(d.map(e=>n[e])),onChange:e=>{let{ids:t}=e;u(t.filter(e=>n[e]))},onSave:_}}},81977:function(e,t,n){n.d(t,{m:()=>i});var o=n(56629);let i=e=>{let t,{key:n,fallback:i}=e,{getSettingFor:r,changeSetting:a}=(0,o.So)(),s=r(n);try{t=s?JSON.parse(s):i}catch(e){t=i}return{setting:t,save:async e=>{let{setting:t}=e;await a({[n]:JSON.stringify(t)})}}}},94778:function(e,t,n){n.d(t,{c:()=>m});var o=n(30396),i=n(39693),r=n.n(i),a=n(24350),s=n.n(a),l=n(78718),d=n.n(l),u=n(81977);let c=["mediumYellow","darkGreen","mediumRed","darkOrange","mediumPurple","mediumBlue"],m=e=>{let{pub:t}=e,n=s()(t.sections,"id"),{setting:i,save:a}=(0,u.m)({key:"video_section_ids",fallback:{metadata:{},order:[]}});for(let e=0;e<i.order.length;e++){var l,m,_;let t=i.order[e];t&&((null===(l=i.metadata[t])||void 0===l?void 0:l.carouselColor)||(i.metadata[t]={youtubeUrl:null!==(_=null===(m=i.metadata[t])||void 0===m?void 0:m.youtubeUrl)&&void 0!==_?_:"",carouselColor:c[e%c.length]}))}let[p,h]=(0,o.eJ)(i.order),[v,g]=(0,o.eJ)(i.metadata),[f,y]=(0,o.eJ)(!1),b=async()=>{y(!0),await a({setting:{order:p,metadata:d()(v,p)}}),window.location.reload()};return{initialSections:r()(i.order.map(e=>n[e])),isSaving:f,metadata:v,ids:p,sections:r()(p.map(e=>n[e])),onChangeMetadata:e=>{let{metadata:t}=e;g(t)},onChangeOrder:e=>{let{ids:t}=e;h(t.filter(e=>n[e]))},onSave:b}}},12757:function(e,t,n){n.d(t,{Co:()=>F});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(30396),l=n(94184),d=n.n(l),u=n(66120),c=n(24840),m=n(43061),_=n(84488),p=n(86374),h=n(83320),v=n(87698),g=n(89320),f=n(9997),y=n(78327);let b=(0,n(6400).createContext)(!1);var C=n(95441),w=n(36518),Z=n(68833),x=n(43251),P=n(98422),k=n(94874),I=n(17540),N=n(15771),S=n(19081),M=n(44424),R=n(58175),B=n(60308),A=n(63651),L=n(47929),E=n(75983);let T=L.b3.userMenu,O="https://support.substack.com/hc/en-us/?utm_source=".concat(T);function F(e){var{user:t,pub:n}=e,l=(0,r._)(e,["user","pub"]);let{iString:u}=(0,C.M1)(),c=(0,s.qp)(b),{isMobile:m}=(0,P.v9)();return(0,a.tZ)(a.HY,{children:t?(0,a.tZ)(z,(0,i._)((0,o._)({},l),{user:t,pub:n})):(0,a.tZ)(N.zx,{href:(0,B.uXE)({for_pub:null==n?void 0:n.subdomain}),priority:"tertiary",size:m?"sm":"md",className:d()({"force-desktop":c}),native:!0,children:u("Sign in")})})}function z(e){let{user:t,pub:n,enableCustomerServiceMode:o,disableCustomerServiceMode:i,freeSignup:r}=e,{iString:s}=(0,C.M1)(),{activityUnreadCount:l}=(0,w.lR)(),{isMobile:d}=(0,P.v9)(),m=e=>()=>{(0,Z.j)(e)},_=d||!t.photo_url?(0,a.tZ)(N.hU,{priority:"tertiary",size:"sm",children:(0,a.tZ)(u.Z,{size:20})}):(0,a.tZ)(N.kG,{resetCss:!0,position:"relative",className:E.Z.avatarButton,showFocus:!0,animate:!0,radius:"full",children:(0,a.tZ)(I.Ct,{priority:"secondary",theme:"default",fillIcon:!0,placement:"bottom-right",content:(0,a.tZ)(p.Z,{size:14}),children:(0,a.tZ)(k.qE,{user:t,size:d?32:40,"aria-hidden":!0})})});return(0,a.BX)(M.v2,{trigger:_,onOpen:()=>(0,Z.j)(Z.FP.USER_MENU_OPENED),onClose:()=>(0,Z.j)(Z.FP.USER_MENU_DISMISSED),className:E.Z.dropdown,ariaLabel:s("More options"),children:[(0,a.tZ)(X,{user:t}),(0,a.BX)(M.xw,{children:[(0,a.tZ)(M.sN,{href:(0,B.E2n)({urlParams:{utm_source:T}}),onClick:m(Z.FP.USER_MENU_FEED_CLICKED),leading:(0,a.tZ)(S.hs,{children:(0,a.tZ)(g.Z,{size:20})}),native:!0,children:s("Home")}),(0,a.tZ)(M.sN,{href:(0,B.HMK)({utm_source:T}),onClick:m(Z.FP.USER_MENU_READER_CLICKED),leading:(0,a.tZ)(S.hs,{children:(0,a.tZ)(f.Z,{size:20})}),native:!0,children:s("Subscriptions")}),(0,a.tZ)(M.sN,{href:(0,A.Cnj)(),onClick:m(Z.FP.USER_MENU_CHAT_CLICKED),leading:(0,a.tZ)(S.hs,{children:(0,a.tZ)(v.Z,{size:20})}),native:!0,children:s("Chat")}),(0,a.tZ)(M.sN,{href:(0,B.Fu$)({utm_source:T}),onClick:m(Z.FP.USER_MENU_ACTIVITY_CLICKED),leading:(0,a.tZ)(S.hs,{children:(0,a.tZ)(h.Z,{size:20})}),native:!0,children:(0,a.BX)(S.hs,{flex:"grow",justifyContent:"space-between",children:[s("Activity"),l>0&&(0,a.tZ)(y.V,{className:"indicator-badge",count:l})]})}),(0,a.tZ)(M.sN,{href:(0,B._P8)(),onClick:m(Z.FP.USER_MENU_DISCOVER_CLICKED),leading:(0,a.tZ)(S.M5,{width:20,height:20,children:(0,a.tZ)(c.Z,{size:16,strokeWidth:2})}),native:!0,children:s("Explore")})]}),(0,a.tZ)(U,{freeSignup:null!=r&&r,pub:null!=n?n:null,user:t}),(0,a.tZ)(D,{pub:null!=n?n:null}),!t.reader_installed_at&&(0,a.tZ)(M.xw,{children:(0,a.tZ)(M.sN,{href:(0,B.tSX)({utm_campaign:L.VX.appMarketing,utm_content:L.fZ.userMenuLink}),priority:"accent",native:!0,children:s("Get the app")})}),(0,a.tZ)(q,{enableCustomerServiceMode:o,disableCustomerServiceMode:i,pub:null!=n?n:null,user:t}),(0,a.tZ)(V,{pub:null!=n?n:null})]})}let X=e=>{let{user:t}=e,{iString:n}=(0,C.M1)(),o=(0,x.Lw)(t,{utm_source:T}),i="",r="";return t&&(i=(null==t?void 0:t.profile_set_up_at)&&t.name?t.name:t.email,r=(null==t?void 0:t.profile_set_up_at)?t.handle?"@".concat(t.handle):null:n("Set up your profile")),(0,a.tZ)(M.sN,{href:o,onClick:()=>(0,Z.j)(Z.FP.USER_MENU_PROFILE_CLICKED),native:!0,children:(0,a.BX)(S.hs,{gap:12,alignItems:"center",children:[(0,a.tZ)(k.qE,{size:40,user:null!=t?t:void 0,"aria-hidden":!0}),(0,a.BX)(S.tu,{flex:"grow",children:[(0,a.tZ)(R.xv.B4,{weight:"semibold",children:i}),r&&(0,a.tZ)(R.xv.B4,{color:"secondary",children:r})]})]})})},U=e=>{let{freeSignup:t,user:n,pub:o}=e,{iString:i}=(0,C.M1)(),r=o&&(t||n&&(n.is_subscribed||n.is_free_subscribed)),s=!!(null==n?void 0:n.subdomain);return s||r?(0,a.BX)(M.xw,{children:[r&&(0,a.tZ)(M.sN,{href:(0,B.n1t)("/account",{utm_source:T}),onClick:()=>(0,Z.j)(Z.FP.USER_MENU_MANAGE_SUBSCRIPTION_CLICKED),priority:"secondary",native:!0,children:i("Manage subscription")}),s&&n.subdomain&&(0,a.tZ)(M.sN,{priority:"secondary",href:(0,B.c0Q)(n.subdomain,{params:{utm_source:L.b3.substack}}),native:!0,trailing:(0,a.tZ)(m.Z,{}),children:i("Dashboard")})]}):null},D=e=>{let{pub:t}=e,{iString:n}=(0,C.M1)();return(0,a.BX)(M.xw,{children:[(0,a.tZ)(M.sN,{href:(0,B.v3t)({utm_source:T}),onClick:()=>(0,Z.j)(Z.FP.USER_MENU_ACCOUNT_SETTINGS_CLICKED),priority:"secondary",native:!0,children:n("Settings")}),(0,a.tZ)(M.sN,{href:O,priority:"secondary",children:n("Support")}),(0,a.tZ)(M.sN,{href:(0,B.ZPN)({utm_source:T,for_pub:null==t?void 0:t.subdomain}),priority:"secondary",native:!0,children:n("Sign out")})]})},q=e=>{let{disableCustomerServiceMode:t,enableCustomerServiceMode:n,pub:o,user:i}=e;return(null==i?void 0:i.is_global_admin)&&(n||t)?(0,a.BX)(M.xw,{children:[n&&(0,a.tZ)(M.sN,{priority:"secondary",onClick:n,trailing:(0,a.tZ)(_.Z,{}),native:!0,children:"Enter support mode"}),t&&(0,a.tZ)(M.sN,{priority:"secondary",onClick:t,trailing:(0,a.tZ)(_.Z,{}),native:!0,children:"Exit support mode"}),o&&(0,a.tZ)(M.sN,{priority:"secondary",href:"".concat((0,A.SVA)({subdomain:"admin"}),"/publications/").concat(o.id),trailing:(0,a.tZ)(_.Z,{}),native:!0,children:"Open in Underground"})]}):null},V=e=>{let{pub:t}=e,{iString:n}=(0,C.M1)();return(0,a.tZ)(M.xw,{children:(0,a.tZ)(R.xv.B4,{size:12,color:"secondary",children:(0,a.BX)(S.hs,{gap:12,padding:8,className:"footer",children:[(0,a.tZ)(R.hh,{href:(0,B.cdl)({utm_source:T}),children:n("About")}),(0,a.tZ)(R.hh,{href:(0,B.RF2)({pub:t,utm_source:T}),children:n("Privacy")}),(0,a.tZ)(R.hh,{href:(0,B.P8A)({pub:t,utm_source:T}),children:n("Terms")}),(0,a.tZ)(R.hh,{href:(0,B.WFt)({utm_source:T}),children:n("Data")})]})})})}},98585:function(e,t,n){n.d(t,{Ml:()=>u});var o=n(16584),i=n(6400),r=n(30396),a=n(42441),s=n.n(a),l=n(74312);let d=(0,i.createContext)({open:()=>void 0});function u(e){let{children:t,load:i,useLocalNavigation:a}=e,[u,c]=(0,r.eJ)(!1);(0,r.d4)(()=>{if(!i)return;let e=e=>{e.preventDefault(),c(!0)};return s().bind(["/","command+k"],e),()=>{s().unbind(["/",e]),s().unbind(["command+k",e])}},[i]);let m=(0,r.Ye)(()=>({open:()=>{i&&c(!0)}}),[i]);return i?(0,o.BX)(d.Provider,{value:m,children:[t,(0,o.tZ)(l.cr,{module:"@/frontend/substack/GlobalSearch",resolve:e=>e.GlobalSearch,onRequest:()=>Promise.all([n.e("546"),n.e("5850"),n.e("8842"),n.e("2290")]).then(n.bind(n,81202)),isOpen:u,onClose:()=>c(!1),useLocalNavigation:a})]}):(0,o.tZ)(o.HY,{children:t})}},35543:function(e,t,n){n.d(t,{Sv:()=>M,Xe:()=>I,oJ:()=>N,oh:()=>S,yr:()=>R});var o=n(7409),i=n(99282),r=n(58865),a=n(16584),s=n(30396),l=n(82569),d=n.n(l),u=n(94734),c=n(17520),m=n(69241),_=n(19548),p=n(95441),h=n(60807),v=n(54371),g=n(6910),f=n(48980),y=n(63018),b=n(98914),C=n(44424),w=n(70379),Z=n(88817),x=n(23945);function P(){let e=(0,r._)(["Followed ",""]);return P=function(){return e},e}function k(){let e=(0,r._)(["Unfollowed ",""]);return k=function(){return e},e}function I(e){let t=(0,h.aF)();return(0,y._I)("/api/v1/feed/following",(0,o._)({auto:!!t},e))}function N(){let{mutate:e}=(0,m.kY)();return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return e("/api/v1/feed/following",...n)}}function S(e,t,n){let{isFollowing:o,toggle:i}=M(e,t,n),r=(0,h.aF)(),s=(0,_.gc)(null==e?void 0:e.id),l=!!(r&&e&&r.id!==e.id)&&!s,d=[];return l&&d.push((0,a.tZ)(C.sN,{leading:o?(0,a.tZ)(g.m,{stroke:"var(--color-fg-primary)"}):(0,a.tZ)(v.w,{stroke:"var(--color-fg-primary)"}),onClick:i,children:o?"Unfollow":"Follow"})),d}function M(e,t,n,r){let s=(0,h.aF)(),{onboardingModalRef:l,requireLogin:m}=(0,Z.SJ)(),_=function(e,t){let{data:n}=I(t);return(null!=n?n:[]).includes(null!=e?e:0)}(null==e?void 0:e.id,r),{mutate:v,data:g}=I(r),y=(0,w.pm)(),C=(0,x.Q1)((null==e?void 0:e.name)||""),{iString:N,iTemplate:S}=(0,p.M1)(),M=async r=>{if(e){if(!s&&l.current){m?m():l.current.open();return}v(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r?[...t,e.id]:d()(t,e.id)},{revalidate:!1});try{await (0,f.rd)("/api/v1/feed/".concat(e.id,"/follow"),{method:r?"POST":"DELETE",json:{surface:t,noteId:n}}),y.popToast(e=>(0,a.tZ)(w.FN,(0,i._)((0,o._)({},e),{Icon:r?u.Z:c.Z,text:r?S(P(),C):S(k(),C),cta:N("Undo"),onAccept:()=>M(!r)})))}catch(e){y.popToast(t=>(0,a.tZ)(w.FN,(0,i._)((0,o._)({},t),{text:(0,b.zx)(e)})));return}}};return{isFollowing:_,toggle:()=>M(!_),isLoaded:!!g}}function R(e,t,n){let{isFollowing:o,toggle:i}=M(e,t,n),[r,a]=(0,s.eJ)(!1);return{isFollowing:o,buttonProps:{onClick:()=>{i(),o||a(!0)},onMouseLeave:()=>a(!1)}}}},36518:function(e,t,n){n.d(t,{N$:()=>p,lR:()=>v});var o=n(16584),i=n(6400),r=n(30396),a=n(32351),s=n(14952),l=n(48980),d=n(8635),u=n(7882),c=n(98750),m=n(98914),_=n(6070);function p(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:r,children:a}=e;return(0,o.tZ)(g,{defaultState:null==t?void 0:t.activity,shouldLoad:n,shouldPoll:i,activityToken:r,children:a})}let h=(0,i.createContext)({lastViewedAt:null,activityUnreadCount:0,activityUnreadAtMax:!1,refetch:async()=>!0,markAllAsRead:async()=>{},hasLoadedOnce:!1});function v(){return(0,r.qp)(h)}function g(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:p,children:v}=e,g=(0,u.ib)({pathname:"/api/v1/activity/unread",deps:[],auto:n,initialResult:t,query:{token:p}}),f=(0,s.Ij)(),y=!!f&&(0,_.HD)({pub:f}),b=!(0,c.th)()&&!y,C=async()=>{let e=await (0,l.rd)("/api/v1/activity/unread",{method:"post",json:{after:new Date().toISOString(),token:p}});g.setResult(e)};(0,d.Z)(async()=>{if(i&&n&&(0,m.dr)()){var e;let t=(null===(e=g.result)||void 0===e?void 0:e.count)||0,n=await g.refetch();if(t!==(!(n instanceof Error)&&n.count||0))return!0}},6e4);let w=null!=g.result?g.result.count:0;return(0,r.d4)(()=>{try{var e,t;null===(e=(t=navigator).setAppBadge)||void 0===e||e.call(t,w)}catch(e){console.warn(e)}},[w]),(0,o.BX)(h.Provider,{value:{lastViewedAt:null!=g.result?g.result.lastViewedAt:null,activityUnreadCount:w,activityUnreadAtMax:null!=g.result&&g.result.max,refetch:g.refetch,markAllAsRead:C,hasLoadedOnce:g.hasLoadedOnce},children:[(0,o.tZ)(a.Metadata,{badge:b?w:void 0}),v]})}h.displayName="NotificationsContext"},42375:function(e,t,n){n.d(t,{$U:()=>m,rI:()=>p});var o=n(16584),i=n(98661),r=n(30396),a=n(25642),s=n(27744),l=n(75822),d=n(88817),u=n(75419),c=n(41233);function m(e){let{state:t,dispatch:n,surface:i,children:m}=e,{onboardingModalRef:p}=(0,d.SJ)(),h=(0,r.Ye)(()=>({dispatch:n}),[]);return(0,o.tZ)(_.Provider,{value:i,children:(0,o.tZ)(s.RR.Provider,{value:h,children:(0,o.tZ)(s.ev.Provider,{value:t,children:(0,o.tZ)(a.ju,{children:(0,o.tZ)(u.Au,{children:(0,o.BX)(l.qS,{children:[m,(0,o.tZ)(c.fA,{isOpen:!!t.isSigningIn,onCancel:()=>n({type:"sign_in",payload:{isSigningIn:!1}}),onSuccess:()=>{n({type:"sign_in",payload:{isSigningIn:!1}}),document.location.reload()},onSignup:()=>{var e;n({type:"sign_in",payload:{isSigningIn:!1}}),null===(e=p.current)||void 0===e||e.open()},noExit:t.signInNoExit})]})})})})})})}let _=(0,i.createContext)("feed");function p(){return(0,r.qp)(_)}},43251:function(e,t,n){n.d(t,{Lw:()=>i});var o=n(60308);function i(e,t){return(null==e?void 0:e.profile_set_up_at)?(0,o.NNq)(e,t):(0,o.Nhr)((null==t?void 0:t.utm_source)?{utm_source:t.utm_source}:void 0)}},59480:function(e,t,n){n.d(t,{Uu:()=>l});var o=n(68833);let i=["sort"],r=["sort","selection"],a=[];function s(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?r:i).includes(e)||n.searchParams.delete(e);return n.toString()}function l(e){setTimeout(()=>(function(e){var t,n;let{previous:i,url:r}=e;if("undefined"==typeof window)return;let l=s(r,!1),d=s(r,!0),{head:u}=document;null===(t=u.querySelector("link[rel=canonical]"))||void 0===t||t.setAttribute("href",l),null===(n=u.querySelector('meta[property="og:url"]'))||void 0===n||n.setAttribute("content",d),a.push(r),setTimeout(()=>{(0,o.jA)({previous:i,url:r})},100)})(e),0)}},46234:function(e,t,n){n.d(t,{B:()=>d});var o=n(7409),i=n(16584),r=n(19081),a=n(58175),s=n(14773),l=n(63651);let d=e=>{let{firehoseFeedUrl:t,pub:n,section:d,trackingSource:u,variant:c="default"}=e,m=(0,s.n1)("/p/how-do-i-add-a-bulwark-member-only",(0,o._)({utm_source:u},d?{utm_content:d.id}:null)),_=(0,s.n1)("/account/add-all-podcasts",(0,o._)({utm_source:u},d?{utm_content:d.id}:null)),p=t?(0,i.BX)(a.xv.B3,{as:"li",font:"text",children:["Click here to set up your podcast app for"," ",(0,i.tZ)("a",{href:t,rel:"noopener noreferrer",target:"_blank",children:"everything in one feed"})]}):null,h=(0,l.W1P)(n,{params:{utm_source:u}});return(0,i.tZ)("div",{className:"container-o06YlK",children:"member-only"===c?(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(a.xv.B3,{as:"li",font:"text",children:["Want to listen without ads? Join Bulwark+ for exclusive ad-free versions of all Bulwark shows."," ",(0,i.tZ)("a",{href:h,rel:"noopener noreferrer",target:"_blank",children:"Upgrade now"})]}),(0,i.BX)(a.xv.B3,{as:"li",font:"text",children:["Already a Bulwark+ member? Login to access premium shows. ",(0,i.tZ)("a",{href:m,children:"Learn more here"})]})]}):(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(a.xv.B3,{as:"li",font:"text",children:["Learn about"," ",(0,i.tZ)("a",{href:m,rel:"noopener noreferrer",target:"_blank",children:"setting up your Bulwark+ private podcast feeds"})]}),p||(0,i.BX)(a.xv.B3,{as:"li",font:"text",children:["Add the Bulwark Premium Show"," ",(0,i.tZ)("a",{href:_,rel:"noopener noreferrer",target:"_blank",children:"super feed"})]})]})})}},30733:function(e,t,n){n.d(t,{N:()=>s});var o=n(16584),i=n(94184),r=n.n(i),a=n(71068);let s=e=>{let{children:t,columns:n=2,paddingTop:i=24}=e,s=(0,a.oB)({paddingTop:i,paddingX:16,paddingBottom:32});return(0,o.tZ)("div",{className:r()("container-kIrj2N",s,{"containerThreeColumn-Rot594":3===n,"containerFourColumn-vOHVwe":4===n}),children:t})}},84370:function(e,t,n){n.d(t,{T:()=>s});var o=n(16584),i=n(43570),r=n(58175),a=n(52503);function s(e){let{modifier:t,children:n,className:s}=e,l=function(e){let t=navigator.platform.toLowerCase().includes("mac");switch(null==e?void 0:e.toLowerCase()){case"cmd":return t?"âŒ˜":"Ctrl + ";case"shift":return t?"â‡§":"Shift + ";case"alt":case"opt":return t?"âŒ¥":"Alt + ";case"ctrl":return t?"âŒƒ":"Ctrl + ";case"esc":return"Esc";case"left":return"â†";case"right":return"â†’";case"up":return"â†‘";case"down":return"â†“";default:return""}}(t);return(0,o.tZ)(i.Vp,{priority:"secondary-outline",theme:"default",className:s,children:(0,o.BX)(r.xv,{as:"kbd",font:"text",weight:"regular",color:"secondary",className:a.Z.kbd,children:[l,n]})})}},78096:function(e,t,n){n.d(t,{dm:()=>v,gd:()=>g,yo:()=>f});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(94184),l=n.n(s),d=n(98661),u=n(86374),c=n(95441),m=n(15771),_=n(19081),p=n(44424),h=n(87815);let v=e=>{var{priority:t="secondary-outline",size:n="md"}=e,i=(0,r._)(e,["priority","size"]);"secondary-outline"===t&&(t="tertiary");let s="tertiary"===t;return(0,a.tZ)(b.Provider,{value:{priority:t,size:n},children:(0,a.tZ)(_.X2,(0,o._)({radius:"sm"===n?"xs":"sm",className:l()(h.Z.group,s&&h.Z.outlined)},i))})},g=e=>{var{children:t,priority:n="primary",size:s="md",menuItems:l,additionalMenuProps:d={}}=e,m=(0,r._)(e,["children","priority","size","menuItems","additionalMenuProps"]);let{iString:_}=(0,c.M1)();return(0,a.BX)(v,{priority:n,size:s,children:[(0,a.tZ)(f,(0,i._)((0,o._)({},m),{children:t})),(0,a.tZ)(p.v2,(0,i._)((0,o._)({},d),{layerOptions:{placement:"bottom-end"},trigger:(0,a.tZ)(y,(0,i._)((0,o._)({},m),{"aria-label":_("Dropdown menu"),children:(0,a.tZ)(u.Z,{size:"sm"===s?16:"md"===s?20:24})})),children:l}))]})},f=(0,d.forwardRef)((e,t)=>{var{className:n}=e,s=(0,r._)(e,["className"]);let{priority:u,size:c}=(0,d.useContext)(b);return(0,a.tZ)(m.zx,(0,i._)((0,o._)({priority:u,size:c,className:l()(h.Z.segment,n)},s),{ref:t}))}),y=(0,d.forwardRef)((e,t)=>{var{className:n}=e,s=(0,r._)(e,["className"]);let{priority:u,size:c}=(0,d.useContext)(b);return(0,a.tZ)(m.hU,(0,i._)((0,o._)({priority:u,size:c,className:l()(h.Z.segment,n)},s),{ref:t}))}),b=(0,d.createContext)({priority:"primary",size:"md"})},89263:function(e,t,n){n.d(t,{n:()=>u});var o=n(7409),i=n(99282),r=n(98848),a=n(16584),s=n(30396),l=n(82876),d=n(51776);let u=e=>{var{details:t,disabled:n,errors:u,helpText:c,inputRef:m,label:_,name:p,paddingBottom:h,paddingTop:v,value:g,onChange:f}=e,y=(0,r._)(e,["details","disabled","errors","helpText","inputRef","label","name","paddingBottom","paddingTop","value","onChange"]);let b=(0,s.I4)(e=>{f(e.target.value)},[f]);return(0,a.tZ)(l.g,{label:_,details:t,errors:u,helpText:c,paddingTop:v,paddingBottom:h,wrapWithLabel:!0,children:(0,a.tZ)(d.oi,(0,i._)((0,o._)({},y),{ref:m,error:!!(null==u?void 0:u.length),disabled:n,name:p,value:g,onChange:b}))})}},83010:function(e,t,n){n.d(t,{H:()=>u,n:()=>c});var o=n(7409),i=n(99282),r=n(16584),a=n(6400),s=n(30396),l=n(68833);let d=(0,a.createContext)({surface:null,platform:"web"});function u(e){let{children:t,trackingProps:n}=e,i=(0,s.qp)(d),a=(0,s.Ye)(()=>(0,o._)({},i,n),Object.values(n));return(0,r.tZ)(d.Provider,{value:a,children:t})}function c(){let e=(0,s.qp)(d);return(t,n)=>(0,l.j)(t,(0,o._)((0,i._)((0,o._)({},e),{ui:"page"===e.surface?"activity-page":e.surface}),n))}},8828:function(e,t,n){n.d(t,{dd:()=>r,oH:()=>i});var o=n(48980);let i=function(){let{before:e,tab:t="all"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async n=>{try{var i,r;let a=await (0,o.rd)("/api/v1/messages/inbox",{query:{paginate:"true",tab:t,before:e}});n({type:"inbox-new_items",payload:{threads:null==a?void 0:a.threads,hasMore:null==a?void 0:a.more,directMessagesUnreadCount:null==a?void 0:a.directMessagesUnreadCount,pendingInviteCount:null==a?void 0:a.pendingInviteCount,pendingInviteUnreadCount:null!==(i=null==a?void 0:a.pendingInviteUnreadCount)&&void 0!==i?i:null==a?void 0:a.pendingInviteCount,pubChatUnreadCount:null!==(r=null==a?void 0:a.pubChatUnreadCount)&&void 0!==r?r:0,mostRecentChatTimestamp:a.mostRecentChatTimestamp}})}catch(e){if(console.warn("error",e),e instanceof o.kp)n({type:"inbox-new_error",payload:{error:e}});else throw e}}},r=e=>async t=>{"direct-message"===e&&t(i({tab:"people"})),t({type:"inbox-set_filter",payload:e})}},8113:function(e,t,n){n.d(t,{aM:()=>M});var o=n(7409),i=n(99282),r=n(16584),a=n(30396),s=n(39693),l=n.n(s),d=n(44908),u=n.n(d),c=n(45578),m=n.n(c),_=n(69241),p=n(60807),h=n(12765),v=n(48980),g=n(9682),f=n(98914),y=n(8828),b=n(78308),C=n(97842),w=n(54584),Z=n(86190),x=n(46603),P=n(16889),k=n(91400),I=n(92039),N=n(98012),S=n(17440);function M(e){let{children:t,surface:n}=e,{user:s,userSettings:l}=(0,p.SE)(),d=l.newest_seen_chat_item_published_at,[{path:u}]=(0,g.tv)(),c=(0,k.XA)(),m=(0,I.rG)(),_=(0,I.m)(),[v,f]=(0,h.L)(E,(0,i._)((0,o._)({},C.UX),{user:s,users:new Map(s?[[s.id,s]]:[])}));(0,C.WG)({auto:!!s},{onSuccess:e=>{f({type:"inbox-unread_count",payload:e})}});let b=(0,a.sO)(0);return(0,a.d4)(()=>{if(m&&s)return m.listen({["user:".concat(s.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?f($(e)):"chat:updated-post"===e.type?f(ee(e)):"chat:new-post"===e.type&&f(et(e))}}})},[m]),(0,a.d4)(()=>{"open"===_&&s&&f((0,y.oH)())},[_]),(0,a.d4)(()=>{if("open"!==_){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;s&&e-b.current>5e3&&"hidden"!==t&&(b.current=e,f((0,y.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},o=(0,P.n)(t);return u.startsWith("/chat")&&!c?n():t(),()=>{e&&clearTimeout(e),o()}}},[d,u,c,f,_]),(0,r.tZ)(w.o.Provider,{value:n,children:(0,r.tZ)(C.ge.Provider,{value:f,children:(0,r.tZ)(C.ky.Provider,{value:v,children:t})})})}let R={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},B={isLoading:!1,hasMore:!1,error:null},A={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},L={before:B,after:(0,i._)((0,o._)({},B),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function E(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,a=null!==(n=e.chats.get(r.id))&&void 0!==n?n:R;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,r.id,(0,i._)((0,o._)({},a),{publication:r})),publications:(0,S.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:d,mostRecentChatTimestamp:u}=t.payload,c=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...l()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...l()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:a}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(a)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...l()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:R;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...l()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},A,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,a,s,l,d,u,c,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!==(u=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==u?u:null,muteStatus:null!==(c=t.muteStatus)&&void 0!==c?c:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(s=e.user)||void 0===s?void 0:null===(a=s.primary_publication)||void 0===a?void 0:a.id)||(null===(l=e.inbox.threads.get(t.id))||void 0===l?void 0:l.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(d=t.recentMessage)||void 0===d?void 0:d.id)&&void 0!==m?m:null,isPrimary:!1})}),_=Q(m),p=(0,S.zg)(e.inbox.threads,m,e=>e.id),h=Q([...p.values()]),{filter:v}=e.inbox,g=(0,b.A)(v);return U((0,i._)((0,o._)({},c),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[g]:{hasMore:r&&_===h,isLoading:!1}}),threads:p,directMessagesUnreadCount:a,pendingInviteCount:s,pendingInviteUnreadCount:d,mostRecentChatTimestamp:u})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,b.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=j(n.id);return(0,i._)((0,o._)({},e),{chats:(0,S.i4)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.i4)(e.inbox.threads,j(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;j(n.id);let r=(0,S.Rg)(e.inbox.threads,j(n.id),{id:j(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,S.FN)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,S.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,o._)({},r,A))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=H(n);return(0,i._)((0,o._)({},e),{conversations:(0,S.i4)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:a,error:s}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[a].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,i._)((0,o._)({},l),{[a]:{isLoading:!1,cursor:r,error:s}}))})}case"conversation-load_more":{let r;let{edge:a,cursor:s,page:{thread:d,replies:u,publications:c,comments:m,pastCursor:_,futureCursor:p,profile:h,subscriberContext:v}}=t.payload,g=u.map(e=>e.comment.id),f=new Set(g),y=e.conversations.get(d.id);if(!y)return console.error("Attempting to load messages for missing conversation"),e;if(y[a].cursor!==s)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let b=y.replyIds.filter(e=>!f.has(e));b="before"===a?g.concat(b):b.concat(g),r=s?{[a]:{isLoading:!1,cursor:"before"===a?_:p,error:null}}:{before:{isLoading:!1,cursor:_,error:null},after:{isLoading:!1,cursor:p,error:null}};let C=(0,i._)((0,o._)({},y,r),{thread:d,replyIds:b}),w=h&&(null===(n=d.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),Z=(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,d.id,C),communityComments:Y(e.communityComments,u.flatMap(e=>l()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.created_at),users:(0,S.zg)(e.users,u.flatMap(e=>{var t;return l()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,S.Rg)(e.profiles,h.id,(0,i._)((0,o._)({},w,h),{subscriberContext:v})):e.profiles,publications:c?(0,S.zg)(e.publications,c,e=>e.id):e.publications,notes:m?(0,S.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===a||!s)return z(Z,d.id,null);return Z}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:s}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let d={comment:(0,i._)((0,o._)({},F(e,t.payload)),{quote_id:null!==(r=l.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,f.Fo)(a)}:void 0,quote:s,quoteId:null==s?void 0:s.comment.id},u=(0,i._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,d.comment.id]});return z((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,d.comment.id,d),conversations:(0,S.Rg)(e.conversations,n,u)}),n,d.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:a,publications:s,comments:l}=t.payload;n=null!=n?n:a.client_id;let d=e.conversations.get(r);if(!d)throw Error("Attempted to post message to missing conversation");let u=n&&e.communityComments.get(n),c=new Map(e.communityComments),m=W(a);c.set(a.comment.id,u?(0,i._)((0,o._)({},m),{clientId:u.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:u.comment.media_uploads})}):m),a.quote&&c.set(a.quote.comment.id,W(a.quote));let _=d.replyIds,p=a.comment.id;return n&&(_=_.map(e=>e===n?p:e)),_.includes(p)||(_=[..._,p]),_=[...new Set(_)],z((0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,r,(0,i._)((0,o._)({},d),{replyIds:_})),communityComments:c,publications:s?(0,S.zg)(e.publications,s,e=>e.id):e.publications,notes:l?(0,S.zg)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,n,(0,i._)((0,o._)({},a),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return V(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return V(e,n,{unmute_at:o?(0,N.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=r!==a.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:X(a.comment,r,s)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,a,s,l,d;let{publication_id:c}=t.payload,m=null!==(n=e.chats.get(c))&&void 0!==n?n:R;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),s=Y(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=j(c),d=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},_=(0,i._)((0,o._)({},e),{users:(0,S.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:s,chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m,d),{posts:u()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return G(null===(n=s.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(o=s.get(t))||void 0===o?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!==(t=null==a?void 0:a.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,i._)((0,o._)({},_),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(_)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(c),{lastViewedAt:new Date().toISOString()})}),chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),s={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(a=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==a?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0};return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,s.communityPost.id,s),chats:(0,S.Rg)(e.chats,c,(0,i._)((0,o._)({},m),{posts:[s.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:a}=t.payload,s=new Map(e.communityPosts);s.set(a,n);let l=Array.from(new Set([a,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,S.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:s,chats:(0,S.Rg)(e.chats,r,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:a}=t.payload,s=new Map(e.communityPosts);s.delete(n),s.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.F5)(e.inbox.threads,j(a),{communityPostId:r.communityPost.id})}),communityPosts:s,chats:(0,S.Rg)(e.chats,a,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!J(a)||!(null===(s=a.communityPost)||void 0===s?void 0:s.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:X(a.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!J(a)||!(null===(l=a.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:X(a.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{O(t,s);let n=e.replies.get(t);n&&n.comments.forEach(e=>{O(e,s)})});let u=null===(d=e.chats.get(r))||void 0===d?void 0:d.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i?void 0:null===(o=i.communityPost)||void 0===o?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null===(o=e.communityPosts.get(t))||void 0===o?void 0:o.communityPost,a=null===(i=e.communityPosts.get(n))||void 0===i?void 0:i.communityPost;return G(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],c=(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:s,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.FN)(e.inbox.threads,j(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=u?u:null}):e)})});return(0,i._)((0,o._)({},c),{inbox:(0,i._)((0,o._)({},c.inbox),{threadList:D(c)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!J(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityPosts.get(n);if(!a||!J(a))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:a}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,S.Rg)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,a=e.communityPosts.get(n);if(!a||!J(a))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,o._)({},a.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,a,s,d,c,m,_,p;let h,g=null,f=null;"parentCommentId"in(p=t).payload&&p.payload.parentCommentId?f=t.payload.parentCommentId:"postId"in t.payload&&(g=t.payload.postId);let y=e=>f?{replies:e}:{comments:e};h=f?null!==(n=e.replies.get(f))&&void 0!==n?n:L:g&&null!==(r=e.comments.get(g))&&void 0!==r?r:L;let b=f?e.replies:e.comments,C=null!=f?f:g;switch(t.type){case"replies-clear":case"comments-clear":return C?(0,o._)({},e,y((0,S.Rg)(b,C,L))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,s=(0,i._)((0,o._)({},B),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{before:"desc"===n?s:B,after:"asc"===n?s:B,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!==(a=null==h?void 0:h.isLoaded)&&void 0!==a&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:a,replies:s,more:d,moreAfter:c,moreBefore:m,lastViewedAt:_}}=t.payload,p=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||R;n.muteStatus||(p=(0,S.Rg)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let v=s.map(e=>e.comment.id),g=Y(e.communityComments,s.flatMap(e=>l()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.updated_at);if(a)g.set(a.comment.id,(0,i._)((0,o._)({},a),{userId:a.user.id}));let f=(0,S.zg)(e.users,l()([null==r?void 0:r.communityPost.user,null==a?void 0:a.user]),e=>e.id),w=C?b.get(C):null,Z=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:d,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:c,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,S.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:g}),p?{chats:p}:{}),{users:new Map([...f,...s.map(e=>[e.user.id,e.user])])}),y((0,S.Rg)(b,C,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:u()([...h.comments,...v]).sort((e,t)=>{var n,o;return G(null===(n=g.get(e))||void 0===n?void 0:n.comment.created_at,null===(o=g.get(t))||void 0===o?void 0:o.comment.created_at)}).filter(e=>{var t;return(null===(t=g.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),Z),{order:"after"!==n||d?h.order:"desc",isLoaded:!0,lastViewedAt:_}))))}case"replies-target":case"comments-target":return C?(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,S.FN)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,S.FN)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return C?(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return C?(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},F(e,n)),{quote_id:null!==(c=null===(s=n.quoteReply)||void 0===s?void 0:s.comment.id)&&void 0!==c?c:null,post_id:n.postId,parent_id:f}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(d=n.quoteReply)||void 0===d?void 0:d.comment.id,pub_roles:n.pubRoles},a=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,r.comment.id,r)}),y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(f){let n=e.communityComments.get(f);if(n&&K(n)){let r=T(n.comment,e.user,t.payload.postId);a.communityComments.set(f,(0,i._)((0,o._)({},n),{comment:r}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&J(l)){let n=T(l.communityPost,e.user,t.payload.postId);a.communityPosts=(0,S.Rg)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},l),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(r.comment.id,W(r));let s=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:a}),y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{comments:s}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,W(r))}),y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,W(r)),users:r.user?(0,S.Rg)(e.users,r.userId,r.user):e.users}),y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof v.kp){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,S.Rg)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null})),users:t.user?(0,S.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,y((0,S.Rg)(b,C,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!K(a)||!(null===(m=a.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:X(a.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!K(a)||!(null===(_=a.comment)||void 0===_?void 0:_.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:X(a.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,a=e.communityComments.get(n);if(!a||!K(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,o._)({},a.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!K(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,a=e.communityComments.get(n);if(!a||!K(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityComments.get(n);if(!a||!K(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,S.Rg)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,i._)((0,o._)({},a.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function T(e,t,n){var r,a;let s;return(t&&t.photo_url&&(s=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(s=m()([...s,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:s,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:s,comment_count:1+(null!==(a=e.comment_count)&&void 0!==a?a:0)}):e}function O(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function F(e,t){var n,r,a;return(0,i._)((0,o._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(a=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==a?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function z(e,t,n){let r=H(t),a=e.inbox.threads.get(r),s=(null==a?void 0:a.type)==="direct-message"?a:null,l=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,S.Rg)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},s),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},l),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(l)})})}function X(e,t,n){var r,a;let s=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!==(r=l[t])&&void 0!==r?r:0)+(n?1:-1),n&&s&&(l[s]=(null!==(a=l[s])&&void 0!==a?a:0)-1),(0,i._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function U(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:D(e)})})}function D(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:G(q(e,t),q(e,n))).map(e=>e.id)}function q(e,t){var n,o,i,r;return"chat"===t.type?null!==(i=t.communityPostId&&(null===(o=e.communityPosts.get(t.communityPostId))||void 0===o?void 0:o.communityPost.created_at))&&void 0!==i?i:t.timestamp:null!==(r=null===(n=(0,x._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function V(e,t,n){let r=e.conversations.get(t),a=null==r?void 0:r.thread;if(!r||!a)throw Error("Tried to update a conversation that does not exist.");let s=e.user;if(!s)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,S.Rg)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},a),{members:a.members.map(e=>e.user_id===s.id?(0,o._)({},e,n):e)})}))})}function j(e){return"chat-".concat(e)}function H(e){return"direct-message-".concat(e)}function W(e){var t,n,r,a;return(0,i._)((0,o._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(a=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==a?a:void 0})}function J(e){return!0!==e.isNew}function K(e){return!0!==e.isNew}function G(e,t){return e===t?0:!t||e&&e>t?-1:1}function Y(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),a=r.get(t);if(!a){r.set(t,e);continue}i(e)>=i(a)&&r.set(t,(0,o._)({},a,e))}return r}function Q(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!==(o=n.timestamp)&&void 0!==o?o:t;return i<e?i:e},t)}let $=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,Z.U)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,_.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:a}=e;if("deleted"===a.status){t({type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}});return}t({type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null}}})},et=e=>async t=>{var n,r;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=a.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=a.user_pub_role_object)&&void 0!==r?r:null}}})}},76819:function(e,t,n){n.d(t,{Hs:()=>a,Rx:()=>s,ye:()=>r});var o=n(7409),i=n(75561);function r(e){var t,n,o;return e.link_title||(null===(t=e.postTag)||void 0===t?void 0:t.name)||(null===(n=e.section)||void 0===n?void 0:n.name)||(null===(o=e.post)||void 0===o?void 0:o.title)||""}function a(e){var t;return e.postTag?"tag":e.section?"section":(null===(t=e.post)||void 0===t?void 0:t.type)==="page"?"page":e.post?"post":"link"}function s(e,t){let{isChatActive:n,isMeetingsActive:r,hasMultipleNewsletters:a,isChatEnabled:s,isFeedEnabled:l,isReaderReferralsLeaderboardActive:d,language:u="en",useReordering:c=!1}=t,m=e.filter(e=>!e.standard_key),_=new Map(e.filter(e=>e.standard_key).map(e=>[e.standard_key,e])),{iString:p}=I18N.i(u);for(let e of m){var h;(null===(h=e.section)||void 0===h?void 0:h.hide_from_navbar)&&(e.is_hidden=!0)}let v=[l&&{standard_key:"notes",link_title:"Notes",link_url:"/notes"},s&&{standard_key:"chat",link_title:"Chat",link_url:"/chat",is_hidden:!n},r&&{standard_key:"meetings",link_title:"Meetings",link_url:"/meetings"},...m,{standard_key:"archive",link_title:p("Archive"),link_url:"/archive"},a&&{standard_key:"newsletters",link_title:p("Newsletters"),link_url:"/newsletters",is_hidden:!0},d&&{standard_key:"leaderboard",link_title:p("Leaderboard"),link_url:"/leaderboard"},{standard_key:"about",link_title:p("About"),link_url:"/about"}].filter(e=>!!e).map(e=>{if(e.standard_key){let t=_.get(e.standard_key);if(t)return(0,i.CD)((0,o._)({},e),t)}return e});if(c){let e=["about","notes","chat","archive"];return[...v.filter(t=>!e.includes(t.standard_key||"")),...e.map(e=>v.find(t=>t.standard_key===e)).filter(e=>!!e)].filter(e=>!!e)}return v}},62515:function(e,t,n){n.d(t,{Ds:()=>l,Rm:()=>r,aD:()=>a,gp:()=>s});var o=n(14773),i=n(63651);function r(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function a(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function s(e){return(0,o.Q2)("/chat/new",e)}function l(e){let{userId:t,userName:n}=e,r=(0,i.JlE)({userId:t,userName:n});return"".concat((0,o.ZX)(),"/chat/dm/user/").concat(r)}},36515:function(e,t,n){n.d(t,{r:()=>a});var o=n(7409),i=n(99282),r=n(14773);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.Q2)("/publish/chat",(0,i._)((0,o._)({},t),{pub:e}))}}}]);