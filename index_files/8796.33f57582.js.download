"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8796"],{32440:function(t,e,r){r.d(e,{Z:()=>i});let i={bubbleStack:"bubbleStack-umAMnU",bubble:"bubble-LfInju",linkBubble:"linkBubble-t8SyEH",paywallBubble:"paywallBubble-HIFC1C",imageGroup:"imageGroup-hmX9Za",hasFooter:"hasFooter-knDZrK",body:"body-SxXE9l",authorName:"authorName-RUTp3m",facepileAvatar:"facepileAvatar-F_BcFw",outgoing:"outgoing-zRoPvi",facepile:"facepile-_l_hyN",readMore:"readMore-OS5vSy",pixels:"pixels-dEQTfm",textLink:"textLink-TnmBfo",linkImg:"linkImg-kNOnWu",linkUrl:"linkUrl-LW11wp",linkTitle:"linkTitle-oVSOfX",reactionsWrapper:"reactionsWrapper-ls9Csz",actions:"actions-QkU3dI",avatarContainer:"avatarContainer-QgIACu",highlight:"highlight-pSh3e7","highlight-animation":"highlight-animation-kGdFb4",highlightAnimation:"highlight-animation-kGdFb4",isLast:"isLast-UDCLfj",quoteBox:"quoteBox-Dcal5K",quote:"quote-IkMApN",incoming:"incoming-yrKQPL",notFirst:"notFirst-MmF7_s",author:"author-naTBRq",hasUnread:"hasUnread-p_1CFW",noUnread:"noUnread-aWF1i8",paywallReplyTag:"paywallReplyTag-AnU7qK",media:"media-H8ykdm",center:"center-F91XRK",right:"right-dRUlyN",iconOnly:"iconOnly-pLEdW7",paywallFade:"paywallFade-jjuRAC",paywallBlur:"paywallBlur-yZ2js3",paywallText:"paywallText-s4FRye"}},77859:function(t,e,r){r.d(e,{Z:()=>i});let i={messageBubbleGroup:"messageBubbleGroup-R4lEWb",bubble:"bubble-JnQPTp",isFirst:"isFirst-cID827",isLast:"isLast-YVpa0l",quote:"quote-NJ4bEy",paywallReplyTag:"paywallReplyTag-_3sIGO",outgoing:"outgoing-hqKZeu",forceIncomingTheme:"forceIncomingTheme-fBbXPp",body:"body-obaIpu",author:"author-M_vI8F","reactions-1":"reactions-1-O8o884",reactions1:"reactions-1-O8o884","reactions-2":"reactions-2-NrnldS",reactions2:"reactions-2-NrnldS","reactions-3":"reactions-3-iPVLb0",reactions3:"reactions-3-iPVLb0",youtubeIframe:"youtubeIframe-rlkjkW",highlight:"highlight-u2yyKp","highlight-animation":"highlight-animation-rBjpTz",highlightAnimation:"highlight-animation-rBjpTz",imageGroup:"imageGroup-KAnMHU bubble-JnQPTp",incoming:"incoming-jCFnDy",postImage:"postImage-eO7gd7",b4:"b4-xXB4IY",bubbs:"bubbs-qLKn32",bubb:"bubb-yci1Gp",isLink:"isLink-NGEdg6",linkImage:"linkImage-FDEYzZ",small:"small-PzwGAf",actions:"actions-utvBvN",actionsWrapper:"actionsWrapper-CEt9E2",dots:"dots-_BmXB7",dot:"dot-XjG0Z6",typing:"typing-vNx1zN",flip:"flip-OUTl4B"}},96726:function(t,e,r){r.d(e,{X:()=>s,h:()=>d});var i=r(16584),l=r(6400),a=r(98661),n=r(30396);let o=(0,l.createContext)(null);function s(t){let{root:e,children:r}=t,l=(0,n.sO)(e);return(0,i.BX)(o.Provider,{value:l,children:[r,!e&&(0,i.tZ)("div",{ref:l})]})}function d(t){let{children:e}=t,r=(0,n.qp)(o).current;return r?(0,a.createPortal)(e,r):null}},16564:function(t,e,r){r.d(e,{KH:()=>T,MR:()=>x,YX:()=>$,_g:()=>_,cM:()=>C,ko:()=>N,nO:()=>z});var i,l,a=r(7409),n=r(99282),o=r(58865),s=r(16584),d=r(94184),u=r.n(d),c=r(1852),p=r(86657);r(36081),r(36813);var m=r(99987),h=r(1055),g=r(72708),v=r(95441);r(68833);var f=r(15771),w=r(6490),b=r(84864),y=r(72925);function k(){let t=(0,o._)(["Playback rate ",""]);return k=function(){return t},t}var x=((i={}).Embed="Embed audio",i.Voiceover="Add voiceover",i.Podcast="Audio",i.PodcastPreview="Podcast free version",i.VideoPodcast="Video",i.ShareQuote="Share quote",i),_=((l={})[l.PubAccent=0]="PubAccent",l[l.PubFull=1]="PubFull",l[l.Substack=2]="Substack",l);let N=t=>{let{containerRef:e,currentTime:r,remainingTime:i,progress:l,onMouseDown:a,shouldCollapseOnMobile:n=!1,theme:o=1}=t;return(0,s.BX)("div",{className:"tw-flex tw-grow tw-items-center tw-gap-3 tw-font-meta tw-text-sm tw-text-substack-primary sm:tw-gap-3","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":100*l,children:[(0,s.tZ)("div",{className:u()("tw-min-w-[40px] tw-text-right",{"tw-hidden sm:tw-block":n}),children:r}),(0,s.BX)("div",{ref:e,className:u()("tw-relative tw-h-5 tw-grow ",{"tw-ml-2 sm:tw-ml-0":n}),onMouseDown:a,children:[(0,s.tZ)("div",{className:u()("audio-progress-bar tw-absolute tw-top-2 tw-right-0 tw-left-0 tw-h-1 tw-rounded",{"tw-bg-pub-detail":1===o,"tw-bg-substack-detail":1!==o})}),(0,s.tZ)("div",{className:u()("tw-absolute tw-top-2 tw-left-0 tw-h-1 tw-rounded-l-full",{"tw-bg-pub-accent":2!==o,"tw-bg-substack-accent":2===o}),style:{width:"".concat(100*l,"%")}}),(0,s.tZ)("div",{className:u()("audio-playhead tw-absolute tw-ml-[-10px] tw-h-4 tw-w-4 tw-rounded-full tw-border-2 tw-border-solid ",{"tw-border-pub-background":1===o,"tw-border-substack-bg":1!==o,"tw-bg-substack-accent":2===o,"tw-bg-pub-accent":2!==o}),style:{left:"".concat(100*l,"%")}})]}),(0,s.tZ)("div",{className:"tw-min-w-[40px]",children:i})]})},Z=[{value:1,display:"1"},{value:1.25,display:"1.25"},{value:1.5,display:"1.5"},{value:1.75,display:"1.75"},{value:2,display:"2"}],S=t=>{var e;let{onSetPlaybackRate:r,playbackRate:i,className:l}=t,a=Z.findIndex(t=>{let{value:e}=t;return e===i}),{iTemplate:n}=(0,v.M1)(),o=(null==Z?void 0:null===(e=Z[a])||void 0===e?void 0:e.display)?"".concat(null==Z?void 0:Z[a].display,"x"):"";return(0,s.BX)("div",{onClick:()=>{let t=(a+1)%Z.length;r(Z[t].value)},className:l,"aria-label":n(k(),o),children:[Z[a].display,"\xd7"]})},C=t=>{let{iString:e}=(0,v.M1)();return(0,s.tZ)(p.Z,(0,n._)((0,a._)({},t),{metricsPost:t.post,feature:"Embed audio",render:r=>{let{currentTime:i,isPlaying:l,progress:a,progressBarRef:n,progressBarOnMouseDown:o,remainingTime:d,playbackRate:u,setPlaybackRate:c,togglePlayback:p}=r;return(0,s.BX)("div",{"data-component-name":"AudioEmbedPlayer","data-drag-handle":"",className:"audio-embed tw-my-4 tw-box-border tw-flex tw-w-full tw-select-none tw-items-center tw-gap-4 tw-space-y-0 tw-rounded-full tw-bg-pub-wash tw-p-4 tw-font-sans sm:tw-gap-5",role:"region","aria-label":e("Audio embed player"),children:[(0,s.tZ)(S,{onSetPlaybackRate:c,playbackRate:u,className:"audio-button tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[t.label&&(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-text-pub-primary-text",children:t.label}),(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 sm:tw-gap-4",children:(0,s.tZ)(N,{currentTime:i,remainingTime:d,containerRef:n,progress:a,onMouseDown:o})})]}),(0,s.tZ)("div",{className:"audio-embed-play-button tw-relative tw-flex tw-h-12 tw-w-12 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:p,role:"button","aria-label":e("Play/pause"),children:l?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-4 tw-justify-between",children:[(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"pause-icon tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(h.Z,{className:"tw-relative tw-left-[.1rem] tw-fill-pub-accent",stroke:"none",height:18})})]})}}))},z=t=>{var e;let{pub:r,post:i,duration:l,label:a}=t,{iString:n}=(0,v.M1)();return(0,s.tZ)("table",{"data-component-name":"AudioEmbedPlayerStatic",className:"tw-w-full tw-rounded-full tw-bg-substack-wash",children:(0,s.tZ)("tr",{children:(0,s.tZ)("td",{className:"tw-text-center tw-font-meta tw-text-ssm tw-uppercase tw-text-substack-primary",children:(0,s.BX)("a",{href:null==i?void 0:i.canonical_url,className:u()("tw-block tw-w-full tw-p-4 tw-text-substack-primary",y.Z.noUnderline),children:[(0,s.tZ)(m.Z,{className:"tw-w-max-4 tw-mr-2 tw-inline-block tw-w-4 tw-align-middle",stroke:null===(e=r.theme)||void 0===e?void 0:e.background_pop_color,isStatic:!0}),(0,s.BX)("span",{className:"tw-align-middle",children:[(0,b.truncateText)(a,10)||n("Listen now")," \xb7 ",(0,b.secondsToHHMMSS)(l||0)]})]})})})})},T=t=>{let e=(0,c.useMediaQuery)({maxWidth:631}),r="/api/v1/audio/upload/".concat(t.mediaUploadId,"/src"),{iString:i}=(0,v.M1)();return(0,s.tZ)(p.Z,(0,n._)((0,a._)({},t),{src:r,feature:"Add voiceover",metricsPost:t.post,render:t=>{let{isPaywalled:r,currentTime:l,isPlaying:a,progress:n,progressBarRef:o,progressBarOnMouseDown:d,remainingTime:u,playbackRate:c,setPlaybackRate:p,togglePlayback:m}=t;return(0,s.BX)("div",{className:"tw-mb-6 tw-flex sm:tw-gap-1",children:[(0,s.tZ)("div",{className:"tw-hidden tw-h-20 tw-shrink-0 tw-basis-20 tw-items-center tw-justify-center tw-rounded-md tw-bg-pub-wash tw-fill-pub-primary-text tw-text-pub-primary-text sm:tw-flex",children:(0,s.tZ)(g.Z,{className:"tw-stroke-pub-secondary-text"})}),(0,s.BX)("div",{className:"tw-box-border tw-flex tw-h-20 tw-w-full tw-select-none tw-items-center tw-gap-3 tw-space-y-0 tw-rounded-l-md tw-rounded-r-[64px] tw-bg-pub-wash  tw-p-4 tw-font-sans",children:[r?(0,s.tZ)("div",{className:"tw-flex tw-w-full tw-flex-wrap tw-justify-center tw-text-ssm tw-text-pub-secondary-text sm:tw-text-sm",children:i("Upgrade to paid to play voiceover")}):(0,s.BX)("div",{className:"tw-flex tw-w-full tw-flex-wrap",children:[(0,s.tZ)("div",{className:"tw-basis-full tw-pb-2 tw-text-ssm tw-font-semibold tw-uppercase tw-text-pub-secondary-text",children:i("Article voiceover")}),(0,s.BX)("div",{className:"tw-flex tw-w-full tw-items-center tw-justify-between tw-gap-2 ",children:[(0,s.tZ)(S,{onSetPlaybackRate:p,playbackRate:c,className:"tw-w-12 tw-cursor-pointer tw-rounded-full tw-border tw-border-solid tw-border-pub-detail-light tw-py-1 tw-text-center tw-font-meta tw-text-sm tw-font-semibold tw-leading-none tw-text-pub-secondary-text hover:tw-border-pub-detail"}),(0,s.tZ)(N,{currentTime:l,remainingTime:u,containerRef:o,progress:n,onMouseDown:d,shouldCollapseOnMobile:!0})]})]}),r?(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-not-allowed tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid tw-border-pub-detail tw-bg-pub-background tw-transition-transform",children:(0,s.tZ)(h.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-detail",stroke:"none",height:e?20:24})}):(0,s.tZ)("div",{className:"tw-relative tw-flex tw-h-14 tw-w-14 tw-shrink-0 tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-full tw-border-2 tw-border-solid  tw-border-pub-detail tw-bg-pub-background tw-transition-transform hover:tw-scale-105",onClick:m,role:"button",children:a?(0,s.BX)("div",{className:"tw-flex tw-h-5 tw-w-5 tw-justify-between",children:[(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"}),(0,s.tZ)("div",{className:"tw-h-full tw-w-1/3 tw-rounded-sm tw-bg-pub-accent"})]}):(0,s.tZ)(h.Z,{className:"tw-relative tw-left-[.15rem] tw-fill-pub-accent",stroke:"none",height:20})})]})]})}}))},$=t=>{let{isOpen:e,onDismiss:r}=t,{iString:i}=(0,v.M1)();return(0,s.BX)(w.u_,{isOpen:e,onClose:r,children:[(0,s.tZ)(w.xB,{showClose:!1,title:i("Something went wrong...")}),(0,s.tZ)(w.fe,{children:i("Unfortunately, there was a problem with your audio file upload. We'll investigate, but in the meantime, please try again, and we apologize for the inconvenience.")}),(0,s.tZ)(w.mz,{showDivider:!1,direction:"row",primaryButton:(0,s.tZ)(f.zx,{onClick:r,priority:"primary",children:i("Got it")})})]})}},26522:function(t,e,r){r.d(e,{Y:()=>v,c:()=>g});var i=r(16584),l=r(94184),a=r.n(l),n=r(19691),o=r(13723),s=r(57336),d=r(20888),u=r(90099),c=r(71068),p=r(19081),m=r(58175),h=r(71075);let g=t=>{var e,r,l;let{disableLinks:u,isEditingCaption:g,post:v,caption:f,onEditCaption:w,onSaveCaption:b,onCancelCaption:y}=t,{publishedBylines:k,title:x,canonical_url:_,post_date:N,section_name:Z,cover_image:S,cover_image_alt:C}=v;return(0,i.BX)(p.tu,{children:[Z&&(0,i.tZ)("a",{className:a()({[null!==(e=h.Z.disableLink)&&void 0!==e?e:""]:u}),href:_,rel:"noopener",target:"_blank",children:(0,i.tZ)(m.xv.Meta,{color:"pub-primary-text",paddingBottom:8,children:Z})}),(0,i.tZ)("a",{className:a()({[null!==(r=h.Z.disableLink)&&void 0!==r?r:""]:u}),href:_,rel:"noopener",target:"_blank",children:(0,i.tZ)(m.xv.H2,{color:"pub-primary-text",children:x})}),(0,i.tZ)(s.h,{bylines:k,date:N,disableLinks:u}),S&&(0,i.tZ)(c.xu,{paddingTop:24,children:(0,i.tZ)("a",{className:a()({[null!==(l=h.Z.disableLink)&&void 0!==l?l:""]:u}),href:_,rel:"noopener",target:"_blank",children:(0,i.tZ)(d.e,{alt:null!=C?C:x,className:h.Z.fullWidth,imageProps:{height:Math.round(650),smartCrop:!0},maxWidth:1300,src:S})})}),(0,i.tZ)(p.hs,{flex:"grow",paddingTop:16,children:g&&b&&y?(0,i.tZ)(n.Z,{initialCaption:f,onCancel:y,onSave:b}):(0,i.tZ)("p",{className:h.Z.caption,dangerouslySetInnerHTML:{__html:f},onClick:w||void 0})}),(0,i.tZ)(o.$,{disableLinks:u,href:_,includeUfi:!1,post:v})]})},v=t=>{let{post:e,children:r}=t,{publishedBylines:l,title:a,canonical_url:n,post_date:p,section_name:g,cover_image:v,cover_image_alt:f}=e;return(0,i.BX)(u.i$,{children:[g&&(0,i.tZ)("a",{href:n,children:(0,i.tZ)(m.xv.Meta,{color:"pub-primary-text",paddingBottom:8,children:g})}),(0,i.tZ)("a",{href:n,children:(0,i.tZ)(m.xv.H2,{color:"pub-primary-text",children:a})}),(0,i.tZ)(s.I,{bylines:l,date:p}),v&&(0,i.tZ)(c.xu,{paddingTop:24,children:(0,i.tZ)("a",{href:n,children:(0,i.tZ)(d.e,{alt:null!=f?f:a,className:h.Z.fullWidth,imageProps:{height:Math.round(650),smartCrop:!0},maxWidth:1300,src:v})})}),(0,i.tZ)("a",{href:n,children:(0,i.tZ)(c.xu,{as:"p",children:r})}),(0,i.tZ)(o.c,{href:n})]})}},36412:function(t,e,r){r.d(e,{Z:()=>s});var i=r(7409),l=r(99282),a=r(16584),n=r(84146),o=r(64515);let s=t=>(0,a.tZ)(o.l,(0,l._)((0,i._)({},t),{name:"LucideCornerDownRight",svgParams:{height:24,width:24,fill:"#000000",strokeWidth:0},children:(0,a.tZ)(n.Z,{height:24,stroke:t.stroke,fill:t.fill,strokeWidth:t.strokeWidth})}))},51534:function(t,e,r){r.d(e,{Z:()=>s});var i=r(7409),l=r(99282),a=r(98848),n=r(16584),o=r(64515);let s=t=>{var{size:e=24,color:r="var(--color-fg-primary)",className:s}=t,d=(0,a._)(t,["size","color","className"]);return(0,n.tZ)(o.l,(0,l._)((0,i._)({},d),{name:"SkinnyLockIcon",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:e,height:e,fill:r,className:s,children:(0,n.tZ)("path",{d:"M6.63672 23.4922H17.3594C19.082 23.4922 19.9961 22.5547 19.9961 20.7031V12.6289C19.9961 10.7773 19.082 9.85156 17.3594 9.85156H6.63672C4.91406 9.85156 4 10.7773 4 12.6289V20.7031C4 22.5547 4.91406 23.4922 6.63672 23.4922ZM6.05078 10.7539H7.91406V6.79297C7.91406 3.83984 9.80078 2.26953 11.9922 2.26953C14.1836 2.26953 16.0938 3.83984 16.0938 6.79297V10.7539H17.9453V7.05078C17.9453 2.64453 15.0625 0.5 11.9922 0.5C8.93359 0.5 6.05078 2.64453 6.05078 7.05078V10.7539Z",stroke:"none"})}))}},45530:function(t,e,r){r.d(e,{Z:()=>s});var i=r(7409),l=r(99282),a=r(98848),n=r(16584),o=r(64515);let s=t=>{var{size:e=24,color:r="var(--color-fg-primary)",className:s}=t,d=(0,a._)(t,["size","color","className"]);return(0,n.tZ)(o.l,(0,l._)((0,i._)({},d),{name:"SkinnyUnlockIcon",svgParams:{viewBox:"0 0 24 24"},stroke:"none",width:e,height:e,fill:r,className:s,children:(0,n.tZ)("path",{d:"M2.5862 23.8914H13.1034C14.793 23.8914 15.6896 22.9366 15.6896 21.051V12.8282C15.6896 10.9545 14.793 9.99975 13.1034 9.99975H2.5862C0.896549 9.99975 0 10.9545 0 12.8282V21.051C0 22.9366 0.896549 23.8914 2.5862 23.8914ZM11.9885 10.9306H13.8046V6.90875C13.8046 3.88935 15.6667 2.30209 17.8161 2.30209C19.9655 2.30209 21.8275 3.88935 21.8275 6.90875V9.55818C21.8275 10.2623 22.2299 10.6203 22.7471 10.6203C23.2413 10.6203 23.6551 10.2981 23.6551 9.55818V7.15937C23.6551 2.67205 20.8161 0.5 17.8161 0.5C14.8046 0.5 11.9885 2.67205 11.9885 7.15937V10.9306Z"})}))}},67348:function(t,e,r){r.d(e,{p:()=>c});var i=r(16584),l=r(94184),a=r.n(l),n=r(85685),o=r(60807),s=r(33017),d=r(36186),u=r(22402);function c(t){let{id:e,label:r,type:l,url:a,unstyled:n}=t;return(0,i.tZ)("span",{className:"node-substack_mention",children:"pub"===l?(0,i.tZ)(m,{id:e,url:a,label:r,unstyled:n}):(0,i.tZ)(p,{id:e,label:r,unstyled:n})})}function p(t){let{id:e,label:r,unstyled:l}=t,s=(0,o.aF)(),c=s&&s.id===e;return(0,i.tZ)(n.ProfileHoverCard,{inline:!0,subject:{id:e,name:r},children:(0,i.tZ)("a",{className:a()(u.Z.mention,c&&u.Z.self,l&&u.Z.unstyled),href:(0,d.GR)(e,r),children:r})})}function m(t){let{id:e,url:r,label:l,unstyled:n}=t,d=(0,o.aF)(),c=d&&d.id===e;return(0,i.tZ)(s.Sm,{publication_id:e,inline:!0,children:(0,i.tZ)("a",{className:a()(u.Z.mention,c&&u.Z.self,n&&u.Z.unstyled),href:r,children:l})})}},12799:function(t,e,r){r.d(e,{g:()=>d});var i=r(7409),l=r(99282),a=r(16584),n=r(99869),o=r(98914),s=r(70379);function d(){let t=(0,s.pm)();return function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"link";(0,o.vQ)(e),t.popToast(t=>(0,a.tZ)(s.FN,(0,l._)((0,i._)({},t),{text:"Copied ".concat(r," to clipboard"),Icon:n.Z})))}}},57639:function(t,e,r){r.d(e,{$y:()=>h,MQ:()=>y,N9:()=>w,Nh:()=>v,RK:()=>g});var i=r(7409),l=r(94184),a=r.n(l),n=r(98661),o=r(26445),s=r(98914),d=r(60308),u=r(63651),c=r(19520),p=r(30548);let m=t=>t.attrs.fullscreen?"full":t.attrs.imageSize||"normal",h={attrs:{src:{default:""},srcNoWatermark:{default:null},fullscreen:{default:null},imageSize:{default:null},height:{default:null},width:{default:null},resizeWidth:{default:null},bytes:{default:null},alt:{default:null},title:{default:null},type:{default:null},href:{default:null},belowTheFold:{default:!1},topImage:{default:!1},internalRedirect:{default:null},isProcessing:{default:!1},align:{default:null}},inline:!1,atom:!0,group:"block",draggable:!0,selectable:!0,isolating:!0,defining:!0,parseDOM:[{tag:"p",priority:100,getAttrs:t=>{if(t.textContent.trim())return!1;let[e]=t.getElementsByTagName("img");return!!e&&v(e)}},{tag:"img[src]",getAttrs:t=>!(t.getAttribute("height")&&1>=Number(t.getAttribute("height"))||t.getAttribute("width")&&1>=Number(t.getAttribute("width")))&&v(t)}],toDOM:t=>{let{ImageActions:e}=r(55918);try{let r,i,l;let s=f(t),c=m(t),p=d.s2v.map(e=>({width:e,imageSrc:f(t,{maxWidth:e})})),h=d.s2v.map(e=>({width:e,imageSrc:f(t,{maxWidth:e,imageProps:{format:"webp"}})})),{isProcessing:g}=t.attrs;t.attrs.height&&t.attrs.width&&(r=t.attrs.height,i=t.attrs.width,t.attrs.resizeWidth?(r=t.attrs.resizeWidth*r/i,i=t.attrs.resizeWidth):x(t.attrs)&&i<d.kPM&&(r*=d.kPM/i,i=d.kPM),"full"===c&&(i=Math.min(i,d.qN9)));let v=t.attrs.width/t.attrs.height,w=t.attrs.resizeWidth?t.attrs.resizeWidth/v:t.attrs.height,b=t.attrs.resizeWidth?t.attrs.resizeWidth/w:v,y=!(t.attrs.href&&t.attrs.href!=t.attrs.src);y=(y=y&&t.attrs.height>240&&w>240)&&v<4&&b<4;let k="undefined"==typeof window;l=t.attrs.href?(0,u.chL)(t.attrs.href)?(0,d.zF4)(t.attrs.href):t.attrs.href:(0,d.zF4)(t.attrs.src);let _=document.createElement("div");if(y&&k){_.className="image-link-expand";try{_.innerHTML=(0,o.Dq)((0,n.createElement)(e,{size:20}))}catch(t){console.error("Error rendering ImageActions",t)}}return["a",{class:a()("image-link image2","left"===t.attrs.align&&"image2-align-left","right"===t.attrs.align&&"image2-align-right",y&&"is-viewable-img",g&&"processing"),target:"_blank",href:l,"data-component-name":"Image2ToDOM"},["div",{class:"image2-inset".concat("full"===c?" image2-full-screen":"")},["picture",{},["source",{type:"image/webp",srcset:h.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw"}],["img",{src:s,width:"full"===c?void 0:i,height:"full"===c?void 0:r,"data-attrs":JSON.stringify(t.attrs),class:"full"===c?"sizing-fullscreen":"large"===c?"sizing-large":"sizing-normal",alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,srcset:p.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw",loading:t.attrs.belowTheFold?"lazy":null,fetchpriority:t.attrs.topImage?"high":null}]],_]]}catch(e){return console.error("Error rendering Maximize2",e),(0,c.s)({msg:null,node:t,err:e,group:"block"})}},toDOMStatic:t=>{var e,r;let i=m(t),l=t.attrs.href||t.attrs.internalRedirect||(0,d.zF4)(t.attrs.src,void 0,{quality:"normal"===i?"auto:good":"auto:best"});if(t.attrs.height&&t.attrs.width&&"full"!==i){let{width:e,height:r}=t.attrs,i=e;t.attrs.resizeWidth?i=t.attrs.resizeWidth:x(t.attrs)&&(i=Math.min(Math.max(e,d.kPM),d.JWy));let a=Math.min(i,d.bxL),n=r*a/e,o=i>d.bxL,s={"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:a,height:n,class:o?"wide-image":"",src:(0,d.zF4)(t.attrs.src,Math.min(!x(t.attrs)&&o?2*i:i,2*d.bxL),{lossy:k(t.attrs)})};return["table",{class:"image-wrapper",width:"100%",border:"0",cellSpacing:"0",cellPadding:"0","data-component-name":"Image2ToDOMStatic"},["tr",{},["td"],["td",{align:"left",class:"content",width:i},["a",{class:"image-link",target:"_blank",href:l},["img",s]]],["td"]]]}return"full"===i?["a",{class:"image-link",target:"_blank",href:l},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs),crop:"limit",aspect:"full"===i?"1":void 0}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,height:t.attrs.height,width:t.attrs.width}]]:["a",{class:"image-link",target:"_blank",href:l},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs)}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:t.attrs.resizeWidth||t.attrs.width,height:t.attrs.resizeWidth?(e=t.attrs.width,r=t.attrs.height,r*t.attrs.resizeWidth/e):t.attrs.height}]]}},g=(0,p.S)({name:"image2",nodeSpec:h}),v=function(t,e){let r,i,l,{bytes:a,internalRedirect:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.getAttribute("data-attrs");if(o)try{return JSON.parse(o)}catch(t){}t.getAttribute("imageSize")&&(r=t.getAttribute("imageSize"));let s=t.getAttribute("style");if(s){let t=/max-height:\s*(\d+)px/.exec(s);t&&(i=Number(t[1]));let e=/max-width:\s*(\d+)px/.exec(s);e&&(l=Number(e[1]))}else t.getAttribute("width")&&t.getAttribute("height")&&(i=Number(t.getAttribute("height")),l=Number(t.getAttribute("width")));return t.complete&&t.naturalHeight&&t.naturalWidth&&(i=t.naturalHeight,l=t.naturalWidth),{src:(0,d.UH4)(t.getAttribute("data-medium-file")||t.getAttribute("src")),type:e,title:t.getAttribute("title"),alt:t.getAttribute("alt"),height:i,width:l,bytes:a,internalRedirect:n,imageSize:r,href:t.getAttribute("href"),align:t.getAttribute("align")}},f=function(t){let{maxWidth:e=null,imageProps:r={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=m(t),a="full"===l?2*d.hI6:"large"===l?2*d.urw:2*d.qN9;return e&&(a=Math.min(e,a)),(0,d.zF4)(t.attrs.src,a,(0,i._)({lossy:k(t.attrs)},r))},w=function(t){var e;let{customSchema:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&!r.nodes.image2)return null;let i=/(https?:\/\/(giphy\.com\/gifs|gph.is\/g|media\d*\.giphy\.com\/media)\/[^\s]+)/.exec(t);return null!==(e=i&&i[1])&&void 0!==e?e:null},b=async t=>{let e=(await Promise.resolve().then(r.t.bind(r,80569,23))).default,i="image/gif",l=await e.get("/api/v1/giphy").query({url:t});return v(await new Promise(t=>(0,s.pt)(f({attrs:{type:i,src:l.body.url}}),t)),i,{bytes:l.body.bytes})},y=async function(t){let{customSchema:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e?{schema:e}:await Promise.resolve().then(r.bind(r,37175))).schema.nodes.image2.create(await b(t))};function k(t){return x(t)&&(!t.bytes||t.bytes>5e6)}function x(t){return!!(t.type&&"image/gif"===t.type||t.src&&t.src.split("?")[0].split("#")[0].endsWith(".gif"))}},37175:function(t,e,r){r.r(e),r.d(e,{EMPTY_DOC:()=>eu,HEADER_IMAGE_ATTRS_FROM_NODE_TYPE:()=>ec,addIdsToHeaders:()=>eB,checkForUnpublishableComments:()=>e0,checkForUnsafeLinks:()=>e1,createStringDoc:()=>e8,customMediaNodes:()=>em,documentToHtml:()=>eA,extractTags:()=>eL,fromHtml:()=>eE,getCoverImage:()=>ej,getCoverImages:()=>eG,getDefaultPodcastDescriptionWithoutFeedCTAs:()=>e5,getDescription:()=>eV,getDimensionsFromImageUrl:()=>ed,getFirstImageFromBody:()=>eJ,getHeaderImageFromBody:()=>eX,getImageUrlsFromPostBody:()=>eq,getImagesFromBody:()=>eR,getLinks:()=>eQ,getPreviewImageUrl:()=>eK,hasExplicitPaywall:()=>e3,migrateMarkdown:()=>eD,migratePost:()=>eU,migrateProsemirrorToTiptap:()=>eC,migratePublication:()=>eH,migrateTiptapToProsemirror:()=>ez,nodeToHtml:()=>eF,normalizeDbPodcastDescriptionToHtmlString:()=>e4,purgeUnsafeLinks:()=>e2,schema:()=>ef,schemaStatic:()=>ew,serializeDoc:()=>eP,serializedToPodcastDescription:()=>eW,setBelowTheFoldAttribute:()=>e9,setButtonActions:()=>eY,tipTapNodes:()=>e_,tipTapSchema:()=>eN,toHtml:()=>eI,toText:()=>eO,trackedCustomNodes:()=>eg,unserializeDoc:()=>e$,unserializeDocAsync:()=>eM,unserializeJson:()=>eT});var i=r(7409),l=r(99282),a=r(88897),n=r(19512),o=r(56070),s=r(18490),d=r(24717),u=r(56782),c=r(43557),p=r(99961),m=r(18e3),h=r(51127),g=r(67338),v=r(75481),f=r(55786),w=r(32018),b=r(91077),y=r(87597),k=r(94886),x=r(99218),_=r(55963),N=r(21803),Z=r(76405),S=r(39693),C=r.n(S),z=r(14293),T=r.n(z),$=r(44908),M=r.n($),P=r(60826),F=r(24791),A=r(40121),B=r(5889),I=r(60308),O=r(84864),W=r(5835),L=r(26603),E=r(57937),D=r(55633),U=r(1451),H=r(44262),V=r(41676),j=r(82032),R=r(95068),J=r(12568),X=r(65626),q=r(37622),G=r(36621),K=r(31188),Y=r(71993),Q=r(88954),tt=r(13991),te=r(36122),tr=r(72270),ti=r(82167),tl=r(47456),ta=r(32978),tn=r(40924),to=r(86725),ts=r(59383),td=r(5660),tu=r(1415),tc=r(98616),tp=r(82708),tm=r(73984),th=r(11105),tg=r(10218),tv=r(98738),tf=r(81519),tw=r(59662),tb=r(75837),ty=r(29961),tk=r(24653),tx=r(80334),t_=r(94413),tN=r(75970),tZ=r(715),tS=r(87113),tC=r(98450),tz=r(87413),tT=r(69323),t$=r(61601),tM=r(57639),tP=r(54793),tF=r(29511),tA=r(49640),tB=r(99975),tI=r(41128),tO=r(23431),tW=r(73078),tL=r(85197),tE=r(53797),tD=r(99741),tU=r(3185),tH=r(18119),tV=r(44288),tj=r(13938),tR=r(54757),tJ=r(11006),tX=r(11470),tq=r(66928),tG=r(19805),tK=r(46393),tY=r(2107),tQ=r(99149),t0=r(79592),t1=r(62645),t2=r(39111),t9=r(42034),t4=r(41505),t5=r(57950),t8=r(78483),t3=r(57881),t6=r(84766),t7=r(62092),et=r(68303),ee=r(88956),er=r(22498),ei=r(22365),el=r(60802),ea=r(45913),en=r(12076),eo=r(34612),es=r(32751);let ed=t=>{var e,r,i,l;let[a,n]=((null===(l=t.split("_"))||void 0===l?void 0:null===(i=l[1])||void 0===i?void 0:null===(r=i.split("."))||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.split("x"))||[0,0]).map(Number);return{width:a,height:n}},eu={type:"doc",content:[{type:"paragraph"}]},ec={captionedImage:t=>{var e,r,i,l;let a=null===(e=t.content)||void 0===e?void 0:e.find(t=>{var e,r;return"image2"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.width)>=300&&(null==t?void 0:null===(r=t.attrs)||void 0===r?void 0:r.height)>=300});if(!a)return{url:null,caption:void 0,alt:void 0};let n=null==t?void 0:null===(r=t.content)||void 0===r?void 0:r.find(t=>"caption"===t.type);return{url:null==a?void 0:null===(i=a.attrs)||void 0===i?void 0:i.src,caption:n,alt:null==a?void 0:null===(l=a.attrs)||void 0===l?void 0:l.alt}},image2:t=>{var e,r,i,l;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?{url:null==t?void 0:null===(i=t.attrs)||void 0===i?void 0:i.src,alt:null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:l.alt}:{url:null,caption:void 0,alt:void 0}},image3:t=>{var e,r,i,l,a;let n=ed(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||n.width>=300&&n.height>=300?{url:null===(l=t.attrs)||void 0===l?void 0:l.src,caption:t.content,alt:null===(a=t.attrs)||void 0===a?void 0:a.alt}:{url:null,caption:void 0,alt:void 0}}},ep={image:t=>{var e;return eK(null===(e=t.attrs)||void 0===e?void 0:e.src)},image2:t=>{var e,r,i;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?eK(null===(i=t.attrs)||void 0===i?void 0:i.src):null},image3:t=>{var e,r,i,l;let a=ed(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||a.width>=300&&a.height>=300?eK(null===(l=t.attrs)||void 0===l?void 0:l.src):null},imageGallery:t=>{var e,r,i;return eK(null===(i=t.attrs)||void 0===i?void 0:null===(r=i.gallery.images)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.src)},spotify:t=>{var e;return eK(null===(e=t.attrs)||void 0===e?void 0:e.image)},spotify2:t=>{var e;return eK(null===(e=t.attrs)||void 0===e?void 0:e.image)},opensea:t=>{var e;return eK(null===(e=t.attrs)||void 0===e?void 0:e.image)},twitter2:t=>{var e,r;if(null===(e=t.attrs)||void 0===e?void 0:e.photos){for(let e of t.attrs.photos)if(e.img_url)return eK(e.img_url)}return(null===(r=t.attrs)||void 0===r?void 0:r.expanded_url)&&t.attrs.expanded_url.image?t.attrs.expanded_url.image.url?eK(t.attrs.expanded_url.image.url):eK(t.attrs.expanded_url.image):null},vimeo:t=>{var e;return ea.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube:t=>{var e;return es.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube2:t=>{var e;return es.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},kindle:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},applePodcast:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},tiktok:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},prediction_market:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},manifold:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},lichess:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},datawrapper:t=>{var e;return(0,I.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)}},em={augmentation_placeholder:U.$,youtube2:es.$y,youtube:eo.$,vimeo:ea.$y,install_substack_app:tA.$,preview_in_substack_app:tR.$,opensea:tE.$y,twitter2:t6.$y,twitter:t3.$,communityChat:Q.$y,communityPost:tt.$y,comment:Y.$y,spotify2:t0.$y,spotify:tQ.$,soundcloud:tK.$y,instagram:tF.$y,image2:tM.$y,image:tT.$,button:R.$y,comic:K.Z.nodeSpec,file:K.Z.nodeSpec,pdf:tU.Z.nodeSpec,xlsx:en.Z.nodeSpec,ebook:ta.Z.nodeSpec,referral_link:tq.$,bandcamp:H.$y,kindle:tB.$y,gitgist:tz.$y,embeddedPost:tn.$y,embeddedPublication:to.$y,applePodcast:W.$y,audio:E.$y,video:el.$,audioUrl:D.$y,tiktok:t8.$y,bluesky:j.$y,poll:tH.$,sponsorshipCampaign:tY.$,imageGallery:t$.$y,image3:tP.$y,cashtag:G.$,substack_mentions:tL.$,prediction_market:tV.$y,manifold:tV.$y,lichess:tO.$y,datawrapper:tr.$y,digestPostEmbed:ti.$y,assetError:L.$,directMessage:tl.$y,recipe:tX.$},eh=(0,l._)((0,i._)({},em),{blockquote:V.$,fragmentNode:tC.$,captionedImage:q.$,caption:J.$,ctaCaption:te.$,footnote:tZ.$,footnoteAnchor:tS.$,latex_block:tI.$y,paywall:tD.$,preformatted_text_block:tj.$,pullquote:tJ.$,subscribeWidget:t2.$,captionedShareButton:(0,X.$y)({url:P.W.SHARE_URL}),captionedWriterReferralButton:(0,X.$y)({hasDynamicSubstitutions:!1}),templateComment:t5.$,meeting:tW.$,referralTier:tG.$y}),eg=(0,l._)((0,i._)({},em),{subscribeWidget:t2.$,paywall:tD.$,templateComment:t5.$}),ev={strikethrough:t1.J,superscript:t4.O,subscript:t9.l},ef=new Z.V_({nodes:eZ(),marks:eS()}),ew=new Z.V_({nodes:eZ({isStatic:!0}),marks:eS({isStatic:!0})}),eb=Object.keys(eh).filter(t=>!["blockquote","pullquote"].includes(t)).map(t=>{let e=(0,et.Co)(t,eh[t]),r=(0,i._)({},eh[t],e);return"youtube2"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new es.dQ(e)}:"tiktok"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new t8.QZ(e)}:"lichess"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tO.$1(e)}:"datawrapper"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tr.s3(e)}:"prediction_market"===t||"manifold"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tV.eC(e)}:"paywall"===t?r.addNodeView=()=>t=>new tD.b:"latex_block"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tI.Jd(e)}:"comic"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return K.Z.getNodeView({node:e,editor:r,getPos:i})}:"pdf"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return tU.Z.getNodeView({node:e,editor:r,getPos:i})}:"xlsx"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return en.Z.getNodeView({node:e,editor:r,getPos:i})}:"ebook"===t&&(r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return ta.Z.getNodeView({node:e,editor:r,getPos:i})}),a.NB.create(r)}),ey=n.V6.extend({addCommands(){return{toggleBlockquote:()=>t=>{let{state:e,commands:r}=t;return!(!(0,a.Ig)(e,"paragraph")||(0,a.Ig)(e,"pullquote"))&&r.toggleWrap(this.name)}}},parseHTML:()=>V.$.parseDOM}),ek=g.b.extend({addCommands:()=>({insertHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;return r&&e.schema.nodes.horizontalRule&&r((0,et.o4)(e,e.schema.nodes.horizontalRule.create())),!0},setHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;return r&&r((0,et.o4)(e,e.schema.nodes.horizontalRule.create())),!0}})}),ex=u.dn.extend({marks:"_"}),e_=[ey,o.d8,s.DY,td.z,d.EK,ex,tc.l,c.B,tm.w,p.U,m.X,h.A,ek,ts.M,tN.f,tg._,tf.r,tb.q,tx.a,ty.R,th.y,v.Tx,tv.d,f.H,w.GS,b.n,tw.f,tJ.z,y.Re,k.a,x.$,_.x,tu.n,t_.T,tp.k,tl.e1,...eb],eN=(0,a.J1)(e_);function eZ(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=N.fK.spec.nodes;for(let r of Object.keys(eh)){let i=Object.assign({},eh[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eS(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=N.fK.spec.marks;for(let r of Object.keys(ev)){let i=Object.assign({},ev[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eC(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eT(i,{postId:e,pubId:r})),(0,et.cb)(i,t=>{let e=et.qj.find(e=>e[0]===t.type);return e&&(t.type=e[1],t.attrs&&"orderedList"===e[1]&&(t.attrs.start=t.attrs.order)),t.marks&&t.marks.forEach(t=>{let e=et.PH.find(e=>e[0]===t.type);e&&(t.type=e[1])}),t}),i}function ez(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eT(i,{postId:e,pubId:r})),(0,et.cb)(i,t=>{let e=et.qj.find(e=>e[1]===t.type);return e&&(t.type=e[0],t.attrs&&"ordered_list"===e[0]&&(t.attrs.order=t.attrs.start)),t.marks&&t.marks.forEach(t=>{let e=et.PH.find(e=>e[1]===t.type);e&&(t.type=e[0])}),t}),i}function eT(t){let e,{postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&(t=(t=t.replace("http://substack-post-media","https://substack-post-media")).replace("http://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984","https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984")),t=eD(t))try{e=JSON.parse(t)}catch(e){console.error("unserializeJson for post [".concat(r,"], pubId [").concat(i,"], could not parse serialized:"),t,e)}return null!=e?e:void 0}function e$(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:a,postId:n,pubId:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=eT(t,{postId:n,pubId:o})||eu;i&&i(a);let s=e2(a);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return l&&(d=e9(d)),d=r?eC(d,{postId:n,pubId:o}):ez(d,{postId:n,pubId:o}),(e||ef).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(n,"], serialized:"),t,r),a)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ef).nodeFromJSON(eu)}}async function eM(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:a,postId:n,pubId:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=eT(t,{postId:n,pubId:o})||eu;i&&await i(a);let s=e2(a);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return l&&(d=e9(d)),d=r?eC(d,{postId:n,pubId:o}):ez(d,{postId:n,pubId:o}),(e||ef).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(n,"], serialized:"),t,r),a)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ef).nodeFromJSON(eu)}}function eP(t){let{runMigrations:e=!1,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=t.toJSON();return e&&(l=ez(l=e2(l=function(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="string"==typeof t?eT(t,{postId:e}):t;return(0,et.cb)(r,t=>{t.text&&(t.text=(0,O.stripInvalidBytes)(t.text))},{nodeTypes:["text"]}),r}(l)),{postId:r,pubId:i})),JSON.stringify(l)}function eF(t,e){let r=document.createElement("div");return r.appendChild(Z.PW.fromSchema(e?ew:ef).serializeFragment([t],{document})),r}function eA(t){return Z.PW.renderSpec(document,t).dom.outerHTML}function eB(t){Array.from(t.querySelectorAll("h2, h3, h4, h5, h6")).forEach(t=>{if(!t.getAttribute("id")){var e,r;let i=(r=t.textContent||"",(0,A.Hm)((0,O.truncateText)(r,500,{ellipsis:""}),{allowUnicode:!0})),l=document.createElement("div");l.setAttribute("id",i),l.setAttribute("class","anchor-target"),null===(e=t.parentNode)||void 0===e||e.insertBefore(l,t);let a=document.createElement("a");for(a.setAttribute("href","#".concat(i));t.firstChild;)a.appendChild(t.firstChild);t.appendChild(a)}})}function eI(t,e){let{isAmp:r,transform:i,useTipTap:l,pubId:a,postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(l){let r=eC(eT(t,{postId:n,pubId:a}),{postId:n,pubId:a});if(!r)throw Error("could not serialize json doc");return(0,ei.e)({doc:r,extensions:(0,tk.p)({isStatic:null!=e&&e}),customDocument:document})}let o=e$(t,{shouldSetBelowTheFoldAttribute:!0,postId:n,pubId:a}),s=Z.PW.fromSchema(e?ew:ef),d=document.createElement("div");try{s.serializeFragment(o.content,{document},d)}catch(t){return console.error("could not serialize fragment, for pubId [".concat(a,"], postId [").concat(n,"]"),t),d.innerHTML}return i&&i(d),r&&function(t){Array.from(t.querySelectorAll("img")).forEach(t=>{let e=document.createElement("amp-img");e.setAttribute("layout","intrinsic"),t.getAttributeNames().forEach(r=>{"srcset"!==r&&e.setAttribute(r,t.getAttribute(r))}),t.replaceWith(e)})}(d),d.innerHTML}function eO(t,e){let{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,et.lr)(e$(t,{postId:r}),e)}function eW(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,et.fX)(e$(t,{postId:e}))}function eL(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,et.E5)(e$(t,{postId:e}))}function eE(t){let{stripEmptyParagraphs:e,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=Z.aw.fromSchema(ef).parse(new DOMParser().parseFromString(t,"text/html"));return(e&&(l=(0,ee.Y)(l,t=>!t.type||"paragraph"!==t.type.name||!!(0,et.lr)(t))),l)?eP(l,{postId:r,pubId:i}):null}function eD(t){return t&&"{"!==t[0]&&"null"!==t?eP(N.EU.parse(t)):t}function eU(t){var e,r;return t.body=null!==(e=eD(t.body))&&void 0!==e?e:null,t.draft_body=null!==(r=eD(t.draft_body))&&void 0!==r?r:null,t}function eH(t){var e,r,i,l,a;return t.subscribe_content=null!==(e=eD(t.subscribe_content))&&void 0!==e?e:null,t.welcome_email_content=null!==(r=eD(t.welcome_email_content))&&void 0!==r?r:null,t.tos_content=null!==(i=eD(t.tos_content))&&void 0!==i?i:null,t.privacy_content=null!==(l=eD(t.privacy_content))&&void 0!==l?l:null,t.disclosures_content=null!==(a=eD(t.disclosures_content))&&void 0!==a?a:null,t}function eV(t,e){let{post:r=null,pubId:i,minCharacters:l=6,maxStopAfter:a=null,singleSentence:n=!0,language:o="en",excludeMediaPrefix:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:d}=I18N.i(o),u=(null==r?void 0:r.type)==="thread"?145:250;(a||0===a)&&(u=Math.min(a,u));let c=(null==r?void 0:r.type)==="thread",p="";if(e)p+=e;else if(0!==u){var m;let e={paragraph:!0,blockquote:!0,list_item:!0,listItem:!0,heading:!0,code_block:!0,codeBlock:!0,hardbreak:!0,hard_break:!0,hardBreak:!0},a={caption:!0,footnote:!0};(0,et.cb)("string"==typeof t?eT(t,{postId:null!==(m=null==r?void 0:r.id)&&void 0!==m?m:null,pubId:i}):t,t=>{if(u&&p.length>=u||t.type&&a[t.type])return!1;if("text"===t.type){let{text:e}=t;if(e){let t=e.match(/[\.\?\!] /);if(n&&(null==t?void 0:t.index))return p+=e.slice(0,t.index+1),er.aT;p+=e}}else if(t.type&&e[t.type]&&p){if(p.length>l)return er.aT;" "!==p[p.length-1]&&(p+=" ")}else if("substack_mentions"===t.type){var r,i;p+=null!==(i=null===(r=t.attrs)||void 0===r?void 0:r.name)&&void 0!==i?i:""}})}if(p=p.replace(/\s+/g," ").trim(),c&&u&&p.length>=u&&(p=(0,O.truncateText)(p,u)),((null==r?void 0:r.type)==="podcast"||(null==r?void 0:r.type)==="video")&&!s){let t=(0,F.XV)(r);p="".concat(d((null==r?void 0:r.type)==="video"||(null==r?void 0:r.videoUpload)?"Watch now":"Listen now")," ").concat(t?"(".concat((0,O.secondsToLargestUnit)(t,{minutesCutoff:10800,language:o}),") "):"","| ").concat(p)}return p}function ej(t,e){var r;return null!==(r=eG(t,e)[0])&&void 0!==r?r:null}function eR(t){let{postId:e,pubId:r,width:i,height:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=eT(t,{postId:e,pubId:r});return a?M()(C()((0,et.fp)(a,t=>{var e;return!!ep[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;let a=null===(e=ep[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(ep,t);return a?(0,I.zF4)(a,i,{height:l}):null}))):[]}function eJ(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=eR(t,{postId:e,pubId:r});return i.length>0&&!T()(i[0])?i[0]:null}function eX(t){let{body:e}=t,r=eT(e);if(r)return(0,et.fp)(r,t=>{var e;return!!ec[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;return null===(e=ec[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(ec,t)})[0]}async function eq(t){let{body:e,postId:r}=t,i=e$(e,{postId:r}),l=[];return(0,et.je)(i,t=>{switch(t.type.name){case"image":case"image2":t.attrs.src&&l.push(t.attrs.src);break;case"imageGallery":var e;null===(e=t.attrs.gallery.images)||void 0===e||e.map(t=>{t.src&&l.push(t.src)})}}),l}function eG(t,e){var r;let i=[];"podcast_episode_image_info"in e&&e.podcast_episode_image_info&&!e.podcast_episode_image_info.isDefaultArt&&i.unshift(e.podcast_episode_image_info.url),i.unshift(...eR(t,{postId:e.id}));let l="podcastUpload"in e&&e.podcastUpload||"draftPodcastUpload"in e&&e.draftPodcastUpload||void 0;if((null==l?void 0:l.state)==="transcoded"&&(null!==(r=null==l?void 0:l.thumbnail_id)&&void 0!==r?r:1)>1){let t=(0,I.ow1)(l);t&&i.unshift(t)}let a="videoUpload"in e&&e.videoUpload||"draftVideoUpload"in e&&e.draftVideoUpload||void 0;if((null==a?void 0:a.state)==="transcoded"){let t=(0,I.ow1)(a);t&&i.unshift(t)}return"podcast_art_url"in e&&e.podcast_art_url&&i.unshift(e.podcast_art_url),i}function eK(t){return"string"!=typeof t?null:(t=t.replace(/\/l_twitter_play_button_rvaygk[^\/]+/g,""),(0,I.zF4)(t,void 0,{height:600}))}function eY(t){(0,et.cb)(t,t=>{var e;return"button"===t.type&&((null===(e=t.attrs)||void 0===e?void 0:e.url)&&"string"==typeof t.attrs.url&&t.attrs.url.startsWith("%%")&&(t.attrs.action=t.attrs.url.replace(/%%/g,"")),!0)},{nodeTypes:"button"})}function eQ(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return[];r=t}eY(r);let i=[];return(0,et.cb)(r,t=>{var e,r,l;if("button"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.url)&&!t.attrs.action)i.push({text:t.attrs.text,url:t.attrs.url});else if("image2"===t.type&&(null===(r=t.attrs)||void 0===r?void 0:r.href))i.push({text:t.attrs.href,url:t.attrs.href});else if(t.marks){for(let e of t.marks)if("link"===e.type&&(null===(l=e.attrs)||void 0===l?void 0:l.href)){i.push({text:t.text,url:e.attrs.href});break}}}),i}function e0(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return!1;r=t}return!!(0,et.DY)(r,t=>"templateComment"===t.type)}function e1(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eT(r,{postId:e});if(!t)return!1;r=t}return!!(0,et.DY)(r,t=>{for(let o of["href","src","url"]){var e,r,i,l,a,n;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!0}return!1})}function e2(t){let e,{postId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){let i=eT(t,{postId:r});if(!i)return null;e=i}else e=t;return(0,t7.f5)(e)?(0,ee.Y)(e,t=>{for(let o of["href","src","url"]){var e,r,i,l,a,n;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!1}return!0}):(0,ee.Y)(e,t=>{for(let o of["href","src","url"]){var e,r,i,l,a,n;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(n=t.marks)||void 0===n?void 0:n.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[o])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!1}return!0})}function e9(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="string"==typeof t?eT(t,{postId:r}):t;if(!i)return;let l=!1;return"doc"===i.type&&i.content&&i.content.map((t,r)=>{r>e?(0,et.cb)(t,t=>{!t.content&&t.attrs&&(t.attrs.belowTheFold=!0)}):l||(0,et.cb)(t,t=>{!t.content&&(null==t?void 0:t.type)=="image2"&&t.attrs&&(t.attrs.topImage=!0,l=!0)})}),i}function e4(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return JSON.parse(t),eW(t,{postId:e})}catch(e){return t}}function e5(t,e){let{body:r,hasPodcastPreview:i}=e;if(!t||!r)return null;let l=r;return i&&(l=JSON.stringify((0,et.N5)(eT(r,{postId:t.id}),{maxLength:t.post_preview_limit?t.post_preview_limit:356}))),eW(l,{postId:t.id})}function e8(t){return eP(ef.node("doc",null,t.split("\n").map(t=>t.trim()).filter(t=>t.length>0).map(t=>{let e=[],r=(0,B.m)(t);if(r.length>0){let i=t;for(;;){let t=r.map(t=>[i.indexOf(t.value),t.value]).sort().find(t=>{let[e]=t;return e>=0});if(!t)break;let[l,a]=t;l>0&&e.push(ef.text(i.substring(0,l))),e.push(ef.text(a,[ef.marks.link.create({title:a,href:a,target:"_blank"})])),i=i.substring(l+a.length)}i&&e.push(ef.text(i))}else e.push(ef.text(t));return ef.node("paragraph",null,e)})))}function e3(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof t){let i=eT(t,{postId:e});if(!i)return!1;r=i}else r=t;return(0,et.C4)(r)}Object.entries(eN.nodes).forEach(t=>{let[e,r]=t;void 0!==eh[e]&&(r.spec=(0,i._)({},eh[e],r.spec))})}}]);